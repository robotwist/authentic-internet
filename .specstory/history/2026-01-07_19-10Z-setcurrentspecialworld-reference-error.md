<!-- Generated by SpecStory, Markdown v2.1.0 -->

<!-- cursor Session 4623bede-4779-4ca7-8ddf-20d0959de5e3 (2026-01-07 19:10Z) -->

# SetCurrentSpecialWorld reference error (2026-01-07 19:10Z)

_**User (2026-01-07 03:53Z)**_

ReferenceError: setCurrentSpecialWorld is not defined
    at http://localhost:5177/src/components/GameWorld.jsx?t=1767812807584:97:45
    at ErrorBoundary (http://localhost:5177/src/components/ErrorBoundary.jsx:8:5)
    at Suspense
    at RenderedRoute (http://localhost:5177/node_modules/.vite/deps/react-router-dom.js?v=ce3ce900:4089:5)
    at Routes (http://localhost:5177/node_modules/.vite/deps/react-router-dom.js?v=ce3ce900:4559:5)
    at main    Find problems associated with this one and correct. We seem to have run into a constellation

---

_**Agent (model default, mode Agent)**_



---


Checking `GameWorld.jsx` around line 97 to identify the `setCurrentSpecialWorld` error and related issues.


---

<tool-use data-tool-type="read" data-tool-name="read_file">
<details><summary>Tool use: **read_file** • Read file: /home/robwistrand/code/ga/projects/authentic-internet/client/src/components/GameWorld.jsx</summary>

</details>
</tool-use>

---

<tool-use data-tool-type="search" data-tool-name="grep">
<details>
<summary>Tool use: **grep** • Grep for "setCurrentSpecialWorld" in "/home/robwistrand/code/ga/projects/authentic-internet/client/src/components" • 24 matches</summary>

Output mode: content


| File | Content | Line |
|------|------|------|
| `client/src/components/GameWorld.jsx` | `setCurrentSpecialWorld(destinationMap);` | L610 |
| `client/src/components/GameWorld.jsx` | `setCurrentSpecialWorld,` | L669 |
| `client/src/components/GameWorld.jsx` | `setCurrentSpecialWorld("terminal");` | L1019 |
| `client/src/components/GameWorld.jsx` | `setCurrentSpecialWorld("shooter");` | L1021 |
| `client/src/components/GameWorld.jsx` | `setCurrentSpecialWorld("text_adventure");` | L1023 |
| `client/src/components/GameWorld.jsx` | `setCurrentSpecialWorld("terminal");` | L1277 |
| `client/src/components/GameWorld.jsx` | `setCurrentSpecialWorld("shooter");` | L1279 |
| `client/src/components/GameWorld.jsx` | `setCurrentSpecialWorld("text_adventure");` | L1281 |
| `client/src/components/GameWorld.jsx` | `setCurrentSpecialWorld,` | L1997 |
| `client/src/components/GameWorld.jsx` | `setCurrentSpecialWorld("hemingway");` | L2150 |
| `client/src/components/GameWorld.jsx` | `setCurrentSpecialWorld("text_adventure");` | L2153 |
| `client/src/components/GameWorld.jsx` | `[updateUIState, setCurrentSpecialWorld],` | L2161 |
| `client/src/components/GameWorld.jsx` | `setCurrentSpecialWorld(null);` | L2166 |
| `client/src/components/GameWorld.jsx` | `\}, [setCurrentSpecialWorld, updateUIState]);` | L2172 |
| `client/src/components/GameWorld.jsx` | `setCurrentSpecialWorld(null);` | L2175 |
| `client/src/components/GameWorld.jsx` | `\}, [setCurrentSpecialWorld]);` | L2176 |
| `client/src/components/GameWorld.jsx` | `setCurrentSpecialWorld(null);` | L2179 |
| `client/src/components/GameWorld.jsx` | `\}, [setCurrentSpecialWorld, updateUIState]);` | L2185 |
| `client/src/components/GameWorld.jsx` | `setCurrentSpecialWorld(null);` | L2192 |
| `client/src/components/GameWorld.jsx` | `\}, [setCurrentSpecialWorld, updatePortalState]);` | L2193 |
| `client/src/components/GameWorld.jsx` | `setCurrentSpecialWorld(null);` | L2624 |
| `client/src/components/GameWorld.jsx` | `setCurrentSpecialWorld(null);` | L2635 |
| `client/src/components/GameWorld.jsx` | `setCurrentSpecialWorld(null);` | L2664 |
| `client/src/components/GameWorld.jsx` | `setCurrentSpecialWorld(null);` | L2675 |


</details>
</tool-use>

---

<tool-use data-tool-type="search" data-tool-name="grep">
<details>
<summary>Tool use: **grep** • Grep for "currentSpecialWorld" in "/home/robwistrand/code/ga/projects/authentic-internet/client/src/components" • 7 matches</summary>

Output mode: content


| File | Content | Line |
|------|------|------|
| `client/src/components/GameWorld.jsx` | `\{currentSpecialWorld === "text_adventure" && (` | L3350 |
| `client/src/components/GameWorld.jsx` | `\{gameState.currentSpecialWorld === "textAdventure" && (` | L3370 |
| `client/src/components/GameWorld.jsx` | `\{currentSpecialWorld === "terminal" && (` | L3378 |
| `client/src/components/GameWorld.jsx` | `\{currentSpecialWorld === "shooter" && (` | L3389 |
| `client/src/components/GameWorld.jsx` | `\{currentSpecialWorld === "hemingway" && (` | L3400 |
| `client/src/components/GameWorld.jsx` | `\{/* Debug overlay to show currentSpecialWorld state */\}` | L3443 |
| `client/src/components/GameWorld.jsx` | `currentSpecialWorld: "\{gameState.currentSpecialWorld\}"` | L3458 |


</details>
</tool-use>

---



---


Checking the `useGameState` hook and reviewing the surrounding code to understand how `setCurrentSpecialWorld` should be defined:


---

<tool-use data-tool-type="read" data-tool-name="read_file">
<details><summary>Tool use: **read_file** • Read file: /home/robwistrand/code/ga/projects/authentic-internet/client/src/components/GameWorld.jsx</summary>

</details>
</tool-use>

---

<tool-use data-tool-type="read" data-tool-name="read_file">
<details><summary>Tool use: **read_file** • Read file: /home/robwistrand/code/ga/projects/authentic-internet/client/src/components/GameWorld.jsx</summary>

</details>
</tool-use>

---

<tool-use data-tool-type="search" data-tool-name="codebase_search">
<details>
                <summary>Tool use: **codebase_search** • Searched codebase "What does useGameState hook return? What is setCurrentSpecialWorld?" • **13** results</summary>
            
| File | Lines |
|------|-------|
| `client/src/hooks/useGameState.js` | L214-512 |
| `client/src/hooks/useGameState.js` | L299-514 |
| `client/src/hooks/useGameState.js` | L75 |
| `client/src/hooks/useGameState.js` | L78-299 |
| `client/src/hooks/useGameState.js` | L5-299 |
| `client/src/context/GameStateContext.jsx` | L171-208 |
| `client/src/hooks/useGameState.js` | L299-512 |
| `client/src/hooks/useGameState.js` | L5-211 |
| `client/src/context/GameStateContext.jsx` | L34 |
| `client/src/context/GameStateContext.jsx` | L94-176 |
| `client/src/components/GameWorld.jsx` | L2142-2202 |
| `client/src/context/GameStateContext.jsx` | L29-103 |
| `client/src/components/GameWorld.jsx` | L848-897 |

</details>
</tool-use>

---

<tool-use data-tool-type="read" data-tool-name="read_file">
<details><summary>Tool use: **read_file** • Read file: /home/robwistrand/code/ga/projects/authentic-internet/client/src/hooks/useGameState.js</summary>

</details>
</tool-use>

---



---


`setCurrentSpecialWorld` is returned by `useGameState` but isn't destructured in `GameWorld.jsx`. Checking where it's used and fixing all occurrences:


---

<tool-use data-tool-type="read" data-tool-name="read_file">
<details><summary>Tool use: **read_file** • Read file: /home/robwistrand/code/ga/projects/authentic-internet/client/src/components/GameWorld.jsx</summary>

</details>
</tool-use>

---

<tool-use data-tool-type="read" data-tool-name="read_file">
<details><summary>Tool use: **read_file** • Read file: /home/robwistrand/code/ga/projects/authentic-internet/client/src/components/GameWorld.jsx</summary>

</details>
</tool-use>

---

<tool-use data-tool-type="read" data-tool-name="read_file">
<details><summary>Tool use: **read_file** • Read file: /home/robwistrand/code/ga/projects/authentic-internet/client/src/components/GameWorld.jsx</summary>

</details>
</tool-use>

---

<tool-use data-tool-type="read" data-tool-name="read_file">
<details><summary>Tool use: **read_file** • Read file: /home/robwistrand/code/ga/projects/authentic-internet/client/src/components/GameWorld.jsx</summary>

</details>
</tool-use>

---

<tool-use data-tool-type="search" data-tool-name="grep">
<details>
<summary>Tool use: **grep** • Grep for "currentSpecialWorld" in "/home/robwistrand/code/ga/projects/authentic-internet/client/src/components/GameWorld.jsx" • 7 matches</summary>

Output mode: content


| File | Content | Line |
|------|------|------|
| `client/src/components/GameWorld.jsx` | `\{currentSpecialWorld === "text_adventure" && (` | L3350 |
| `client/src/components/GameWorld.jsx` | `\{gameState.currentSpecialWorld === "textAdventure" && (` | L3370 |
| `client/src/components/GameWorld.jsx` | `\{currentSpecialWorld === "terminal" && (` | L3378 |
| `client/src/components/GameWorld.jsx` | `\{currentSpecialWorld === "shooter" && (` | L3389 |
| `client/src/components/GameWorld.jsx` | `\{currentSpecialWorld === "hemingway" && (` | L3400 |
| `client/src/components/GameWorld.jsx` | `\{/* Debug overlay to show currentSpecialWorld state */\}` | L3443 |
| `client/src/components/GameWorld.jsx` | `currentSpecialWorld: "\{gameState.currentSpecialWorld\}"` | L3458 |


</details>
</tool-use>

---



---


Searching for other undefined variables and inconsistencies:


---

<tool-use data-tool-type="read" data-tool-name="read_file">
<details><summary>Tool use: **read_file** • Read file: /home/robwistrand/code/ga/projects/authentic-internet/client/src/components/GameWorld.jsx</summary>

</details>
</tool-use>

---

<tool-use data-tool-type="read" data-tool-name="read_file">
<details><summary>Tool use: **read_file** • Read file: /home/robwistrand/code/ga/projects/authentic-internet/client/src/components/GameWorld.jsx</summary>

</details>
</tool-use>

---

<tool-use data-tool-type="search" data-tool-name="grep">
<details>
<summary>Tool use: **grep** • Grep for "setCurrentMapIndex|setCharacterPosition" in "/home/robwistrand/code/ga/projects/authentic-internet/client/src/components/GameWorld.jsx" • 9 matches</summary>

Output mode: content


| File | Content | Line |
|------|------|------|
| `client/src/components/GameWorld.jsx` | `setCurrentMapIndex(destinationIndex);` | L616 |
| `client/src/components/GameWorld.jsx` | `setCharacterPosition(spawnPosition);` | L617 |
| `client/src/components/GameWorld.jsx` | `setCharacterPosition(INITIAL_CHARACTER_POSITION);` | L792 |
| `client/src/components/GameWorld.jsx` | `setCharacterPosition(characterData.position);` | L1386 |
| `client/src/components/GameWorld.jsx` | `setCurrentMapIndex,` | L1994 |
| `client/src/components/GameWorld.jsx` | `setCharacterPosition,` | L1995 |
| `client/src/components/GameWorld.jsx` | `onPlayerMove=\{setCharacterPosition\}` | L2915 |
| `client/src/components/GameWorld.jsx` | `setCurrentMapIndex=\{setCurrentMapIndex\}` | L2948 |
| `client/src/components/GameWorld.jsx` | `setCharacterPosition(position);` | L2963 |


</details>
</tool-use>

---



---


Checking the exact location of the destructuring:


---

<tool-use data-tool-type="read" data-tool-name="read_file">
<details><summary>Tool use: **read_file** • Read file: /home/robwistrand/code/ga/projects/authentic-internet/client/src/components/GameWorld.jsx</summary>

</details>
</tool-use>

---

<tool-use data-tool-type="search" data-tool-name="grep">
<details>
<summary>Tool use: **grep** • Grep for "const \{[^}]*setCurrentMapIndex|const \{[^}]*setCurrentSpecialWorld|const \{[^}]*currentSpecialWorld" in "/home/robwistrand/code/ga/projects/authentic-internet/client/src/components/GameWorld.jsx" • 0 matches</summary>

Output mode: content


_No matches found_

</details>
</tool-use>

---

<tool-use data-tool-type="read" data-tool-name="read_file">
<details><summary>Tool use: **read_file** • Read file: /home/robwistrand/code/ga/projects/authentic-internet/client/src/components/GameWorld.jsx</summary>

</details>
</tool-use>

---

<tool-use data-tool-type="read" data-tool-name="read_file">
<details><summary>Tool use: **read_file** • Read file: /home/robwistrand/code/ga/projects/authentic-internet/client/src/components/GameWorld.jsx</summary>

</details>
</tool-use>

---

<tool-use data-tool-type="read" data-tool-name="read_file">
<details><summary>Tool use: **read_file** • Read file: /home/robwistrand/code/ga/projects/authentic-internet/client/src/components/GameWorld.jsx</summary>

</details>
</tool-use>

---



---


Creating a todo list and fixing the issues. `setCurrentSpecialWorld` is used but never destructured from `gameState`, and `currentSpecialWorld` has inconsistent usage.


---

<tool-use data-tool-type="task" data-tool-name="todo_write">
<details><summary>Tool use: **todo_write** • Todo List</summary>

- [-] Destructure setCurrentSpecialWorld and currentSpecialWorld from gameState
- [ ] Fix all references to currentSpecialWorld to use destructured variable consistently
- [ ] Check for other missing destructured variables (setCurrentMapIndex, setCharacterPosition, etc.)
- [ ] Verify all dependency arrays and fix any missing dependencies

</details>
</tool-use>

---

<tool-use data-tool-type="read" data-tool-name="read_file">
<details><summary>Tool use: **read_file** • Read file: /home/robwistrand/code/ga/projects/authentic-internet/client/src/components/GameWorld.jsx</summary>

</details>
</tool-use>

---



---


Checking which variables are used but not destructured:


---

<tool-use data-tool-type="search" data-tool-name="grep">
<details>
<summary>Tool use: **grep** • Grep for "^\s*(const|let|var)\s+\{[^}]*gameState" in "/home/robwistrand/code/ga/projects/authentic-internet/client/src/components/GameWorld.jsx" • 0 matches</summary>

Output mode: content


_No matches found_

</details>
</tool-use>

---

<tool-use data-tool-type="read" data-tool-name="read_file">
<details><summary>Tool use: **read_file** • Read file: /home/robwistrand/code/ga/projects/authentic-internet/client/src/components/GameWorld.jsx</summary>

</details>
</tool-use>

---

<tool-use data-tool-type="search" data-tool-name="grep">
<details>
<summary>Tool use: **grep** • Grep for "setCharacterStats|setPlayerHealth|setMaxPlayerHealth|setViewport|setCurrentMapIndex|setCharacterPosition|setShowLevelUpModal" in "/home/robwistrand/code/ga/projects/authentic-internet/client/src/components/GameWorld.jsx" • 18 matches</summary>

Output mode: content


| File | Content | Line |
|------|------|------|
| `client/src/components/GameWorld.jsx` | `setPlayerHealth(newHealth);` | L334 |
| `client/src/components/GameWorld.jsx` | `setPlayerHealth(newHealth);` | L362 |
| `client/src/components/GameWorld.jsx` | `setCharacterStats((prev) => \{` | L406 |
| `client/src/components/GameWorld.jsx` | `setPlayerHealth(newMaxHealth);` | L419 |
| `client/src/components/GameWorld.jsx` | `setMaxPlayerHealth(newMaxHealth);` | L420 |
| `client/src/components/GameWorld.jsx` | `setShowLevelUpModal(true);` | L423 |
| `client/src/components/GameWorld.jsx` | `setViewport(\{ x: clampedX, y: clampedY \});` | L490 |
| `client/src/components/GameWorld.jsx` | `setCurrentMapIndex(destinationIndex);` | L616 |
| `client/src/components/GameWorld.jsx` | `setCharacterPosition(spawnPosition);` | L617 |
| `client/src/components/GameWorld.jsx` | `setPlayerHealth(Math.floor(gameState.maxPlayerHealth / 2)); // Respawn with half health` | L790 |
| `client/src/components/GameWorld.jsx` | `setCharacterPosition(INITIAL_CHARACTER_POSITION);` | L792 |
| `client/src/components/GameWorld.jsx` | `setCharacterPosition(characterData.position);` | L1386 |
| `client/src/components/GameWorld.jsx` | `setCurrentMapIndex,` | L1994 |
| `client/src/components/GameWorld.jsx` | `setCharacterPosition,` | L1995 |
| `client/src/components/GameWorld.jsx` | `onPlayerMove=\{setCharacterPosition\}` | L2915 |
| `client/src/components/GameWorld.jsx` | `setCurrentMapIndex=\{setCurrentMapIndex\}` | L2948 |
| `client/src/components/GameWorld.jsx` | `setCharacterPosition(position);` | L2963 |
| `client/src/components/GameWorld.jsx` | `onClose=\{() => setShowLevelUpModal(false)\}` | L3176 |


</details>
</tool-use>

---



---


Fixing all issues: destructuring required variables from `gameState` and fixing references.


---

<tool-use data-tool-type="read" data-tool-name="read_file">
<details><summary>Tool use: **read_file** • Read file: /home/robwistrand/code/ga/projects/authentic-internet/client/src/components/GameWorld.jsx</summary>

</details>
</tool-use>

---

<tool-use data-tool-type="search" data-tool-name="grep">
<details>
<summary>Tool use: **grep** • Grep for "setShowLevelUpModal" in "/home/robwistrand/code/ga/projects/authentic-internet/client/src/hooks/useGameState.js" • 0 matches</summary>

Output mode: content


_No matches found_

</details>
</tool-use>

---

<tool-use data-tool-type="search" data-tool-name="grep">
<details>
<summary>Tool use: **grep** • Grep for "setViewport|setPlayerHealth|setMaxPlayerHealth|setCharacterStats|setCurrentMapIndex|setCharacterPosition" in "/home/robwistrand/code/ga/projects/authentic-internet/client/src/hooks/useGameState.js" • 12 matches</summary>

Output mode: content


| File | Content | Line |
|------|------|------|
| `client/src/hooks/useGameState.js` | `const setCurrentMapIndex = useCallback((value) => \{` | L307 |
| `client/src/hooks/useGameState.js` | `const setCharacterPosition = useCallback((value) => \{` | L315 |
| `client/src/hooks/useGameState.js` | `const setViewport = useCallback((value) => \{` | L327 |
| `client/src/hooks/useGameState.js` | `const setPlayerHealth = useCallback((value) => \{` | L387 |
| `client/src/hooks/useGameState.js` | `const setMaxPlayerHealth = useCallback((value) => \{` | L391 |
| `client/src/hooks/useGameState.js` | `const setCharacterStats = useCallback((updates) => \{` | L419 |
| `client/src/hooks/useGameState.js` | `setCurrentMapIndex,` | L472 |
| `client/src/hooks/useGameState.js` | `setCharacterPosition,` | L474 |
| `client/src/hooks/useGameState.js` | `setViewport,` | L477 |
| `client/src/hooks/useGameState.js` | `setPlayerHealth,` | L492 |
| `client/src/hooks/useGameState.js` | `setMaxPlayerHealth,` | L493 |
| `client/src/hooks/useGameState.js` | `setCharacterStats,` | L500 |


</details>
</tool-use>

---

<tool-use data-tool-type="read" data-tool-name="read_file">
<details><summary>Tool use: **read_file** • Read file: /home/robwistrand/code/ga/projects/authentic-internet/client/src/components/GameWorld.jsx</summary>

</details>
</tool-use>

---



---


Checking which variables need to be destructured by looking for direct variable usage:


---

<tool-use data-tool-type="search" data-tool-name="grep">
<details>
<summary>Tool use: **grep** • Grep for "\bcurrentMapIndex\b|\bcharacterPosition\b|\bviewport\b|\bexploredTiles\b|\binventory\b|\bvisibleArtifact\b|\buiState\b|\bquestStatusMap\b" in "/home/robwistrand/code/ga/projects/authentic-internet/client/src/components/GameWorld.jsx" • 37 matches</summary>

Output mode: content


| File | Content | Line |
|------|------|------|
| `client/src/components/GameWorld.jsx` | `if (!MAPS[gameState.currentMapIndex]?.npcs) return;` | L150 |
| `client/src/components/GameWorld.jsx` | `const currentNPCs = MAPS[gameState.currentMapIndex].npcs \|\| [];` | L153 |
| `client/src/components/GameWorld.jsx` | `if (!characterPos \|\| typeof gameState.currentMapIndex !== "number") return;` | L462 |
| `client/src/components/GameWorld.jsx` | `// Calculate new viewport position to center character` | L470 |
| `client/src/components/GameWorld.jsx` | `const currentMapData = MAPS[gameState.currentMapIndex];` | L475 |
| `client/src/components/GameWorld.jsx` | `// Clamp viewport to map boundaries` | L480 |
| `client/src/components/GameWorld.jsx` | `[gameState.currentMapIndex],` | L493 |
| `client/src/components/GameWorld.jsx` | `const currentMapName = MAPS[gameState.currentMapIndex]?.name \|\| "";` | L743 |
| `client/src/components/GameWorld.jsx` | `[gameState.soundManager, gameState.currentMapIndex, validateQuestProgress, showPortalNotification, hidePortalNotification],` | L770 |
| `client/src/components/GameWorld.jsx` | `const currentMapName = MAPS[gameState.currentMapIndex]?.name \|\| "";` | L778 |
| `client/src/components/GameWorld.jsx` | `\}, [gameState.soundManager, gameState.currentMapIndex]);` | L785 |
| `client/src/components/GameWorld.jsx` | `if (typeof gameState.currentMapIndex !== "number" \|\| !MAPS \|\| !Array.isArray(MAPS)) \{` | L884 |
| `client/src/components/GameWorld.jsx` | `return MAPS[gameState.currentMapIndex] \|\| MAPS[0];` | L887 |
| `client/src/components/GameWorld.jsx` | `\}, [gameState.currentMapIndex]);` | L888 |
| `client/src/components/GameWorld.jsx` | `const tileX = Math.floor(gameState.characterPosition.x / TILE_SIZE);` | L897 |
| `client/src/components/GameWorld.jsx` | `const tileY = Math.floor(gameState.characterPosition.y / TILE_SIZE);` | L898 |
| `client/src/components/GameWorld.jsx` | `\}, [getCharacterPosition]); // Remove exploredTiles from dependencies` | L926 |
| `client/src/components/GameWorld.jsx` | `const playerTileX = Math.floor(gameState.characterPosition.x / TILE_SIZE);` | L1058 |
| `client/src/components/GameWorld.jsx` | `const playerTileY = Math.floor(gameState.characterPosition.y / TILE_SIZE);` | L1059 |
| `client/src/components/GameWorld.jsx` | `characterPosition,` | L1173 |
| `client/src/components/GameWorld.jsx` | `// Add to inventory` | L1187 |
| `client/src/components/GameWorld.jsx` | `name: `Level $\{currentMapIndex + 1\} Artifact`,` | L1331 |
| `client/src/components/GameWorld.jsx` | `description: `An artifact from level $\{currentMapIndex + 1\}`,` | L1332 |
| `client/src/components/GameWorld.jsx` | `level: currentMapIndex + 1,` | L1334 |
| `client/src/components/GameWorld.jsx` | `position: \{ x: characterPosition.x, y: characterPosition.y \},` | L1335 |
| `client/src/components/GameWorld.jsx` | `currentMapIndex,` | L1356 |
| `client/src/components/GameWorld.jsx` | `characterPosition,` | L1357 |
| `client/src/components/GameWorld.jsx` | `updateUIState(\{ showInventory: !gameState.uiState.showInventory \});` | L1406 |
| `client/src/components/GameWorld.jsx` | `const message = gameState.uiState.showInventory` | L1409 |
| `client/src/components/GameWorld.jsx` | `? "Closing inventory"` | L1410 |
| `client/src/components/GameWorld.jsx` | `: "Opening inventory";` | L1411 |
| `client/src/components/GameWorld.jsx` | `updateUIState(\{ showQuotes: !gameState.uiState.showQuotes \});` | L1417 |
| `client/src/components/GameWorld.jsx` | `const message = gameState.uiState.showQuotes` | L1419 |
| `client/src/components/GameWorld.jsx` | `updateUIState(\{ showWorldMap: !gameState.uiState.showWorldMap \});` | L1427 |
| `client/src/components/GameWorld.jsx` | `const message = gameState.uiState.showWorldMap` | L1429 |
| `client/src/components/GameWorld.jsx` | `updateUIState(\{ showFeedback: !gameState.uiState.showFeedback \});` | L1437 |
| `client/src/components/GameWorld.jsx` | `const message = gameState.uiState.showFeedback` | L1439 |


</details>
</tool-use>

---

<tool-use data-tool-type="read" data-tool-name="read_file">
<details><summary>Tool use: **read_file** • Read file: /home/robwistrand/code/ga/projects/authentic-internet/client/src/components/GameWorld.jsx</summary>

</details>
</tool-use>

---



---


Checking for local state variables and fixing all issues systematically:


---

<tool-use data-tool-type="search" data-tool-name="grep">
<details>
<summary>Tool use: **grep** • Grep for "useState|const \[showLevelUpModal|const \[currentMapIndex|const \[characterPosition" in "/home/robwistrand/code/ga/projects/authentic-internet/client/src/components/GameWorld.jsx" • 2 matches</summary>

Output mode: content


| File | Content | Line |
|------|------|------|
| `client/src/components/GameWorld.jsx` | `useState,` | L2 |
| `client/src/components/GameWorld.jsx` | `const [isInitialized, setIsInitialized] = useState(false);` | L86 |


</details>
</tool-use>

---

<tool-use data-tool-type="search" data-tool-name="codebase_search">
<details>
                <summary>Tool use: **codebase_search** • Searched codebase "Where is showLevelUpModal state defined? Is it a useState or from gameState?" • **15** results</summary>
            
| File | Lines |
|------|-------|
| `client/src/components/GameWorld.jsx` | L3141-3197 |
| `client/src/components/Level4Shooter.jsx` | L49 |
| `client/src/components/GameWorld.jsx` | L392-459 |
| `client/src/components/GameWorld.jsx` | L79-148 |
| `client/src/components/TextAdventure.jsx` | L31 |
| `client/src/components/ArtifactGameLauncher.jsx` | L27-68 |
| `client/src/components/GameWorld.jsx` | L54 |
| `client/src/components/Level4Shooter.jsx` | L340-421 |
| `client/src/components/GameWorld.jsx` | L513-587 |
| `client/src/components/GameWorld.jsx` | L3086-3145 |
| `client/src/components/GameWorld.jsx` | L2847-2889 |
| `client/src/components/ActionBar.jsx` | L70 |
| `client/src/components/UI/LevelUpModal.jsx` | L49 |
| `client/src/components/GameWorld.jsx` | L324-396 |
| `client/src/components/CollaborationEngine.jsx` | L55-110 |

</details>
</tool-use>

---



---


Fixing the issues: destructuring missing variables and fixing references. Adding local state for `showLevelUpModal` if needed:


---

<tool-use data-tool-type="read" data-tool-name="read_file">
<details><summary>Tool use: **read_file** • Read file: /home/robwistrand/code/ga/projects/authentic-internet/client/src/components/GameWorld.jsx</summary>

</details>
</tool-use>

---

<tool-use data-tool-type="read" data-tool-name="read_file">
<details><summary>Tool use: **read_file** • Read file: /home/robwistrand/code/ga/projects/authentic-internet/client/src/components/GameWorld.jsx</summary>

</details>
</tool-use>

---



---


Applying fixes: destructuring required variables from `gameState`, adding local state where needed, and updating references.


---

<tool-use data-tool-type="write" data-tool-name="search_replace">

<details><summary>Tool use: **search_replace** • Edit file: /home/robwistrand/code/ga/projects/authentic-internet/client/src/components/GameWorld.jsx</summary>

**Chunk 1**
Lines added: 36, lines removed: undefined

```diff
@@ -85,7 +85,43 @@
    // Initialization guard to prevent render-order issues
    const [isInitialized, setIsInitialized] = useState(false);
+   const [showLevelUpModal, setShowLevelUpModal] = useState(false);
  
    // Use the custom game state hook
    const gameState = useGameState();
+ 
+   // Destructure state values and setters from gameState
+   const {
+     // State values
+     currentMapIndex,
+     characterPosition,
+     viewport,
+     exploredTiles,
+     inventory,
+     character,
+     visibleArtifact,
+     currentSpecialWorld,
+     characterStats,
+     // Setters
+     setCurrentMapIndex,
+     setCharacterPosition,
+     setViewport,
+     setExploredTiles,
+     setInventory,
+     setCharacter,
+     setVisibleArtifact,
+     setCurrentSpecialWorld,
+     setCharacterStats,
+     setPlayerHealth,
+     setMaxPlayerHealth,
+     setPortalState,
+     setGameData,
+     updateUIState,
+     setActiveNPC,
+     setSelectedUserArtifact,
+     setIsInvincible,
+     setRupees,
+     setKeys,
+     setCharacterState,
+   } = gameState;
  
    // Performance tracking
```

</details>

</tool-use>

---

<tool-use data-tool-type="task" data-tool-name="todo_write">
<details><summary>Tool use: **todo_write** • Todo List</summary>

- [x] Destructure setCurrentSpecialWorld and currentSpecialWorld from gameState
- [-] Fix all references to currentSpecialWorld to use destructured variable consistently
- [ ] Check for other missing destructured variables (setCurrentMapIndex, setCharacterPosition, etc.)
- [ ] Verify all dependency arrays and fix any missing dependencies

</details>
</tool-use>

---



---


Fixing all `currentSpecialWorld` references to use the destructured variable:


---

<tool-use data-tool-type="read" data-tool-name="read_file">
<details><summary>Tool use: **read_file** • Read file: /home/robwistrand/code/ga/projects/authentic-internet/client/src/components/GameWorld.jsx</summary>

</details>
</tool-use>

---

<tool-use data-tool-type="write" data-tool-name="search_replace">

<details><summary>Tool use: **search_replace** • Edit file: /home/robwistrand/code/ga/projects/authentic-internet/client/src/components/GameWorld.jsx</summary>

**Chunk 1**
Lines added: 1, lines removed: 1

```diff
@@ -3386,5 +3386,5 @@
            {currentSpecialWorld === "text_adventure" &amp;&amp; (
              &lt;TextAdventure
-               username={gameState.character?.username || "traveler"}
+               username={character?.username || "traveler"}
                onComplete={handleTextAdventureComplete}
                onExit={handleTextAdventureExit}
```

</details>

</tool-use>

---

<tool-use data-tool-type="search" data-tool-name="grep">
<details>
<summary>Tool use: **grep** • Grep for "gameState\.currentSpecialWorld|currentSpecialWorld ===" in "/home/robwistrand/code/ga/projects/authentic-internet/client/src/components/GameWorld.jsx" • 6 matches</summary>

Output mode: content


| File | Content | Line |
|------|------|------|
| `client/src/components/GameWorld.jsx` | `\{currentSpecialWorld === "text_adventure" && (` | L3386 |
| `client/src/components/GameWorld.jsx` | `\{gameState.currentSpecialWorld === "textAdventure" && (` | L3406 |
| `client/src/components/GameWorld.jsx` | `\{currentSpecialWorld === "terminal" && (` | L3414 |
| `client/src/components/GameWorld.jsx` | `\{currentSpecialWorld === "shooter" && (` | L3425 |
| `client/src/components/GameWorld.jsx` | `\{currentSpecialWorld === "hemingway" && (` | L3436 |
| `client/src/components/GameWorld.jsx` | `currentSpecialWorld: "\{gameState.currentSpecialWorld\}"` | L3494 |


</details>
</tool-use>

---



---


Fixing remaining `currentSpecialWorld` references and checking for other inconsistencies:


---

<tool-use data-tool-type="write" data-tool-name="search_replace">

<details><summary>Tool use: **search_replace** • Edit file: /home/robwistrand/code/ga/projects/authentic-internet/client/src/components/GameWorld.jsx</summary>

**Chunk 1**
Lines added: 2, lines removed: 2

```diff
@@ -3404,9 +3404,9 @@
  
            {/* === SPECIAL WORLDS AND MINI-GAMES === */}
-           {gameState.currentSpecialWorld === "textAdventure" &amp;&amp; (
+           {currentSpecialWorld === "textAdventure" &amp;&amp; (
              &lt;TextAdventure
                onComplete={handleTextAdventureComplete}
                onExit={handleTextAdventureExit}
-               character={gameState.character}
+               character={character}
              /&gt;
            )}
```

</details>

</tool-use>

---

<tool-use data-tool-type="write" data-tool-name="search_replace">

<details><summary>Tool use: **search_replace** • Edit file: /home/robwistrand/code/ga/projects/authentic-internet/client/src/components/GameWorld.jsx</summary>

**Chunk 1**
Lines added: 1, lines removed: 1

```diff
@@ -3492,5 +3492,5 @@
              }}
            &gt;
-             currentSpecialWorld: "{gameState.currentSpecialWorld}"
+             currentSpecialWorld: "{currentSpecialWorld}"
            &lt;/div&gt;
  
```

</details>

</tool-use>

---

<tool-use data-tool-type="search" data-tool-name="grep">
<details>
<summary>Tool use: **grep** • Grep for "\bcharacterStats\b|\bvisibleArtifact\b|\bquestStatusMap\b|\buiState\b" in "/home/robwistrand/code/ga/projects/authentic-internet/client/src/components/GameWorld.jsx" • 29 matches</summary>

Output mode: content


| File | Content | Line |
|------|------|------|
| `client/src/components/GameWorld.jsx` | `visibleArtifact,` | L101 |
| `client/src/components/GameWorld.jsx` | `characterStats,` | L103 |
| `client/src/components/GameWorld.jsx` | `updateUIState(\{ showInventory: !gameState.uiState.showInventory \});` | L1442 |
| `client/src/components/GameWorld.jsx` | `const message = gameState.uiState.showInventory` | L1445 |
| `client/src/components/GameWorld.jsx` | `updateUIState(\{ showQuotes: !gameState.uiState.showQuotes \});` | L1453 |
| `client/src/components/GameWorld.jsx` | `const message = gameState.uiState.showQuotes` | L1455 |
| `client/src/components/GameWorld.jsx` | `updateUIState(\{ showWorldMap: !gameState.uiState.showWorldMap \});` | L1463 |
| `client/src/components/GameWorld.jsx` | `const message = gameState.uiState.showWorldMap` | L1465 |
| `client/src/components/GameWorld.jsx` | `updateUIState(\{ showFeedback: !gameState.uiState.showFeedback \});` | L1473 |
| `client/src/components/GameWorld.jsx` | `const message = gameState.uiState.showFeedback` | L1475 |
| `client/src/components/GameWorld.jsx` | `updateUIState(\{ showControlsGuide: !gameState.uiState.showControlsGuide \});` | L1484 |
| `client/src/components/GameWorld.jsx` | `const message = gameState.uiState.showControlsGuide` | L1486 |
| `client/src/components/GameWorld.jsx` | `[uiState, updateUIState, mobileState],` | L1628 |
| `client/src/components/GameWorld.jsx` | `updateUIState(\{ showArtifactsOnMap: !gameState.uiState.showArtifactsOnMap \});` | L2759 |
| `client/src/components/GameWorld.jsx` | `\}, [gameState.uiState.showArtifactsOnMap, updateUIState]);` | L2760 |
| `client/src/components/GameWorld.jsx` | `showArtifactsOnMap=\{gameState.uiState.showArtifactsOnMap\}` | L2867 |
| `client/src/components/GameWorld.jsx` | `inDungeon=\{gameState.uiState.inDungeon\}` | L2868 |
| `client/src/components/GameWorld.jsx` | `experience=\{gameState.characterStats.experience\}` | L2894 |
| `client/src/components/GameWorld.jsx` | `level=\{gameState.characterStats.level\}` | L2895 |
| `client/src/components/GameWorld.jsx` | `gameState.characterStats.level + 1,` | L2897 |
| `client/src/components/GameWorld.jsx` | `\{gameState.uiState.showLevel4 && (` | L2913 |
| `client/src/components/GameWorld.jsx` | `\{gameState.uiState.inDungeon && gameState.dungeonState.currentDungeon ? (` | L2947 |
| `client/src/components/GameWorld.jsx` | `!gameState.uiState.showArtifactsOnMap ? [] : artifactsToShow` | L2970 |
| `client/src/components/GameWorld.jsx` | `questStatusMap=\{questStatusMap\}` | L2976 |
| `client/src/components/GameWorld.jsx` | `visibleArtifact=\{visibleArtifact\}` | L2986 |
| `client/src/components/GameWorld.jsx` | `uiState=\{uiState\}` | L2993 |
| `client/src/components/GameWorld.jsx` | `\{gameState.uiState.isDarkMode && <div className="darkmode-overlay" />\}` | L3037 |
| `client/src/components/GameWorld.jsx` | `gameState.uiState.showArtifactsOnMap` | L3074 |
| `client/src/components/GameWorld.jsx` | `className=\{`fas fa-$\{gameState.uiState.showArtifactsOnMap ? "eye-slash" : "eye"\}`\}` | L3080 |


</details>
</tool-use>

---

<tool-use data-tool-type="read" data-tool-name="read_file">
<details><summary>Tool use: **read_file** • Read file: /home/robwistrand/code/ga/projects/authentic-internet/client/src/components/GameWorld.jsx</summary>

</details>
</tool-use>

---



---


Checking which variables are missing and need to be destructured, especially `uiState` and `questStatusMap`:


---

<tool-use data-tool-type="read" data-tool-name="read_file">
<details><summary>Tool use: **read_file** • Read file: /home/robwistrand/code/ga/projects/authentic-internet/client/src/components/GameWorld.jsx</summary>

</details>
</tool-use>

---

<tool-use data-tool-type="read" data-tool-name="read_file">
<details><summary>Tool use: **read_file** • Read file: /home/robwistrand/code/ga/projects/authentic-internet/client/src/components/GameWorld.jsx</summary>

</details>
</tool-use>

---

<tool-use data-tool-type="search" data-tool-name="grep">
<details>
<summary>Tool use: **grep** • Grep for "const questStatusMap|let questStatusMap|var questStatusMap" in "/home/robwistrand/code/ga/projects/authentic-internet/client/src/components/GameWorld.jsx" • 0 matches</summary>

Output mode: content


_No matches found_

</details>
</tool-use>

---



---


Adding missing destructured variables and fixing references. Checking what `questStatusMap` and `uiState` are:


---

<tool-use data-tool-type="read" data-tool-name="read_file">
<details><summary>Tool use: **read_file** • Read file: /home/robwistrand/code/ga/projects/authentic-internet/client/src/components/GameWorld.jsx</summary>

</details>
</tool-use>

---

<tool-use data-tool-type="search" data-tool-name="grep">
<details>
<summary>Tool use: **grep** • Grep for "setQuestStatusMap|questStatusMap" in "/home/robwistrand/code/ga/projects/authentic-internet/client/src/components/GameWorld.jsx" • 2 matches</summary>

Output mode: content


| File | Content | Line |
|------|------|------|
| `client/src/components/GameWorld.jsx` | `setQuestStatusMap(statusMap);` | L244 |
| `client/src/components/GameWorld.jsx` | `questStatusMap=\{questStatusMap\}` | L2976 |


</details>
</tool-use>

---

<tool-use data-tool-type="read" data-tool-name="read_file">
<details><summary>Tool use: **read_file** • Read file: /home/robwistrand/code/ga/projects/authentic-internet/client/src/components/GameWorld.jsx</summary>

</details>
</tool-use>

---



---


Adding missing destructured variables and fixing references:


---

<tool-use data-tool-type="write" data-tool-name="search_replace">

<details><summary>Tool use: **search_replace** • Edit file: /home/robwistrand/code/ga/projects/authentic-internet/client/src/components/GameWorld.jsx</summary>

**Chunk 1**
Lines added: 3, lines removed: undefined

```diff
@@ -102,4 +102,7 @@
      currentSpecialWorld,
      characterStats,
+     uiState,
+     questStatusMap,
+     mobileState,
      // Setters
      setCurrentMapIndex,
```

**Chunk 2**
Lines added: 2, lines removed: undefined

```diff
@@ -123,4 +126,6 @@
      setKeys,
      setCharacterState,
+     setQuestStatusMap,
+     setMobileState,
    } = gameState;
  
```

</details>

</tool-use>

---

<tool-use data-tool-type="write" data-tool-name="search_replace">

<details><summary>Tool use: **search_replace** • Edit file: /home/robwistrand/code/ga/projects/authentic-internet/client/src/components/GameWorld.jsx</summary>

**Chunk 1**
Lines added: 2, lines removed: 2

```diff
@@ -189,8 +189,8 @@
    // Create quest status map for NPCs when quests or current map changes
    useEffect(() =&gt; {
-     if (!MAPS[gameState.currentMapIndex]?.npcs) return;
+     if (!MAPS[currentMapIndex]?.npcs) return;
  
      const statusMap = new Map();
-     const currentNPCs = MAPS[gameState.currentMapIndex].npcs || [];
+     const currentNPCs = MAPS[currentMapIndex].npcs || [];
  
      currentNPCs.forEach((npc) =&gt; {
```

</details>

</tool-use>

---

<tool-use data-tool-type="write" data-tool-name="search_replace">

<details><summary>Tool use: **search_replace** • Edit file: /home/robwistrand/code/ga/projects/authentic-internet/client/src/components/GameWorld.jsx</summary>

**Chunk 1**
Lines added: 1, lines removed: 1

```diff
@@ -248,5 +248,5 @@
  
      setQuestStatusMap(statusMap);
-   }, [gameState]);
+   }, [gameState.activeQuests, gameState.completedQuests, currentMapIndex, setQuestStatusMap]);
  
    // Screen reader announcement function
```

</details>

</tool-use>

---

<tool-use data-tool-type="write" data-tool-name="search_replace">

<details><summary>Tool use: **search_replace** • Edit file: /home/robwistrand/code/ga/projects/authentic-internet/client/src/components/GameWorld.jsx</summary>

**Chunk 1**
Lines added: 5, lines removed: 5

```diff
@@ -1620,9 +1620,9 @@
          case "S":
            // Toggle screen reader mode
-           setMobileState((prev) =&gt; ({
-             ...prev,
-             screenReaderMode: !prev.screenReaderMode,
-           }));
-           const message = gameState.mobileState.screenReaderMode
+           setMobileState({
+             ...mobileState,
+             screenReaderMode: !mobileState.screenReaderMode,
+           });
+           const message = mobileState.screenReaderMode
              ? "Screen reader mode disabled"
              : "Screen reader mode enabled";
```

**Chunk 2**
Lines added: 1, lines removed: 1

```diff
@@ -1631,5 +1631,5 @@
        }
      },
-     [uiState, updateUIState, mobileState],
+     [uiState, updateUIState, mobileState, setMobileState, announceToScreenReader],
    );
  
```

</details>

</tool-use>

---

<tool-use data-tool-type="generic" data-tool-name="read_lints">
<details>
          <summary>Tool use: **read_lints** • Read lints for 1 file</summary>
      
Lint paths:

- `client/src/components/GameWorld.jsx`

Lint results


**No lint errors found**
</details>
</tool-use>

---



---


No linter errors. Checking for remaining issues and fixing references to `gameState.characterPosition` and similar that should use destructured variables:


---

<tool-use data-tool-type="search" data-tool-name="grep">
<details>
<summary>Tool use: **grep** • Grep for "gameState\.characterPosition|gameState\.currentMapIndex|gameState\.viewport" in "/home/robwistrand/code/ga/projects/authentic-internet/client/src/components/GameWorld.jsx" • 9 matches</summary>

Output mode: content


| File | Content | Line |
|------|------|------|
| `client/src/components/GameWorld.jsx` | `if (!characterPos \|\| typeof gameState.currentMapIndex !== "number") return;` | L503 |
| `client/src/components/GameWorld.jsx` | `const currentMapData = MAPS[gameState.currentMapIndex];` | L516 |
| `client/src/components/GameWorld.jsx` | `[gameState.currentMapIndex],` | L534 |
| `client/src/components/GameWorld.jsx` | `const currentMapName = MAPS[gameState.currentMapIndex]?.name \|\| "";` | L784 |
| `client/src/components/GameWorld.jsx` | `[gameState.soundManager, gameState.currentMapIndex, validateQuestProgress, showPortalNotification, hidePortalNotification],` | L811 |
| `client/src/components/GameWorld.jsx` | `const currentMapName = MAPS[gameState.currentMapIndex]?.name \|\| "";` | L819 |
| `client/src/components/GameWorld.jsx` | `\}, [gameState.soundManager, gameState.currentMapIndex]);` | L826 |
| `client/src/components/GameWorld.jsx` | `if (typeof gameState.currentMapIndex !== "number" \|\| !MAPS \|\| !Array.isArray(MAPS)) \{` | L925 |
| `client/src/components/GameWorld.jsx` | `return MAPS[gameState.currentMapIndex] \|\| MAPS[0];` | L928 |


</details>
</tool-use>

---

<tool-use data-tool-type="task" data-tool-name="todo_write">
<details><summary>Tool use: **todo_write** • Todo List</summary>

- [x] Destructure setCurrentSpecialWorld and currentSpecialWorld from gameState
- [x] Fix all references to currentSpecialWorld to use destructured variable consistently
- [x] Check for other missing destructured variables (setCurrentMapIndex, setCharacterPosition, etc.)
- [-] Verify all dependency arrays and fix any missing dependencies

</details>
</tool-use>

---

<tool-use data-tool-type="search" data-tool-name="grep">
<details>
<summary>Tool use: **grep** • Grep for "portalNotificationActive" in "/home/robwistrand/code/ga/projects/authentic-internet/client/src/components/GameWorld.jsx" • 8 matches</summary>

Output mode: content


| File | Content | Line |
|------|------|------|
| `client/src/components/GameWorld.jsx` | `// portalNotificationActive is now handled by NotificationSystem` | L164 |
| `client/src/components/GameWorld.jsx` | `portalNotificationActive: false,` | L684 |
| `client/src/components/GameWorld.jsx` | `portalNotificationActive: true,` | L1069 |
| `client/src/components/GameWorld.jsx` | `portalNotificationActive: true,` | L1195 |
| `client/src/components/GameWorld.jsx` | `portalNotificationActive: true,` | L1327 |
| `client/src/components/GameWorld.jsx` | `if (nearPortal && !portalState.portalNotificationActive) \{` | L1812 |
| `client/src/components/GameWorld.jsx` | `portalState.portalNotificationActive,` | L1829 |
| `client/src/components/GameWorld.jsx` | `portalNotificationActive,` | L2030 |


</details>
</tool-use>

---

<tool-use data-tool-type="read" data-tool-name="read_file">
<details><summary>Tool use: **read_file** • Read file: /home/robwistrand/code/ga/projects/authentic-internet/client/src/components/GameWorld.jsx</summary>

</details>
</tool-use>

---



---


Checking dependency arrays and ensuring all variables used in callbacks are properly destructured and included:


---

<tool-use data-tool-type="read" data-tool-name="read_file">
<details><summary>Tool use: **read_file** • Read file: /home/robwistrand/code/ga/projects/authentic-internet/client/src/components/GameWorld.jsx</summary>

</details>
</tool-use>

---

<tool-use data-tool-type="read" data-tool-name="read_file">
<details><summary>Tool use: **read_file** • Read file: /home/robwistrand/code/ga/projects/authentic-internet/client/src/components/GameWorld.jsx</summary>

</details>
</tool-use>

---

<tool-use data-tool-type="read" data-tool-name="read_file">
<details><summary>Tool use: **read_file** • Read file: /home/robwistrand/code/ga/projects/authentic-internet/client/src/components/GameWorld.jsx</summary>

</details>
</tool-use>

---



---


Checking where `portalNotificationActive` comes from and whether it needs to be defined:


---

<tool-use data-tool-type="search" data-tool-name="grep">
<details>
<summary>Tool use: **grep** • Grep for "const.*portalNotificationActive|portalNotificationActive\s*=" in "/home/robwistrand/code/ga/projects/authentic-internet/client/src/components/GameWorld.jsx" • 0 matches</summary>

Output mode: content


_No matches found_

</details>
</tool-use>

---

<tool-use data-tool-type="read" data-tool-name="read_file">
<details><summary>Tool use: **read_file** • Read file: /home/robwistrand/code/ga/projects/authentic-internet/client/src/components/GameWorld.jsx</summary>

</details>
</tool-use>

---

<tool-use data-tool-type="search" data-tool-name="codebase_search">
<details>
                <summary>Tool use: **codebase_search** • Searched codebase "How is portalNotificationActive used? Where does it come from in usePortalCollisions?" • **13** results</summary>
            
| File | Lines |
|------|-------|
| `client/src/components/GameWorld.jsx` | L1981-2046 |
| `client/src/hooks/usePortalCollisions.js` | L392 |
| `client/src/hooks/usePortalCollisions.js` | L1-392 |
| `client/src/components/GameWorld.jsx` | L1254-1308 |
| `client/src/hooks/useGameState.js` | L5-299 |
| `client/src/components/GameWorld.jsx` | L1001-1050 |
| `client/src/components/GameWorld.jsx` | L1048-1089 |
| `client/src/components/GameWorld.jsx` | L1177-1225 |
| `client/src/components/systems/NotificationSystem.jsx` | L89-158 |
| `client/src/components/GameWorld.jsx` | L2124-2186 |
| `client/src/components/systems/NotificationSystem.jsx` | L52 |
| `client/src/components/GameWorld.jsx` | L1304-1369 |
| `client/src/components/GameWorld.jsx` | L1810-1869 |

</details>
</tool-use>

---



---


Using `gameState.portalState.portalNotificationActive` for `portalNotificationActive`:


---

<tool-use data-tool-type="write" data-tool-name="search_replace">

<details><summary>Tool use: **search_replace** • Edit file: /home/robwistrand/code/ga/projects/authentic-internet/client/src/components/GameWorld.jsx</summary>

**Chunk 1**
Lines added: 1, lines removed: 1

```diff
@@ -2028,5 +2028,5 @@
      currentMapIndex,
      soundManager: gameState.soundManager,
-     portalNotificationActive,
+     portalNotificationActive: gameState.portalState.portalNotificationActive,
      setPortalNotificationActive,
      showPortalNotification,
```

**Chunk 2**
Lines added: 1, lines removed: 1

```diff
@@ -2037,5 +2037,5 @@
      adjustViewport,
      setCurrentSpecialWorld,
-     gameData,
+     gameData: gameState.gameData,
      handleLevelCompletion,
    });
```

</details>

</tool-use>

---

<tool-use data-tool-type="search" data-tool-name="grep">
<details>
<summary>Tool use: **grep** • Grep for "\bgameData\b" in "/home/robwistrand/code/ga/projects/authentic-internet/client/src/components/GameWorld.jsx" • 13 matches</summary>

Output mode: content


| File | Content | Line |
|------|------|------|
| `client/src/components/GameWorld.jsx` | `if (gameState.gameData.levelCompletion[level]) return; // Already completed` | L594 |
| `client/src/components/GameWorld.jsx` | `levelCompletion: \{ ...gameState.gameData.levelCompletion, [level]: true \},` | L597 |
| `client/src/components/GameWorld.jsx` | `gameState.gameData.levelCompletion,` | L619 |
| `client/src/components/GameWorld.jsx` | `// Optionally: Track dungeon completion in gameData` | L1362 |
| `client/src/components/GameWorld.jsx` | `artifacts: [...gameState.gameData.artifacts, newArtifact],` | L1383 |
| `client/src/components/GameWorld.jsx` | `gameState.gameData.artifacts,` | L1400 |
| `client/src/components/GameWorld.jsx` | `const npcs = [...currentMapNPCs, ...gameState.gameData.databaseNPCs];` | L1638 |
| `client/src/components/GameWorld.jsx` | `\}, [currentMapNPCs, gameState.gameData.databaseNPCs, getCharacterPosition]);` | L1648 |
| `client/src/components/GameWorld.jsx` | `levelCompletion: gameState.gameData.levelCompletion,` | L1854 |
| `client/src/components/GameWorld.jsx` | `achievements: gameState.gameData.achievements,` | L1855 |
| `client/src/components/GameWorld.jsx` | `viewedArtifacts: gameState.gameData.viewedArtifacts,` | L1856 |
| `client/src/components/GameWorld.jsx` | `\}, [user, characterPosition, currentMapIndex, inventory, gameData]);` | L1860 |
| `client/src/components/GameWorld.jsx` | `!Array.isArray(gameState.gameData.viewedArtifacts) \|\|` | L1949 |


</details>
</tool-use>

---

<tool-use data-tool-type="read" data-tool-name="read_file">
<details><summary>Tool use: **read_file** • Read file: /home/robwistrand/code/ga/projects/authentic-internet/client/src/components/GameWorld.jsx</summary>

</details>
</tool-use>

---

<tool-use data-tool-type="read" data-tool-name="read_file">
<details><summary>Tool use: **read_file** • Read file: /home/robwistrand/code/ga/projects/authentic-internet/client/src/components/GameWorld.jsx</summary>

</details>
</tool-use>

---

<tool-use data-tool-type="task" data-tool-name="todo_write">
<details><summary>Tool use: **todo_write** • Todo List</summary>

- [x] Destructure setCurrentSpecialWorld and currentSpecialWorld from gameState
- [x] Fix all references to currentSpecialWorld to use destructured variable consistently
- [x] Check for other missing destructured variables (setCurrentMapIndex, setCharacterPosition, etc.)
- [x] Verify all dependency arrays and fix any missing dependencies

</details>
</tool-use>

---

<tool-use data-tool-type="generic" data-tool-name="read_lints">
<details>
          <summary>Tool use: **read_lints** • Read lints for 1 file</summary>
      
Lint paths:

- `client/src/components/GameWorld.jsx`

Lint results


**No lint errors found**
</details>
</tool-use>

---



---


No linter errors. Checking for other issues and verifying `gameData` usage:


---

<tool-use data-tool-type="search" data-tool-name="grep">
<details>
<summary>Tool use: **grep** • Grep for "\bgameData\b[^.]" in "/home/robwistrand/code/ga/projects/authentic-internet/client/src/components/GameWorld.jsx" • 2 matches</summary>

Output mode: content


| File | Content | Line |
|------|------|------|
| `client/src/components/GameWorld.jsx` | `\}, [user, characterPosition, currentMapIndex, inventory, gameData]);` | L1860 |
| `client/src/components/GameWorld.jsx` | `gameData: gameState.gameData,` | L2039 |


</details>
</tool-use>

---

<tool-use data-tool-type="read" data-tool-name="read_file">
<details><summary>Tool use: **read_file** • Read file: /home/robwistrand/code/ga/projects/authentic-internet/client/src/components/GameWorld.jsx</summary>

</details>
</tool-use>

---

<tool-use data-tool-type="read" data-tool-name="read_file">
<details><summary>Tool use: **read_file** • Read file: /home/robwistrand/code/ga/projects/authentic-internet/client/src/components/GameWorld.jsx</summary>

</details>
</tool-use>

---



---


Fixing the `gameData` reference in the dependency array:


---

<tool-use data-tool-type="read" data-tool-name="read_file">
<details><summary>Tool use: **read_file** • Read file: /home/robwistrand/code/ga/projects/authentic-internet/client/src/components/GameWorld.jsx</summary>

</details>
</tool-use>

---

<tool-use data-tool-type="write" data-tool-name="search_replace">

<details><summary>Tool use: **search_replace** • Edit file: /home/robwistrand/code/ga/projects/authentic-internet/client/src/components/GameWorld.jsx</summary>

**Chunk 1**
Lines added: 1, lines removed: 1

```diff
@@ -1858,5 +1858,5 @@
  
      gameStateManager.updateState(gameState);
-   }, [user, characterPosition, currentMapIndex, inventory, gameData]);
+   }, [user, characterPosition, currentMapIndex, inventory, gameState.gameData]);
  
    // Auto-save effect
```

</details>

</tool-use>

---

<tool-use data-tool-type="read" data-tool-name="read_file">
<details><summary>Tool use: **read_file** • Read file: /home/robwistrand/code/ga/projects/authentic-internet/client/src/components/GameWorld.jsx</summary>

</details>
</tool-use>

---

<tool-use data-tool-type="search" data-tool-name="grep">
<details>
<summary>Tool use: **grep** • Grep for "portalState\.|const portalState" in "/home/robwistrand/code/ga/projects/authentic-internet/client/src/components/GameWorld.jsx" • 9 matches</summary>

Output mode: content


| File | Content | Line |
|------|------|------|
| `client/src/components/GameWorld.jsx` | `if (portalState.isTransitioning) return;` | L630 |
| `client/src/components/GameWorld.jsx` | `gameState.portalState.isTransitioning,` | L708 |
| `client/src/components/GameWorld.jsx` | `if (portalState.isTransitioning) return;` | L1007 |
| `client/src/components/GameWorld.jsx` | `portalState.isTransitioning,` | L1081 |
| `client/src/components/GameWorld.jsx` | `if (e.key !== " " \|\| portalState.isTransitioning) return;` | L1091 |
| `client/src/components/GameWorld.jsx` | `portalState.isTransitioning,` | L1212 |
| `client/src/components/GameWorld.jsx` | `if (portalState.isTransitioning) return;` | L1265 |
| `client/src/components/GameWorld.jsx` | `portalState.isTransitioning,` | L1339 |
| `client/src/components/GameWorld.jsx` | `if (nearPortal && !portalState.portalNotificationActive) \{` | L1812 |


</details>
</tool-use>

---

<tool-use data-tool-type="generic" data-tool-name="read_lints">
<details>
          <summary>Tool use: **read_lints** • Read lints for 1 file</summary>
      
Lint paths:

- `client/src/components/GameWorld.jsx`

Lint results


**No lint errors found**
</details>
</tool-use>

---



---


Adding `portalState` to the destructuring:


---

<tool-use data-tool-type="write" data-tool-name="search_replace">

<details><summary>Tool use: **search_replace** • Edit file: /home/robwistrand/code/ga/projects/authentic-internet/client/src/components/GameWorld.jsx</summary>

**Chunk 1**
Lines added: 1, lines removed: undefined

```diff
@@ -105,4 +105,5 @@
      questStatusMap,
      mobileState,
+     portalState,
      // Setters
      setCurrentMapIndex,
```

</details>

</tool-use>

---

<tool-use data-tool-type="generic" data-tool-name="read_lints">
<details>
          <summary>Tool use: **read_lints** • Read lints for 1 file</summary>
      
Lint paths:

- `client/src/components/GameWorld.jsx`

Lint results


**No lint errors found**
</details>
</tool-use>

---



---


Fixing dependency arrays to include the correct dependencies:


---

<tool-use data-tool-type="read" data-tool-name="read_file">
<details><summary>Tool use: **read_file** • Read file: /home/robwistrand/code/ga/projects/authentic-internet/client/src/components/GameWorld.jsx</summary>

</details>
</tool-use>

---

<tool-use data-tool-type="write" data-tool-name="search_replace">

<details><summary>Tool use: **search_replace** • Edit file: /home/robwistrand/code/ga/projects/authentic-internet/client/src/components/GameWorld.jsx</summary>

**Chunk 1**
Lines added: 1, lines removed: 1

```diff
@@ -707,5 +707,5 @@
      },
      [
-       gameState.portalState.isTransitioning,
+       portalState.isTransitioning,
        gameState.soundManager,
        setCurrentSpecialWorld,
```

**Chunk 2**
Lines added: 2, lines removed: undefined

```diff
@@ -714,4 +714,6 @@
        handleLevelCompletion,
        hidePortalNotification,
+       setCurrentMapIndex,
+       setCharacterPosition,
      ],
    );
```

</details>

</tool-use>

---

<tool-use data-tool-type="generic" data-tool-name="read_lints">
<details>
          <summary>Tool use: **read_lints** • Read lints for 1 file</summary>
      
Lint paths:

- `client/src/components/GameWorld.jsx`

Lint results


**No lint errors found**
</details>
</tool-use>

---



---


## Summary

Fixed the `ReferenceError: setCurrentSpecialWorld is not defined` and related issues:

1. **Main fix**: Destructured `setCurrentSpecialWorld` and `currentSpecialWorld` from `gameState` (they were being used but not extracted).

2. **Additional fixes**:
   - Added `showLevelUpModal` as local state (it was undefined)
   - Destructured state values: `currentMapIndex`, `characterPosition`, `viewport`, `exploredTiles`, `inventory`, `character`, `visibleArtifact`, `characterStats`, `uiState`, `questStatusMap`, `mobileState`, `portalState`
   - Destructured setters: `setCurrentMapIndex`, `setCharacterPosition`, `setViewport`, `setCharacterStats`, `setPlayerHealth`, `setMaxPlayerHealth`, `setMobileState`, `setQuestStatusMap`, and others
   - Updated references to use destructured variables consistently
   - Fixed dependency arrays to include the correct dependencies
   - Fixed `portalNotificationActive` reference (using `gameState.portalState.portalNotificationActive`)
   - Fixed `gameData` reference (using `gameState.gameData`)

All linter checks pass. The `setCurrentSpecialWorld` error should be resolved, and related issues addressed.

---

_**User (2026-01-07 03:53Z)**_

client:702 [vite] Internal Server Error
/home/robwistrand/code/ga/projects/authentic-internet/client/src/components/GameWorld.jsx: Identifier 'updateUIState' has already been declared. (282:8)

  280 |
  281 |   // UI state update function - now uses gameState
> 282 |   const updateUIState = useCallback((updates) => {
      |         ^
  283 |     gameState.updateUIState(updates);
  284 |   }, [gameState]);
  285 |
    at constructor (/home/robwistrand/code/ga/projects/authentic-internet/client/node_modules/@babel/parser/lib/index.js:367:19)
    at JSXParserMixin.raise (/home/robwistrand/code/ga/projects/authentic-internet/client/node_modules/@babel/parser/lib/index.js:6624:19)
    at ScopeHandler.checkRedeclarationInScope (/home/robwistrand/code/ga/projects/authentic-internet/client/node_modules/@babel/parser/lib/index.js:1646:19)
    at ScopeHandler.declareName (/home/robwistrand/code/ga/projects/authentic-internet/client/node_modules/@babel/parser/lib/index.js:1612:12)
    at JSXParserMixin.declareNameFromIdentifier (/home/robwistrand/code/ga/projects/authentic-internet/client/node_modules/@babel/parser/lib/index.js:7594:16)
    at JSXParserMixin.checkIdentifier (/home/robwistrand/code/ga/projects/authentic-internet/client/node_modules/@babel/parser/lib/index.js:7590:12)
    at JSXParserMixin.checkLVal (/home/robwistrand/code/ga/projects/authentic-internet/client/node_modules/@babel/parser/lib/index.js:7527:12)
    at JSXParserMixin.parseVarId (/home/robwistrand/code/ga/projects/authentic-internet/client/node_modules/@babel/parser/lib/index.js:13488:10)
    at JSXParserMixin.parseVar (/home/robwistrand/code/ga/projects/authentic-internet/client/node_modules/@babel/parser/lib/index.js:13459:12)
    at JSXParserMixin.parseVarStatement (/home/robwistrand/code/ga/projects/authentic-internet/client/node_modules/@babel/parser/lib/index.js:13306:10)
    at JSXParserMixin.parseStatementContent (/home/robwistrand/code/ga/projects/authentic-internet/client/node_modules/@babel/parser/lib/index.js:12927:23)
    at JSXParserMixin.parseStatementLike (/home/robwistrand/code/ga/projects/authentic-internet/client/node_modules/@babel/parser/lib/index.js:12843:17)
    at JSXParserMixin.parseStatementListItem (/home/robwistrand/code/ga/projects/authentic-internet/client/node_modules/@babel/parser/lib/index.js:12823:17)
    at JSXParserMixin.parseBlockOrModuleBlockBody (/home/robwistrand/code/ga/projects/authentic-internet/client/node_modules/@babel/parser/lib/index.js:13392:61)
    at JSXParserMixin.parseBlockBody (/home/robwistrand/code/ga/projects/authentic-internet/client/node_modules/@babel/parser/lib/index.js:13385:10)
    at JSXParserMixin.parseBlock (/home/robwistrand/code/ga/projects/authentic-internet/client/node_modules/@babel/parser/lib/index.js:13373:10)
    at JSXParserMixin.parseFunctionBody (/home/robwistrand/code/ga/projects/authentic-internet/client/node_modules/@babel/parser/lib/index.js:12174:24)
    at JSXParserMixin.parseArrowExpression (/home/robwistrand/code/ga/projects/authentic-internet/client/node_modules/@babel/parser/lib/index.js:12149:10)
    at JSXParserMixin.parseParenAndDistinguishExpression (/home/robwistrand/code/ga/projects/authentic-internet/client/node_modules/@babel/parser/lib/index.js:11759:12)
    at JSXParserMixin.parseExprAtom (/home/robwistrand/code/ga/projects/authentic-internet/client/node_modules/@babel/parser/lib/index.js:11395:23)
    at JSXParserMixin.parseExprAtom (/home/robwistrand/code/ga/projects/authentic-internet/client/node_modules/@babel/parser/lib/index.js:4793:20)
    at JSXParserMixin.parseExprSubscripts (/home/robwistrand/code/ga/projects/authentic-internet/client/node_modules/@babel/parser/lib/index.js:11145:23)
    at JSXParserMixin.parseUpdate (/home/robwistrand/code/ga/projects/authentic-internet/client/node_modules/@babel/parser/lib/index.js:11130:21)
    at JSXParserMixin.parseMaybeUnary (/home/robwistrand/code/ga/projects/authentic-internet/client/node_modules/@babel/parser/lib/index.js:11110:23)
    at JSXParserMixin.parseMaybeUnaryOrPrivate (/home/robwistrand/code/ga/projects/authentic-internet/client/node_modules/@babel/parser/lib/index.js:10963:61)
    at JSXParserMixin.parseExprOps (/home/robwistrand/code/ga/projects/authentic-internet/client/node_modules/@babel/parser/lib/index.js:10968:23)
    at JSXParserMixin.parseMaybeConditional (/home/robwistrand/code/ga/projects/authentic-internet/client/node_modules/@babel/parser/lib/index.js:10945:23)
    at JSXParserMixin.parseMaybeAssign (/home/robwistrand/code/ga/projects/authentic-internet/client/node_modules/@babel/parser/lib/index.js:10895:21)
    at /home/robwistrand/code/ga/projects/authentic-internet/client/node_modules/@babel/parser/lib/index.js:10864:39
    at JSXParserMixin.allowInAnd (/home/robwistrand/code/ga/projects/authentic-internet/client/node_modules/@babel/parser/lib/index.js:12500:12)
    at JSXParserMixin.parseMaybeAssignAllowIn (/home/robwistrand/code/ga/projects/authentic-internet/client/node_modules/@babel/parser/lib/index.js:10864:17)
    at JSXParserMixin.parseMaybeAssignAllowInOrVoidPattern (/home/robwistrand/code/ga/projects/authentic-internet/client/node_modules/@babel/parser/lib/index.js:12567:17)
    at JSXParserMixin.parseExprListItem (/home/robwistrand/code/ga/projects/authentic-internet/client/node_modules/@babel/parser/lib/index.js:12249:18)
    at JSXParserMixin.parseCallExpressionArguments (/home/robwistrand/code/ga/projects/authentic-internet/client/node_modules/@babel/parser/lib/index.js:11316:22)
    at JSXParserMixin.parseCoverCallAndAsyncArrowHead (/home/robwistrand/code/ga/projects/authentic-internet/client/node_modules/@babel/parser/lib/index.js:11250:29)
    at JSXParserMixin.parseSubscript (/home/robwistrand/code/ga/projects/authentic-internet/client/node_modules/@babel/parser/lib/index.js:11184:19)
    at JSXParserMixin.parseSubscripts (/home/robwistrand/code/ga/projects/authentic-internet/client/node_modules/@babel/parser/lib/index.js:11158:19)
    at JSXParserMixin.parseExprSubscripts (/home/robwistrand/code/ga/projects/authentic-internet/client/node_modules/@babel/parser/lib/index.js:11149:17)
    at JSXParserMixin.parseUpdate (/home/robwistrand/code/ga/projects/authentic-internet/client/node_modules/@babel/parser/lib/index.js:11130:21)
    at JSXParserMixin.parseMaybeUnary (/home/robwistrand/code/ga/projects/authentic-internet/client/node_modules/@babel/parser/lib/index.js:11110:23)
    at JSXParserMixin.parseMaybeUnaryOrPrivate (/home/robwistrand/code/ga/projects/authentic-internet/client/node_modules/@babel/parser/lib/index.js:10963:61)
    at JSXParserMixin.parseExprOps (/home/robwistrand/code/ga/projects/authentic-internet/client/node_modules/@babel/parser/lib/index.js:10968:23)
    at JSXParserMixin.parseMaybeConditional (/home/robwistrand/code/ga/projects/authentic-internet/client/node_modules/@babel/parser/lib/index.js:10945:23)
    at JSXParserMixin.parseMaybeAssign (/home/robwistrand/code/ga/projects/authentic-internet/client/node_modules/@babel/parser/lib/index.js:10895:21)
    at /home/robwistrand/code/ga/projects/authentic-internet/client/node_modules/@babel/parser/lib/index.js:10864:39
    at JSXParserMixin.allowInAnd (/home/robwistrand/code/ga/projects/authentic-internet/client/node_modules/@babel/parser/lib/index.js:12495:16)
    at JSXParserMixin.parseMaybeAssignAllowIn (/home/robwistrand/code/ga/projects/authentic-internet/client/node_modules/@babel/parser/lib/index.js:10864:17)
    at JSXParserMixin.parseVar (/home/robwistrand/code/ga/projects/authentic-internet/client/node_modules/@babel/parser/lib/index.js:13460:91)
    at JSXParserMixin.parseVarStatement (/home/robwistrand/code/ga/projects/authentic-internet/client/node_modules/@babel/parser/lib/index.js:13306:10)
    at JSXParserMixin.parseStatementContent (/home/robwistrand/code/ga/projects/authentic-internet/client/node_modules/@babel/parser/lib/index.js:12927:23)
handleMessage @ client:702
(anonymous) @ client:550
App.jsx:32  GET http://localhost:5177/src/components/GameWorld.jsx?t=1767813426970 net::ERR_ABORTED 500 (Internal Server Error)


---

_**Agent (model default, mode Agent)**_



---


Removing the duplicate `updateUIState` declaration. It's already destructured from `gameState`, so the later declaration is redundant.


---

<tool-use data-tool-type="read" data-tool-name="read_file">
<details><summary>Tool use: **read_file** • Read file: /home/robwistrand/code/ga/projects/authentic-internet/client/src/components/GameWorld.jsx</summary>

</details>
</tool-use>

---

<tool-use data-tool-type="search" data-tool-name="grep">
<details>
<summary>Tool use: **grep** • Grep for "const updateUIState|updateUIState\s*=" in "/home/robwistrand/code/ga/projects/authentic-internet/client/src/components/GameWorld.jsx" • 2 matches</summary>

Output mode: content


| File | Content | Line |
|------|------|------|
| `client/src/components/GameWorld.jsx` | `const updateUIState = useCallback((updates) => \{` | L282 |
| `client/src/components/GameWorld.jsx` | `updateUIState=\{updateUIState\}` | L3212 |


</details>
</tool-use>

---



---


Removing the duplicate `updateUIState` declaration. It's already destructured from `gameState`, so the wrapper is unnecessary.


---

<tool-use data-tool-type="write" data-tool-name="search_replace">

<details><summary>Tool use: **search_replace** • Edit file: /home/robwistrand/code/ga/projects/authentic-internet/client/src/components/GameWorld.jsx</summary>

**Chunk 1**
Lines added: undefined, lines removed: 5

```diff
@@ -278,9 +278,4 @@
  
    // Portal notification functions are now handled by NotificationSystem
- 
-   // UI state update function - now uses gameState
-   const updateUIState = useCallback((updates) =&gt; {
-     gameState.updateUIState(updates);
-   }, [gameState]);
  
    // Quest validation: Check if gameplay actions complete quest stages
```

</details>

</tool-use>

---

<tool-use data-tool-type="generic" data-tool-name="read_lints">
<details>
          <summary>Tool use: **read_lints** • Read lints for 1 file</summary>
      
Lint paths:

- `client/src/components/GameWorld.jsx`

Lint results


**No lint errors found**
</details>
</tool-use>

---



---


Removed the duplicate `updateUIState` declaration. It's already destructured from `gameState` at the top, so the wrapper was redundant.

The error should be resolved. `updateUIState` is now only declared once (from the destructuring) and can be used throughout the component.

---

_**User (2026-01-07 03:53Z)**_

errorTracker.js:90 [unknown] Unhandled error: Uncaught ReferenceError: getCharacterPosition is not defined {source: 'http://localhost:5177/src/components/GameWorld.jsx?t=1767821486115', line: 744, column: 7} ReferenceError: getCharacterPosition is not defined
    at GameWorld.jsx:965:7
    at renderWithHooks (chunk-NUMECXU6.js?v=c9a7e100:11548:26)
    at updateFunctionComponent (chunk-NUMECXU6.js?v=c9a7e100:14582:28)
    at updateSimpleMemoComponent (chunk-NUMECXU6.js?v=c9a7e100:14463:18)
    at updateMemoComponent (chunk-NUMECXU6.js?v=c9a7e100:14366:22)
    at beginWork (chunk-NUMECXU6.js?v=c9a7e100:15977:22)
    at HTMLUnknownElement.callCallback2 (chunk-NUMECXU6.js?v=c9a7e100:3674:22)
    at Object.invokeGuardedCallbackDev (chunk-NUMECXU6.js?v=c9a7e100:3699:24)
    at invokeGuardedCallback (chunk-NUMECXU6.js?v=c9a7e100:3733:39)
    at beginWork$1 (chunk-NUMECXU6.js?v=c9a7e100:19765:15)
trackError @ errorTracker.js:90
(anonymous) @ errorTracker.js:196
invokeGuardedCallbackDev @ chunk-NUMECXU6.js?v=c9a7e100:3699
invokeGuardedCallback @ chunk-NUMECXU6.js?v=c9a7e100:3733
beginWork$1 @ chunk-NUMECXU6.js?v=c9a7e100:19765
performUnitOfWork @ chunk-NUMECXU6.js?v=c9a7e100:19198
workLoopSync @ chunk-NUMECXU6.js?v=c9a7e100:19137
renderRootSync @ chunk-NUMECXU6.js?v=c9a7e100:19116
performConcurrentWorkOnRoot @ chunk-NUMECXU6.js?v=c9a7e100:18678
workLoop @ chunk-NUMECXU6.js?v=c9a7e100:197
flushWork @ chunk-NUMECXU6.js?v=c9a7e100:176
performWorkUntilDeadline @ chunk-NUMECXU6.js?v=c9a7e100:384
GameWorld.jsx:965 Uncaught ReferenceError: getCharacterPosition is not defined
    at GameWorld.jsx:965:7
    at renderWithHooks (chunk-NUMECXU6.js?v=c9a7e100:11548:26)
    at updateFunctionComponent (chunk-NUMECXU6.js?v=c9a7e100:14582:28)
    at updateSimpleMemoComponent (chunk-NUMECXU6.js?v=c9a7e100:14463:18)
    at updateMemoComponent (chunk-NUMECXU6.js?v=c9a7e100:14366:22)
    at beginWork (chunk-NUMECXU6.js?v=c9a7e100:15977:22)
    at HTMLUnknownElement.callCallback2 (chunk-NUMECXU6.js?v=c9a7e100:3674:22)
    at Object.invokeGuardedCallbackDev (chunk-NUMECXU6.js?v=c9a7e100:3699:24)
    at invokeGuardedCallback (chunk-NUMECXU6.js?v=c9a7e100:3733:39)
    at beginWork$1 (chunk-NUMECXU6.js?v=c9a7e100:19765:15)
(anonymous) @ GameWorld.jsx:965
renderWithHooks @ chunk-NUMECXU6.js?v=c9a7e100:11548
updateFunctionComponent @ chunk-NUMECXU6.js?v=c9a7e100:14582
updateSimpleMemoComponent @ chunk-NUMECXU6.js?v=c9a7e100:14463
updateMemoComponent @ chunk-NUMECXU6.js?v=c9a7e100:14366
beginWork @ chunk-NUMECXU6.js?v=c9a7e100:15977
callCallback2 @ chunk-NUMECXU6.js?v=c9a7e100:3674
invokeGuardedCallbackDev @ chunk-NUMECXU6.js?v=c9a7e100:3699
invokeGuardedCallback @ chunk-NUMECXU6.js?v=c9a7e100:3733
beginWork$1 @ chunk-NUMECXU6.js?v=c9a7e100:19765
performUnitOfWork @ chunk-NUMECXU6.js?v=c9a7e100:19198
workLoopSync @ chunk-NUMECXU6.js?v=c9a7e100:19137
renderRootSync @ chunk-NUMECXU6.js?v=c9a7e100:19116
performConcurrentWorkOnRoot @ chunk-NUMECXU6.js?v=c9a7e100:18678
workLoop @ chunk-NUMECXU6.js?v=c9a7e100:197
flushWork @ chunk-NUMECXU6.js?v=c9a7e100:176
performWorkUntilDeadline @ chunk-NUMECXU6.js?v=c9a7e100:384
errorTracker.js:90 [unknown] Unhandled error: Uncaught ReferenceError: getCharacterPosition is not defined {source: 'http://localhost:5177/src/components/GameWorld.jsx?t=1767821486115', line: 744, column: 7} ReferenceError: getCharacterPosition is not defined
    at GameWorld.jsx:965:7
    at renderWithHooks (chunk-NUMECXU6.js?v=c9a7e100:11548:26)
    at updateFunctionComponent (chunk-NUMECXU6.js?v=c9a7e100:14582:28)
    at updateSimpleMemoComponent (chunk-NUMECXU6.js?v=c9a7e100:14463:18)
    at updateMemoComponent (chunk-NUMECXU6.js?v=c9a7e100:14366:22)
    at beginWork (chunk-NUMECXU6.js?v=c9a7e100:15977:22)
    at HTMLUnknownElement.callCallback2 (chunk-NUMECXU6.js?v=c9a7e100:3674:22)
    at Object.invokeGuardedCallbackDev (chunk-NUMECXU6.js?v=c9a7e100:3699:24)
    at invokeGuardedCallback (chunk-NUMECXU6.js?v=c9a7e100:3733:39)
    at beginWork$1 (chunk-NUMECXU6.js?v=c9a7e100:19765:15)
trackError @ errorTracker.js:90
(anonymous) @ errorTracker.js:196
invokeGuardedCallbackDev @ chunk-NUMECXU6.js?v=c9a7e100:3699
invokeGuardedCallback @ chunk-NUMECXU6.js?v=c9a7e100:3733
beginWork$1 @ chunk-NUMECXU6.js?v=c9a7e100:19765
performUnitOfWork @ chunk-NUMECXU6.js?v=c9a7e100:19198
workLoopSync @ chunk-NUMECXU6.js?v=c9a7e100:19137
renderRootSync @ chunk-NUMECXU6.js?v=c9a7e100:19116
recoverFromConcurrentError @ chunk-NUMECXU6.js?v=c9a7e100:18736
performConcurrentWorkOnRoot @ chunk-NUMECXU6.js?v=c9a7e100:18684
workLoop @ chunk-NUMECXU6.js?v=c9a7e100:197
flushWork @ chunk-NUMECXU6.js?v=c9a7e100:176
performWorkUntilDeadline @ chunk-NUMECXU6.js?v=c9a7e100:384
GameWorld.jsx:965 Uncaught ReferenceError: getCharacterPosition is not defined
    at GameWorld.jsx:965:7
    at renderWithHooks (chunk-NUMECXU6.js?v=c9a7e100:11548:26)
    at updateFunctionComponent (chunk-NUMECXU6.js?v=c9a7e100:14582:28)
    at updateSimpleMemoComponent (chunk-NUMECXU6.js?v=c9a7e100:14463:18)
    at updateMemoComponent (chunk-NUMECXU6.js?v=c9a7e100:14366:22)
    at beginWork (chunk-NUMECXU6.js?v=c9a7e100:15977:22)
    at HTMLUnknownElement.callCallback2 (chunk-NUMECXU6.js?v=c9a7e100:3674:22)
    at Object.invokeGuardedCallbackDev (chunk-NUMECXU6.js?v=c9a7e100:3699:24)
    at invokeGuardedCallback (chunk-NUMECXU6.js?v=c9a7e100:3733:39)
    at beginWork$1 (chunk-NUMECXU6.js?v=c9a7e100:19765:15)
(anonymous) @ GameWorld.jsx:965
renderWithHooks @ chunk-NUMECXU6.js?v=c9a7e100:11548
updateFunctionComponent @ chunk-NUMECXU6.js?v=c9a7e100:14582
updateSimpleMemoComponent @ chunk-NUMECXU6.js?v=c9a7e100:14463
updateMemoComponent @ chunk-NUMECXU6.js?v=c9a7e100:14366
beginWork @ chunk-NUMECXU6.js?v=c9a7e100:15977
callCallback2 @ chunk-NUMECXU6.js?v=c9a7e100:3674
invokeGuardedCallbackDev @ chunk-NUMECXU6.js?v=c9a7e100:3699
invokeGuardedCallback @ chunk-NUMECXU6.js?v=c9a7e100:3733
beginWork$1 @ chunk-NUMECXU6.js?v=c9a7e100:19765
performUnitOfWork @ chunk-NUMECXU6.js?v=c9a7e100:19198
workLoopSync @ chunk-NUMECXU6.js?v=c9a7e100:19137
renderRootSync @ chunk-NUMECXU6.js?v=c9a7e100:19116
recoverFromConcurrentError @ chunk-NUMECXU6.js?v=c9a7e100:18736
performConcurrentWorkOnRoot @ chunk-NUMECXU6.js?v=c9a7e100:18684
workLoop @ chunk-NUMECXU6.js?v=c9a7e100:197
flushWork @ chunk-NUMECXU6.js?v=c9a7e100:176
performWorkUntilDeadline @ chunk-NUMECXU6.js?v=c9a7e100:384
chunk-NUMECXU6.js?v=c9a7e100:14032 The above error occurred in the <GameWorld> component:

    at http://localhost:5177/src/components/GameWorld.jsx?t=1767821486115:97:45
    at ErrorBoundary (http://localhost:5177/src/components/ErrorBoundary.jsx:8:5)
    at Suspense
    at RenderedRoute (http://localhost:5177/node_modules/.vite/deps/react-router-dom.js?v=ce3ce900:4089:5)
    at Routes (http://localhost:5177/node_modules/.vite/deps/react-router-dom.js?v=ce3ce900:4559:5)
    at main
    at AchievementProvider (http://localhost:5177/src/context/AchievementContext.jsx:89:39)
    at div
    at App (http://localhost:5177/src/App.jsx?t=1767821486115:45:3)
    at ErrorBoundary (http://localhost:5177/src/components/ErrorBoundary.jsx:8:5)
    at GameStateProvider (http://localhost:5177/src/context/GameStateContext.jsx:98:37)
    at WebSocketProvider (http://localhost:5177/src/context/WebSocketContext.jsx:28:37)
    at AuthProvider (http://localhost:5177/src/context/AuthContext.jsx:227:32)
    at Router (http://localhost:5177/node_modules/.vite/deps/react-router-dom.js?v=ce3ce900:4502:15)
    at BrowserRouter (http://localhost:5177/node_modules/.vite/deps/react-router-dom.js?v=ce3ce900:5248:5)

React will try to recreate this component tree from scratch using the error boundary you provided, ErrorBoundary.
logCapturedError @ chunk-NUMECXU6.js?v=c9a7e100:14032
callback @ chunk-NUMECXU6.js?v=c9a7e100:14078
callCallback @ chunk-NUMECXU6.js?v=c9a7e100:11248
commitUpdateQueue @ chunk-NUMECXU6.js?v=c9a7e100:11265
commitLayoutEffectOnFiber @ chunk-NUMECXU6.js?v=c9a7e100:17075
commitLayoutMountEffects_complete @ chunk-NUMECXU6.js?v=c9a7e100:17980
commitLayoutEffects_begin @ chunk-NUMECXU6.js?v=c9a7e100:17969
commitLayoutEffects_begin @ chunk-NUMECXU6.js?v=c9a7e100:17950
commitLayoutEffects @ chunk-NUMECXU6.js?v=c9a7e100:17920
commitRootImpl @ chunk-NUMECXU6.js?v=c9a7e100:19353
commitRoot @ chunk-NUMECXU6.js?v=c9a7e100:19277
finishConcurrentRender @ chunk-NUMECXU6.js?v=c9a7e100:18760
performConcurrentWorkOnRoot @ chunk-NUMECXU6.js?v=c9a7e100:18718
workLoop @ chunk-NUMECXU6.js?v=c9a7e100:197
flushWork @ chunk-NUMECXU6.js?v=c9a7e100:176
performWorkUntilDeadline @ chunk-NUMECXU6.js?v=c9a7e100:384
ErrorBoundary.jsx:31 Error caught by boundary: ReferenceError: getCharacterPosition is not defined
    at GameWorld.jsx:965:7
    at renderWithHooks (chunk-NUMECXU6.js?v=c9a7e100:11548:26)
    at updateFunctionComponent (chunk-NUMECXU6.js?v=c9a7e100:14582:28)
    at updateSimpleMemoComponent (chunk-NUMECXU6.js?v=c9a7e100:14463:18)
    at updateMemoComponent (chunk-NUMECXU6.js?v=c9a7e100:14366:22)
    at beginWork (chunk-NUMECXU6.js?v=c9a7e100:15977:22)
    at beginWork$1 (chunk-NUMECXU6.js?v=c9a7e100:19753:22)
    at performUnitOfWork (chunk-NUMECXU6.js?v=c9a7e100:19198:20)
    at workLoopSync (chunk-NUMECXU6.js?v=c9a7e100:19137:13)
    at renderRootSync (chunk-NUMECXU6.js?v=c9a7e100:19116:15) {componentStack: '\n    at http://localhost:5177/src/components/GameW….vite/deps/react-router-dom.js?v=ce3ce900:5248:5)'}
componentDidCatch @ ErrorBoundary.jsx:31
callback @ chunk-NUMECXU6.js?v=c9a7e100:14084
callCallback @ chunk-NUMECXU6.js?v=c9a7e100:11248
commitUpdateQueue @ chunk-NUMECXU6.js?v=c9a7e100:11265
commitLayoutEffectOnFiber @ chunk-NUMECXU6.js?v=c9a7e100:17075
commitLayoutMountEffects_complete @ chunk-NUMECXU6.js?v=c9a7e100:17980
commitLayoutEffects_begin @ chunk-NUMECXU6.js?v=c9a7e100:17969
commitLayoutEffects_begin @ chunk-NUMECXU6.js?v=c9a7e100:17950
commitLayoutEffects @ chunk-NUMECXU6.js?v=c9a7e100:17920
commitRootImpl @ chunk-NUMECXU6.js?v=c9a7e100:19353
commitRoot @ chunk-NUMECXU6.js?v=c9a7e100:19277
finishConcurrentRender @ chunk-NUMECXU6.js?v=c9a7e100:18760
performConcurrentWorkOnRoot @ chunk-NUMECXU6.js?v=c9a7e100:18718
workLoop @ chunk-NUMECXU6.js?v=c9a7e100:197
flushWork @ chunk-NUMECXU6.js?v=c9a7e100:176
performWorkUntilDeadline @ chunk-NUMECXU6.js?v=c9a7e100:384
errorTracker.js:138  POST http://localhost:5177/api/diagnostics/errors net::ERR_ABORTED 500 (Internal Server Error)
reportErrorToServer @ errorTracker.js:138
trackError @ errorTracker.js:106
(anonymous) @ errorTracker.js:196
invokeGuardedCallbackDev @ chunk-NUMECXU6.js?v=c9a7e100:3699
invokeGuardedCallback @ chunk-NUMECXU6.js?v=c9a7e100:3733
beginWork$1 @ chunk-NUMECXU6.js?v=c9a7e100:19765
performUnitOfWork @ chunk-NUMECXU6.js?v=c9a7e100:19198
workLoopSync @ chunk-NUMECXU6.js?v=c9a7e100:19137
renderRootSync @ chunk-NUMECXU6.js?v=c9a7e100:19116
performConcurrentWorkOnRoot @ chunk-NUMECXU6.js?v=c9a7e100:18678
workLoop @ chunk-NUMECXU6.js?v=c9a7e100:197
flushWork @ chunk-NUMECXU6.js?v=c9a7e100:176
performWorkUntilDeadline @ chunk-NUMECXU6.js?v=c9a7e100:384
errorTracker.js:152 Error reporting to server: Error: Server returned 500: Internal Server Error
    at reportErrorToServer (errorTracker.js:145:13)
reportErrorToServer @ errorTracker.js:152
await in reportErrorToServer
trackError @ errorTracker.js:106
(anonymous) @ errorTracker.js:196
invokeGuardedCallbackDev @ chunk-NUMECXU6.js?v=c9a7e100:3699
invokeGuardedCallback @ chunk-NUMECXU6.js?v=c9a7e100:3733
beginWork$1 @ chunk-NUMECXU6.js?v=c9a7e100:19765
performUnitOfWork @ chunk-NUMECXU6.js?v=c9a7e100:19198
workLoopSync @ chunk-NUMECXU6.js?v=c9a7e100:19137
renderRootSync @ chunk-NUMECXU6.js?v=c9a7e100:19116
performConcurrentWorkOnRoot @ chunk-NUMECXU6.js?v=c9a7e100:18678
workLoop @ chunk-NUMECXU6.js?v=c9a7e100:197
flushWork @ chunk-NUMECXU6.js?v=c9a7e100:176
performWorkUntilDeadline @ chunk-NUMECXU6.js?v=c9a7e100:384
errorTracker.js:113 Failed to report critical error to server: Error: Server returned 500: Internal Server Error
    at reportErrorToServer (errorTracker.js:145:13)
(anonymous) @ errorTracker.js:113
Promise.catch
trackError @ errorTracker.js:106
(anonymous) @ errorTracker.js:196
invokeGuardedCallbackDev @ chunk-NUMECXU6.js?v=c9a7e100:3699
invokeGuardedCallback @ chunk-NUMECXU6.js?v=c9a7e100:3733
beginWork$1 @ chunk-NUMECXU6.js?v=c9a7e100:19765
performUnitOfWork @ chunk-NUMECXU6.js?v=c9a7e100:19198
workLoopSync @ chunk-NUMECXU6.js?v=c9a7e100:19137
renderRootSync @ chunk-NUMECXU6.js?v=c9a7e100:19116
performConcurrentWorkOnRoot @ chunk-NUMECXU6.js?v=c9a7e100:18678
workLoop @ chunk-NUMECXU6.js?v=c9a7e100:197
flushWork @ chunk-NUMECXU6.js?v=c9a7e100:176
performWorkUntilDeadline @ chunk-NUMECXU6.js?v=c9a7e100:384
errorTracker.js:138  POST http://localhost:5177/api/diagnostics/errors net::ERR_ABORTED 500 (Internal Server Error)
reportErrorToServer @ errorTracker.js:138
trackError @ errorTracker.js:106
(anonymous) @ errorTracker.js:196
invokeGuardedCallbackDev @ chunk-NUMECXU6.js?v=c9a7e100:3699
invokeGuardedCallback @ chunk-NUMECXU6.js?v=c9a7e100:3733
beginWork$1 @ chunk-NUMECXU6.js?v=c9a7e100:19765
performUnitOfWork @ chunk-NUMECXU6.js?v=c9a7e100:19198
workLoopSync @ chunk-NUMECXU6.js?v=c9a7e100:19137
renderRootSync @ chunk-NUMECXU6.js?v=c9a7e100:19116
recoverFromConcurrentError @ chunk-NUMECXU6.js?v=c9a7e100:18736
performConcurrentWorkOnRoot @ chunk-NUMECXU6.js?v=c9a7e100:18684
workLoop @ chunk-NUMECXU6.js?v=c9a7e100:197
flushWork @ chunk-NUMECXU6.js?v=c9a7e100:176
performWorkUntilDeadline @ chunk-NUMECXU6.js?v=c9a7e100:384
errorTracker.js:152 Error reporting to server: Error: Server returned 500: Internal Server Error
    at reportErrorToServer (errorTracker.js:145:13)
reportErrorToServer @ errorTracker.js:152
await in reportErrorToServer
trackError @ errorTracker.js:106
(anonymous) @ errorTracker.js:196
invokeGuardedCallbackDev @ chunk-NUMECXU6.js?v=c9a7e100:3699
invokeGuardedCallback @ chunk-NUMECXU6.js?v=c9a7e100:3733
beginWork$1 @ chunk-NUMECXU6.js?v=c9a7e100:19765
performUnitOfWork @ chunk-NUMECXU6.js?v=c9a7e100:19198
workLoopSync @ chunk-NUMECXU6.js?v=c9a7e100:19137
renderRootSync @ chunk-NUMECXU6.js?v=c9a7e100:19116
recoverFromConcurrentError @ chunk-NUMECXU6.js?v=c9a7e100:18736
performConcurrentWorkOnRoot @ chunk-NUMECXU6.js?v=c9a7e100:18684
workLoop @ chunk-NUMECXU6.js?v=c9a7e100:197
flushWork @ chunk-NUMECXU6.js?v=c9a7e100:176
performWorkUntilDeadline @ chunk-NUMECXU6.js?v=c9a7e100:384
errorTracker.js:113 Failed to report critical error to server: Error: Server returned 500: Internal Server Error
    at reportErrorToServer (errorTracker.js:145:13)
(anonymous) @ errorTracker.js:113
Promise.catch
trackError @ errorTracker.js:106
(anonymous) @ errorTracker.js:196
invokeGuardedCallbackDev @ chunk-NUMECXU6.js?v=c9a7e100:3699
invokeGuardedCallback @ chunk-NUMECXU6.js?v=c9a7e100:3733
beginWork$1 @ chunk-NUMECXU6.js?v=c9a7e100:19765
performUnitOfWork @ chunk-NUMECXU6.js?v=c9a7e100:19198
workLoopSync @ chunk-NUMECXU6.js?v=c9a7e100:19137
renderRootSync @ chunk-NUMECXU6.js?v=c9a7e100:19116
recoverFromConcurrentError @ chunk-NUMECXU6.js?v=c9a7e100:18736
performConcurrentWorkOnRoot @ chunk-NUMECXU6.js?v=c9a7e100:18684
workLoop @ chunk-NUMECXU6.js?v=c9a7e100:197
flushWork @ chunk-NUMECXU6.js?v=c9a7e100:176
performWorkUntilDeadline @ chunk-NUMECXU6.js?v=c9a7e100:384


---

_**Agent (model default, mode Agent)**_

<think><details><summary>Thought Process</summary>
**Fixing ReferenceError**

I need to address the ReferenceError stating that `getCharacterPosition` is not defined. This seems to be related to the GameWorld context. It’s likely that this helper function was previously defined but removed during a transition to gameState. I’ll check around the specified line numbers in the code for its usage. It might be a good idea to define `getCharacterPosition` again or replace it with the already destructured `characterPosition` to enhance robustness. Let’s search for it!</details></think>

---

Got it—this is another fallout from the state refactor: `getCharacterPosition` is referenced (and even used in dependency arrays), but the function itself no longer exists. I’ll locate all uses in `GameWorld.jsx`, then either reintroduce it (as a small wrapper) or replace calls with `characterPosition` directly—whichever is safest.

---

<tool-use data-tool-type="search" data-tool-name="grep">
<details>
<summary>Tool use: **grep** • Grep for "getCharacterPosition" in "/home/robwistrand/code/ga/projects/authentic-internet/client/src/components/GameWorld.jsx" • 2 matches</summary>

Output mode: content


| File | Content | Line |
|------|------|------|
| `client/src/components/GameWorld.jsx` | `\}, [getCharacterPosition]); // Remove exploredTiles from dependencies` | L965 |
| `client/src/components/GameWorld.jsx` | `\}, [currentMapNPCs, gameState.gameData.databaseNPCs, getCharacterPosition]);` | L1646 |


</details>
</tool-use>

---

<tool-use data-tool-type="read" data-tool-name="read_file">
<details><summary>Tool use: **read_file** • Read file: /home/robwistrand/code/ga/projects/authentic-internet/client/src/components/GameWorld.jsx</summary>

</details>
</tool-use>

---

<tool-use data-tool-type="read" data-tool-name="read_file">
<details><summary>Tool use: **read_file** • Read file: /home/robwistrand/code/ga/projects/authentic-internet/client/src/components/GameWorld.jsx</summary>

</details>
</tool-use>

---

<think><details><summary>Thought Process</summary>
**Evaluating dependencies in code**

I see that the function getCharacterPosition is only referenced in dependencies, while the effect directly uses gameState.characterPosition. It seems like it should depend on characterPosition or currentMapIndex. I need to recognize that explored tiles update whenever characterPosition changes. So, it makes sense to replace the dependency array from [getCharacterPosition] to either [characterPosition] or [gameState.characterPosition]. I also noticed that findNearbyNPC’s useCallback dependency includes getCharacterPosition, likely indicating a reliance on characterPosition in that function as well. I'll check around lines 1630-1655.</details></think>

---

<tool-use data-tool-type="read" data-tool-name="read_file">
<details><summary>Tool use: **read_file** • Read file: /home/robwistrand/code/ga/projects/authentic-internet/client/src/components/GameWorld.jsx</summary>

</details>
</tool-use>

---

<tool-use data-tool-type="read" data-tool-name="read_file">
<details><summary>Tool use: **read_file** • Read file: /home/robwistrand/code/ga/projects/authentic-internet/client/src/components/GameWorld.jsx</summary>

</details>
</tool-use>

---

<think><details><summary>Thought Process</summary>
**Analyzing JS declarations**

In JavaScript, I realize that `const` declarations aren't hoisted, meaning they must be defined before use. When executing the module, it evaluates top-to-bottom, so I need to declare `getCharacterPosition` before using it in the dependency array at line 965. I’ll update the `findNearbyNPC` dependency array to include `characterPosition`. 

It's okay to keep `getCharacterPosition`, but the closure captures the variable values at render time, ensuring that it reflects the latest `characterPosition` even without being recreated.
**Updating React dependencies**

I realized that if the callback isn't recreated on new renders, it retains the old `characterPosition`. In React, when state changes, the component re-renders, but if the dependencies array doesn’t include `characterPosition`, the callback stays the same, causing a bug. I need to include `characterPosition` or something that changes with it, like `getCharacterPosition`. Since `findNearbyNPC` depends on `getCharacterPosition`, it’ll update correctly.

For the explored tiles effect, it also relies on `getCharacterPosition` but doesn't call it directly, which is fine. I'll patch it by adding `getCharacterPosition` in `useCallback`, and I'll adjust the explored tiles effect to use `characterPosition` instead of `gameState.characterPosition`.
**Implementing patches and updates**

I’m noting that it's always an "object." So, I should consider patching to minimize errors while updating `currentMap` memo dependencies to use `currentMapIndex`. While it's not strictly necessary, it could help reduce errors. I’ll go ahead and implement this patch, then run linters on the file to ensure everything is clean and follows the style guidelines. Let's make sure everything is tidy and functioning smoothly!</details></think>

---

Nice—this one’s a clean root cause: `getCharacterPosition` is referenced in a couple dependency arrays, but the function itself was never defined after the refactor. I’m going to reintroduce it as a tiny `useCallback(() => characterPosition, [characterPosition])` so those hooks update correctly and the runtime error disappears.

---

<tool-use data-tool-type="unknown" data-tool-name="apply_patch">
<details>
<summary>Tool use: **apply_patch**</summary>


Parameters:

```json
{
  "relativeWorkspacePath": "client/src/components/GameWorld.jsx"
}
```
Additional data:

```json
{
  "codeblockId": "47221893-2cfe-4d26-b77d-31959d7d4967",
  "codeblock": {
    "uri": {
      "scheme": "file",
      "authority": "",
      "path": "/home/robwistrand/code/ga/projects/authentic-internet/client/src/components/GameWorld.jsx",
      "query": "",
      "fragment": "",
      "_formatted": "file:///home/robwistrand/code/ga/projects/authentic-internet/client/src/components/GameWorld.jsx",
      "_fsPath": "/home/robwistrand/code/ga/projects/authentic-internet/client/src/components/GameWorld.jsx"
    },
    "codeblockId": "47221893-2cfe-4d26-b77d-31959d7d4967",
    "codeBlockIdx": 0,
    "content": "import React, {\n  useState,\n  useEffect,\n  useRef,\n  useCallback,\n  useMemo,\n} from \"react\";\nimport {\n  fetchArtifacts,\n  createArtifact,\n  fetchCharacter,\n  updateCharacter,\n  updateUserExperience,\n  fetchQuests,\n  completeQuestStage,\n} from \"../api/api\";\nimport Character from \"./Character\";\nimport ArtifactCreation from \"./ArtifactCreation\";\nimport InventoryManager from \"./managers/InventoryManager\";\nimport ErrorBoundary from \"./ErrorBoundary\";\nimport MapComponent from \"./Map\";\nimport WorldMap from \"./WorldMap\";\nimport FeedbackForm from \"./FeedbackForm\";\nimport CharacterController from \"./controllers/CharacterController\";\nimport GameHUD from \"./UI/GameHUD\";\nimport { getPowerDefinition } from \"../constants/Powers\";\nimport ControlsGuide from \"./UI/ControlsGuide\";\nimport TouchControls from \"./TouchControls\";\nimport Minimap from \"./UI/Minimap\";\nimport CombatManager from \"./Combat/CombatManager\";\nimport { TILE_SIZE, MAP_COLS, MAP_ROWS } from \"./Constants\";\nimport { MAPS } from \"./GameData\";\nimport \"./GameWorld.css\";\nimport \"./Character.css\";\nimport \"./Artifact.css\";\nimport \"./Inventory.css\";\nimport SavedQuotes from \"./SavedQuotes\";\nimport RewardModal from \"./RewardModal\";\nimport LevelUpModal from \"./UI/LevelUpModal\";\nimport DialogBox from \"./DialogBox\";\nimport TextAdventure from \"./TextAdventure\";\nimport SoundManager from \"./utils/SoundManager\";\nimport ArtifactDiscovery from \"./ArtifactDiscovery\";\nimport NotificationSystem from \"./systems/NotificationSystem\";\nimport { useNotification } from \"./systems/useNotification\";\n// XPNotification and AchievementNotification are now handled by NotificationSystem\nimport Level3Terminal from \"./Level3Terminal\";\nimport Level4Shooter from \"./Level4Shooter\";\nimport HemingwayChallenge from \"./HemingwayChallenge\";\nimport ArtifactGameLauncher from \"./ArtifactGameLauncher\";\nimport MultiplayerChat from \"./MultiplayerChat\";\nimport NPCInteraction from \"./NPCs/NPCInteraction\";\nimport Dungeon from \"./Dungeons/Dungeon\";\nimport { LIBRARY_OF_ALEXANDRIA } from \"./Dungeons/DungeonData\";\nimport HamletFinale from \"./MiniGames/HamletFinale\";\nimport QuestCompletionCelebration from \"./QuestCompletionCelebration\";\nimport { useAuth } from \"../context/AuthContext\";\nimport { useAchievements } from \"../context/AchievementContext\";\nimport { useGameState as useGameStateContext } from \"../context/GameStateContext\";\nimport { useGameState } from \"../hooks/useGameState\";\nimport { useWebSocket } from \"../context/WebSocketContext\";\nimport gameStateManager from \"../utils/gameStateManager\";\nimport { IconButton } from \"@mui/material\";\nimport { usePortalCollisions } from \"../hooks/usePortalCollisions\";\n\n// Performance monitoring\nconst PERFORMANCE_MARKERS = {\n  RENDER_START: \"gameworld-render-start\",\n  RENDER_END: \"gameworld-render-end\",\n  STATE_UPDATE: \"gameworld-state-update\",\n  PORTAL_TRANSITION: \"gameworld-portal-transition\",\n};\n\n// Memoized constants to prevent recreation\nconst INITIAL_CHARACTER_POSITION = { x: 64, y: 64 };\nconst INITIAL_VIEWPORT = { x: 0, y: 0 };\nconst INITIAL_LEVEL_COMPLETION = {\n  level1: false,\n  level2: false,\n  level3: false,\n  level4: false,\n};\n\nconst GameWorld = React.memo(() =&gt; {\n  // Initialization guard to prevent render-order issues\n  const [isInitialized, setIsInitialized] = useState(false);\n  const [showLevelUpModal, setShowLevelUpModal] = useState(false);\n\n  // Use the custom game state hook\n  const gameState = useGameState();\n\n  // Destructure state values and setters from gameState\n  const {\n    // State values\n    currentMapIndex,\n    characterPosition,\n    viewport,\n    exploredTiles,\n    inventory,\n    character,\n    visibleArtifact,\n    currentSpecialWorld,\n    characterStats,\n    uiState,\n    questStatusMap,\n    mobileState,\n    portalState,\n    // Setters\n    setCurrentMapIndex,\n    setCharacterPosition,\n    setViewport,\n    setExploredTiles,\n    setInventory,\n    setCharacter,\n    setVisibleArtifact,\n    setCurrentSpecialWorld,\n    setCharacterStats,\n    setPlayerHealth,\n    setMaxPlayerHealth,\n    setPortalState,\n    setGameData,\n    updateUIState,\n    setActiveNPC,\n    setSelectedUserArtifact,\n    setIsInvincible,\n    setRupees,\n    setKeys,\n    setCharacterState,\n    setQuestStatusMap,\n    setMobileState,\n  } = gameState;\n\n  // Performance tracking\n  const renderCount = useRef(0);\n  const lastRenderTime = useRef(performance.now());\n  const lastUpdateTime = useRef(performance.now());\n  const updateThrottle = useRef(16); // 16ms throttle (60fps)\n\n  // All state is now managed by the gameState hook\n\n  // Context hooks\n  const { user } = useAuth();\n  const {\n    unlockAchievement,\n    checkLevelAchievements,\n    checkDiscoveryAchievements,\n    checkCollectionAchievements,\n  } = useAchievements();\n  const { updateGameProgress } = useGameStateContext();\n  const {\n    addXPNotification,\n    addAchievementNotification,\n    showPortalNotification,\n    hidePortalNotification,\n    createInteractiveNotification,\n    setPortalNotificationActive,\n  } = useNotification();\n\n  // WebSocket connection for multiplayer\n  const { socket, isConnected, sendMessage } = useWebSocket();\n  const gameWorldRef = useRef(null);\n  const characterRef = useRef(null);\n  const characterControllerRef = useRef(null);\n\n  // portalNotificationActive is now handled by NotificationSystem\n\n  // Update checkForLevelUpAchievements to use our context\n  const checkForLevelUpAchievements = useCallback(\n    (experience) =&gt; {\n      const level = Math.floor(experience / 100) + 1;\n      checkLevelAchievements(level);\n    },\n    [checkLevelAchievements],\n  );\n\n  // Fetch active quests on mount and when user changes\n  useEffect(() =&gt; {\n    if (user?.id) {\n      fetchQuests()\n        .then((response) =&gt; {\n          if (response.success) {\n            gameState.setActiveQuests(response.data.activeQuests || []);\n            gameState.setCompletedQuests(response.data.completedQuests || []);\n          }\n        })\n        .catch((err) =&gt; console.error(\"Error fetching quests:\", err));\n    }\n  }, [user?.id]);\n\n  // Create quest status map for NPCs when quests or current map changes\n  useEffect(() =&gt; {\n    if (!MAPS[currentMapIndex]?.npcs) return;\n\n    const statusMap = new Map();\n    const currentNPCs = MAPS[currentMapIndex].npcs || [];\n\n    currentNPCs.forEach((npc) =&gt; {\n      const npcId = npc._id || npc.id;\n      if (!npcId) return;\n\n      // Check if NPC has any active quests\n      const npcActiveQuests = gameState.activeQuests.filter(\n        (quest) =&gt;\n          quest.npcId === npcId ||\n          quest.npcId?.toString() === npcId?.toString(),\n      );\n\n      // Check if NPC has any completed quests\n      const npcCompletedQuests = gameState.completedQuests.filter(\n        (quest) =&gt;\n          quest.npcId === npcId ||\n          quest.npcId?.toString() === npcId?.toString(),\n      );\n\n      // Check if NPC has quests in their data (available but not started)\n      const hasQuestsData = npc.quests &amp;&amp; npc.quests.length &gt; 0;\n\n      // Determine status: available &gt; active &gt; completed\n      if (\n        hasQuestsData &amp;&amp;\n        npcActiveQuests.length === 0 &amp;&amp;\n        npcCompletedQuests.length === 0\n      ) {\n        // Has quests in data but none started/completed = available\n        statusMap.set(npcId, {\n          status: \"available\",\n          icon: \"!\",\n          color: \"#f39c12\",\n          title: \"Has available quests!\",\n        });\n      } else if (npcActiveQuests.length &gt; 0) {\n        // Has active quests\n        statusMap.set(npcId, {\n          status: \"active\",\n          icon: \"?\",\n          color: \"#3498db\",\n          title: \"Has active quests\",\n        });\n      } else if (npcCompletedQuests.length &gt; 0) {\n        // Has completed quests\n        statusMap.set(npcId, {\n          status: \"completed\",\n          icon: \"✓\",\n          color: \"#27ae60\",\n          title: \"Quest completed\",\n        });\n      }\n    });\n\n    setQuestStatusMap(statusMap);\n  }, [gameState.activeQuests, gameState.completedQuests, currentMapIndex, setQuestStatusMap]);\n\n  // Screen reader announcement function\n  const announceToScreenReader = useCallback((message) =&gt; {\n    const announcementsElement = document.getElementById(\n      \"screen-reader-announcements\",\n    );\n    if (announcementsElement) {\n      announcementsElement.textContent = message;\n      // Clear after a short delay to allow re-announcement\n      setTimeout(() =&gt; {\n        announcementsElement.textContent = \"\";\n      }, 1000);\n    }\n  }, []);\n\n  // Get Shakespeare quest from active quests\n  const shakespeareQuest = useMemo(() =&gt; {\n    return (\n      gameState.activeQuests.find(\n        (quest) =&gt;\n          quest.npcId === \"shakespeare\" ||\n          quest.title?.includes(\"Shakespeare\") ||\n          quest.title?.includes(\"Tempest\"),\n      ) || { stage: \"not_started\" }\n    );\n  }, [gameState.activeQuests]);\n\n  // Portal notification functions are now handled by NotificationSystem\n\n  // Quest validation: Check if gameplay actions complete quest stages\n  const validateQuestProgress = useCallback(\n    async (actionType, actionData = {}) =&gt; {\n      if (gameState.activeQuests.length === 0) return;\n\n      for (const quest of gameState.activeQuests) {\n        const currentStage = quest.stages?.[quest.currentStage];\n        if (!currentStage || currentStage.completed) continue;\n\n        const task = currentStage.task?.toLowerCase() || \"\";\n        let shouldComplete = false;\n\n        // Check task requirements\n        if (actionType === \"artifact_collected\" &amp;&amp; task.includes(\"collect\")) {\n          // Check if task mentions artifacts or specific artifact\n          if (task.includes(\"artifact\") || task.includes(\"item\")) {\n            shouldComplete = true;\n          }\n        } else if (\n          actionType === \"game_completed\" &amp;&amp;\n          task.includes(\"complete\")\n        ) {\n          // Check if task mentions games or mini-games\n          if (\n            task.includes(\"game\") ||\n            task.includes(\"mini-game\") ||\n            task.includes(\"challenge\")\n          ) {\n            shouldComplete = true;\n          }\n        } else if (\n          actionType === \"artifact_discovered\" &amp;&amp;\n          task.includes(\"discover\")\n        ) {\n          shouldComplete = true;\n        }\n\n        if (shouldComplete) {\n          try {\n            const response = await completeQuestStage(\n              quest.questId,\n              quest.currentStage,\n            );\n            if (response.success) {\n              // Refresh quests\n              const questResponse = await fetchQuests();\n              if (questResponse.success) {\n                gameState.setActiveQuests(questResponse.data.activeQuests || []);\n                gameState.setCompletedQuests(questResponse.data.completedQuests || []);\n              }\n\n              const rewards = response.data.rewards;\n\n              // If quest is fully completed, show celebration\n              if (response.data.questCompleted) {\n                const completedQuest = {\n                  title: quest.title,\n                  description: quest.description,\n                };\n                gameState.setQuestCompletionCelebration({\n                  quest: completedQuest,\n                  rewards: rewards,\n                });\n              } else {\n                // Show progress notification for stage completion\n                let rewardText = &#96;Quest progress!&#96;;\n                if (rewards.exp) rewardText += &#96; +${rewards.exp} XP&#96;;\n                if (rewards.item) rewardText += &#96; +${rewards.item}&#96;;\n\n                // Show a brief notification\n                showPortalNotification(\"Quest Progress\", rewardText);\n                setTimeout(() =&gt; hidePortalNotification(), 3000);\n              }\n            }\n          } catch (error) {\n            console.error(\"Error completing quest stage:\", error);\n          }\n        }\n      }\n    },\n    [gameState.activeQuests, showPortalNotification, hidePortalNotification],\n  );\n\n  // Function to add XP and show notification\n  const addExperiencePoints = useCallback(\n    (amount, reason) =&gt; {\n      // Update local experience state\n      const newExperience = (user?.experience || 0) + amount;\n\n      const newHealth = Math.max(0, gameState.playerHealth - damage);\n      setPlayerHealth(newHealth);\n\n      // Play damage sound\n      if (gameState.soundManager) {\n        gameState.soundManager.playSound(\"damage\", 0.5);\n      }\n\n      // Trigger hit animation (retreat and flash)\n      setCharacterState((prev) =&gt; ({ ...prev, isHit: true }));\n      setTimeout(() =&gt; {\n        setCharacterState((prev) =&gt; ({ ...prev, isHit: false }));\n      }, 400); // Match CSS animation duration\n\n      // Invincibility frames\n      setIsInvincible(true);\n      setTimeout(() =&gt; setIsInvincible(false), 1000);\n\n      // Check for game over\n      if (newHealth &lt;= 0) {\n        handleGameOver();\n      }\n    },\n    [gameState.playerHealth, gameState.isInvincible, gameState.soundManager],\n  );\n\n  const handlePlayerHeal = useCallback(\n    (amount) =&gt; {\n      const newHealth = Math.min(gameState.maxPlayerHealth, gameState.playerHealth + amount);\n      setPlayerHealth(newHealth);\n\n      if (gameState.soundManager) {\n        gameState.soundManager.playSound(\"heal\", 0.3);\n      }\n    },\n    [gameState.playerHealth, gameState.maxPlayerHealth, gameState.soundManager],\n  );\n\n  const handleCollectRupee = useCallback(\n    (amount) =&gt; {\n      setRupees((prev) =&gt; prev + amount);\n\n      if (gameState.soundManager) {\n        gameState.soundManager.playSound(\"rupee\", 0.3);\n      }\n    },\n    [gameState.soundManager],\n  );\n\n  const handleCollectKey = useCallback(() =&gt; {\n    setKeys((prev) =&gt; prev + 1);\n\n    if (gameState.soundManager) {\n      gameState.soundManager.playSound(\"key\", 0.3);\n    }\n  }, [gameState.soundManager]);\n\n  // XP and Leveling System\n  // Calculate XP required for next level\n  const calculateXPForLevel = useCallback((level) =&gt; {\n    return Math.floor(100 * Math.pow(1.5, level - 1));\n  }, []);\n\n  // Handle gaining experience with level-up logic\n  const handleGainExperience = useCallback(\n    (amount, source = \"Unknown\", position = null) =&gt; {\n      console.log(&#96;Gained ${amount} XP from: ${source}&#96;);\n\n      // Add XP notification at enemy position\n      if (position) {\n        addXPNotification(amount, source, position);\n      }\n\n      setCharacterStats((prev) =&gt; {\n        const newXP = prev.experience + amount;\n        const xpNeeded = calculateXPForLevel(prev.level + 1);\n\n        // Check for level up\n        if (newXP &gt;= xpNeeded) {\n          const newLevel = prev.level + 1;\n          const newMaxHealth = gameState.maxPlayerHealth + 2;\n          const newAttack = prev.attack + 1;\n          const newDefense =\n            newLevel % 2 === 0 ? prev.defense + 1 : prev.defense;\n\n          // Full heal on level up\n          setPlayerHealth(newMaxHealth);\n          setMaxPlayerHealth(newMaxHealth);\n\n          // Show level-up modal\n          setShowLevelUpModal(true);\n\n          // Play level-up sound\n          if (gameState.soundManager) {\n            gameState.soundManager.playSound(\"powerup\", 0.7); // Use powerup sound for now\n          }\n\n          console.log(&#96;🌟 LEVEL UP! Now level ${newLevel}&#96;);\n          console.log(&#96;  +2 Max Health (${newMaxHealth})&#96;);\n          console.log(&#96;  +1 Attack (${newAttack})&#96;);\n          if (newLevel % 2 === 0) {\n            console.log(&#96;  +1 Defense (${newDefense})&#96;);\n          }\n\n          return {\n            experience: newXP,\n            level: newLevel,\n            attack: newAttack,\n            defense: newDefense,\n          };\n        }\n\n        return { ...prev, experience: newXP };\n      });\n    },\n    [calculateXPForLevel, gameState.maxPlayerHealth, gameState.soundManager],\n  );\n\n  // Alias for handleGainExperience to match existing code that uses awardXP\n  const awardXP = useCallback(\n    (amount, reason) =&gt; {\n      handleGainExperience(amount, reason, null);\n    },\n    [handleGainExperience],\n  );\n\n  // Viewport adjustment function to follow character\n  const adjustViewport = useCallback(\n    (characterPos) =&gt; {\n      if (!characterPos || typeof gameState.currentMapIndex !== \"number\") return;\n\n      const gameWorldElement = document.querySelector(\".game-world\");\n      if (!gameWorldElement) return;\n\n      const viewportWidth = window.innerWidth;\n      const viewportHeight = window.innerHeight;\n\n      // Calculate new viewport position to center character\n      const newViewportX = Math.max(0, characterPos.x - viewportWidth / 2);\n      const newViewportY = Math.max(0, characterPos.y - viewportHeight / 2);\n\n      // Get map dimensions\n      const currentMapData = MAPS[gameState.currentMapIndex];\n      if (currentMapData &amp;&amp; currentMapData.data) {\n        const mapWidth = currentMapData.data[0]?.length * TILE_SIZE || 800;\n        const mapHeight = currentMapData.data.length * TILE_SIZE || 600;\n\n        // Clamp viewport to map boundaries\n        const clampedX = Math.min(\n          newViewportX,\n          Math.max(0, mapWidth - viewportWidth),\n        );\n        const clampedY = Math.min(\n          newViewportY,\n          Math.max(0, mapHeight - viewportHeight),\n        );\n\n        setViewport({ x: clampedX, y: clampedY });\n      }\n    },\n    [gameState.currentMapIndex],\n  );\n\n  // updateNotifications is now handled by NotificationSystem\n\n  const updateCharacterState = useCallback((updates) =&gt; {\n    setCharacterState((prev) =&gt; ({ ...prev, ...updates }));\n  }, []);\n\n  const updatePortalState = useCallback((updates) =&gt; {\n    setPortalState((prev) =&gt; ({ ...prev, ...updates }));\n  }, []);\n\n  // Optimized state update function\n  const updateGameState = useCallback(\n    (updates) =&gt; {\n      const now = performance.now();\n      if (now - lastUpdateTime.current &lt; updateThrottle.current) {\n        return; // Throttle updates\n      }\n      lastUpdateTime.current = now;\n      setGameData((prev) =&gt; ({ ...prev, ...updates }));\n    },\n    [],\n  );\n\n  // Show world announcement when transitioning to new area\n  const showWorldAnnouncement = useCallback((worldName) =&gt; {\n    // Create the announcement element if it doesn't exist\n    let announcement = document.getElementById(\"world-announcement\");\n\n    if (!announcement) {\n      announcement = document.createElement(\"div\");\n      announcement.id = \"world-announcement\";\n      announcement.className = \"world-announcement\";\n      document.body.appendChild(announcement);\n    }\n\n    // Update announcement content\n    announcement.innerHTML = &#96;&lt;h2&gt;Welcome to ${worldName}&lt;/h2&gt;&#96;;\n\n    // Make announcement visible\n    setTimeout(() =&gt; {\n      announcement.classList.add(\"active\");\n    }, 10);\n\n    // Auto-hide after 3 seconds\n    setTimeout(() =&gt; {\n      announcement.classList.add(\"fade-out\");\n      setTimeout(() =&gt; {\n        if (announcement &amp;&amp; announcement.parentNode) {\n          announcement.parentNode.removeChild(announcement);\n        }\n      }, 1000);\n    }, 3000);\n  }, []);\n\n  // Optimized level completion handler\n  const handleLevelCompletion = useCallback(\n    (level) =&gt; {\n      if (gameState.gameData.levelCompletion[level]) return; // Already completed\n\n      updateGameState({\n        levelCompletion: { ...gameState.gameData.levelCompletion, [level]: true },\n      });\n\n      updateUIState({\n        showWinNotification: true,\n        winMessage: &#96;Level ${level} Complete!&#96;,\n      });\n\n      // Play completion sound\n      if (gameState.soundManager) {\n        gameState.soundManager.playSound(\"level_complete\");\n      }\n\n      // Award experience\n      if (user) {\n        updateUserExperience(user.id, 100);\n      }\n\n      // Check achievements\n      checkLevelAchievements(level);\n    },\n    [\n      gameState.gameData.levelCompletion,\n      updateGameState,\n      gameState.soundManager,\n      user,\n      checkLevelAchievements,\n    ],\n  );\n\n  // Handle portal transitions with performance optimization\n  const handlePortalTransition = useCallback(\n    (destinationMap, spawnPosition, isSpecial = false) =&gt; {\n      if (portalState.isTransitioning) return;\n\n      performance.mark(PERFORMANCE_MARKERS.PORTAL_TRANSITION);\n\n      updatePortalState({ isTransitioning: true });\n\n      // Play portal sound\n      if (gameState.soundManager) {\n        gameState.soundManager.playSound(\"portal\");\n      }\n\n      // Add portal transition animation\n      const gameWorld = document.querySelector(\".game-world\");\n      if (gameWorld) {\n        gameWorld.classList.add(\"portal-transition\");\n      }\n\n      // Use requestAnimationFrame for smooth transitions\n      const transitionAnimation = () =&gt; {\n        setTimeout(() =&gt; {\n          if (isSpecial) {\n            setCurrentSpecialWorld(destinationMap);\n          } else {\n            const destinationIndex = MAPS.findIndex(\n              (map) =&gt; map.name === destinationMap,\n            );\n            if (destinationIndex !== -1) {\n              setCurrentMapIndex(destinationIndex);\n              setCharacterPosition(spawnPosition);\n\n              // Show world announcement\n              showWorldAnnouncement(destinationMap);\n\n              // Handle level completion for Yosemite\n              if (destinationMap === \"Yosemite\") {\n                setTimeout(() =&gt; {\n                  handleLevelCompletion(\"level1\");\n                }, 800);\n              }\n            } else {\n              console.error(\n                &#96;Destination map \"${destinationMap}\" not found&#96;,\n              );\n            }\n          }\n\n          // Remove transition animation\n          if (gameWorld) {\n            gameWorld.classList.remove(\"portal-transition\");\n          }\n\n          updatePortalState({\n            isTransitioning: false,\n            activePortal: null,\n            portalNotificationActive: false,\n          });\n          hidePortalNotification();\n\n          performance.mark(PERFORMANCE_MARKERS.PORTAL_TRANSITION + \"-end\");\n          try {\n            performance.measure(\n              \"Portal Transition\",\n              PERFORMANCE_MARKERS.PORTAL_TRANSITION,\n              PERFORMANCE_MARKERS.PORTAL_TRANSITION + \"-end\",\n            );\n          } catch (error) {\n            // Performance timing not available, skip measurement\n            console.debug(\n              \"Performance measurement skipped:\",\n              error.message,\n            );\n          }\n        }, 1000);\n      };\n\n      requestAnimationFrame(transitionAnimation);\n    },\n    [\n      portalState.isTransitioning,\n      gameState.soundManager,\n      setCurrentSpecialWorld,\n      updatePortalState,\n      showWorldAnnouncement,\n      handleLevelCompletion,\n      hidePortalNotification,\n      setCurrentMapIndex,\n      setCharacterPosition,\n    ],\n  );\n\n  // Handle NPC interaction\n  const handleNPCInteraction = useCallback(\n    (npc) =&gt; {\n      if (!npc) return;\n\n      console.log(\"Interacting with NPC:\", npc.name || npc.type);\n\n      // Special handling for Shakespeare's quest\n      if (\n        npc.name === \"William Shakespeare\" &amp;&amp;\n        shakespeareQuest.stage === \"enemies_defeated\"\n      ) {\n        console.log(\"🎭 Triggering Hamlet Finale!\");\n        gameState.setShowHamletFinale(true);\n\n        // Play dramatic sound\n        if (gameState.soundManager) {\n          gameState.soundManager.playSound(\"quest_start\", 0.8);\n        }\n\n        if (gameState.mobileState.screenReaderMode) {\n          announceToScreenReader(\"Beginning the Hamlet Finale challenge!\");\n        }\n        return; // Don't show regular dialogue\n      }\n\n      // Set the active NPC and show dialog\n      gameState.setActiveNPC(npc);\n      updateUIState({ showNPCDialog: true });\n\n      // Play interaction sound if available\n      if (gameState.soundManager) {\n        gameState.soundManager.playSound(\"npc_interaction\");\n      }\n\n      // Add visual feedback\n      if (gameState.mobileState.screenReaderMode) {\n        announceToScreenReader(\n          &#96;Starting conversation with ${npc.name || npc.type}&#96;,\n        );\n      }\n    },\n    [\n      shakespeareQuest.stage,\n      gameState.soundManager,\n      gameState.mobileState.screenReaderMode,\n      announceToScreenReader,\n      updateUIState,\n    ],\n  );\n\n  // Handler for clicking on an NPC in the map\n  const handleNPCClick = useCallback(\n    (npc) =&gt; {\n      handleNPCInteraction(npc);\n    },\n    [handleNPCInteraction],\n  );\n\n  // Artifact Game Launcher handlers\n  const handleGameComplete = useCallback(\n    (completionData) =&gt; {\n      console.log(\"🎉 Game completed:\", completionData);\n\n      // Resume background music\n      if (gameState.soundManager) {\n        const currentMapName = MAPS[gameState.currentMapIndex]?.name || \"\";\n        gameState.soundManager.playMusic(currentMapName);\n      }\n\n      // Validate quest progress for game completion\n      validateQuestProgress(\"game_completed\", {\n        gameType: completionData.artifact?.type || \"game\",\n        artifact: completionData.artifact,\n      });\n\n      // Close game launcher\n      setShowGameLauncher(false);\n      setCurrentGameArtifact(null);\n\n      // Show completion notification\n      if (completionData.artifact) {\n        showPortalNotification(\n          \"Quest Complete!\",\n          &#96;You completed ${completionData.artifact.name}!&#96;,\n        );\n\n        // Auto-hide notification after 3 seconds\n        setTimeout(() =&gt; {\n          hidePortalNotification();\n        }, 3000);\n      }\n    },\n    [gameState.soundManager, gameState.currentMapIndex, validateQuestProgress, showPortalNotification, hidePortalNotification],\n  );\n\n  const handleGameExit = useCallback(() =&gt; {\n    console.log(\"🚪 Exiting game launcher\");\n\n    // Resume background music\n    if (gameState.soundManager) {\n      const currentMapName = MAPS[gameState.currentMapIndex]?.name || \"\";\n      gameState.soundManager.playMusic(currentMapName);\n    }\n\n    // Close game launcher\n    setShowGameLauncher(false);\n    setCurrentGameArtifact(null);\n  }, [gameState.soundManager, gameState.currentMapIndex]);\n\n  const handleGameOver = useCallback(() =&gt; {\n    console.log(\"Game Over!\");\n    // Reset player health\n    setPlayerHealth(Math.floor(gameState.maxPlayerHealth / 2)); // Respawn with half health\n    // Reset position to start\n    setCharacterPosition(INITIAL_CHARACTER_POSITION);\n\n    if (gameState.soundManager) {\n      gameState.soundManager.playSound(\"gameover\", 0.5);\n    }\n  }, [gameState.maxPlayerHealth, gameState.soundManager]);\n\n  // Memoized portal configuration\n  const PORTAL_CONFIG = useMemo(\n    () =&gt; ({\n      progression: {\n        Overworld: [\n          {\n            destination: \"Overworld 2\",\n            spawnPosition: { x: 4 * TILE_SIZE, y: 4 * TILE_SIZE },\n            condition: (x, y) =&gt; x === 8 &amp;&amp; y === 11,\n          },\n          {\n            destination: \"Dungeon Level 1\",\n            spawnPosition: { x: 1 * TILE_SIZE, y: 1 * TILE_SIZE },\n            condition: (x, y) =&gt; x === 10 &amp;&amp; y === 12,\n          },\n        ],\n        \"Overworld 2\": {\n          destination: \"Overworld 3\",\n          spawnPosition: { x: 4 * TILE_SIZE, y: 4 * TILE_SIZE },\n        },\n        \"Overworld 3\": [\n          {\n            destination: \"Desert 1\",\n            spawnPosition: { x: 4 * TILE_SIZE, y: 4 * TILE_SIZE },\n            condition: (x, y) =&gt; x === 8 &amp;&amp; y === 0,\n          },\n          {\n            destination: \"Yosemite\",\n            spawnPosition: { x: 10 * TILE_SIZE, y: 20 * TILE_SIZE }, // Central spawn for larger map\n            condition: (x, y) =&gt; x === 8 &amp;&amp; y === 11,\n          },\n        ],\n        \"Desert 1\": {\n          destination: \"Desert 2\",\n          spawnPosition: { x: 4 * TILE_SIZE, y: 4 * TILE_SIZE },\n        },\n        \"Desert 2\": {\n          destination: \"Desert 3\",\n          spawnPosition: { x: 4 * TILE_SIZE, y: 4 * TILE_SIZE },\n        },\n        \"Desert 3\": {\n          destination: \"Dungeon Level 1\",\n          spawnPosition: { x: 4 * TILE_SIZE, y: 4 * TILE_SIZE },\n        },\n        \"Dungeon Level 1\": {\n          destination: \"Dungeon Level 2\",\n          spawnPosition: { x: 1 * TILE_SIZE, y: 1 * TILE_SIZE },\n        },\n        \"Dungeon Level 2\": {\n          destination: \"Dungeon Level 3\",\n          spawnPosition: { x: 1 * TILE_SIZE, y: 1 * TILE_SIZE },\n        },\n        \"Dungeon Level 3\": {\n          destination: \"Yosemite\",\n          spawnPosition: { x: 10 * TILE_SIZE, y: 20 * TILE_SIZE }, // Central spawn for larger map\n        },\n      },\n      yosemiteReturn: {\n        destination: \"Overworld 3\",\n        spawnPosition: { x: 8 * TILE_SIZE, y: 2 * TILE_SIZE },\n      },\n      special: {\n        6: {\n          type: \"terminal\",\n          title: \"Terminal Challenge\",\n          message: \"Press SPACE to enter the Terminal Challenge\",\n        },\n        7: {\n          type: \"shooter\",\n          title: \"Arcade Shooter\",\n          message: \"Press SPACE to enter the Arcade Shooter\",\n        },\n        8: {\n          type: \"text_adventure\",\n          title: \"Text Adventure\",\n          message: \"Press SPACE to enter the Text Adventure\",\n        },\n      },\n    }),\n    [],\n  );\n\n  // Memoized current map data with safety check\n  const currentMap = useMemo(() =&gt; {\n    // Safety check to prevent initialization order issues\n    if (typeof gameState.currentMapIndex !== \"number\" || !MAPS || !Array.isArray(MAPS)) {\n      return MAPS?.[0] || null;\n    }\n    return MAPS[gameState.currentMapIndex] || MAPS[0];\n  }, [gameState.currentMapIndex]);\n  const currentMapNPCs = useMemo(() =&gt; currentMap?.npcs || [], [currentMap]);\n  const currentMapArtifacts = useMemo(\n    () =&gt; currentMap?.artifacts || [],\n    [currentMap],\n  );\n\n  // Convenience getter used by some hook dependency arrays\n  const getCharacterPosition = useCallback(\n    () =&gt; characterPosition,\n    [characterPosition],\n  );\n\n  // Update explored tiles for minimap fog of war\n  useEffect(() =&gt; {\n    const tileX = Math.floor(gameState.characterPosition.x / TILE_SIZE);\n    const tileY = Math.floor(gameState.characterPosition.y / TILE_SIZE);\n\n    // Explore tiles in a radius around the player (view distance)\n    const viewRadius = 3; // Explore 3 tiles in all directions\n\n    setExploredTiles((prevExploredTiles) =&gt; {\n      const newExploredTiles = new Set(prevExploredTiles);\n      let hasNewTiles = false;\n\n      for (let dy = -viewRadius; dy &lt;= viewRadius; dy++) {\n        for (let dx = -viewRadius; dx &lt;= viewRadius; dx++) {\n          const x = tileX + dx;\n          const y = tileY + dy;\n\n          // Check if tile is within map bounds\n          if (x &gt;= 0 &amp;&amp; x &lt; MAP_COLS &amp;&amp; y &gt;= 0 &amp;&amp; y &lt; MAP_ROWS) {\n            const tileKey = &#96;${x},${y}&#96;;\n            if (!newExploredTiles.has(tileKey)) {\n              newExploredTiles.add(tileKey);\n              hasNewTiles = true;\n            }\n          }\n        }\n      }\n\n      // Only update if new tiles were explored\n      return hasNewTiles ? newExploredTiles : prevExploredTiles;\n    });\n  }, [getCharacterPosition]); // Remove exploredTiles from dependencies\n\n  // Performance monitoring - only run occasionally to avoid render loops\n  useEffect(() =&gt; {\n    renderCount.current++;\n    const now = performance.now();\n    const renderTime = now - lastRenderTime.current;\n\n    // Only log slow renders occasionally (every 100th render) to avoid console spam\n    if (renderTime &gt; 16 &amp;&amp; renderCount.current % 100 === 0) {\n      console.warn(\n        &#96;Slow render detected: ${renderTime.toFixed(2)}ms (render #${renderCount.current})&#96;,\n      );\n    }\n\n    lastRenderTime.current = now;\n\n    // Performance mark for render - with safety checks\n    if (performance.mark &amp;&amp; renderCount.current % 100 === 0) {\n      performance.mark(PERFORMANCE_MARKERS.RENDER_END);\n\n      // Only measure if the start mark exists\n      try {\n        performance.measure(\n          \"GameWorld Render\",\n          PERFORMANCE_MARKERS.RENDER_START,\n          PERFORMANCE_MARKERS.RENDER_END,\n        );\n      } catch (error) {\n        // Start mark doesn't exist yet, create it for next time\n        performance.mark(PERFORMANCE_MARKERS.RENDER_START);\n      }\n    }\n    // Empty dependency array would prevent this from running on every render,\n    // but we want to track render count, so we'll keep it running but throttle logging\n  });\n\n  // Automatic portal activation on collision\n  useEffect(() =&gt; {\n    const handlePortalCollision = (event) =&gt; {\n      if (portalState.isTransitioning) return;\n\n      const { tileX, tileY, tileType } = event.detail;\n      const currentMapName = currentMap?.name;\n\n      if (!currentMapName) return;\n\n      console.log(\n        &#96;Portal collision detected - Map: ${currentMapName}, Tile: (${tileX}, ${tileY}), Type: ${tileType}&#96;,\n      );\n\n      // Handle progression portals (type 5)\n      if (tileType === 5) {\n        const progressionPortal = PORTAL_CONFIG.progression[currentMapName];\n        if (progressionPortal) {\n          // Handle multiple portals per map (array)\n          if (Array.isArray(progressionPortal)) {\n            for (const portal of progressionPortal) {\n              const { destination, spawnPosition, condition } = portal;\n\n              // Check if portal condition is met\n              if (condition &amp;&amp; condition(tileX, tileY)) {\n                console.log(&#96;✅ Auto-activating portal to ${destination}&#96;);\n                handlePortalTransition(destination, spawnPosition);\n                return;\n              }\n            }\n          } else {\n            // Handle single portal (object)\n            const { destination, spawnPosition, condition } =\n              progressionPortal;\n\n            // Check if portal condition is met (if any)\n            if (!condition || condition(tileX, tileY)) {\n              console.log(&#96;✅ Auto-activating portal to ${destination}&#96;);\n              handlePortalTransition(destination, spawnPosition);\n              return;\n            }\n          }\n        }\n      }\n\n      // Handle special portals in Yosemite (types 6-8)\n      if (currentMapName === \"Yosemite\" &amp;&amp; tileType &gt;= 6 &amp;&amp; tileType &lt;= 8) {\n        const specialPortal = PORTAL_CONFIG.special[tileX];\n\n        if (specialPortal &amp;&amp; tileY === 1) {\n          console.log(\n            &#96;✅ Auto-activating special portal: ${specialPortal.title}&#96;,\n          );\n\n          // Activate the special world directly\n          if (specialPortal.type === \"terminal\") {\n            setCurrentSpecialWorld(\"terminal\");\n          } else if (specialPortal.type === \"shooter\") {\n            setCurrentSpecialWorld(\"shooter\");\n          } else if (specialPortal.type === \"text_adventure\") {\n            setCurrentSpecialWorld(\"text_adventure\");\n          }\n\n          updatePortalState({\n            activePortal: specialPortal,\n            portalNotificationActive: true,\n          });\n          return;\n        }\n      }\n    };\n\n    window.addEventListener(\"portalCollision\", handlePortalCollision);\n    return () =&gt; {\n      window.removeEventListener(\"portalCollision\", handlePortalCollision);\n    };\n  }, [\n    portalState.isTransitioning,\n    currentMap,\n    PORTAL_CONFIG,\n    handlePortalTransition,\n    updatePortalState,\n  ]);\n\n  // Optimized portal activation handler with improved detection and feedback (kept for manual SPACE activation)\n  const handlePortalActivation = useCallback(\n    (e) =&gt; {\n      if (e.key !== \" \" || portalState.isTransitioning) return;\n\n      const currentMapName = currentMap?.name;\n      if (!currentMapName) {\n        console.log(\"No current map name available for portal activation\");\n        return;\n      }\n\n      const playerTileX = Math.floor(gameState.characterPosition.x / TILE_SIZE);\n      const playerTileY = Math.floor(gameState.characterPosition.y / TILE_SIZE);\n\n      console.log(\n        &#96;Manual portal activation attempt - Map: ${currentMapName}, Player position: (${playerTileX}, ${playerTileY})&#96;,\n      );\n\n      // Check for dungeon portal (tile type 9)\n      const currentMapData = currentMap?.data;\n      if (\n        currentMapData &amp;&amp;\n        playerTileY &gt;= 0 &amp;&amp;\n        playerTileY &lt; currentMapData.length\n      ) {\n        const row = currentMapData[playerTileY];\n        if (row &amp;&amp; playerTileX &gt;= 0 &amp;&amp; playerTileX &lt; row.length) {\n          const tileType = row[playerTileX];\n          if (tileType === 9) {\n            // Dungeon portal detected!\n            console.log(\"🏰 Dungeon portal detected!\");\n\n            // Check if there's a special portal defined for this location\n            const dungeonPortal = currentMap?.specialPortals?.find(\n              (portal) =&gt;\n                portal.position.x === playerTileX &amp;&amp;\n                portal.position.y === playerTileY &amp;&amp;\n                portal.type === \"dungeon\",\n            );\n\n            if (dungeonPortal) {\n              console.log(&#96;✅ Entering ${dungeonPortal.name}&#96;);\n              handleEnterDungeon(dungeonPortal.destination);\n              return;\n            }\n          }\n        }\n      }\n\n      // Check progression portals\n      const progressionPortal = PORTAL_CONFIG.progression[currentMapName];\n      if (progressionPortal) {\n        // Handle multiple portals per map (array)\n        if (Array.isArray(progressionPortal)) {\n          for (const portal of progressionPortal) {\n            const { destination, spawnPosition, condition } = portal;\n            console.log(\n              &#96;Checking progression portal to ${destination}, condition:&#96;,\n              condition,\n            );\n\n            if (condition &amp;&amp; condition(playerTileX, playerTileY)) {\n              console.log(&#96;✅ Activating portal to ${destination}&#96;);\n              handlePortalTransition(destination, spawnPosition);\n              return;\n            }\n          }\n          console.log(&#96;❌ Portal condition not met&#96;);\n          showWorldAnnouncement(\n            \"Find the correct portal location to proceed\",\n          );\n        } else {\n          // Handle single portal (object)\n          const { destination, spawnPosition, condition } =\n            progressionPortal;\n          console.log(\n            &#96;Checking progression portal to ${destination}, condition:&#96;,\n            condition,\n          );\n\n          if (!condition || condition(playerTileX, playerTileY)) {\n            console.log(&#96;✅ Activating portal to ${destination}&#96;);\n            handlePortalTransition(destination, spawnPosition);\n            return;\n          } else {\n            console.log(&#96;❌ Portal condition not met for ${destination}&#96;);\n            showWorldAnnouncement(\n              \"Find the correct portal location to proceed\",\n            );\n          }\n        }\n      }\n\n      // Check special portals in Yosemite\n      if (currentMapName === \"Yosemite\") {\n        const specialPortal = PORTAL_CONFIG.special[playerTileX];\n        console.log(\n          &#96;Checking special portal at X=${playerTileX}, Y=${playerTileY}:&#96;,\n          specialPortal,\n        );\n\n        if (specialPortal &amp;&amp; playerTileY === 1) {\n          console.log(\n            &#96;✅ Activating special portal: ${specialPortal.title}&#96;,\n          );\n          updatePortalState({\n            activePortal: specialPortal,\n            portalNotificationActive: true,\n          });\n          showPortalNotification(\n            specialPortal.title,\n            specialPortal.message,\n          );\n          return;\n        }\n      }\n\n      // No portal found - give user feedback\n      console.log(\"❌ No portal found at current location\");\n      if (gameState.soundManager) {\n        gameState.soundManager.playSound(\"bump\"); // Play bump sound to indicate no portal\n      }\n    },\n    [\n      portalState.isTransitioning,\n      currentMap,\n      characterPosition,\n      PORTAL_CONFIG,\n      handlePortalTransition,\n      updatePortalState,\n      showPortalNotification,\n      showWorldAnnouncement,\n      gameState.soundManager,\n    ],\n  );\n\n  // Handle Hamlet Finale completion\n  const handleHamletFinaleComplete = useCallback(\n    (result) =&gt; {\n      // =====================================\n      // Add to inventory\n      gameState.setInventory((prev) =&gt; [\n        ...prev,\n        {\n          id: \"wand_of_prospero\",\n          name: \"Wand of Prospero\",\n          description:\n            \"A mystical staff from The Tempest, capable of conjuring storms and bending reality itself\",\n          type: \"MAGIC_WEAPON\",\n          power: 50,\n          special: \"conjure_storm\",\n        },\n      ]);\n\n      // Award XP\n      handleGainExperience(result.exp || 100, \"Completed Hamlet Finale\");\n\n      // Close the finale\n      gameState.setShowHamletFinale(false);\n\n      // Show achievement\n      if (gameState.soundManager) {\n        gameState.soundManager.playSound(\"powerup\", 0.8);\n      }\n\n      console.log(\"⚔️ Wand of Prospero obtained!\");\n    },\n    [handleGainExperience, gameState.soundManager],\n  );\n\n\n\n\n\n      // Automatic portal activation on collision\n      useEffect(() =&gt; {\n        const handlePortalCollision = (event) =&gt; {\n          if (portalState.isTransitioning) return;\n\n          const { tileX, tileY, tileType } = event.detail;\n          const currentMapName = currentMap?.name;\n\n          if (!currentMapName) return;\n\n          console.log(\n            &#96;Portal collision detected - Map: ${currentMapName}, Tile: (${tileX}, ${tileY}), Type: ${tileType}&#96;,\n          );\n\n          // Handle progression portals (type 5)\n          if (tileType === 5) {\n            const progressionPortal = PORTAL_CONFIG.progression[currentMapName];\n            if (progressionPortal) {\n              // Handle multiple portals per map (array)\n              if (Array.isArray(progressionPortal)) {\n                for (const portal of progressionPortal) {\n                  const { destination, spawnPosition, condition } = portal;\n\n                  // Check if portal condition is met\n                  if (condition &amp;&amp; condition(tileX, tileY)) {\n                    console.log(&#96;✅ Auto-activating portal to ${destination}&#96;);\n                    handlePortalTransition(destination, spawnPosition);\n                    return;\n                  }\n                }\n              } else {\n                // Handle single portal (object)\n                const { destination, spawnPosition, condition } =\n                  progressionPortal;\n\n                // Check if portal condition is met (if any)\n                if (!condition || condition(tileX, tileY)) {\n                  console.log(&#96;✅ Auto-activating portal to ${destination}&#96;);\n                  handlePortalTransition(destination, spawnPosition);\n                  return;\n                }\n              }\n            }\n          }\n\n          // Handle special portals in Yosemite (types 6-8)\n          if (currentMapName === \"Yosemite\" &amp;&amp; tileType &gt;= 6 &amp;&amp; tileType &lt;= 8) {\n            const specialPortal = PORTAL_CONFIG.special[tileX];\n\n            if (specialPortal &amp;&amp; tileY === 1) {\n              console.log(\n                &#96;✅ Auto-activating special portal: ${specialPortal.title}&#96;,\n              );\n\n              // Activate the special world directly\n              if (specialPortal.type === \"terminal\") {\n                setCurrentSpecialWorld(\"terminal\");\n              } else if (specialPortal.type === \"shooter\") {\n                setCurrentSpecialWorld(\"shooter\");\n              } else if (specialPortal.type === \"text_adventure\") {\n                setCurrentSpecialWorld(\"text_adventure\");\n              }\n\n              updatePortalState({\n                activePortal: specialPortal,\n                portalNotificationActive: true,\n              });\n              return;\n            }\n          }\n        };\n\n        window.addEventListener(\"portalCollision\", handlePortalCollision);\n        return () =&gt; {\n          window.removeEventListener(\"portalCollision\", handlePortalCollision);\n        };\n      }, [\n        portalState.isTransitioning,\n        currentMap,\n        PORTAL_CONFIG,\n        handlePortalTransition,\n        updatePortalState,\n      ]);\n\n  // Boss defeat\n  const handleBossDefeat = useCallback(\n    (dungeonId) =&gt; {\n      console.log(&#96;🎉 Boss defeated in: ${dungeonId}&#96;);\n\n      // Play boss defeat fanfare\n      if (gameState.soundManager) {\n        gameState.soundManager.playSound(\"boss_defeat\", 1.0);\n      }\n\n      // Award massive XP\n      handleGainExperience(100, \"Boss defeated\");\n\n      // Mark dungeon as complete\n      console.log(\"🏆 Dungeon complete! Treasure revealed.\");\n\n      // Optionally: Track dungeon completion in gameData\n      // This allows for future features like dungeon tracker, etc.\n    },\n    [gameState.soundManager, handleGainExperience],\n  );\n\n  // Optimized artifact creation\n  const createLevelArtifact = useCallback(async () =&gt; {\n    try {\n      const artifactData = {\n        name: &#96;Level ${currentMapIndex + 1} Artifact&#96;,\n        description: &#96;An artifact from level ${currentMapIndex + 1}&#96;,\n        type: \"level\",\n        level: currentMapIndex + 1,\n        position: { x: characterPosition.x, y: characterPosition.y },\n        creator: user?.id || \"anonymous\",\n      };\n\n      const newArtifact = await createArtifact(artifactData);\n\n      updateGameState({\n        artifacts: [...gameState.gameData.artifacts, newArtifact],\n      });\n\n      // Play creation sound\n      if (gameState.soundManager) {\n        gameState.soundManager.playSound(\"artifact_create\");\n      }\n\n      return newArtifact;\n    } catch (error) {\n      console.error(\"Error creating level artifact:\", error);\n      return null;\n    }\n  }, [\n    currentMapIndex,\n    characterPosition,\n    user,\n    gameState.gameData.artifacts,\n    gameState.soundManager,\n    updateGameState,\n  ]);\n\n  // Optimized NPC fetching\n  const fetchNPCs = useCallback(async () =&gt; {\n    try {\n      // This would fetch NPCs from the database\n      // For now, we'll use the static NPCs from the map\n      const npcs = currentMapNPCs;\n      updateGameState({ databaseNPCs: npcs });\n    } catch (error) {\n      console.error(\"Error fetching NPCs:\", error);\n    }\n  }, [currentMapNPCs, updateGameState]);\n\n  // Optimized character loading\n  const loadCharacter = useCallback(async () =&gt; {\n    if (!user) return;\n\n    try {\n      const characterData = await fetchCharacter(user.id);\n      setCharacter(characterData);\n\n      // Update character position from saved data\n      if (characterData?.position) {\n        setCharacterPosition(characterData.position);\n      }\n    } catch (error) {\n      console.error(\"Error loading character:\", error);\n    }\n  }, [user]);\n\n  // Optimized key handler with throttling\n  const handleKeyDown = useCallback(\n    (event) =&gt; {\n      const now = performance.now();\n      if (now - lastUpdateTime.current &lt; updateThrottle.current) {\n        return; // Throttle key events\n      }\n      lastUpdateTime.current = now;\n\n      // Enhanced keyboard navigation with accessibility support\n      switch (event.key) {\n        case \"i\":\n        case \"I\":\n          updateUIState({ showInventory: !gameState.uiState.showInventory });\n          // Announce to screen readers\n          if (gameState.mobileState.screenReaderMode) {\n            const message = gameState.uiState.showInventory\n              ? \"Closing inventory\"\n              : \"Opening inventory\";\n            announceToScreenReader(message);\n          }\n          break;\n        case \"q\":\n        case \"Q\":\n          updateUIState({ showQuotes: !gameState.uiState.showQuotes });\n          if (gameState.mobileState.screenReaderMode) {\n            const message = gameState.uiState.showQuotes\n              ? \"Closing quotes\"\n              : \"Opening saved quotes\";\n            announceToScreenReader(message);\n          }\n          break;\n        case \"m\":\n        case \"M\":\n          updateUIState({ showWorldMap: !gameState.uiState.showWorldMap });\n          if (gameState.mobileState.screenReaderMode) {\n            const message = gameState.uiState.showWorldMap\n              ? \"Closing world map\"\n              : \"Opening world map\";\n            announceToScreenReader(message);\n          }\n          break;\n        case \"f\":\n        case \"F\":\n          updateUIState({ showFeedback: !gameState.uiState.showFeedback });\n          if (gameState.mobileState.screenReaderMode) {\n            const message = gameState.uiState.showFeedback\n              ? \"Closing feedback form\"\n              : \"Opening feedback form\";\n            announceToScreenReader(message);\n          }\n          break;\n        case \"c\":\n        case \"C\":\n        case \"?\":\n          updateUIState({ showControlsGuide: !gameState.uiState.showControlsGuide });\n          if (gameState.mobileState.screenReaderMode) {\n            const message = gameState.uiState.showControlsGuide\n              ? \"Closing controls guide\"\n              : \"Opening keyboard controls guide\";\n            announceToScreenReader(message);\n          }\n          break;\n        case \"Escape\":\n          updateUIState({\n            showInventory: false,\n            showQuotes: false,\n            showWorldMap: false,\n            showFeedback: false,\n            showControlsGuide: false,\n            showForm: false,\n          });\n          if (gameState.mobileState.screenReaderMode) {\n            announceToScreenReader(\"Closed all menus\");\n          }\n          break;\n        case \" \":\n          // Portal activation - call if available\n          // The function is defined later in the component, so we check for it\n          break;\n        case \"z\":\n        case \"Z\":\n          // Sword attack with cooldown and AUTO-TARGETING\n          const now = Date.now();\n          const ATTACK_COOLDOWN = 400; // ms between attacks\n\n          if (\n            !gameState.isAttacking &amp;&amp;\n            now - lastAttackTimeRef.current &gt;= ATTACK_COOLDOWN\n          ) {\n            lastAttackTimeRef.current = now;\n\n            // AUTO-TARGET: Find closest enemy and face them\n            const enemies = document.querySelectorAll('[data-hitbox=\"enemy\"]');\n            let closestEnemy = null;\n            let closestDistance = Infinity;\n\n            enemies.forEach((enemyElement) =&gt; {\n              const enemyRect = enemyElement.getBoundingClientRect();\n              const enemyX = parseFloat(enemyElement.style.left) || 0;\n              const enemyY = parseFloat(enemyElement.style.top) || 0;\n\n              const dx = enemyX - characterPosition.x;\n              const dy = enemyY - characterPosition.y;\n              const distance = Math.sqrt(dx * dx + dy * dy);\n\n              if (distance &lt; closestDistance &amp;&amp; distance &lt; 150) {\n                // 150px auto-target range\n                closestDistance = distance;\n                closestEnemy = { x: enemyX, y: enemyY, dx, dy };\n              }\n            });\n\n            // Face the closest enemy\n            if (closestEnemy) {\n              const { dx, dy } = closestEnemy;\n              let targetDirection = characterState.direction;\n\n              // Determine which direction to face based on angle to enemy\n              if (Math.abs(dx) &gt; Math.abs(dy)) {\n                targetDirection = dx &gt; 0 ? \"right\" : \"left\";\n              } else {\n                targetDirection = dy &gt; 0 ? \"down\" : \"up\";\n              }\n\n              // Update character direction to face enemy\n              setCharacterState((prev) =&gt; ({\n                ...prev,\n                direction: targetDirection,\n              }));\n            }\n\n            setIsAttacking(true);\n            if (gameState.soundManager) {\n              gameState.soundManager.playSound(\"sword\", 0.3);\n            }\n            // CombatManager will reset attack state via onAttackComplete\n            if (gameState.mobileState.screenReaderMode) {\n              announceToScreenReader(\"Sword attack\");\n            }\n          }\n          event.preventDefault();\n          break;\n        case \"t\":\n        case \"T\":\n          // NPC interaction\n          const nearbyNPC = findNearbyNPC();\n          if (nearbyNPC) {\n            gameState.setActiveNPC(nearbyNPC);\n            updateUIState({ showNPCDialog: true });\n            if (gameState.mobileState.screenReaderMode) {\n              announceToScreenReader(&#96;Talking to ${nearbyNPC.name || \"NPC\"}&#96;);\n            }\n          } else if (gameState.mobileState.screenReaderMode) {\n            announceToScreenReader(\"No NPC nearby to talk to\");\n          }\n          break;\n        case \"h\":\n        case \"H\":\n          // Toggle high contrast mode\n          setMobileState((prev) =&gt; ({\n            ...prev,\n            highContrastMode: !prev.highContrastMode,\n          }));\n          if (gameState.mobileState.screenReaderMode) {\n            const message = gameState.mobileState.highContrastMode\n              ? \"High contrast mode disabled\"\n              : \"High contrast mode enabled\";\n            announceToScreenReader(message);\n          }\n          break;\n        case \"r\":\n        case \"R\":\n          // Toggle reduced motion mode\n          setMobileState((prev) =&gt; ({\n            ...prev,\n            reducedMotionMode: !prev.reducedMotionMode,\n          }));\n          if (gameState.mobileState.screenReaderMode) {\n            const message = gameState.mobileState.reducedMotionMode\n              ? \"Reduced motion mode disabled\"\n              : \"Reduced motion mode enabled\";\n            announceToScreenReader(message);\n          }\n          break;\n        case \"s\":\n        case \"S\":\n          // Toggle screen reader mode\n          setMobileState({\n            ...mobileState,\n            screenReaderMode: !mobileState.screenReaderMode,\n          });\n          const message = mobileState.screenReaderMode\n            ? \"Screen reader mode disabled\"\n            : \"Screen reader mode enabled\";\n          announceToScreenReader(message);\n          break;\n      }\n    },\n    [uiState, updateUIState, mobileState, setMobileState, announceToScreenReader],\n  );\n\n  // Optimized nearby NPC finder\n  const findNearbyNPC = useCallback(() =&gt; {\n    const npcs = [...currentMapNPCs, ...gameState.gameData.databaseNPCs];\n    return npcs.find((npc) =&gt; {\n      const npcX = npc.position?.x || 0;\n      const npcY = npc.position?.y || 0;\n      const distance = Math.sqrt(\n        Math.pow(characterPosition.x - npcX, 2) +\n          Math.pow(characterPosition.y - npcY, 2),\n      );\n      return distance &lt; TILE_SIZE * 2;\n    });\n  }, [currentMapNPCs, gameState.gameData.databaseNPCs, getCharacterPosition]);\n\n  // Optimized sound manager initialization\n  const initSoundManager = useCallback(async () =&gt; {\n    if (gameState.soundManager) return;\n\n    try {\n      const manager = SoundManager.getInstance();\n      await manager.initialize();\n      setSoundManager(manager);\n      console.log(\"Sound manager initialized successfully\");\n    } catch (error) {\n      console.error(\"Error initializing sound manager:\", error);\n    }\n  }, [gameState.soundManager]);\n\n  // Initialize component safely\n  useEffect(() =&gt; {\n    // Mark as initialized after first render cycle completes\n    if (!isInitialized) {\n      setIsInitialized(true);\n    }\n  }, [isInitialized]);\n\n  // Performance-optimized effects\n  useEffect(() =&gt; {\n    performance.mark(PERFORMANCE_MARKERS.RENDER_START);\n\n    // Initialize game state manager\n    gameStateManager.init();\n\n    // Load character and NPCs\n    loadCharacter();\n    fetchNPCs();\n\n    // Initialize sound manager\n    initSoundManager();\n\n    // Set up event listeners\n    const handleKeyDownEvent = (e) =&gt; handleKeyDown(e);\n    window.addEventListener(\"keydown\", handleKeyDownEvent);\n\n    return () =&gt; {\n      window.removeEventListener(\"keydown\", handleKeyDownEvent);\n      if (gameState.soundManager) {\n        gameState.soundManager.cleanup();\n      }\n    };\n  }, [loadCharacter, fetchNPCs, initSoundManager, handleKeyDown, gameState.soundManager]);\n\n  // Music management based on current map\n  useEffect(() =&gt; {\n    if (!gameState.soundManager || !currentMap) return;\n\n    const currentMapName = currentMap.name || \"\";\n    const newMusicTrack = getMusicTrackForMap(currentMapName);\n\n    console.log(\n      \"Map music check - Map:\",\n      currentMapName,\n      \"Track:\",\n      newMusicTrack,\n    );\n\n    // Only change music if we have a valid track and it's different from current\n    if (newMusicTrack) {\n      try {\n        // Check if we're already playing this track by comparing current music\n        const shouldChangeMusic =\n          !gameState.soundManager.currentMusic ||\n          gameState.soundManager.currentMusic !== newMusicTrack;\n\n        if (shouldChangeMusic) {\n          console.log(\n            \"Changing music from\",\n            gameState.soundManager.currentMusic,\n            \"to\",\n            newMusicTrack,\n          );\n\n          // Stop current music before starting new one\n          gameState.soundManager.stopMusic();\n\n          // Start appropriate music for the current map\n          if (currentMapName === \"Yosemite\") {\n            gameState.soundManager.playMusic(\"yosemite\", true, 0.3);\n          } else if (currentMapName.includes(\"Overworld\")) {\n            gameState.soundManager.playMusic(\"overworld\", true, 0.3);\n          } else if (currentMapName.includes(\"Dungeon\")) {\n            gameState.soundManager.playMusic(\"terminal\", true, 0.3);\n          } else if (currentMapName.includes(\"Desert\")) {\n            gameState.soundManager.playMusic(\"desert\", true, 0.3);\n          }\n        }\n      } catch (error) {\n        console.error(\"Error changing music:\", error);\n      }\n    }\n  }, [gameState.soundManager, gameState.currentMapIndex]); // Only trigger on map index change\n\n  // Helper function to get music track for map\n  const getMusicTrackForMap = useCallback((mapName) =&gt; {\n    if (mapName === \"Yosemite\") return \"yosemite\";\n    if (mapName.includes(\"Overworld\")) return \"overworld\";\n    if (mapName.includes(\"Dungeon\")) return \"terminal\";\n    if (mapName.includes(\"Desert\")) return \"desert\";\n    return null;\n  }, []);\n\n  // Portal proximity detection - show hints when near portals\n  useEffect(() =&gt; {\n    if (!currentMap || !characterPosition) return;\n\n    const currentMapName = currentMap.name;\n    const playerTileX = Math.floor(characterPosition.x / TILE_SIZE);\n    const playerTileY = Math.floor(characterPosition.y / TILE_SIZE);\n\n    // Check if player is near any portal\n    const progressionPortal = PORTAL_CONFIG.progression[currentMapName];\n    let nearPortal = false;\n\n    if (progressionPortal) {\n      // Handle multiple portals per map (array)\n      const portals = Array.isArray(progressionPortal)\n        ? progressionPortal\n        : [progressionPortal];\n\n      for (const portal of portals) {\n        const { condition } = portal;\n\n        // For portals with conditions, check if player is close\n        if (condition) {\n          // Check surrounding tiles (1-tile radius)\n          for (let dx = -1; dx &lt;= 1; dx++) {\n            for (let dy = -1; dy &lt;= 1; dy++) {\n              if (condition(playerTileX + dx, playerTileY + dy)) {\n                nearPortal = true;\n                break;\n              }\n            }\n            if (nearPortal) break;\n          }\n        } else {\n          // For portals without conditions, consider always near if on this map\n          nearPortal = true;\n        }\n\n        if (nearPortal) break;\n      }\n    }\n\n    // Check special portals in Yosemite\n    if (currentMapName === \"Yosemite\") {\n      // Check if player is near any special portal (1-tile radius)\n      for (let dx = -1; dx &lt;= 1; dx++) {\n        const checkX = playerTileX + dx;\n        if (PORTAL_CONFIG.special[checkX] &amp;&amp; Math.abs(playerTileY - 1) &lt;= 1) {\n          nearPortal = true;\n          break;\n        }\n      }\n    }\n\n    // Show/hide portal hint\n    if (nearPortal &amp;&amp; !portalState.portalNotificationActive) {\n      const hintElement = document.getElementById(\"portal-hint\");\n      if (!hintElement) {\n        const hint = document.createElement(\"div\");\n        hint.id = \"portal-hint\";\n        hint.className = \"portal-hint\";\n        hint.innerHTML = \"Press SPACE to activate portal\";\n        document.body.appendChild(hint);\n      }\n      document.getElementById(\"portal-hint\")?.classList.add(\"visible\");\n    } else {\n      document.getElementById(\"portal-hint\")?.classList.remove(\"visible\");\n    }\n  }, [\n    characterPosition,\n    currentMap,\n    PORTAL_CONFIG,\n    portalState.portalNotificationActive,\n  ]);\n\n  // Optimized artifact loading\n  useEffect(() =&gt; {\n    const loadArtifacts = async () =&gt; {\n      try {\n        const artifactsData = await fetchArtifacts();\n        updateGameState({ artifacts: artifactsData });\n      } catch (error) {\n        console.error(\"Error loading artifacts:\", error);\n      }\n    };\n\n    loadArtifacts();\n  }, [updateGameState]);\n\n  // Optimized game state saving\n  const saveGameProgress = useCallback(() =&gt; {\n    if (!user) return;\n\n    const gameState = {\n      characterPosition,\n      currentMapIndex,\n      inventory,\n      levelCompletion: gameState.gameData.levelCompletion,\n      achievements: gameState.gameData.achievements,\n      viewedArtifacts: gameState.gameData.viewedArtifacts,\n    };\n\n    gameStateManager.updateState(gameState);\n  }, [user, characterPosition, currentMapIndex, inventory, gameState.gameData]);\n\n  // Auto-save effect\n  useEffect(() =&gt; {\n    const autoSaveInterval = setInterval(saveGameProgress, 30000); // Save every 30 seconds\n    return () =&gt; clearInterval(autoSaveInterval);\n  }, [saveGameProgress]);\n\n  // Mobile and accessibility detection\n  useEffect(() =&gt; {\n    const detectMobileAndAccessibility = () =&gt; {\n      const isMobile =\n        window.innerWidth &lt;= 768 ||\n        /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(\n          navigator.userAgent,\n        );\n\n      const prefersReducedMotion = window.matchMedia(\n        \"(prefers-reduced-motion: reduce)\",\n      ).matches;\n      const prefersHighContrast = window.matchMedia(\n        \"(prefers-contrast: high)\",\n      ).matches;\n\n      setMobileState((prev) =&gt; ({\n        ...prev,\n        isMobile,\n        showTouchControls: isMobile,\n        touchControlsEnabled: isMobile,\n        reducedMotionMode: prefersReducedMotion,\n        highContrastMode: prefersHighContrast,\n      }));\n    };\n\n    detectMobileAndAccessibility();\n    window.addEventListener(\"resize\", detectMobileAndAccessibility);\n\n    // Listen for accessibility preference changes\n    const reducedMotionQuery = window.matchMedia(\n      \"(prefers-reduced-motion: reduce)\",\n    );\n    const highContrastQuery = window.matchMedia(\"(prefers-contrast: high)\");\n\n    const handleReducedMotionChange = (e) =&gt; {\n      setMobileState((prev) =&gt; ({ ...prev, reducedMotionMode: e.matches }));\n    };\n\n    const handleHighContrastChange = (e) =&gt; {\n      setMobileState((prev) =&gt; ({ ...prev, highContrastMode: e.matches }));\n    };\n\n    reducedMotionQuery.addEventListener(\"change\", handleReducedMotionChange);\n    highContrastQuery.addEventListener(\"change\", handleHighContrastChange);\n\n    return () =&gt; {\n      window.removeEventListener(\"resize\", detectMobileAndAccessibility);\n      reducedMotionQuery.removeEventListener(\n        \"change\",\n        handleReducedMotionChange,\n      );\n      highContrastQuery.removeEventListener(\"change\", handleHighContrastChange);\n    };\n  }, []);\n\n  // Performance monitoring effect\n  useEffect(() =&gt; {\n    if (process.env.NODE_ENV === \"development\") {\n      const performanceInterval = setInterval(() =&gt; {\n        const memory = performance.memory;\n        if (memory &amp;&amp; memory.usedJSHeapSize &gt; 100 * 1024 * 1024) {\n          // 100MB threshold\n          console.warn(\n            \"High memory usage detected:\",\n            Math.round(memory.usedJSHeapSize / 1024 / 1024) + \"MB\",\n          );\n        }\n      }, 10000); // Check every 10 seconds\n\n      return () =&gt; clearInterval(performanceInterval);\n    }\n  }, []);\n\n  // Handle artifact pickup when user presses E or P\n  const handleArtifactPickup = useCallback(\n    (artifact) =&gt; {\n      if (!artifact) return;\n\n      // Check if this artifact was already viewed\n      const isFirstView =\n        !Array.isArray(gameState.gameData.viewedArtifacts) ||\n        !gameState.gameData.viewedArtifacts.includes(artifact.id);\n\n      // Update viewed artifacts\n      if (isFirstView) {\n        const updatedViewedArtifacts = [\n          ...(Array.isArray(gameState.gameData.viewedArtifacts)\n            ? gameState.gameData.viewedArtifacts\n            : []),\n          artifact.id,\n        ];\n        updateGameState({ viewedArtifacts: updatedViewedArtifacts });\n        localStorage.setItem(\n          \"viewedArtifacts\",\n          JSON.stringify(updatedViewedArtifacts),\n        );\n\n        // Award XP for discovering a new artifact - with safety check\n        if (typeof awardXP === \"function\") {\n          awardXP(15, &#96;Discovered ${artifact.name}&#96;);\n        }\n\n        // Check for discovery achievements\n        if (typeof checkDiscoveryAchievements === \"function\") {\n          checkDiscoveryAchievements(updatedViewedArtifacts.length);\n        }\n      } else {\n        // Award smaller XP for revisiting an artifact - with safety check\n        if (typeof awardXP === \"function\") {\n          awardXP(2, \"Revisited an artifact\");\n        }\n      }\n\n      // Select the artifact to display details\n      if (typeof setVisibleArtifact === \"function\") {\n        setVisibleArtifact(artifact);\n      }\n\n      // Save game state if user is logged in\n      if (user &amp;&amp; typeof updateGameProgress === \"function\") {\n        const gameState = {\n          inventory,\n          viewedArtifacts: gameState.gameData.viewedArtifacts,\n          lastPosition: {\n            x: characterPosition.x,\n            y: characterPosition.y,\n            worldId: MAPS[currentMapIndex].name,\n          },\n          gameProgress: {\n            currentQuest: \"Artifact Exploration\",\n            completedQuests: [],\n            discoveredLocations: [MAPS[currentMapIndex].name],\n          },\n        };\n\n        updateGameProgress(gameState);\n      }\n    },\n    [\n      gameState.gameData.viewedArtifacts,\n      updateGameState,\n      updateGameProgress,\n      user,\n      inventory,\n      characterPosition,\n      currentMapIndex,\n      awardXP,\n      checkDiscoveryAchievements,\n      setVisibleArtifact,\n    ],\n  );\n\n  // Get active powers from user\n  const activePowers = user?.activePowers || [];\n\n\n  // Portal collision detection hook\n  const { checkPortalCollisions } = usePortalCollisions({\n    characterPosition,\n    currentMapIndex,\n    soundManager: gameState.soundManager,\n    portalNotificationActive: gameState.portalState.portalNotificationActive,\n    setPortalNotificationActive,\n    showPortalNotification,\n    hidePortalNotification,\n    createInteractiveNotification,\n    setCurrentMapIndex,\n    setCharacterPosition,\n    adjustViewport,\n    setCurrentSpecialWorld,\n    gameData: gameState.gameData,\n    handleLevelCompletion,\n  });\n\n\n\n  useEffect(() =&gt; {\n    // Check for both map artifacts and server artifacts at the player's position\n    const checkBothArtifactSources = () =&gt; {\n      if (!characterPosition || !MAPS || !MAPS[currentMapIndex]) return;\n\n      const playerX = characterPosition.x / TILE_SIZE;\n      const playerY = characterPosition.y / TILE_SIZE;\n\n      // Check if the current map and its artifacts property exist before accessing them\n      const mapArtifact = MAPS[currentMapIndex]?.artifacts?.find(\n        (artifact) =&gt;\n          artifact?.location &amp;&amp;\n          artifact.visible &amp;&amp;\n          artifact.location.x === playerX &amp;&amp;\n          artifact.location.y === playerY,\n      );\n\n      // Check server artifacts\n      const serverArtifact =\n        gameState.gameData.artifacts &amp;&amp; Array.isArray(gameState.gameData.artifacts)\n          ? gameState.gameData.artifacts.find(\n              (artifact) =&gt;\n                artifact &amp;&amp;\n                artifact.location &amp;&amp;\n                artifact.location.x === playerX &amp;&amp;\n                artifact.location.y === playerY &amp;&amp;\n                (!artifact.area ||\n                  artifact.area === MAPS[currentMapIndex]?.name),\n            )\n          : null;\n\n      // Prioritize server artifacts (they might be more up-to-date)\n      if (serverArtifact) {\n        setVisibleArtifact(serverArtifact);\n      } else if (mapArtifact) {\n        setVisibleArtifact(mapArtifact);\n      } else {\n        setVisibleArtifact(null);\n      }\n    };\n\n    // Check for both map artifacts and server artifacts\n    checkBothArtifactSources();\n  }, [characterPosition, currentMapIndex, gameState.gameData.artifacts]);\n\n  // Portal collision detection\n  useEffect(() =&gt; {\n    checkPortalCollisions();\n  }, [checkPortalCollisions]);\n\n  useEffect(() =&gt; {\n    // Subscribe to position changes to detect and handle artifact interactions\n    const checkArtifactGameInteractions = () =&gt; {\n      if (!characterPosition || !gameState.gameData.artifacts?.length) return;\n\n      const currentMapName = MAPS[currentMapIndex]?.name || \"\";\n\n      // Find game artifacts in the current area that the character is near\n      const gameArtifacts = gameState.gameData.artifacts.filter(\n        (artifact) =&gt;\n          artifact.area === currentMapName &amp;&amp;\n          [\n            \"shooter_experience\",\n            \"text_adventure_world\",\n            \"terminal_challenge\",\n          ].includes(artifact.type) &amp;&amp;\n          artifact.isInteractive,\n      );\n\n      // Check if character is close enough to any game artifact\n      for (const artifact of gameArtifacts) {\n        if (!artifact.position) continue;\n\n        const artifactX = artifact.position.x;\n        const artifactY = artifact.position.y;\n        const distance = Math.sqrt(\n          Math.pow(characterPosition.x - artifactX, 2) +\n            Math.pow(characterPosition.y - artifactY, 2),\n        );\n\n        // If within interaction range (approximately 1.5 tiles)\n        if (distance &lt;= TILE_SIZE * 1.5) {\n          // Show interaction notification\n          if (!portalNotificationActive) {\n            showPortalNotification(\n              artifact.name,\n              &#96;Press SPACE to play ${artifact.name}&#96;,\n            );\n            setPortalNotificationActive(true);\n\n            // Handle space key press to launch the game\n            const handleGameLaunch = (e) =&gt; {\n              if (e.code === \"Space\" &amp;&amp; distance &lt;= TILE_SIZE * 1.5) {\n                // Play interaction sound\n                if (gameState.soundManager) {\n                  gameState.soundManager.playSound(\"portal\");\n                }\n\n                // Hide notification\n                hidePortalNotification();\n                setPortalNotificationActive(false);\n\n                // Set current game artifact and show launcher\n                setCurrentGameArtifact(artifact);\n                setShowGameLauncher(true);\n\n                // Stop background music for immersive game experience\n                if (gameState.soundManager) {\n                  gameState.soundManager.stopMusic(true);\n                }\n\n                // Remove event listener\n                window.removeEventListener(\"keydown\", handleGameLaunch);\n              }\n            };\n\n            // Add event listener\n            window.addEventListener(\"keydown\", handleGameLaunch);\n\n            // Cleanup function\n            return () =&gt; {\n              window.removeEventListener(\"keydown\", handleGameLaunch);\n              setPortalNotificationActive(false);\n            };\n          }\n\n          // Break once we find an artifact in range\n          break;\n        }\n      }\n    };\n\n    checkArtifactGameInteractions();\n  }, [characterPosition, currentMapIndex, gameState.gameData.artifacts]);\n\n  // Close NPC dialog\n  const handleCloseNPCDialog = useCallback(() =&gt; {\n    updateUIState({ showNPCDialog: false });\n    gameState.setActiveNPC(null);\n  }, []);\n\n  // Add a handler for the World Map node click\n  const handleWorldMapNodeClick = useCallback(\n    (worldId) =&gt; {\n      // Check if it's a special world type\n      if (worldId === \"hemingway\") {\n        setCurrentSpecialWorld(\"hemingway\");\n        updateUIState({ showWorldMap: false });\n      } else if (worldId === \"text_adventure\") {\n        setCurrentSpecialWorld(\"text_adventure\");\n        updateUIState({ showWorldMap: false });\n      } else {\n        // Handle normal world navigation here\n        // (This would depend on your existing world navigation logic)\n        updateUIState({ showWorldMap: false });\n      }\n    },\n    [updateUIState, setCurrentSpecialWorld],\n  );\n\n  // Add handlers for exiting special worlds\n  const handleHemingwayComplete = useCallback(() =&gt; {\n    setCurrentSpecialWorld(null);\n    // Give rewards, etc.\n    updateUIState({\n      currentAchievement: \"Completed Hemingway's Adventure\",\n      showRewardModal: true\n    });\n  }, [setCurrentSpecialWorld, updateUIState]);\n\n  const handleHemingwayExit = useCallback(() =&gt; {\n    setCurrentSpecialWorld(null);\n  }, [setCurrentSpecialWorld]);\n\n  const handleTextAdventureComplete = useCallback(() =&gt; {\n    setCurrentSpecialWorld(null);\n    // Give rewards, etc.\n    updateUIState({\n      currentAchievement: \"Completed The Writer's Journey\",\n      showRewardModal: true\n    });\n  }, [setCurrentSpecialWorld, updateUIState]);\n\n  const handleTextAdventureExit = useCallback(() =&gt; {\n    // Hide any remaining portal notification\n    hidePortalNotification();\n    updatePortalState({ portalNotificationActive: false });\n\n    setCurrentSpecialWorld(null);\n  }, [setCurrentSpecialWorld, updatePortalState]);\n\n  // Handle dismissing the world guide\n  const handleDismissWorldGuide = useCallback(() =&gt; {\n    updateUIState({ showWorldGuide: false });\n    // Possibly save this preference to localStorage or user profile\n    localStorage.setItem(\"has-dismissed-world-guide\", \"true\");\n  }, [updateUIState]);\n\n  // Handle showing the world guide\n  const handleShowWorldGuide = useCallback(() =&gt; {\n    updateUIState({ showWorldGuide: true });\n  }, [updateUIState]);\n\n  // Handle showing the world map\n  const handleShowWorldMap = useCallback(() =&gt; {\n    updateUIState({ showWorldMap: true });\n  }, [updateUIState]);\n\n  // Handle deleting a quote from savedQuotes\n  const handleDeleteQuote = useCallback(\n    (quoteIndex) =&gt; {\n      if (!gameState.character || !gameState.character.savedQuotes) return;\n\n      // Create a copy of the savedQuotes array without the quote to delete\n      const updatedQuotes = [...character.savedQuotes];\n      updatedQuotes.splice(quoteIndex, 1);\n\n      // Update the character with the new quotes array\n      const updatedCharacter = {\n        ...character,\n        savedQuotes: updatedQuotes,\n      };\n\n      // Update state and save to backend\n      setCharacter(updatedCharacter);\n      updateCharacter(updatedCharacter);\n\n      console.log(&#96;🗑️ Deleted quote at index ${quoteIndex}&#96;);\n    },\n    [character, updateCharacter],\n  );\n\n  // Utilities for persisting map artifact visibility\n  const applyMapArtifactVisibilityFromStorage = () =&gt; {\n    if (!Array.isArray(MAPS)) return;\n\n    // Apply to all maps\n    MAPS.forEach((map, mapIndex) =&gt; {\n      if (!map || !Array.isArray(map.artifacts)) return;\n\n      map.artifacts.forEach((artifact, artifactIndex) =&gt; {\n        if (localStorage.getItem(&#96;artifact-${artifact.id}-found&#96;)) {\n          MAPS[mapIndex].artifacts[artifactIndex].visible = false;\n        }\n      });\n    });\n  };\n\n  const saveMapArtifactVisibilityToStorage = (artifactId) =&gt; {\n    try {\n      const savedState = localStorage.getItem(\"collectedMapArtifacts\");\n      let collectedIds = savedState ? JSON.parse(savedState) : [];\n\n      if (!collectedIds.includes(artifactId)) {\n        collectedIds.push(artifactId);\n        localStorage.setItem(\n          \"collectedMapArtifacts\",\n          JSON.stringify(collectedIds),\n        );\n        console.log(\"💾 Saved artifact collection state to localStorage\");\n      }\n    } catch (error) {\n      console.error(\"❌ Error saving artifact collection state:\", error);\n    }\n  };\n\n  // Function to find the closest NPC to the player\n  const findClosestNPC = useCallback(() =&gt; {\n    if (!MAPS[currentMapIndex]?.npcs?.length) return null;\n\n    const playerX = characterPosition.x;\n    const playerY = characterPosition.y;\n\n    let closestNPC = null;\n    let minDistance = Infinity;\n\n    MAPS[currentMapIndex].npcs.forEach((npc) =&gt; {\n      if (!npc.position) return;\n\n      const distance = Math.sqrt(\n        Math.pow(playerX - npc.position.x, 2) +\n          Math.pow(playerY - npc.position.y, 2),\n      );\n\n      // Only consider NPCs within interaction range (1 tile for collision)\n      if (distance &lt;= TILE_SIZE * 1.5 &amp;&amp; distance &lt; minDistance) {\n        minDistance = distance;\n        closestNPC = npc;\n      }\n    });\n\n    return closestNPC;\n  }, [characterPosition, currentMapIndex]);\n\n  // Function to handle and save gained achievements\n  const handleAchievementUnlocked = useCallback(\n    (achievementId, title, description) =&gt; {\n      // Check if character already has this achievement\n      if (\n        character &amp;&amp;\n        character.achievements &amp;&amp;\n        character.achievements.some((a) =&gt; a.id === achievementId)\n      ) {\n        return; // Already has this achievement\n      }\n\n      // Show achievement notification\n      addAchievementNotification({ title, description });\n\n      // Add achievement to character record\n      if (character &amp;&amp; character.id) {\n        const newAchievement = {\n          id: achievementId,\n          name: title,\n          description,\n          unlockedAt: new Date(),\n        };\n\n        // Update local state\n        setCharacter((prev) =&gt; {\n          const updatedAchievements = [\n            ...(prev.achievements || []),\n            newAchievement,\n          ];\n          const updatedCharacter = {\n            ...prev,\n            achievements: updatedAchievements,\n          };\n\n          // Save to backend\n          if (updatedCharacter.id) {\n            updateCharacter(updatedCharacter)\n              .then(() =&gt; console.log(\"✅ Achievement saved to backend\"))\n              .catch((err) =&gt;\n                console.error(\"❌ Failed to save achievement:\", err),\n              );\n          }\n\n          return updatedCharacter;\n        });\n\n        // Save to local storage for offline access\n        try {\n          const storedAchievements = JSON.parse(\n            localStorage.getItem(\"achievements\") || \"[]\",\n          );\n          if (!storedAchievements.some((a) =&gt; a.id === achievementId)) {\n            localStorage.setItem(\n              \"achievements\",\n              JSON.stringify([...storedAchievements, newAchievement]),\n            );\n          }\n        } catch (err) {\n          console.error(\"Failed to save achievement to localStorage:\", err);\n        }\n      }\n    },\n    [character, updateCharacter],\n  );\n\n  // Load achievements from localStorage on component mount\n  useEffect(() =&gt; {\n    try {\n      const savedAchievements = JSON.parse(\n        localStorage.getItem(\"achievements\") || \"[]\",\n      );\n      setGameData((prev) =&gt; ({ ...prev, achievements: savedAchievements }));\n    } catch (error) {\n      console.error(\"Error loading achievements:\", error);\n    }\n  }, []);\n\n  // Update checkForArtifactAchievements to use our context\n  const checkForArtifactAchievements = useCallback(\n    (updatedInventory) =&gt; {\n      checkCollectionAchievements(updatedInventory.length);\n    },\n    [checkCollectionAchievements],\n  );\n\n  // Update the handleCreateArtifact function to include achievements\n  const handleCreateArtifact = useCallback(\n    async (artifactData) =&gt; {\n      try {\n        const newArtifact = await createArtifact({\n          ...artifactData,\n          createdAt: new Date().toISOString(),\n        });\n\n        updateGameState({ artifacts: [...gameState.gameData.artifacts, newArtifact] });\n\n        // Award XP for creating an artifact\n        if (typeof awardXP === \"function\") {\n          awardXP(50, \"Created a new artifact\");\n        }\n\n        // Check for creator achievement\n        if (character &amp;&amp; character.id) {\n          const createdCount =\n            (Array.isArray(gameState.gameData.artifacts)\n              ? gameState.gameData.artifacts.filter((a) =&gt; a.createdBy === character.id)\n                  .length\n              : 0) + 1;\n          if (createdCount &gt;= 5) {\n            handleAchievementUnlocked(\n              \"creator5\",\n              \"Master Creator\",\n              \"Created 5 artifacts to shape the Authentic Internet\",\n            );\n          } else if (createdCount === 1) {\n            handleAchievementUnlocked(\n              \"creator1\",\n              \"Creator\",\n              \"Created your first artifact in the world\",\n            );\n          }\n        }\n\n        return newArtifact;\n      } catch (error) {\n        console.error(\"❌ Error creating artifact:\", error);\n        throw error;\n      }\n    },\n    [gameState.gameData.artifacts, character, updateGameState, handleAchievementUnlocked],\n  );\n\n  // Update the handleArtifactClick function to include achievements\n  const handleArtifactClick = useCallback(\n    (artifactId) =&gt; {\n      // Find the clicked artifact\n      const clickedArtifact = artifacts.find(\n        (artifact) =&gt; artifact.id === artifactId,\n      );\n      if (!clickedArtifact) return;\n\n      // Check if this artifact was already viewed\n      const isFirstView = !viewedArtifacts.includes(artifactId);\n\n      // Update viewed artifacts\n      if (isFirstView) {\n        const updatedViewedArtifacts = [...viewedArtifacts, artifactId];\n        setViewedArtifacts(updatedViewedArtifacts);\n        localStorage.setItem(\n          \"viewedArtifacts\",\n          JSON.stringify(updatedViewedArtifacts),\n        );\n\n        // Award XP for discovering a new artifact\n        addExperiencePoints(15, &#96;Discovered ${clickedArtifact.name}&#96;);\n\n        // Validate quest progress for artifact discovery\n        validateQuestProgress(\"artifact_discovered\", {\n          artifact: clickedArtifact,\n        });\n\n        // Check for discovery achievements\n        checkDiscoveryAchievements(updatedViewedArtifacts.length);\n      } else {\n        // Award smaller XP for revisiting an artifact\n        awardXP(2, \"Revisited an artifact\");\n      }\n\n      // Select the artifact to display details\n      setVisibleArtifact(clickedArtifact);\n\n      // Save game state if user is logged in\n      if (user &amp;&amp; typeof updateGameProgress === \"function\") {\n        const gameState = {\n          inventory,\n          viewedArtifacts: isFirstView\n            ? [...viewedArtifacts, artifactId]\n            : viewedArtifacts,\n          lastPosition: {\n            x: characterPosition.x,\n            y: characterPosition.y,\n            worldId: MAPS[currentMapIndex].name,\n          },\n          gameProgress: {\n            currentQuest: \"Artifact Exploration\",\n            completedQuests: [],\n            discoveredLocations: [MAPS[currentMapIndex].name],\n          },\n        };\n\n        updateGameProgress(gameState);\n      }\n    },\n    [\n      artifacts,\n      viewedArtifacts,\n      user,\n      inventory,\n      characterPosition,\n      currentMapIndex,\n      addExperiencePoints,\n      awardXP,\n      checkDiscoveryAchievements,\n      setVisibleArtifact,\n      validateQuestProgress,\n      updateGameProgress,\n    ],\n  );\n\n  // removeXpNotification and removeAchievementNotification are now handled by NotificationSystem\n\n  // Handle tile clicks for game interactions\n  const handleTileClick = useCallback(\n    (x, y, tileType) =&gt; {\n      console.log(&#96;Tile clicked at (${x}, ${y}), type: ${tileType}&#96;);\n\n      // Try NPC interaction first\n      const tileX = Math.floor(x / TILE_SIZE);\n      const tileY = Math.floor(y / TILE_SIZE);\n      const currentMap = MAPS[currentMapIndex];\n      let npcInteracted = false;\n      if (currentMap &amp;&amp; Array.isArray(currentMap.npcs)) {\n        const npc = currentMap.npcs.find(\n          (npc) =&gt;\n            npc.position &amp;&amp;\n            Math.floor(npc.position.x / TILE_SIZE) === tileX &amp;&amp;\n            Math.floor(npc.position.y / TILE_SIZE) === tileY,\n        );\n        if (npc) {\n          handleNPCInteraction(npc);\n          npcInteracted = true;\n        }\n      }\n      if (npcInteracted) return true;\n\n      // Check for artifacts at this position\n      const clickedArtifact = Array.isArray(gameState.gameData.artifacts)\n        ? gameState.gameData.artifacts.find(\n            (artifact) =&gt;\n              artifact.location &amp;&amp;\n              Math.floor(artifact.location.x) === tileX &amp;&amp;\n              Math.floor(artifact.location.y) === tileY,\n          )\n        : null;\n\n      if (clickedArtifact) {\n        handleArtifactClick(clickedArtifact.id);\n        return true;\n      }\n\n      // Handle special tile types\n      if (tileType === 3) {\n        // Special interaction tile\n        console.log(\"Special interaction tile clicked\");\n        // Show a dialog or trigger an event\n      } else if (tileType === 4) {\n        // Quest tile\n        console.log(\"Quest tile clicked\");\n        // Trigger quest dialog or advancement\n      }\n      return false;\n    },\n    [\n      gameState.gameData.artifacts,\n      handleNPCInteraction,\n      handleArtifactClick,\n      currentMapIndex,\n    ],\n  );\n\n  // Handle tile clicks with the correct tileType\n  const handleMapTileClick = useCallback(\n    (x, y) =&gt; {\n      if (currentMapIndex &lt; 0 || currentMapIndex &gt;= MAPS.length) {\n        console.error(\"Invalid map index:\", currentMapIndex);\n        return;\n      }\n\n      const mapData = MAPS[currentMapIndex];\n      if (!mapData || !mapData.tiles) {\n        console.error(\"Invalid map data or tiles:\", mapData);\n        return;\n      }\n\n      // Calculate the tile position in the map data\n      const tileX = Math.floor(x / TILE_SIZE);\n      const tileY = Math.floor(y / TILE_SIZE);\n\n      // Check if coordinates are valid\n      if (tileX &lt; 0 || tileX &gt;= MAP_COLS || tileY &lt; 0 || tileY &gt;= MAP_ROWS) {\n        console.error(\"Tile coordinates out of bounds:\", tileX, tileY);\n        return;\n      }\n\n      // Get the tile type from the map data\n      const tileIndex = tileY * MAP_COLS + tileX;\n      const tileType = mapData.tiles[tileIndex];\n\n      // Call the tile click handler with tile type\n      handleTileClick(x, y, tileType);\n    },\n    [currentMapIndex, handleTileClick],\n  );\n\n  // Handle terminal adventure completion\n  const handleTerminalComplete = useCallback(\n    (score) =&gt; {\n      // Hide any remaining portal notification\n      hidePortalNotification();\n      setPortalNotificationActive(false);\n\n      // Award XP and show notification\n      awardXP(100, \"Completed Terminal Adventure!\");\n\n      // Validate quest progress for game completion\n      validateQuestProgress(\"game_completed\", { gameType: \"terminal\", score });\n\n      // Grant achievement\n      handleAchievementUnlocked(\n        \"terminal_master\",\n        \"Terminal Master\",\n        \"Successfully navigated through the command line challenges\",\n      );\n\n      // Exit the terminal adventure\n      setCurrentSpecialWorld(null);\n    },\n    [awardXP, handleAchievementUnlocked, validateQuestProgress],\n  );\n\n  // Handle terminal adventure exit\n  const handleTerminalExit = useCallback(() =&gt; {\n    // Hide any remaining portal notification\n    hidePortalNotification();\n    updatePortalState({ portalNotificationActive: false });\n\n    setCurrentSpecialWorld(null);\n  }, [updatePortalState]);\n\n  // Handle shooter adventure completion\n  const handleShooterComplete = useCallback(\n    (score) =&gt; {\n      // Award XP based on score\n      const xpAmount = Math.min(200, score * 2);\n      awardXP(xpAmount, &#96;Shooter Score: ${score}&#96;);\n\n      // Validate quest progress for game completion\n      validateQuestProgress(\"game_completed\", { gameType: \"shooter\", score });\n\n      // Grant achievement based on score\n      if (score &gt;= 1000) {\n        handleAchievementUnlocked(\n          \"shooter_expert\",\n          \"Pixel Sharpshooter\",\n          \"Achieved an incredible score in the arcade shooter\",\n        );\n      } else if (score &gt;= 500) {\n        handleAchievementUnlocked(\n          \"shooter_adept\",\n          \"Arcade Adept\",\n          \"Proved your skills in the arcade shooter challenge\",\n        );\n      }\n\n      // Exit the shooter adventure\n      setCurrentSpecialWorld(null);\n    },\n    [awardXP, handleAchievementUnlocked],\n  );\n\n  // Handle shooter adventure exit\n  const handleShooterExit = useCallback(() =&gt; {\n    // Hide any remaining portal notification\n    hidePortalNotification();\n    updatePortalState({ portalNotificationActive: false });\n\n    setCurrentSpecialWorld(null);\n  }, [updatePortalState]);\n\n  // Update the saveGameProgress method to use context\n  const saveGameProgressWithContext = useCallback(() =&gt; {\n    if (gameState.isLoggedIn &amp;&amp; gameState.character?.id) {\n      const gameState = {\n        experience: character.experience || 0,\n        avatar: character.avatar,\n        inventory,\n        viewedArtifacts: gameState.gameData.viewedArtifacts,\n        lastPosition: {\n          x: characterPosition.x,\n          y: characterPosition.y,\n          worldId: MAPS[currentMapIndex].name,\n        },\n        gameProgress: {\n          currentQuest: \"Artifact Exploration\",\n          completedQuests: [],\n          discoveredLocations: [MAPS[currentMapIndex].name],\n        },\n      };\n\n      updateGameProgress(gameState);\n    }\n  }, [\n    isLoggedIn,\n    character,\n    inventory,\n    gameState.gameData.viewedArtifacts,\n    characterPosition,\n    currentMapIndex,\n    updateGameProgress,\n  ]);\n\n  // Function to refresh the artifacts list\n  const refreshArtifactList = useCallback(async () =&gt; {\n    try {\n      const artifactsData = await fetchArtifacts();\n      updateGameState({ artifacts: artifactsData });\n    } catch (error) {\n      console.error(\"❌ Error refreshing artifacts:\", error);\n    }\n  }, [updateGameState]);\n\n\n  // Function to toggle artifacts visibility\n  const toggleArtifactsVisibility = useCallback(() =&gt; {\n    updateUIState({ showArtifactsOnMap: !gameState.uiState.showArtifactsOnMap });\n  }, [gameState.uiState.showArtifactsOnMap, updateUIState]);\n\n  // Calculate artifacts to show based on current map\n  const artifactsToShow = useMemo(() =&gt; {\n    if (\n      !gameState.gameData.artifacts ||\n      !Array.isArray(gameState.gameData.artifacts) ||\n      !MAPS ||\n      !MAPS[currentMapIndex]\n    ) {\n      return [];\n    }\n\n    const currentMapName = MAPS[currentMapIndex].name;\n    const artifactMapName = gameState.gameData.artifacts.find(\n      (artifact) =&gt; artifact.location,\n    )?.location.mapName;\n\n    // Handle different naming conventions between MAPS and database\n    if (artifactMapName === currentMapName) {\n      return gameState.gameData.artifacts.filter((artifact) =&gt; artifact.visible);\n    }\n\n    // Handle case-insensitive matching, only if artifactMapName and currentMapName are defined\n    if (\n      typeof artifactMapName === \"string\" &amp;&amp;\n      typeof currentMapName === \"string\" &amp;&amp;\n      artifactMapName.toLowerCase() === currentMapName.toLowerCase()\n    ) {\n      return gameState.gameData.artifacts.filter((artifact) =&gt; artifact.visible);\n    }\n\n    // Handle specific mappings\n    const mapMappings = {\n      overworld: \"Overworld\",\n      desert: \"Desert 1\",\n      dungeon: \"Dungeon Level 1\",\n    };\n\n    if (mapMappings[artifactMapName] === currentMapName) {\n      return gameState.gameData.artifacts.filter((artifact) =&gt; artifact.visible);\n    }\n\n    // Handle reverse mappings\n    const reverseMappings = {\n      Overworld: \"overworld\",\n      \"Desert 1\": \"desert\",\n      \"Dungeon Level 1\": \"dungeon\",\n    };\n\n    if (reverseMappings[currentMapName] === artifactMapName) {\n      return gameState.gameData.artifacts.filter((artifact) =&gt; artifact.visible);\n    }\n\n    return [];\n  }, [gameState.gameData.artifacts, currentMapIndex]);\n\n  return (\n    &lt;ErrorBoundary&gt;\n      {/* Initialization guard to prevent render-order issues */}\n      {!isInitialized ? (\n        &lt;div\n          className=\"game-loading\"\n          style={{\n            display: \"flex\",\n            alignItems: \"center\",\n            justifyContent: \"center\",\n            height: \"100vh\",\n            backgroundColor: \"transparent\",\n            color: \"#fff\",\n            fontSize: \"18px\",\n            textShadow: \"2px 2px 4px rgba(0,0,0,0.8)\",\n          }}\n        &gt;\n          Loading...\n        &lt;/div&gt;\n      ) : (\n        &lt;div\n          className={&#96;game-container ${gameState.mobileState.highContrastMode ? \"high-contrast\" : \"\"} ${gameState.mobileState.reducedMotionMode ? \"reduced-motion\" : \"\"}&#96;}\n          role=\"application\"\n          aria-label=\"Authentic Internet Game World\"\n          aria-describedby=\"game-instructions\"\n          tabIndex={0}\n          onKeyDown={handleKeyDown}\n        &gt;\n          {/* === ACCESSIBILITY === */}\n          &lt;div id=\"game-instructions\" className=\"sr-only\"&gt;\n            Use arrow keys or WASD to move. Press I for inventory, M for map, C\n            for controls guide, F for feedback, T to talk to NPCs, H for high\n            contrast mode, R for reduced motion, S for screen reader mode. Press\n            Escape to close menus.\n          &lt;/div&gt;\n\n          &lt;div\n            id=\"screen-reader-announcements\"\n            aria-live=\"polite\"\n            aria-atomic=\"true\"\n            className=\"sr-only\"\n          /&gt;\n\n          {/* === CORE GAME WORLD === */}\n          &lt;MapComponent\n            currentMapIndex={gameState.currentMapIndex}\n            exploredTiles={gameState.exploredTiles}\n            viewport={gameState.viewport}\n            characterPosition={gameState.characterPosition}\n            artifacts={gameState.gameData.artifacts}\n            showArtifactsOnMap={gameState.uiState.showArtifactsOnMap}\n            inDungeon={gameState.uiState.inDungeon}\n          /&gt;\n\n          &lt;Character\n            ref={characterRef}\n            position={gameState.characterPosition}\n            characterState={gameState.characterState}\n            direction={gameState.characterState.direction}\n            isLoggedIn={gameState.isLoggedIn}\n            character={gameState.character}\n            soundManager={gameState.soundManager}\n            playerHealth={gameState.playerHealth}\n            maxPlayerHealth={gameState.maxPlayerHealth}\n            isInvincible={gameState.isInvincible}\n          /&gt;\n\n          {/* === UI SYSTEMS === */}\n\n          {/* Zelda-style HUD */}\n          &lt;GameHUD\n            health={gameState.playerHealth}\n            maxHealth={gameState.maxPlayerHealth}\n            rupees={gameState.rupees}\n            keys={gameState.keys}\n            currentArea={MAPS[gameState.currentMapIndex]?.name || \"Overworld\"}\n            equippedItem={gameState.equippedItem}\n            experience={gameState.characterStats.experience}\n            level={gameState.characterStats.level}\n            experienceToNextLevel={calculateXPForLevel(\n              gameState.characterStats.level + 1,\n            )}\n            isDamaged={gameState.characterState.isHit}\n          /&gt;\n\n          {/* Minimap with fog of war */}\n          &lt;Minimap\n            mapData={MAPS[currentMapIndex]?.data || []}\n            playerPosition={characterPosition}\n            npcs={MAPS[currentMapIndex]?.npcs || []}\n            portals={MAPS[currentMapIndex]?.specialPortals || []}\n            tileSize={TILE_SIZE}\n            exploredTiles={exploredTiles}\n            currentArea={MAPS[currentMapIndex]?.name || \"Overworld\"}\n          /&gt;\n\n          {gameState.uiState.showLevel4 &amp;&amp; (\n            &lt;Level4Shooter\n              onComplete={handleLevel4Complete}\n              onExit={handleLevel4Exit}\n            /&gt;\n          )}\n          &lt;div\n            className=\"viewport\"\n            style={{ width: \"100%\", height: \"100%\" }}\n            role=\"region\"\n            aria-label=\"Game viewport\"\n          &gt;\n            &lt;div\n              className={&#96;game-world ${currentMapIndex === 2 ? \"level-3\" : currentMapIndex === 1 ? \"level-2\" : \"level-1\"} ${gameState.mobileState.reducedMotionMode ? \"no-animations\" : \"\"}&#96;}\n              style={{\n                transform: gameState.mobileState.reducedMotionMode\n                  ? &#96;translate(${-viewport.x}px, ${-viewport.y}px)&#96;\n                  : &#96;translate(${-viewport.x}px, ${-viewport.y}px)&#96;,\n                width: &#96;${\n                  Array.isArray(MAPS) &amp;&amp;\n                  MAPS[currentMapIndex]?.data?.[0]?.length\n                    ? MAPS[currentMapIndex].data[0].length * TILE_SIZE\n                    : 800\n                }px&#96;,\n                height: &#96;${\n                  Array.isArray(MAPS) &amp;&amp; MAPS[currentMapIndex]?.data?.length\n                    ? MAPS[currentMapIndex].data.length * TILE_SIZE\n                    : 600\n                }px&#96;,\n              }}\n              role=\"region\"\n              aria-label={&#96;Current area: ${MAPS[currentMapIndex]?.name || \"Unknown\"}&#96;}\n            &gt;\n              {/* Conditional rendering: Dungeon or Overworld */}\n              {gameState.uiState.inDungeon &amp;&amp; gameState.dungeonState.currentDungeon ? (\n                &lt;Dungeon\n                  dungeonData={gameState.dungeonState.currentDungeon}\n                  playerPosition={characterPosition}\n                  onPlayerMove={setCharacterPosition}\n                  onCollectItem={handleDungeonItemCollect}\n                  onEnemyDefeat={handleDungeonEnemyDefeat}\n                  onBossDefeat={handleBossDefeat}\n                  onExit={handleExitDungeon}\n                  playerKeys={gameState.dungeonState.smallKeys}\n                  hasBossKey={gameState.dungeonState.hasBossKey}\n                  characterRef={characterRef}\n                /&gt;\n              ) : (\n                MAPS[currentMapIndex] &amp;&amp; (\n                  &lt;MapComponent\n                    mapData={MAPS[currentMapIndex].data}\n                    npcs={\n                      MAPS[currentMapIndex].npcs?.filter(\n                        (npc) =&gt; npc &amp;&amp; npc.position,\n                      ) || []\n                    }\n                    artifacts={\n                      !gameState.uiState.showArtifactsOnMap ? [] : artifactsToShow\n                    }\n                    onTileClick={handleMapTileClick}\n                    onNPCClick={handleNPCClick}\n                    onArtifactClick={handleArtifactClick}\n                    mapName={MAPS[currentMapIndex].name}\n                    questStatusMap={questStatusMap}\n                  /&gt;\n                )\n              )}\n\n              {/* Player Character */}\n              &lt;CharacterController\n                currentMapIndex={currentMapIndex}\n                setCurrentMapIndex={setCurrentMapIndex}\n                isLoggedIn={gameState.isLoggedIn}\n                visibleArtifact={visibleArtifact}\n                handleArtifactPickup={handleArtifactPickup}\n                setFormPosition={setFormPosition}\n                setShowInventory={setShowInventory}\n                adjustViewport={adjustViewport}\n                activePowers={activePowers}\n                user={user}\n                uiState={uiState}\n                isInvincible={gameState.isInvincible}\n                characterState={gameState.characterState}\n                onPositionChange={(position, reason) =&gt; {\n                  // Update GameWorld characterPosition state for compatibility\n                  // This is throttled to prevent excessive re-renders\n                  setCharacterPosition(position);\n                  if (reason === 'portal') {\n                    // Handle portal-specific logic if needed\n                  }\n                }}\n              /&gt;\n\n              {/* Other Players */}\n              {otherPlayers.map((player) =&gt; (\n                &lt;div\n                  key={player.userId}\n                  className=\"other-player\"\n                  style={{\n                    position: \"absolute\",\n                    left: &#96;${player.position.x}px&#96;,\n                    top: &#96;${player.position.y}px&#96;,\n                    width: &#96;${TILE_SIZE}px&#96;,\n                    height: &#96;${TILE_SIZE}px&#96;,\n                    zIndex: 10,\n                  }}\n                &gt;\n                  &lt;div className=\"other-player-avatar\"&gt;\n                    &lt;img\n                      src={player.avatar || \"/assets/default-avatar.svg\"}\n                      alt={player.username}\n                      style={{\n                        width: \"100%\",\n                        height: \"100%\",\n                        borderRadius: \"50%\",\n                        border: \"2px solid #3498db\",\n                      }}\n                    /&gt;\n                  &lt;/div&gt;\n                  &lt;div className=\"other-player-name\"&gt;{player.username}&lt;/div&gt;\n                &lt;/div&gt;\n              ))}\n\n              {/* Environment Modifiers */}\n              {gameState.uiState.isDarkMode &amp;&amp; &lt;div className=\"darkmode-overlay\" /&gt;}\n\n              {/* Buttons Menu */}\n              &lt;div className=\"game-controls\"&gt;\n                &lt;IconButton\n                  onClick={() =&gt; updateUIState({ showInventory: true })}\n                  tooltip=\"Inventory\"\n                &gt;\n                  &lt;i className=\"fas fa-briefcase\"&gt;&lt;/i&gt;\n                &lt;/IconButton&gt;\n                &lt;IconButton\n                  onClick={() =&gt; updateUIState({ showWorldMap: true })}\n                  tooltip=\"World Map\"\n                &gt;\n                  &lt;i className=\"fas fa-map\"&gt;&lt;/i&gt;\n                &lt;/IconButton&gt;\n                &lt;IconButton\n                  onClick={() =&gt; updateUIState({ showQuotes: true })}\n                  tooltip=\"Saved Quotes\"\n                &gt;\n                  &lt;i className=\"fas fa-quote-right\"&gt;&lt;/i&gt;\n                &lt;/IconButton&gt;\n                &lt;IconButton\n                  onClick={() =&gt; updateUIState({ showWorldGuide: true })}\n                  tooltip=\"World Guide\"\n                &gt;\n                  &lt;i className=\"fas fa-compass\"&gt;&lt;/i&gt;\n                &lt;/IconButton&gt;\n                &lt;IconButton\n                  onClick={() =&gt; updateUIState({ showControlsGuide: true })}\n                  tooltip=\"Keyboard Controls (C)\"\n                &gt;\n                  &lt;i className=\"fas fa-keyboard\"&gt;&lt;/i&gt;\n                &lt;/IconButton&gt;\n                &lt;IconButton\n                  onClick={toggleArtifactsVisibility}\n                  tooltip={\n                    gameState.uiState.showArtifactsOnMap\n                      ? \"Hide Artifacts\"\n                      : \"Show Artifacts\"\n                  }\n                &gt;\n                  &lt;i\n                    className={&#96;fas fa-${gameState.uiState.showArtifactsOnMap ? \"eye-slash\" : \"eye\"}&#96;}\n                  &gt;&lt;/i&gt;\n                &lt;/IconButton&gt;\n              &lt;/div&gt;\n\n              {/* Active Quest Display */}\n              {activeQuests.length &gt; 0 &amp;&amp; (\n                &lt;div className=\"active-quest-hud\"&gt;\n                  &lt;div className=\"quest-hud-header\"&gt;\n                    &lt;i className=\"fas fa-scroll\"&gt;&lt;/i&gt;\n                    &lt;span&gt;\n                      Active Quest{activeQuests.length &gt; 1 ? \"s\" : \"\"}\n                    &lt;/span&gt;\n                  &lt;/div&gt;\n                  {activeQuests.slice(0, 2).map((quest) =&gt; {\n                    const completedStages =\n                      quest.stages?.filter((s) =&gt; s.completed).length || 0;\n                    const totalStages = quest.stages?.length || 0;\n                    const progress =\n                      totalStages &gt; 0\n                        ? (completedStages / totalStages) * 100\n                        : 0;\n                    const currentStage = quest.stages?.[quest.currentStage];\n\n                    return (\n                      &lt;div key={quest.questId} className=\"quest-hud-item\"&gt;\n                        &lt;div className=\"quest-hud-title\"&gt;{quest.title}&lt;/div&gt;\n                        &lt;div className=\"quest-hud-progress\"&gt;\n                          &lt;div className=\"quest-hud-progress-bar\"&gt;\n                            &lt;div\n                              className=\"quest-hud-progress-fill\"\n                              style={{ width: &#96;${progress}%&#96; }}\n                            &gt;&lt;/div&gt;\n                          &lt;/div&gt;\n                          &lt;span className=\"quest-hud-progress-text\"&gt;\n                            {completedStages}/{totalStages}\n                          &lt;/span&gt;\n                        &lt;/div&gt;\n                        {currentStage &amp;&amp; !currentStage.completed &amp;&amp; (\n                          &lt;div className=\"quest-hud-current-task\"&gt;\n                            {currentStage.task}\n                          &lt;/div&gt;\n                        )}\n                      &lt;/div&gt;\n                    );\n                  })}\n                  {activeQuests.length &gt; 2 &amp;&amp; (\n                    &lt;div className=\"quest-hud-more\"&gt;\n                      +{activeQuests.length - 2} more quest\n                      {activeQuests.length - 2 &gt; 1 ? \"s\" : \"\"}\n                    &lt;/div&gt;\n                  )}\n                &lt;/div&gt;\n              )}\n            &lt;/div&gt;\n          &lt;/div&gt;\n\n          {/* === MODALS AND OVERLAYS === */}\n          {gameState.uiState.showWorldMap &amp;&amp; (\n            &lt;WorldMap\n              currentWorld={MAPS[gameState.currentMapIndex].name}\n              onClose={() =&gt; updateUIState({ showWorldMap: false })}\n              onNodeClick={handleWorldMapNodeClick}\n            /&gt;\n          )}\n\n          {/* Display feedback form when toggled */}\n          {gameState.uiState.showFeedback &amp;&amp; (\n            &lt;FeedbackForm\n              onClose={() =&gt; updateUIState({ showFeedback: false })}\n            /&gt;\n          )}\n\n          {/* Display keyboard controls guide */}\n          {gameState.uiState.showControlsGuide &amp;&amp; (\n            &lt;ControlsGuide\n              onClose={() =&gt; updateUIState({ showControlsGuide: false })}\n            /&gt;\n          )}\n\n          {gameState.uiState.showWinNotification &amp;&amp; (\n            &lt;div className=\"win-notification\"&gt;\n              &lt;div className=\"win-content\"&gt;\n                &lt;h2&gt;Level Complete!&lt;/h2&gt;\n                &lt;p&gt;{gameState.uiState.winMessage}&lt;/p&gt;\n                &lt;div className=\"win-stars\"&gt;★★★&lt;/div&gt;\n                &lt;button\n                  onClick={() =&gt; updateUIState({ showWinNotification: false })}\n                &gt;\n                  Continue\n                &lt;/button&gt;\n              &lt;/div&gt;\n            &lt;/div&gt;\n          )}\n\n          &lt;RewardModal\n            visible={gameState.uiState.showRewardModal}\n            onClose={() =&gt; updateUIState({ showRewardModal: false })}\n            achievement={gameState.uiState.currentAchievement}\n          /&gt;\n\n          {gameState.uiState.showForm &amp;&amp; (\n            &lt;ArtifactCreation\n              position={gameState.formPosition}\n              onClose={() =&gt; updateUIState({ showForm: false })}\n              refreshArtifacts={refreshArtifactList}\n              currentArea={MAPS[currentMapIndex].name}\n            /&gt;\n          )}\n\n          &lt;InventoryManager\n            showInventory={gameState.uiState.showInventory}\n            setShowInventory={(show) =&gt; updateUIState({ showInventory: show })}\n            character={character}\n            inventory={gameState.character?.inventory || []}\n            artifacts={gameState.gameData.artifacts}\n            currentArea={\n              Array.isArray(MAPS) &amp;&amp; MAPS[currentMapIndex]?.name\n                ? MAPS[currentMapIndex].name\n                : \"Unknown Area\"\n            }\n            setSelectedUserArtifact={setSelectedUserArtifact}\n            refreshArtifactList={refreshArtifactList}\n            setInventory={gameState.setInventory}\n            updateUIState={updateUIState}\n          /&gt;\n\n          {/* Level Up Modal */}\n          {showLevelUpModal &amp;&amp; (\n            &lt;LevelUpModal\n              level={gameState.characterStats.level}\n              stats={characterStats}\n              onClose={() =&gt; setShowLevelUpModal(false)}\n            /&gt;\n          )}\n\n          {/* Hamlet Finale Mini-Game */}\n          {gameState.showHamletFinale &amp;&amp; (\n            &lt;HamletFinale\n              onComplete={handleHamletFinaleComplete}\n              onExit={() =&gt; gameState.setShowHamletFinale(false)}\n            /&gt;\n          )}\n\n          {gameState.uiState.showQuotes &amp;&amp; character &amp;&amp; (\n            &lt;SavedQuotes\n              quotes={character.savedQuotes || []}\n              onClose={() =&gt; updateUIState({ showQuotes: false })}\n              onDeleteQuote={handleDeleteQuote}\n            /&gt;\n          )}\n\n          {/* NPC Interaction Dialog */}\n          {gameState.uiState.showNPCDialog &amp;&amp; gameState.activeNPC &amp;&amp; (\n            &lt;NPCInteraction\n              npc={gameState.activeNPC}\n              onClose={() =&gt; {\n                updateUIState({ showNPCDialog: false });\n                gameState.setActiveNPC(null);\n              }}\n              context={{\n                area: MAPS[currentMapIndex]?.name || \"Unknown\",\n                weather: \"sunny\", // Could be enhanced with real weather\n                timeOfDay:\n                  new Date().getHours() &lt; 12\n                    ? \"morning\"\n                    : new Date().getHours() &lt; 18\n                      ? \"afternoon\"\n                      : \"evening\",\n              }}\n              onQuestUpdate={async () =&gt; {\n                // Refresh quests when a quest is updated\n                const questResponse = await fetchQuests();\n                if (questResponse.success) {\n                  gameState.setActiveQuests(questResponse.data.activeQuests || []);\n                  gameState.setCompletedQuests(questResponse.data.completedQuests || []);\n                }\n              }}\n            /&gt;\n          )}\n\n          {/* Quest Completion Celebration */}\n          {gameState.questCompletionCelebration &amp;&amp; (\n            &lt;QuestCompletionCelebration\n              quest={questCompletionCelebration.quest}\n              rewards={questCompletionCelebration.rewards}\n              onClose={() =&gt; gameState.setQuestCompletionCelebration(null)}\n            /&gt;\n          )}\n\n          {/* Feedback button */}\n          &lt;div\n            className=\"feedback-button\"\n            onClick={() =&gt; updateUIState({ showFeedback: true })}\n          &gt;\n            &lt;span role=\"img\" aria-label=\"Feedback\"&gt;\n              💬\n            &lt;/span&gt;\n            &lt;span className=\"feedback-text\"&gt;Feedback&lt;/span&gt;\n          &lt;/div&gt;\n\n          {/* Map key hint - only shown when there's no other overlay */}\n          {!gameState.uiState.showInventory &amp;&amp;\n            !gameState.uiState.showForm &amp;&amp;\n            !gameState.uiState.showQuotes &amp;&amp;\n            !gameState.uiState.showWorldMap &amp;&amp;\n            !gameState.uiState.showWinNotification &amp;&amp;\n            !gameState.uiState.showRewardModal &amp;&amp;\n            !gameState.uiState.showLevel4 &amp;&amp;\n            !gameState.uiState.showFeedback &amp;&amp;\n            !gameState.uiState.showNPCDialog &amp;&amp; (\n              &lt;div className=\"map-key-hint\" role=\"status\" aria-live=\"polite\"&gt;\n                {gameState.mobileState.isMobile ? (\n                  &lt;span&gt;\n                    Tap and drag to move | Tap NPCs to talk | Use menu buttons\n                  &lt;/span&gt;\n                ) : (\n                  &lt;span&gt;\n                    Press M to view World Map | Press F for Feedback | Press T\n                    to talk to NPCs\n                  &lt;/span&gt;\n                )}\n              &lt;/div&gt;\n            )}\n\n          {/* Mobile touch controls - Directional pad for movement */}\n          {gameState.mobileState.showTouchControls &amp;&amp;\n            gameState.mobileState.touchControlsEnabled &amp;&amp;\n            characterMovement.handleMove &amp;&amp; (\n              &lt;TouchControls\n                onMove={(direction) =&gt; {\n                  characterMovement.handleMove(direction);\n                }}\n                onDrop={() =&gt; {\n                  // Handle drop action if needed\n                }}\n              /&gt;\n            )}\n\n          {/* Mobile UI controls */}\n          {gameState.mobileState.showTouchControls &amp;&amp;\n            gameState.mobileState.touchControlsEnabled &amp;&amp; (\n              &lt;div\n                className=\"mobile-controls\"\n                role=\"group\"\n                aria-label=\"Mobile game controls\"\n              &gt;\n                &lt;button\n                  className=\"mobile-control-btn inventory-btn\"\n                  onClick={() =&gt; updateUIState({ showInventory: true })}\n                  aria-label=\"Open inventory\"\n                &gt;\n                  &lt;span role=\"img\" aria-hidden=\"true\"&gt;\n                    📦\n                  &lt;/span&gt;\n                &lt;/button&gt;\n                &lt;button\n                  className=\"mobile-control-btn map-btn\"\n                  onClick={() =&gt; updateUIState({ showWorldMap: true })}\n                  aria-label=\"Open world map\"\n                &gt;\n                  &lt;span role=\"img\" aria-hidden=\"true\"&gt;\n                    🗺️\n                  &lt;/span&gt;\n                &lt;/button&gt;\n                &lt;button\n                  className=\"mobile-control-btn feedback-btn\"\n                  onClick={() =&gt; updateUIState({ showFeedback: true })}\n                  aria-label=\"Open feedback form\"\n                &gt;\n                  &lt;span role=\"img\" aria-hidden=\"true\"&gt;\n                    💬\n                  &lt;/span&gt;\n                &lt;/button&gt;\n                &lt;button\n                  className=\"mobile-control-btn accessibility-btn\"\n                  onClick={() =&gt;\n                    setMobileState((prev) =&gt; ({\n                      ...prev,\n                      screenReaderMode: !prev.screenReaderMode,\n                    }))\n                  }\n                  aria-label={\n                    gameState.mobileState.screenReaderMode\n                      ? \"Disable screen reader mode\"\n                      : \"Enable screen reader mode\"\n                  }\n                &gt;\n                  &lt;span role=\"img\" aria-hidden=\"true\"&gt;\n                    🔊\n                  &lt;/span&gt;\n                &lt;/button&gt;\n              &lt;/div&gt;\n            )}\n\n          {/* Accessibility status indicator */}\n          {gameState.mobileState.screenReaderMode &amp;&amp; (\n            &lt;div\n              className=\"accessibility-status\"\n              role=\"status\"\n              aria-live=\"polite\"\n            &gt;\n              &lt;span&gt;Screen reader mode active&lt;/span&gt;\n            &lt;/div&gt;\n          )}\n\n          {currentSpecialWorld === \"text_adventure\" &amp;&amp; (\n            &lt;TextAdventure\n              username={character?.username || \"traveler\"}\n              onComplete={handleTextAdventureComplete}\n              onExit={handleTextAdventureExit}\n            /&gt;\n          )}\n\n          {/* Add ArtifactDiscovery component */}\n          &lt;ArtifactDiscovery\n            artifacts={gameState.gameData.artifacts}\n            characterPosition={characterPosition}\n            currentMapName={MAPS[currentMapIndex].name}\n            onArtifactFound={handleArtifactClick}\n            character={character}\n          /&gt;\n\n\n\n          {/* === SPECIAL WORLDS AND MINI-GAMES === */}\n          {currentSpecialWorld === \"textAdventure\" &amp;&amp; (\n            &lt;TextAdventure\n              onComplete={handleTextAdventureComplete}\n              onExit={handleTextAdventureExit}\n              character={character}\n            /&gt;\n          )}\n\n          {currentSpecialWorld === \"terminal\" &amp;&amp; (\n            &lt;Level3Terminal\n              onComplete={handleTerminalComplete}\n              onExit={handleTerminalExit}\n              character={character}\n              artifacts={gameState.gameData.artifacts}\n              username={gameState.character?.username || \"User\"}\n              inventory={inventory}\n            /&gt;\n          )}\n\n          {currentSpecialWorld === \"shooter\" &amp;&amp; (\n            &lt;&gt;\n              {console.log(\"GameWorld: Rendering Level4Shooter component\")}\n              &lt;Level4Shooter\n                onComplete={handleShooterComplete}\n                onExit={handleShooterExit}\n                character={character}\n              /&gt;\n            &lt;/&gt;\n          )}\n\n          {currentSpecialWorld === \"hemingway\" &amp;&amp; (\n            &lt;HemingwayChallenge\n              onComplete={handleHemingwayComplete}\n              onExit={handleHemingwayExit}\n              character={character}\n            /&gt;\n          )}\n\n          {/* Artifact Game Launcher */}\n          {gameState.showGameLauncher &amp;&amp; gameState.currentGameArtifact &amp;&amp; (\n            &lt;ArtifactGameLauncher\n              artifact={gameState.currentGameArtifact}\n              character={character}\n              onComplete={handleGameComplete}\n              onExit={handleGameExit}\n              onProgressUpdate={(progress) =&gt; {\n                console.log(\"Game progress update:\", progress);\n              }}\n            /&gt;\n          )}\n\n          {/* Active Powers Display */}\n          {activePowers.length &gt; 0 &amp;&amp; (\n            &lt;div className=\"active-powers-hud\"&gt;\n              &lt;div className=\"powers-hud-label\"&gt;Active Powers:&lt;/div&gt;\n              &lt;div className=\"powers-hud-list\"&gt;\n                {activePowers.map((powerId) =&gt; {\n                  const powerDef = getPowerDefinition(powerId);\n                  return (\n                    &lt;div\n                      key={powerId}\n                      className=\"power-hud-item\"\n                      title={powerDef.description}\n                    &gt;\n                      &lt;span className=\"power-hud-icon\"&gt;{powerDef.icon}&lt;/span&gt;\n                      &lt;span className=\"power-hud-name\"&gt;{powerDef.name}&lt;/span&gt;\n                    &lt;/div&gt;\n                  );\n                })}\n              &lt;/div&gt;\n            &lt;/div&gt;\n          )}\n\n          {/* Debug overlay to show currentSpecialWorld state */}\n          &lt;div\n            className=\"debug-overlay\"\n            style={{\n              position: \"fixed\",\n              top: \"10px\",\n              left: \"10px\",\n              background: \"rgba(0,0,0,0.8)\",\n              color: \"#00ff00\",\n              padding: \"10px\",\n              zIndex: 9999,\n              pointerEvents: \"none\",\n              fontFamily: \"monospace\",\n            }}\n          &gt;\n            currentSpecialWorld: \"{currentSpecialWorld}\"\n          &lt;/div&gt;\n\n          {/* === SYSTEMS === */}\n          &lt;NotificationSystem soundManager={gameState.soundManager} /&gt;\n\n          &lt;MultiplayerChat\n            worldId={worldId}\n            worldName={MAPS[gameState.currentMapIndex]?.name || \"Unknown World\"}\n            onPlayerClick={(player) =&gt; {\n              console.log(\"Player clicked:\", player);\n              // Handle player interaction\n            }}\n          /&gt;\n        &lt;/div&gt;\n      )}\n    &lt;/ErrorBoundary&gt;\n  );\n});\n\nGameWorld.displayName = \"GameWorld\";\n\nexport default GameWorld;\n",
    "languageId": "javascriptreact"
  }
}
```
Result:

```json
{
  "diff": {
    "chunks": [
      {
        "diffString": "      [currentMap],\n    );\n+ \n+   // Convenience getter used by some hook dependency arrays\n+   const getCharacterPosition = useCallback(\n+     () =&gt; characterPosition,\n+     [characterPosition],\n+   );\n  \n    // Update explored tiles for minimap fog of war",
        "oldStart": 931,
        "newStart": 931,
        "oldLines": 4,
        "newLines": 10,
        "linesAdded": 6
      }
    ],
    "editor": "EDITOR_AI"
  },
  "shouldAutoFixLints": true,
  "resultForModel": "Success. Updated the following files:\nM client/src/components/GameWorld.jsx",
  "contentsAfterEdit": "import React, {\n  useState,\n  useEffect,\n  useRef,\n  useCallback,\n  useMemo,\n} from \"react\";\nimport {\n  fetchArtifacts,\n  createArtifact,\n  fetchCharacter,\n  updateCharacter,\n  updateUserExperience,\n  fetchQuests,\n  completeQuestStage,\n} from \"../api/api\";\nimport Character from \"./Character\";\nimport ArtifactCreation from \"./ArtifactCreation\";\nimport InventoryManager from \"./managers/InventoryManager\";\nimport ErrorBoundary from \"./ErrorBoundary\";\nimport MapComponent from \"./Map\";\nimport WorldMap from \"./WorldMap\";\nimport FeedbackForm from \"./FeedbackForm\";\nimport CharacterController from \"./controllers/CharacterController\";\nimport GameHUD from \"./UI/GameHUD\";\nimport { getPowerDefinition } from \"../constants/Powers\";\nimport ControlsGuide from \"./UI/ControlsGuide\";\nimport TouchControls from \"./TouchControls\";\nimport Minimap from \"./UI/Minimap\";\nimport CombatManager from \"./Combat/CombatManager\";\nimport { TILE_SIZE, MAP_COLS, MAP_ROWS } from \"./Constants\";\nimport { MAPS } from \"./GameData\";\nimport \"./GameWorld.css\";\nimport \"./Character.css\";\nimport \"./Artifact.css\";\nimport \"./Inventory.css\";\nimport SavedQuotes from \"./SavedQuotes\";\nimport RewardModal from \"./RewardModal\";\nimport LevelUpModal from \"./UI/LevelUpModal\";\nimport DialogBox from \"./DialogBox\";\nimport TextAdventure from \"./TextAdventure\";\nimport SoundManager from \"./utils/SoundManager\";\nimport ArtifactDiscovery from \"./ArtifactDiscovery\";\nimport NotificationSystem from \"./systems/NotificationSystem\";\nimport { useNotification } from \"./systems/useNotification\";\n// XPNotification and AchievementNotification are now handled by NotificationSystem\nimport Level3Terminal from \"./Level3Terminal\";\nimport Level4Shooter from \"./Level4Shooter\";\nimport HemingwayChallenge from \"./HemingwayChallenge\";\nimport ArtifactGameLauncher from \"./ArtifactGameLauncher\";\nimport MultiplayerChat from \"./MultiplayerChat\";\nimport NPCInteraction from \"./NPCs/NPCInteraction\";\nimport Dungeon from \"./Dungeons/Dungeon\";\nimport { LIBRARY_OF_ALEXANDRIA } from \"./Dungeons/DungeonData\";\nimport HamletFinale from \"./MiniGames/HamletFinale\";\nimport QuestCompletionCelebration from \"./QuestCompletionCelebration\";\nimport { useAuth } from \"../context/AuthContext\";\nimport { useAchievements } from \"../context/AchievementContext\";\nimport { useGameState as useGameStateContext } from \"../context/GameStateContext\";\nimport { useGameState } from \"../hooks/useGameState\";\nimport { useWebSocket } from \"../context/WebSocketContext\";\nimport gameStateManager from \"../utils/gameStateManager\";\nimport { IconButton } from \"@mui/material\";\nimport { usePortalCollisions } from \"../hooks/usePortalCollisions\";\n\n// Performance monitoring\nconst PERFORMANCE_MARKERS = {\n  RENDER_START: \"gameworld-render-start\",\n  RENDER_END: \"gameworld-render-end\",\n  STATE_UPDATE: \"gameworld-state-update\",\n  PORTAL_TRANSITION: \"gameworld-portal-transition\",\n};\n\n// Memoized constants to prevent recreation\nconst INITIAL_CHARACTER_POSITION = { x: 64, y: 64 };\nconst INITIAL_VIEWPORT = { x: 0, y: 0 };\nconst INITIAL_LEVEL_COMPLETION = {\n  level1: false,\n  level2: false,\n  level3: false,\n  level4: false,\n};\n\nconst GameWorld = React.memo(() =&gt; {\n  // Initialization guard to prevent render-order issues\n  const [isInitialized, setIsInitialized] = useState(false);\n  const [showLevelUpModal, setShowLevelUpModal] = useState(false);\n\n  // Use the custom game state hook\n  const gameState = useGameState();\n\n  // Destructure state values and setters from gameState\n  const {\n    // State values\n    currentMapIndex,\n    characterPosition,\n    viewport,\n    exploredTiles,\n    inventory,\n    character,\n    visibleArtifact,\n    currentSpecialWorld,\n    characterStats,\n    uiState,\n    questStatusMap,\n    mobileState,\n    portalState,\n    // Setters\n    setCurrentMapIndex,\n    setCharacterPosition,\n    setViewport,\n    setExploredTiles,\n    setInventory,\n    setCharacter,\n    setVisibleArtifact,\n    setCurrentSpecialWorld,\n    setCharacterStats,\n    setPlayerHealth,\n    setMaxPlayerHealth,\n    setPortalState,\n    setGameData,\n    updateUIState,\n    setActiveNPC,\n    setSelectedUserArtifact,\n    setIsInvincible,\n    setRupees,\n    setKeys,\n    setCharacterState,\n    setQuestStatusMap,\n    setMobileState,\n  } = gameState;\n\n  // Performance tracking\n  const renderCount = useRef(0);\n  const lastRenderTime = useRef(performance.now());\n  const lastUpdateTime = useRef(performance.now());\n  const updateThrottle = useRef(16); // 16ms throttle (60fps)\n\n  // All state is now managed by the gameState hook\n\n  // Context hooks\n  const { user } = useAuth();\n  const {\n    unlockAchievement,\n    checkLevelAchievements,\n    checkDiscoveryAchievements,\n    checkCollectionAchievements,\n  } = useAchievements();\n  const { updateGameProgress } = useGameStateContext();\n  const {\n    addXPNotification,\n    addAchievementNotification,\n    showPortalNotification,\n    hidePortalNotification,\n    createInteractiveNotification,\n    setPortalNotificationActive,\n  } = useNotification();\n\n  // WebSocket connection for multiplayer\n  const { socket, isConnected, sendMessage } = useWebSocket();\n  const gameWorldRef = useRef(null);\n  const characterRef = useRef(null);\n  const characterControllerRef = useRef(null);\n\n  // portalNotificationActive is now handled by NotificationSystem\n\n  // Update checkForLevelUpAchievements to use our context\n  const checkForLevelUpAchievements = useCallback(\n    (experience) =&gt; {\n      const level = Math.floor(experience / 100) + 1;\n      checkLevelAchievements(level);\n    },\n    [checkLevelAchievements],\n  );\n\n  // Fetch active quests on mount and when user changes\n  useEffect(() =&gt; {\n    if (user?.id) {\n      fetchQuests()\n        .then((response) =&gt; {\n          if (response.success) {\n            gameState.setActiveQuests(response.data.activeQuests || []);\n            gameState.setCompletedQuests(response.data.completedQuests || []);\n          }\n        })\n        .catch((err) =&gt; console.error(\"Error fetching quests:\", err));\n    }\n  }, [user?.id]);\n\n  // Create quest status map for NPCs when quests or current map changes\n  useEffect(() =&gt; {\n    if (!MAPS[currentMapIndex]?.npcs) return;\n\n    const statusMap = new Map();\n    const currentNPCs = MAPS[currentMapIndex].npcs || [];\n\n    currentNPCs.forEach((npc) =&gt; {\n      const npcId = npc._id || npc.id;\n      if (!npcId) return;\n\n      // Check if NPC has any active quests\n      const npcActiveQuests = gameState.activeQuests.filter(\n        (quest) =&gt;\n          quest.npcId === npcId ||\n          quest.npcId?.toString() === npcId?.toString(),\n      );\n\n      // Check if NPC has any completed quests\n      const npcCompletedQuests = gameState.completedQuests.filter(\n        (quest) =&gt;\n          quest.npcId === npcId ||\n          quest.npcId?.toString() === npcId?.toString(),\n      );\n\n      // Check if NPC has quests in their data (available but not started)\n      const hasQuestsData = npc.quests &amp;&amp; npc.quests.length &gt; 0;\n\n      // Determine status: available &gt; active &gt; completed\n      if (\n        hasQuestsData &amp;&amp;\n        npcActiveQuests.length === 0 &amp;&amp;\n        npcCompletedQuests.length === 0\n      ) {\n        // Has quests in data but none started/completed = available\n        statusMap.set(npcId, {\n          status: \"available\",\n          icon: \"!\",\n          color: \"#f39c12\",\n          title: \"Has available quests!\",\n        });\n      } else if (npcActiveQuests.length &gt; 0) {\n        // Has active quests\n        statusMap.set(npcId, {\n          status: \"active\",\n          icon: \"?\",\n          color: \"#3498db\",\n          title: \"Has active quests\",\n        });\n      } else if (npcCompletedQuests.length &gt; 0) {\n        // Has completed quests\n        statusMap.set(npcId, {\n          status: \"completed\",\n          icon: \"✓\",\n          color: \"#27ae60\",\n          title: \"Quest completed\",\n        });\n      }\n    });\n\n    setQuestStatusMap(statusMap);\n  }, [gameState.activeQuests, gameState.completedQuests, currentMapIndex, setQuestStatusMap]);\n\n  // Screen reader announcement function\n  const announceToScreenReader = useCallback((message) =&gt; {\n    const announcementsElement = document.getElementById(\n      \"screen-reader-announcements\",\n    );\n    if (announcementsElement) {\n      announcementsElement.textContent = message;\n      // Clear after a short delay to allow re-announcement\n      setTimeout(() =&gt; {\n        announcementsElement.textContent = \"\";\n      }, 1000);\n    }\n  }, []);\n\n  // Get Shakespeare quest from active quests\n  const shakespeareQuest = useMemo(() =&gt; {\n    return (\n      gameState.activeQuests.find(\n        (quest) =&gt;\n          quest.npcId === \"shakespeare\" ||\n          quest.title?.includes(\"Shakespeare\") ||\n          quest.title?.includes(\"Tempest\"),\n      ) || { stage: \"not_started\" }\n    );\n  }, [gameState.activeQuests]);\n\n  // Portal notification functions are now handled by NotificationSystem\n\n  // Quest validation: Check if gameplay actions complete quest stages\n  const validateQuestProgress = useCallback(\n    async (actionType, actionData = {}) =&gt; {\n      if (gameState.activeQuests.length === 0) return;\n\n      for (const quest of gameState.activeQuests) {\n        const currentStage = quest.stages?.[quest.currentStage];\n        if (!currentStage || currentStage.completed) continue;\n\n        const task = currentStage.task?.toLowerCase() || \"\";\n        let shouldComplete = false;\n\n        // Check task requirements\n        if (actionType === \"artifact_collected\" &amp;&amp; task.includes(\"collect\")) {\n          // Check if task mentions artifacts or specific artifact\n          if (task.includes(\"artifact\") || task.includes(\"item\")) {\n            shouldComplete = true;\n          }\n        } else if (\n          actionType === \"game_completed\" &amp;&amp;\n          task.includes(\"complete\")\n        ) {\n          // Check if task mentions games or mini-games\n          if (\n            task.includes(\"game\") ||\n            task.includes(\"mini-game\") ||\n            task.includes(\"challenge\")\n          ) {\n            shouldComplete = true;\n          }\n        } else if (\n          actionType === \"artifact_discovered\" &amp;&amp;\n          task.includes(\"discover\")\n        ) {\n          shouldComplete = true;\n        }\n\n        if (shouldComplete) {\n          try {\n            const response = await completeQuestStage(\n              quest.questId,\n              quest.currentStage,\n            );\n            if (response.success) {\n              // Refresh quests\n              const questResponse = await fetchQuests();\n              if (questResponse.success) {\n                gameState.setActiveQuests(questResponse.data.activeQuests || []);\n                gameState.setCompletedQuests(questResponse.data.completedQuests || []);\n              }\n\n              const rewards = response.data.rewards;\n\n              // If quest is fully completed, show celebration\n              if (response.data.questCompleted) {\n                const completedQuest = {\n                  title: quest.title,\n                  description: quest.description,\n                };\n                gameState.setQuestCompletionCelebration({\n                  quest: completedQuest,\n                  rewards: rewards,\n                });\n              } else {\n                // Show progress notification for stage completion\n                let rewardText = &#96;Quest progress!&#96;;\n                if (rewards.exp) rewardText += &#96; +${rewards.exp} XP&#96;;\n                if (rewards.item) rewardText += &#96; +${rewards.item}&#96;;\n\n                // Show a brief notification\n                showPortalNotification(\"Quest Progress\", rewardText);\n                setTimeout(() =&gt; hidePortalNotification(), 3000);\n              }\n            }\n          } catch (error) {\n            console.error(\"Error completing quest stage:\", error);\n          }\n        }\n      }\n    },\n    [gameState.activeQuests, showPortalNotification, hidePortalNotification],\n  );\n\n  // Function to add XP and show notification\n  const addExperiencePoints = useCallback(\n    (amount, reason) =&gt; {\n      // Update local experience state\n      const newExperience = (user?.experience || 0) + amount;\n\n      const newHealth = Math.max(0, gameState.playerHealth - damage);\n      setPlayerHealth(newHealth);\n\n      // Play damage sound\n      if (gameState.soundManager) {\n        gameState.soundManager.playSound(\"damage\", 0.5);\n      }\n\n      // Trigger hit animation (retreat and flash)\n      setCharacterState((prev) =&gt; ({ ...prev, isHit: true }));\n      setTimeout(() =&gt; {\n        setCharacterState((prev) =&gt; ({ ...prev, isHit: false }));\n      }, 400); // Match CSS animation duration\n\n      // Invincibility frames\n      setIsInvincible(true);\n      setTimeout(() =&gt; setIsInvincible(false), 1000);\n\n      // Check for game over\n      if (newHealth &lt;= 0) {\n        handleGameOver();\n      }\n    },\n    [gameState.playerHealth, gameState.isInvincible, gameState.soundManager],\n  );\n\n  const handlePlayerHeal = useCallback(\n    (amount) =&gt; {\n      const newHealth = Math.min(gameState.maxPlayerHealth, gameState.playerHealth + amount);\n      setPlayerHealth(newHealth);\n\n      if (gameState.soundManager) {\n        gameState.soundManager.playSound(\"heal\", 0.3);\n      }\n    },\n    [gameState.playerHealth, gameState.maxPlayerHealth, gameState.soundManager],\n  );\n\n  const handleCollectRupee = useCallback(\n    (amount) =&gt; {\n      setRupees((prev) =&gt; prev + amount);\n\n      if (gameState.soundManager) {\n        gameState.soundManager.playSound(\"rupee\", 0.3);\n      }\n    },\n    [gameState.soundManager],\n  );\n\n  const handleCollectKey = useCallback(() =&gt; {\n    setKeys((prev) =&gt; prev + 1);\n\n    if (gameState.soundManager) {\n      gameState.soundManager.playSound(\"key\", 0.3);\n    }\n  }, [gameState.soundManager]);\n\n  // XP and Leveling System\n  // Calculate XP required for next level\n  const calculateXPForLevel = useCallback((level) =&gt; {\n    return Math.floor(100 * Math.pow(1.5, level - 1));\n  }, []);\n\n  // Handle gaining experience with level-up logic\n  const handleGainExperience = useCallback(\n    (amount, source = \"Unknown\", position = null) =&gt; {\n      console.log(&#96;Gained ${amount} XP from: ${source}&#96;);\n\n      // Add XP notification at enemy position\n      if (position) {\n        addXPNotification(amount, source, position);\n      }\n\n      setCharacterStats((prev) =&gt; {\n        const newXP = prev.experience + amount;\n        const xpNeeded = calculateXPForLevel(prev.level + 1);\n\n        // Check for level up\n        if (newXP &gt;= xpNeeded) {\n          const newLevel = prev.level + 1;\n          const newMaxHealth = gameState.maxPlayerHealth + 2;\n          const newAttack = prev.attack + 1;\n          const newDefense =\n            newLevel % 2 === 0 ? prev.defense + 1 : prev.defense;\n\n          // Full heal on level up\n          setPlayerHealth(newMaxHealth);\n          setMaxPlayerHealth(newMaxHealth);\n\n          // Show level-up modal\n          setShowLevelUpModal(true);\n\n          // Play level-up sound\n          if (gameState.soundManager) {\n            gameState.soundManager.playSound(\"powerup\", 0.7); // Use powerup sound for now\n          }\n\n          console.log(&#96;🌟 LEVEL UP! Now level ${newLevel}&#96;);\n          console.log(&#96;  +2 Max Health (${newMaxHealth})&#96;);\n          console.log(&#96;  +1 Attack (${newAttack})&#96;);\n          if (newLevel % 2 === 0) {\n            console.log(&#96;  +1 Defense (${newDefense})&#96;);\n          }\n\n          return {\n            experience: newXP,\n            level: newLevel,\n            attack: newAttack,\n            defense: newDefense,\n          };\n        }\n\n        return { ...prev, experience: newXP };\n      });\n    },\n    [calculateXPForLevel, gameState.maxPlayerHealth, gameState.soundManager],\n  );\n\n  // Alias for handleGainExperience to match existing code that uses awardXP\n  const awardXP = useCallback(\n    (amount, reason) =&gt; {\n      handleGainExperience(amount, reason, null);\n    },\n    [handleGainExperience],\n  );\n\n  // Viewport adjustment function to follow character\n  const adjustViewport = useCallback(\n    (characterPos) =&gt; {\n      if (!characterPos || typeof gameState.currentMapIndex !== \"number\") return;\n\n      const gameWorldElement = document.querySelector(\".game-world\");\n      if (!gameWorldElement) return;\n\n      const viewportWidth = window.innerWidth;\n      const viewportHeight = window.innerHeight;\n\n      // Calculate new viewport position to center character\n      const newViewportX = Math.max(0, characterPos.x - viewportWidth / 2);\n      const newViewportY = Math.max(0, characterPos.y - viewportHeight / 2);\n\n      // Get map dimensions\n      const currentMapData = MAPS[gameState.currentMapIndex];\n      if (currentMapData &amp;&amp; currentMapData.data) {\n        const mapWidth = currentMapData.data[0]?.length * TILE_SIZE || 800;\n        const mapHeight = currentMapData.data.length * TILE_SIZE || 600;\n\n        // Clamp viewport to map boundaries\n        const clampedX = Math.min(\n          newViewportX,\n          Math.max(0, mapWidth - viewportWidth),\n        );\n        const clampedY = Math.min(\n          newViewportY,\n          Math.max(0, mapHeight - viewportHeight),\n        );\n\n        setViewport({ x: clampedX, y: clampedY });\n      }\n    },\n    [gameState.currentMapIndex],\n  );\n\n  // updateNotifications is now handled by NotificationSystem\n\n  const updateCharacterState = useCallback((updates) =&gt; {\n    setCharacterState((prev) =&gt; ({ ...prev, ...updates }));\n  }, []);\n\n  const updatePortalState = useCallback((updates) =&gt; {\n    setPortalState((prev) =&gt; ({ ...prev, ...updates }));\n  }, []);\n\n  // Optimized state update function\n  const updateGameState = useCallback(\n    (updates) =&gt; {\n      const now = performance.now();\n      if (now - lastUpdateTime.current &lt; updateThrottle.current) {\n        return; // Throttle updates\n      }\n      lastUpdateTime.current = now;\n      setGameData((prev) =&gt; ({ ...prev, ...updates }));\n    },\n    [],\n  );\n\n  // Show world announcement when transitioning to new area\n  const showWorldAnnouncement = useCallback((worldName) =&gt; {\n    // Create the announcement element if it doesn't exist\n    let announcement = document.getElementById(\"world-announcement\");\n\n    if (!announcement) {\n      announcement = document.createElement(\"div\");\n      announcement.id = \"world-announcement\";\n      announcement.className = \"world-announcement\";\n      document.body.appendChild(announcement);\n    }\n\n    // Update announcement content\n    announcement.innerHTML = &#96;&lt;h2&gt;Welcome to ${worldName}&lt;/h2&gt;&#96;;\n\n    // Make announcement visible\n    setTimeout(() =&gt; {\n      announcement.classList.add(\"active\");\n    }, 10);\n\n    // Auto-hide after 3 seconds\n    setTimeout(() =&gt; {\n      announcement.classList.add(\"fade-out\");\n      setTimeout(() =&gt; {\n        if (announcement &amp;&amp; announcement.parentNode) {\n          announcement.parentNode.removeChild(announcement);\n        }\n      }, 1000);\n    }, 3000);\n  }, []);\n\n  // Optimized level completion handler\n  const handleLevelCompletion = useCallback(\n    (level) =&gt; {\n      if (gameState.gameData.levelCompletion[level]) return; // Already completed\n\n      updateGameState({\n        levelCompletion: { ...gameState.gameData.levelCompletion, [level]: true },\n      });\n\n      updateUIState({\n        showWinNotification: true,\n        winMessage: &#96;Level ${level} Complete!&#96;,\n      });\n\n      // Play completion sound\n      if (gameState.soundManager) {\n        gameState.soundManager.playSound(\"level_complete\");\n      }\n\n      // Award experience\n      if (user) {\n        updateUserExperience(user.id, 100);\n      }\n\n      // Check achievements\n      checkLevelAchievements(level);\n    },\n    [\n      gameState.gameData.levelCompletion,\n      updateGameState,\n      gameState.soundManager,\n      user,\n      checkLevelAchievements,\n    ],\n  );\n\n  // Handle portal transitions with performance optimization\n  const handlePortalTransition = useCallback(\n    (destinationMap, spawnPosition, isSpecial = false) =&gt; {\n      if (portalState.isTransitioning) return;\n\n      performance.mark(PERFORMANCE_MARKERS.PORTAL_TRANSITION);\n\n      updatePortalState({ isTransitioning: true });\n\n      // Play portal sound\n      if (gameState.soundManager) {\n        gameState.soundManager.playSound(\"portal\");\n      }\n\n      // Add portal transition animation\n      const gameWorld = document.querySelector(\".game-world\");\n      if (gameWorld) {\n        gameWorld.classList.add(\"portal-transition\");\n      }\n\n      // Use requestAnimationFrame for smooth transitions\n      const transitionAnimation = () =&gt; {\n        setTimeout(() =&gt; {\n          if (isSpecial) {\n            setCurrentSpecialWorld(destinationMap);\n          } else {\n            const destinationIndex = MAPS.findIndex(\n              (map) =&gt; map.name === destinationMap,\n            );\n            if (destinationIndex !== -1) {\n              setCurrentMapIndex(destinationIndex);\n              setCharacterPosition(spawnPosition);\n\n              // Show world announcement\n              showWorldAnnouncement(destinationMap);\n\n              // Handle level completion for Yosemite\n              if (destinationMap === \"Yosemite\") {\n                setTimeout(() =&gt; {\n                  handleLevelCompletion(\"level1\");\n                }, 800);\n              }\n            } else {\n              console.error(\n                &#96;Destination map \"${destinationMap}\" not found&#96;,\n              );\n            }\n          }\n\n          // Remove transition animation\n          if (gameWorld) {\n            gameWorld.classList.remove(\"portal-transition\");\n          }\n\n          updatePortalState({\n            isTransitioning: false,\n            activePortal: null,\n            portalNotificationActive: false,\n          });\n          hidePortalNotification();\n\n          performance.mark(PERFORMANCE_MARKERS.PORTAL_TRANSITION + \"-end\");\n          try {\n            performance.measure(\n              \"Portal Transition\",\n              PERFORMANCE_MARKERS.PORTAL_TRANSITION,\n              PERFORMANCE_MARKERS.PORTAL_TRANSITION + \"-end\",\n            );\n          } catch (error) {\n            // Performance timing not available, skip measurement\n            console.debug(\n              \"Performance measurement skipped:\",\n              error.message,\n            );\n          }\n        }, 1000);\n      };\n\n      requestAnimationFrame(transitionAnimation);\n    },\n    [\n      portalState.isTransitioning,\n      gameState.soundManager,\n      setCurrentSpecialWorld,\n      updatePortalState,\n      showWorldAnnouncement,\n      handleLevelCompletion,\n      hidePortalNotification,\n      setCurrentMapIndex,\n      setCharacterPosition,\n    ],\n  );\n\n  // Handle NPC interaction\n  const handleNPCInteraction = useCallback(\n    (npc) =&gt; {\n      if (!npc) return;\n\n      console.log(\"Interacting with NPC:\", npc.name || npc.type);\n\n      // Special handling for Shakespeare's quest\n      if (\n        npc.name === \"William Shakespeare\" &amp;&amp;\n        shakespeareQuest.stage === \"enemies_defeated\"\n      ) {\n        console.log(\"🎭 Triggering Hamlet Finale!\");\n        gameState.setShowHamletFinale(true);\n\n        // Play dramatic sound\n        if (gameState.soundManager) {\n          gameState.soundManager.playSound(\"quest_start\", 0.8);\n        }\n\n        if (gameState.mobileState.screenReaderMode) {\n          announceToScreenReader(\"Beginning the Hamlet Finale challenge!\");\n        }\n        return; // Don't show regular dialogue\n      }\n\n      // Set the active NPC and show dialog\n      gameState.setActiveNPC(npc);\n      updateUIState({ showNPCDialog: true });\n\n      // Play interaction sound if available\n      if (gameState.soundManager) {\n        gameState.soundManager.playSound(\"npc_interaction\");\n      }\n\n      // Add visual feedback\n      if (gameState.mobileState.screenReaderMode) {\n        announceToScreenReader(\n          &#96;Starting conversation with ${npc.name || npc.type}&#96;,\n        );\n      }\n    },\n    [\n      shakespeareQuest.stage,\n      gameState.soundManager,\n      gameState.mobileState.screenReaderMode,\n      announceToScreenReader,\n      updateUIState,\n    ],\n  );\n\n  // Handler for clicking on an NPC in the map\n  const handleNPCClick = useCallback(\n    (npc) =&gt; {\n      handleNPCInteraction(npc);\n    },\n    [handleNPCInteraction],\n  );\n\n  // Artifact Game Launcher handlers\n  const handleGameComplete = useCallback(\n    (completionData) =&gt; {\n      console.log(\"🎉 Game completed:\", completionData);\n\n      // Resume background music\n      if (gameState.soundManager) {\n        const currentMapName = MAPS[gameState.currentMapIndex]?.name || \"\";\n        gameState.soundManager.playMusic(currentMapName);\n      }\n\n      // Validate quest progress for game completion\n      validateQuestProgress(\"game_completed\", {\n        gameType: completionData.artifact?.type || \"game\",\n        artifact: completionData.artifact,\n      });\n\n      // Close game launcher\n      setShowGameLauncher(false);\n      setCurrentGameArtifact(null);\n\n      // Show completion notification\n      if (completionData.artifact) {\n        showPortalNotification(\n          \"Quest Complete!\",\n          &#96;You completed ${completionData.artifact.name}!&#96;,\n        );\n\n        // Auto-hide notification after 3 seconds\n        setTimeout(() =&gt; {\n          hidePortalNotification();\n        }, 3000);\n      }\n    },\n    [gameState.soundManager, gameState.currentMapIndex, validateQuestProgress, showPortalNotification, hidePortalNotification],\n  );\n\n  const handleGameExit = useCallback(() =&gt; {\n    console.log(\"🚪 Exiting game launcher\");\n\n    // Resume background music\n    if (gameState.soundManager) {\n      const currentMapName = MAPS[gameState.currentMapIndex]?.name || \"\";\n      gameState.soundManager.playMusic(currentMapName);\n    }\n\n    // Close game launcher\n    setShowGameLauncher(false);\n    setCurrentGameArtifact(null);\n  }, [gameState.soundManager, gameState.currentMapIndex]);\n\n  const handleGameOver = useCallback(() =&gt; {\n    console.log(\"Game Over!\");\n    // Reset player health\n    setPlayerHealth(Math.floor(gameState.maxPlayerHealth / 2)); // Respawn with half health\n    // Reset position to start\n    setCharacterPosition(INITIAL_CHARACTER_POSITION);\n\n    if (gameState.soundManager) {\n      gameState.soundManager.playSound(\"gameover\", 0.5);\n    }\n  }, [gameState.maxPlayerHealth, gameState.soundManager]);\n\n  // Memoized portal configuration\n  const PORTAL_CONFIG = useMemo(\n    () =&gt; ({\n      progression: {\n        Overworld: [\n          {\n            destination: \"Overworld 2\",\n            spawnPosition: { x: 4 * TILE_SIZE, y: 4 * TILE_SIZE },\n            condition: (x, y) =&gt; x === 8 &amp;&amp; y === 11,\n          },\n          {\n            destination: \"Dungeon Level 1\",\n            spawnPosition: { x: 1 * TILE_SIZE, y: 1 * TILE_SIZE },\n            condition: (x, y) =&gt; x === 10 &amp;&amp; y === 12,\n          },\n        ],\n        \"Overworld 2\": {\n          destination: \"Overworld 3\",\n          spawnPosition: { x: 4 * TILE_SIZE, y: 4 * TILE_SIZE },\n        },\n        \"Overworld 3\": [\n          {\n            destination: \"Desert 1\",\n            spawnPosition: { x: 4 * TILE_SIZE, y: 4 * TILE_SIZE },\n            condition: (x, y) =&gt; x === 8 &amp;&amp; y === 0,\n          },\n          {\n            destination: \"Yosemite\",\n            spawnPosition: { x: 10 * TILE_SIZE, y: 20 * TILE_SIZE }, // Central spawn for larger map\n            condition: (x, y) =&gt; x === 8 &amp;&amp; y === 11,\n          },\n        ],\n        \"Desert 1\": {\n          destination: \"Desert 2\",\n          spawnPosition: { x: 4 * TILE_SIZE, y: 4 * TILE_SIZE },\n        },\n        \"Desert 2\": {\n          destination: \"Desert 3\",\n          spawnPosition: { x: 4 * TILE_SIZE, y: 4 * TILE_SIZE },\n        },\n        \"Desert 3\": {\n          destination: \"Dungeon Level 1\",\n          spawnPosition: { x: 4 * TILE_SIZE, y: 4 * TILE_SIZE },\n        },\n        \"Dungeon Level 1\": {\n          destination: \"Dungeon Level 2\",\n          spawnPosition: { x: 1 * TILE_SIZE, y: 1 * TILE_SIZE },\n        },\n        \"Dungeon Level 2\": {\n          destination: \"Dungeon Level 3\",\n          spawnPosition: { x: 1 * TILE_SIZE, y: 1 * TILE_SIZE },\n        },\n        \"Dungeon Level 3\": {\n          destination: \"Yosemite\",\n          spawnPosition: { x: 10 * TILE_SIZE, y: 20 * TILE_SIZE }, // Central spawn for larger map\n        },\n      },\n      yosemiteReturn: {\n        destination: \"Overworld 3\",\n        spawnPosition: { x: 8 * TILE_SIZE, y: 2 * TILE_SIZE },\n      },\n      special: {\n        6: {\n          type: \"terminal\",\n          title: \"Terminal Challenge\",\n          message: \"Press SPACE to enter the Terminal Challenge\",\n        },\n        7: {\n          type: \"shooter\",\n          title: \"Arcade Shooter\",\n          message: \"Press SPACE to enter the Arcade Shooter\",\n        },\n        8: {\n          type: \"text_adventure\",\n          title: \"Text Adventure\",\n          message: \"Press SPACE to enter the Text Adventure\",\n        },\n      },\n    }),\n    [],\n  );\n\n  // Memoized current map data with safety check\n  const currentMap = useMemo(() =&gt; {\n    // Safety check to prevent initialization order issues\n    if (typeof gameState.currentMapIndex !== \"number\" || !MAPS || !Array.isArray(MAPS)) {\n      return MAPS?.[0] || null;\n    }\n    return MAPS[gameState.currentMapIndex] || MAPS[0];\n  }, [gameState.currentMapIndex]);\n  const currentMapNPCs = useMemo(() =&gt; currentMap?.npcs || [], [currentMap]);\n  const currentMapArtifacts = useMemo(\n    () =&gt; currentMap?.artifacts || [],\n    [currentMap],\n  );\n\n  // Convenience getter used by some hook dependency arrays\n  const getCharacterPosition = useCallback(\n    () =&gt; characterPosition,\n    [characterPosition],\n  );\n\n  // Update explored tiles for minimap fog of war\n  useEffect(() =&gt; {\n    const tileX = Math.floor(gameState.characterPosition.x / TILE_SIZE);\n    const tileY = Math.floor(gameState.characterPosition.y / TILE_SIZE);\n\n    // Explore tiles in a radius around the player (view distance)\n    const viewRadius = 3; // Explore 3 tiles in all directions\n\n    setExploredTiles((prevExploredTiles) =&gt; {\n      const newExploredTiles = new Set(prevExploredTiles);\n      let hasNewTiles = false;\n\n      for (let dy = -viewRadius; dy &lt;= viewRadius; dy++) {\n        for (let dx = -viewRadius; dx &lt;= viewRadius; dx++) {\n          const x = tileX + dx;\n          const y = tileY + dy;\n\n          // Check if tile is within map bounds\n          if (x &gt;= 0 &amp;&amp; x &lt; MAP_COLS &amp;&amp; y &gt;= 0 &amp;&amp; y &lt; MAP_ROWS) {\n            const tileKey = &#96;${x},${y}&#96;;\n            if (!newExploredTiles.has(tileKey)) {\n              newExploredTiles.add(tileKey);\n              hasNewTiles = true;\n            }\n          }\n        }\n      }\n\n      // Only update if new tiles were explored\n      return hasNewTiles ? newExploredTiles : prevExploredTiles;\n    });\n  }, [getCharacterPosition]); // Remove exploredTiles from dependencies\n\n  // Performance monitoring - only run occasionally to avoid render loops\n  useEffect(() =&gt; {\n    renderCount.current++;\n    const now = performance.now();\n    const renderTime = now - lastRenderTime.current;\n\n    // Only log slow renders occasionally (every 100th render) to avoid console spam\n    if (renderTime &gt; 16 &amp;&amp; renderCount.current % 100 === 0) {\n      console.warn(\n        &#96;Slow render detected: ${renderTime.toFixed(2)}ms (render #${renderCount.current})&#96;,\n      );\n    }\n\n    lastRenderTime.current = now;\n\n    // Performance mark for render - with safety checks\n    if (performance.mark &amp;&amp; renderCount.current % 100 === 0) {\n      performance.mark(PERFORMANCE_MARKERS.RENDER_END);\n\n      // Only measure if the start mark exists\n      try {\n        performance.measure(\n          \"GameWorld Render\",\n          PERFORMANCE_MARKERS.RENDER_START,\n          PERFORMANCE_MARKERS.RENDER_END,\n        );\n      } catch (error) {\n        // Start mark doesn't exist yet, create it for next time\n        performance.mark(PERFORMANCE_MARKERS.RENDER_START);\n      }\n    }\n    // Empty dependency array would prevent this from running on every render,\n    // but we want to track render count, so we'll keep it running but throttle logging\n  });\n\n  // Automatic portal activation on collision\n  useEffect(() =&gt; {\n    const handlePortalCollision = (event) =&gt; {\n      if (portalState.isTransitioning) return;\n\n      const { tileX, tileY, tileType } = event.detail;\n      const currentMapName = currentMap?.name;\n\n      if (!currentMapName) return;\n\n      console.log(\n        &#96;Portal collision detected - Map: ${currentMapName}, Tile: (${tileX}, ${tileY}), Type: ${tileType}&#96;,\n      );\n\n      // Handle progression portals (type 5)\n      if (tileType === 5) {\n        const progressionPortal = PORTAL_CONFIG.progression[currentMapName];\n        if (progressionPortal) {\n          // Handle multiple portals per map (array)\n          if (Array.isArray(progressionPortal)) {\n            for (const portal of progressionPortal) {\n              const { destination, spawnPosition, condition } = portal;\n\n              // Check if portal condition is met\n              if (condition &amp;&amp; condition(tileX, tileY)) {\n                console.log(&#96;✅ Auto-activating portal to ${destination}&#96;);\n                handlePortalTransition(destination, spawnPosition);\n                return;\n              }\n            }\n          } else {\n            // Handle single portal (object)\n            const { destination, spawnPosition, condition } =\n              progressionPortal;\n\n            // Check if portal condition is met (if any)\n            if (!condition || condition(tileX, tileY)) {\n              console.log(&#96;✅ Auto-activating portal to ${destination}&#96;);\n              handlePortalTransition(destination, spawnPosition);\n              return;\n            }\n          }\n        }\n      }\n\n      // Handle special portals in Yosemite (types 6-8)\n      if (currentMapName === \"Yosemite\" &amp;&amp; tileType &gt;= 6 &amp;&amp; tileType &lt;= 8) {\n        const specialPortal = PORTAL_CONFIG.special[tileX];\n\n        if (specialPortal &amp;&amp; tileY === 1) {\n          console.log(\n            &#96;✅ Auto-activating special portal: ${specialPortal.title}&#96;,\n          );\n\n          // Activate the special world directly\n          if (specialPortal.type === \"terminal\") {\n            setCurrentSpecialWorld(\"terminal\");\n          } else if (specialPortal.type === \"shooter\") {\n            setCurrentSpecialWorld(\"shooter\");\n          } else if (specialPortal.type === \"text_adventure\") {\n            setCurrentSpecialWorld(\"text_adventure\");\n          }\n\n          updatePortalState({\n            activePortal: specialPortal,\n            portalNotificationActive: true,\n          });\n          return;\n        }\n      }\n    };\n\n    window.addEventListener(\"portalCollision\", handlePortalCollision);\n    return () =&gt; {\n      window.removeEventListener(\"portalCollision\", handlePortalCollision);\n    };\n  }, [\n    portalState.isTransitioning,\n    currentMap,\n    PORTAL_CONFIG,\n    handlePortalTransition,\n    updatePortalState,\n  ]);\n\n  // Optimized portal activation handler with improved detection and feedback (kept for manual SPACE activation)\n  const handlePortalActivation = useCallback(\n    (e) =&gt; {\n      if (e.key !== \" \" || portalState.isTransitioning) return;\n\n      const currentMapName = currentMap?.name;\n      if (!currentMapName) {\n        console.log(\"No current map name available for portal activation\");\n        return;\n      }\n\n      const playerTileX = Math.floor(gameState.characterPosition.x / TILE_SIZE);\n      const playerTileY = Math.floor(gameState.characterPosition.y / TILE_SIZE);\n\n      console.log(\n        &#96;Manual portal activation attempt - Map: ${currentMapName}, Player position: (${playerTileX}, ${playerTileY})&#96;,\n      );\n\n      // Check for dungeon portal (tile type 9)\n      const currentMapData = currentMap?.data;\n      if (\n        currentMapData &amp;&amp;\n        playerTileY &gt;= 0 &amp;&amp;\n        playerTileY &lt; currentMapData.length\n      ) {\n        const row = currentMapData[playerTileY];\n        if (row &amp;&amp; playerTileX &gt;= 0 &amp;&amp; playerTileX &lt; row.length) {\n          const tileType = row[playerTileX];\n          if (tileType === 9) {\n            // Dungeon portal detected!\n            console.log(\"🏰 Dungeon portal detected!\");\n\n            // Check if there's a special portal defined for this location\n            const dungeonPortal = currentMap?.specialPortals?.find(\n              (portal) =&gt;\n                portal.position.x === playerTileX &amp;&amp;\n                portal.position.y === playerTileY &amp;&amp;\n                portal.type === \"dungeon\",\n            );\n\n            if (dungeonPortal) {\n              console.log(&#96;✅ Entering ${dungeonPortal.name}&#96;);\n              handleEnterDungeon(dungeonPortal.destination);\n              return;\n            }\n          }\n        }\n      }\n\n      // Check progression portals\n      const progressionPortal = PORTAL_CONFIG.progression[currentMapName];\n      if (progressionPortal) {\n        // Handle multiple portals per map (array)\n        if (Array.isArray(progressionPortal)) {\n          for (const portal of progressionPortal) {\n            const { destination, spawnPosition, condition } = portal;\n            console.log(\n              &#96;Checking progression portal to ${destination}, condition:&#96;,\n              condition,\n            );\n\n            if (condition &amp;&amp; condition(playerTileX, playerTileY)) {\n              console.log(&#96;✅ Activating portal to ${destination}&#96;);\n              handlePortalTransition(destination, spawnPosition);\n              return;\n            }\n          }\n          console.log(&#96;❌ Portal condition not met&#96;);\n          showWorldAnnouncement(\n            \"Find the correct portal location to proceed\",\n          );\n        } else {\n          // Handle single portal (object)\n          const { destination, spawnPosition, condition } =\n            progressionPortal;\n          console.log(\n            &#96;Checking progression portal to ${destination}, condition:&#96;,\n            condition,\n          );\n\n          if (!condition || condition(playerTileX, playerTileY)) {\n            console.log(&#96;✅ Activating portal to ${destination}&#96;);\n            handlePortalTransition(destination, spawnPosition);\n            return;\n          } else {\n            console.log(&#96;❌ Portal condition not met for ${destination}&#96;);\n            showWorldAnnouncement(\n              \"Find the correct portal location to proceed\",\n            );\n          }\n        }\n      }\n\n      // Check special portals in Yosemite\n      if (currentMapName === \"Yosemite\") {\n        const specialPortal = PORTAL_CONFIG.special[playerTileX];\n        console.log(\n          &#96;Checking special portal at X=${playerTileX}, Y=${playerTileY}:&#96;,\n          specialPortal,\n        );\n\n        if (specialPortal &amp;&amp; playerTileY === 1) {\n          console.log(\n            &#96;✅ Activating special portal: ${specialPortal.title}&#96;,\n          );\n          updatePortalState({\n            activePortal: specialPortal,\n            portalNotificationActive: true,\n          });\n          showPortalNotification(\n            specialPortal.title,\n            specialPortal.message,\n          );\n          return;\n        }\n      }\n\n      // No portal found - give user feedback\n      console.log(\"❌ No portal found at current location\");\n      if (gameState.soundManager) {\n        gameState.soundManager.playSound(\"bump\"); // Play bump sound to indicate no portal\n      }\n    },\n    [\n      portalState.isTransitioning,\n      currentMap,\n      characterPosition,\n      PORTAL_CONFIG,\n      handlePortalTransition,\n      updatePortalState,\n      showPortalNotification,\n      showWorldAnnouncement,\n      gameState.soundManager,\n    ],\n  );\n\n  // Handle Hamlet Finale completion\n  const handleHamletFinaleComplete = useCallback(\n    (result) =&gt; {\n      // =====================================\n      // Add to inventory\n      gameState.setInventory((prev) =&gt; [\n        ...prev,\n        {\n          id: \"wand_of_prospero\",\n          name: \"Wand of Prospero\",\n          description:\n            \"A mystical staff from The Tempest, capable of conjuring storms and bending reality itself\",\n          type: \"MAGIC_WEAPON\",\n          power: 50,\n          special: \"conjure_storm\",\n        },\n      ]);\n\n      // Award XP\n      handleGainExperience(result.exp || 100, \"Completed Hamlet Finale\");\n\n      // Close the finale\n      gameState.setShowHamletFinale(false);\n\n      // Show achievement\n      if (gameState.soundManager) {\n        gameState.soundManager.playSound(\"powerup\", 0.8);\n      }\n\n      console.log(\"⚔️ Wand of Prospero obtained!\");\n    },\n    [handleGainExperience, gameState.soundManager],\n  );\n\n\n\n\n\n      // Automatic portal activation on collision\n      useEffect(() =&gt; {\n        const handlePortalCollision = (event) =&gt; {\n          if (portalState.isTransitioning) return;\n\n          const { tileX, tileY, tileType } = event.detail;\n          const currentMapName = currentMap?.name;\n\n          if (!currentMapName) return;\n\n          console.log(\n            &#96;Portal collision detected - Map: ${currentMapName}, Tile: (${tileX}, ${tileY}), Type: ${tileType}&#96;,\n          );\n\n          // Handle progression portals (type 5)\n          if (tileType === 5) {\n            const progressionPortal = PORTAL_CONFIG.progression[currentMapName];\n            if (progressionPortal) {\n              // Handle multiple portals per map (array)\n              if (Array.isArray(progressionPortal)) {\n                for (const portal of progressionPortal) {\n                  const { destination, spawnPosition, condition } = portal;\n\n                  // Check if portal condition is met\n                  if (condition &amp;&amp; condition(tileX, tileY)) {\n                    console.log(&#96;✅ Auto-activating portal to ${destination}&#96;);\n                    handlePortalTransition(destination, spawnPosition);\n                    return;\n                  }\n                }\n              } else {\n                // Handle single portal (object)\n                const { destination, spawnPosition, condition } =\n                  progressionPortal;\n\n                // Check if portal condition is met (if any)\n                if (!condition || condition(tileX, tileY)) {\n                  console.log(&#96;✅ Auto-activating portal to ${destination}&#96;);\n                  handlePortalTransition(destination, spawnPosition);\n                  return;\n                }\n              }\n            }\n          }\n\n          // Handle special portals in Yosemite (types 6-8)\n          if (currentMapName === \"Yosemite\" &amp;&amp; tileType &gt;= 6 &amp;&amp; tileType &lt;= 8) {\n            const specialPortal = PORTAL_CONFIG.special[tileX];\n\n            if (specialPortal &amp;&amp; tileY === 1) {\n              console.log(\n                &#96;✅ Auto-activating special portal: ${specialPortal.title}&#96;,\n              );\n\n              // Activate the special world directly\n              if (specialPortal.type === \"terminal\") {\n                setCurrentSpecialWorld(\"terminal\");\n              } else if (specialPortal.type === \"shooter\") {\n                setCurrentSpecialWorld(\"shooter\");\n              } else if (specialPortal.type === \"text_adventure\") {\n                setCurrentSpecialWorld(\"text_adventure\");\n              }\n\n              updatePortalState({\n                activePortal: specialPortal,\n                portalNotificationActive: true,\n              });\n              return;\n            }\n          }\n        };\n\n        window.addEventListener(\"portalCollision\", handlePortalCollision);\n        return () =&gt; {\n          window.removeEventListener(\"portalCollision\", handlePortalCollision);\n        };\n      }, [\n        portalState.isTransitioning,\n        currentMap,\n        PORTAL_CONFIG,\n        handlePortalTransition,\n        updatePortalState,\n      ]);\n\n  // Boss defeat\n  const handleBossDefeat = useCallback(\n    (dungeonId) =&gt; {\n      console.log(&#96;🎉 Boss defeated in: ${dungeonId}&#96;);\n\n      // Play boss defeat fanfare\n      if (gameState.soundManager) {\n        gameState.soundManager.playSound(\"boss_defeat\", 1.0);\n      }\n\n      // Award massive XP\n      handleGainExperience(100, \"Boss defeated\");\n\n      // Mark dungeon as complete\n      console.log(\"🏆 Dungeon complete! Treasure revealed.\");\n\n      // Optionally: Track dungeon completion in gameData\n      // This allows for future features like dungeon tracker, etc.\n    },\n    [gameState.soundManager, handleGainExperience],\n  );\n\n  // Optimized artifact creation\n  const createLevelArtifact = useCallback(async () =&gt; {\n    try {\n      const artifactData = {\n        name: &#96;Level ${currentMapIndex + 1} Artifact&#96;,\n        description: &#96;An artifact from level ${currentMapIndex + 1}&#96;,\n        type: \"level\",\n        level: currentMapIndex + 1,\n        position: { x: characterPosition.x, y: characterPosition.y },\n        creator: user?.id || \"anonymous\",\n      };\n\n      const newArtifact = await createArtifact(artifactData);\n\n      updateGameState({\n        artifacts: [...gameState.gameData.artifacts, newArtifact],\n      });\n\n      // Play creation sound\n      if (gameState.soundManager) {\n        gameState.soundManager.playSound(\"artifact_create\");\n      }\n\n      return newArtifact;\n    } catch (error) {\n      console.error(\"Error creating level artifact:\", error);\n      return null;\n    }\n  }, [\n    currentMapIndex,\n    characterPosition,\n    user,\n    gameState.gameData.artifacts,\n    gameState.soundManager,\n    updateGameState,\n  ]);\n\n  // Optimized NPC fetching\n  const fetchNPCs = useCallback(async () =&gt; {\n    try {\n      // This would fetch NPCs from the database\n      // For now, we'll use the static NPCs from the map\n      const npcs = currentMapNPCs;\n      updateGameState({ databaseNPCs: npcs });\n    } catch (error) {\n      console.error(\"Error fetching NPCs:\", error);\n    }\n  }, [currentMapNPCs, updateGameState]);\n\n  // Optimized character loading\n  const loadCharacter = useCallback(async () =&gt; {\n    if (!user) return;\n\n    try {\n      const characterData = await fetchCharacter(user.id);\n      setCharacter(characterData);\n\n      // Update character position from saved data\n      if (characterData?.position) {\n        setCharacterPosition(characterData.position);\n      }\n    } catch (error) {\n      console.error(\"Error loading character:\", error);\n    }\n  }, [user]);\n\n  // Optimized key handler with throttling\n  const handleKeyDown = useCallback(\n    (event) =&gt; {\n      const now = performance.now();\n      if (now - lastUpdateTime.current &lt; updateThrottle.current) {\n        return; // Throttle key events\n      }\n      lastUpdateTime.current = now;\n\n      // Enhanced keyboard navigation with accessibility support\n      switch (event.key) {\n        case \"i\":\n        case \"I\":\n          updateUIState({ showInventory: !gameState.uiState.showInventory });\n          // Announce to screen readers\n          if (gameState.mobileState.screenReaderMode) {\n            const message = gameState.uiState.showInventory\n              ? \"Closing inventory\"\n              : \"Opening inventory\";\n            announceToScreenReader(message);\n          }\n          break;\n        case \"q\":\n        case \"Q\":\n          updateUIState({ showQuotes: !gameState.uiState.showQuotes });\n          if (gameState.mobileState.screenReaderMode) {\n            const message = gameState.uiState.showQuotes\n              ? \"Closing quotes\"\n              : \"Opening saved quotes\";\n            announceToScreenReader(message);\n          }\n          break;\n        case \"m\":\n        case \"M\":\n          updateUIState({ showWorldMap: !gameState.uiState.showWorldMap });\n          if (gameState.mobileState.screenReaderMode) {\n            const message = gameState.uiState.showWorldMap\n              ? \"Closing world map\"\n              : \"Opening world map\";\n            announceToScreenReader(message);\n          }\n          break;\n        case \"f\":\n        case \"F\":\n          updateUIState({ showFeedback: !gameState.uiState.showFeedback });\n          if (gameState.mobileState.screenReaderMode) {\n            const message = gameState.uiState.showFeedback\n              ? \"Closing feedback form\"\n              : \"Opening feedback form\";\n            announceToScreenReader(message);\n          }\n          break;\n        case \"c\":\n        case \"C\":\n        case \"?\":\n          updateUIState({ showControlsGuide: !gameState.uiState.showControlsGuide });\n          if (gameState.mobileState.screenReaderMode) {\n            const message = gameState.uiState.showControlsGuide\n              ? \"Closing controls guide\"\n              : \"Opening keyboard controls guide\";\n            announceToScreenReader(message);\n          }\n          break;\n        case \"Escape\":\n          updateUIState({\n            showInventory: false,\n            showQuotes: false,\n            showWorldMap: false,\n            showFeedback: false,\n            showControlsGuide: false,\n            showForm: false,\n          });\n          if (gameState.mobileState.screenReaderMode) {\n            announceToScreenReader(\"Closed all menus\");\n          }\n          break;\n        case \" \":\n          // Portal activation - call if available\n          // The function is defined later in the component, so we check for it\n          break;\n        case \"z\":\n        case \"Z\":\n          // Sword attack with cooldown and AUTO-TARGETING\n          const now = Date.now();\n          const ATTACK_COOLDOWN = 400; // ms between attacks\n\n          if (\n            !gameState.isAttacking &amp;&amp;\n            now - lastAttackTimeRef.current &gt;= ATTACK_COOLDOWN\n          ) {\n            lastAttackTimeRef.current = now;\n\n            // AUTO-TARGET: Find closest enemy and face them\n            const enemies = document.querySelectorAll('[data-hitbox=\"enemy\"]');\n            let closestEnemy = null;\n            let closestDistance = Infinity;\n\n            enemies.forEach((enemyElement) =&gt; {\n              const enemyRect = enemyElement.getBoundingClientRect();\n              const enemyX = parseFloat(enemyElement.style.left) || 0;\n              const enemyY = parseFloat(enemyElement.style.top) || 0;\n\n              const dx = enemyX - characterPosition.x;\n              const dy = enemyY - characterPosition.y;\n              const distance = Math.sqrt(dx * dx + dy * dy);\n\n              if (distance &lt; closestDistance &amp;&amp; distance &lt; 150) {\n                // 150px auto-target range\n                closestDistance = distance;\n                closestEnemy = { x: enemyX, y: enemyY, dx, dy };\n              }\n            });\n\n            // Face the closest enemy\n            if (closestEnemy) {\n              const { dx, dy } = closestEnemy;\n              let targetDirection = characterState.direction;\n\n              // Determine which direction to face based on angle to enemy\n              if (Math.abs(dx) &gt; Math.abs(dy)) {\n                targetDirection = dx &gt; 0 ? \"right\" : \"left\";\n              } else {\n                targetDirection = dy &gt; 0 ? \"down\" : \"up\";\n              }\n\n              // Update character direction to face enemy\n              setCharacterState((prev) =&gt; ({\n                ...prev,\n                direction: targetDirection,\n              }));\n            }\n\n            setIsAttacking(true);\n            if (gameState.soundManager) {\n              gameState.soundManager.playSound(\"sword\", 0.3);\n            }\n            // CombatManager will reset attack state via onAttackComplete\n            if (gameState.mobileState.screenReaderMode) {\n              announceToScreenReader(\"Sword attack\");\n            }\n          }\n          event.preventDefault();\n          break;\n        case \"t\":\n        case \"T\":\n          // NPC interaction\n          const nearbyNPC = findNearbyNPC();\n          if (nearbyNPC) {\n            gameState.setActiveNPC(nearbyNPC);\n            updateUIState({ showNPCDialog: true });\n            if (gameState.mobileState.screenReaderMode) {\n              announceToScreenReader(&#96;Talking to ${nearbyNPC.name || \"NPC\"}&#96;);\n            }\n          } else if (gameState.mobileState.screenReaderMode) {\n            announceToScreenReader(\"No NPC nearby to talk to\");\n          }\n          break;\n        case \"h\":\n        case \"H\":\n          // Toggle high contrast mode\n          setMobileState((prev) =&gt; ({\n            ...prev,\n            highContrastMode: !prev.highContrastMode,\n          }));\n          if (gameState.mobileState.screenReaderMode) {\n            const message = gameState.mobileState.highContrastMode\n              ? \"High contrast mode disabled\"\n              : \"High contrast mode enabled\";\n            announceToScreenReader(message);\n          }\n          break;\n        case \"r\":\n        case \"R\":\n          // Toggle reduced motion mode\n          setMobileState((prev) =&gt; ({\n            ...prev,\n            reducedMotionMode: !prev.reducedMotionMode,\n          }));\n          if (gameState.mobileState.screenReaderMode) {\n            const message = gameState.mobileState.reducedMotionMode\n              ? \"Reduced motion mode disabled\"\n              : \"Reduced motion mode enabled\";\n            announceToScreenReader(message);\n          }\n          break;\n        case \"s\":\n        case \"S\":\n          // Toggle screen reader mode\n          setMobileState({\n            ...mobileState,\n            screenReaderMode: !mobileState.screenReaderMode,\n          });\n          const message = mobileState.screenReaderMode\n            ? \"Screen reader mode disabled\"\n            : \"Screen reader mode enabled\";\n          announceToScreenReader(message);\n          break;\n      }\n    },\n    [uiState, updateUIState, mobileState, setMobileState, announceToScreenReader],\n  );\n\n  // Optimized nearby NPC finder\n  const findNearbyNPC = useCallback(() =&gt; {\n    const npcs = [...currentMapNPCs, ...gameState.gameData.databaseNPCs];\n    return npcs.find((npc) =&gt; {\n      const npcX = npc.position?.x || 0;\n      const npcY = npc.position?.y || 0;\n      const distance = Math.sqrt(\n        Math.pow(characterPosition.x - npcX, 2) +\n          Math.pow(characterPosition.y - npcY, 2),\n      );\n      return distance &lt; TILE_SIZE * 2;\n    });\n  }, [currentMapNPCs, gameState.gameData.databaseNPCs, getCharacterPosition]);\n\n  // Optimized sound manager initialization\n  const initSoundManager = useCallback(async () =&gt; {\n    if (gameState.soundManager) return;\n\n    try {\n      const manager = SoundManager.getInstance();\n      await manager.initialize();\n      setSoundManager(manager);\n      console.log(\"Sound manager initialized successfully\");\n    } catch (error) {\n      console.error(\"Error initializing sound manager:\", error);\n    }\n  }, [gameState.soundManager]);\n\n  // Initialize component safely\n  useEffect(() =&gt; {\n    // Mark as initialized after first render cycle completes\n    if (!isInitialized) {\n      setIsInitialized(true);\n    }\n  }, [isInitialized]);\n\n  // Performance-optimized effects\n  useEffect(() =&gt; {\n    performance.mark(PERFORMANCE_MARKERS.RENDER_START);\n\n    // Initialize game state manager\n    gameStateManager.init();\n\n    // Load character and NPCs\n    loadCharacter();\n    fetchNPCs();\n\n    // Initialize sound manager\n    initSoundManager();\n\n    // Set up event listeners\n    const handleKeyDownEvent = (e) =&gt; handleKeyDown(e);\n    window.addEventListener(\"keydown\", handleKeyDownEvent);\n\n    return () =&gt; {\n      window.removeEventListener(\"keydown\", handleKeyDownEvent);\n      if (gameState.soundManager) {\n        gameState.soundManager.cleanup();\n      }\n    };\n  }, [loadCharacter, fetchNPCs, initSoundManager, handleKeyDown, gameState.soundManager]);\n\n  // Music management based on current map\n  useEffect(() =&gt; {\n    if (!gameState.soundManager || !currentMap) return;\n\n    const currentMapName = currentMap.name || \"\";\n    const newMusicTrack = getMusicTrackForMap(currentMapName);\n\n    console.log(\n      \"Map music check - Map:\",\n      currentMapName,\n      \"Track:\",\n      newMusicTrack,\n    );\n\n    // Only change music if we have a valid track and it's different from current\n    if (newMusicTrack) {\n      try {\n        // Check if we're already playing this track by comparing current music\n        const shouldChangeMusic =\n          !gameState.soundManager.currentMusic ||\n          gameState.soundManager.currentMusic !== newMusicTrack;\n\n        if (shouldChangeMusic) {\n          console.log(\n            \"Changing music from\",\n            gameState.soundManager.currentMusic,\n            \"to\",\n            newMusicTrack,\n          );\n\n          // Stop current music before starting new one\n          gameState.soundManager.stopMusic();\n\n          // Start appropriate music for the current map\n          if (currentMapName === \"Yosemite\") {\n            gameState.soundManager.playMusic(\"yosemite\", true, 0.3);\n          } else if (currentMapName.includes(\"Overworld\")) {\n            gameState.soundManager.playMusic(\"overworld\", true, 0.3);\n          } else if (currentMapName.includes(\"Dungeon\")) {\n            gameState.soundManager.playMusic(\"terminal\", true, 0.3);\n          } else if (currentMapName.includes(\"Desert\")) {\n            gameState.soundManager.playMusic(\"desert\", true, 0.3);\n          }\n        }\n      } catch (error) {\n        console.error(\"Error changing music:\", error);\n      }\n    }\n  }, [gameState.soundManager, gameState.currentMapIndex]); // Only trigger on map index change\n\n  // Helper function to get music track for map\n  const getMusicTrackForMap = useCallback((mapName) =&gt; {\n    if (mapName === \"Yosemite\") return \"yosemite\";\n    if (mapName.includes(\"Overworld\")) return \"overworld\";\n    if (mapName.includes(\"Dungeon\")) return \"terminal\";\n    if (mapName.includes(\"Desert\")) return \"desert\";\n    return null;\n  }, []);\n\n  // Portal proximity detection - show hints when near portals\n  useEffect(() =&gt; {\n    if (!currentMap || !characterPosition) return;\n\n    const currentMapName = currentMap.name;\n    const playerTileX = Math.floor(characterPosition.x / TILE_SIZE);\n    const playerTileY = Math.floor(characterPosition.y / TILE_SIZE);\n\n    // Check if player is near any portal\n    const progressionPortal = PORTAL_CONFIG.progression[currentMapName];\n    let nearPortal = false;\n\n    if (progressionPortal) {\n      // Handle multiple portals per map (array)\n      const portals = Array.isArray(progressionPortal)\n        ? progressionPortal\n        : [progressionPortal];\n\n      for (const portal of portals) {\n        const { condition } = portal;\n\n        // For portals with conditions, check if player is close\n        if (condition) {\n          // Check surrounding tiles (1-tile radius)\n          for (let dx = -1; dx &lt;= 1; dx++) {\n            for (let dy = -1; dy &lt;= 1; dy++) {\n              if (condition(playerTileX + dx, playerTileY + dy)) {\n                nearPortal = true;\n                break;\n              }\n            }\n            if (nearPortal) break;\n          }\n        } else {\n          // For portals without conditions, consider always near if on this map\n          nearPortal = true;\n        }\n\n        if (nearPortal) break;\n      }\n    }\n\n    // Check special portals in Yosemite\n    if (currentMapName === \"Yosemite\") {\n      // Check if player is near any special portal (1-tile radius)\n      for (let dx = -1; dx &lt;= 1; dx++) {\n        const checkX = playerTileX + dx;\n        if (PORTAL_CONFIG.special[checkX] &amp;&amp; Math.abs(playerTileY - 1) &lt;= 1) {\n          nearPortal = true;\n          break;\n        }\n      }\n    }\n\n    // Show/hide portal hint\n    if (nearPortal &amp;&amp; !portalState.portalNotificationActive) {\n      const hintElement = document.getElementById(\"portal-hint\");\n      if (!hintElement) {\n        const hint = document.createElement(\"div\");\n        hint.id = \"portal-hint\";\n        hint.className = \"portal-hint\";\n        hint.innerHTML = \"Press SPACE to activate portal\";\n        document.body.appendChild(hint);\n      }\n      document.getElementById(\"portal-hint\")?.classList.add(\"visible\");\n    } else {\n      document.getElementById(\"portal-hint\")?.classList.remove(\"visible\");\n    }\n  }, [\n    characterPosition,\n    currentMap,\n    PORTAL_CONFIG,\n    portalState.portalNotificationActive,\n  ]);\n\n  // Optimized artifact loading\n  useEffect(() =&gt; {\n    const loadArtifacts = async () =&gt; {\n      try {\n        const artifactsData = await fetchArtifacts();\n        updateGameState({ artifacts: artifactsData });\n      } catch (error) {\n        console.error(\"Error loading artifacts:\", error);\n      }\n    };\n\n    loadArtifacts();\n  }, [updateGameState]);\n\n  // Optimized game state saving\n  const saveGameProgress = useCallback(() =&gt; {\n    if (!user) return;\n\n    const gameState = {\n      characterPosition,\n      currentMapIndex,\n      inventory,\n      levelCompletion: gameState.gameData.levelCompletion,\n      achievements: gameState.gameData.achievements,\n      viewedArtifacts: gameState.gameData.viewedArtifacts,\n    };\n\n    gameStateManager.updateState(gameState);\n  }, [user, characterPosition, currentMapIndex, inventory, gameState.gameData]);\n\n  // Auto-save effect\n  useEffect(() =&gt; {\n    const autoSaveInterval = setInterval(saveGameProgress, 30000); // Save every 30 seconds\n    return () =&gt; clearInterval(autoSaveInterval);\n  }, [saveGameProgress]);\n\n  // Mobile and accessibility detection\n  useEffect(() =&gt; {\n    const detectMobileAndAccessibility = () =&gt; {\n      const isMobile =\n        window.innerWidth &lt;= 768 ||\n        /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(\n          navigator.userAgent,\n        );\n\n      const prefersReducedMotion = window.matchMedia(\n        \"(prefers-reduced-motion: reduce)\",\n      ).matches;\n      const prefersHighContrast = window.matchMedia(\n        \"(prefers-contrast: high)\",\n      ).matches;\n\n      setMobileState((prev) =&gt; ({\n        ...prev,\n        isMobile,\n        showTouchControls: isMobile,\n        touchControlsEnabled: isMobile,\n        reducedMotionMode: prefersReducedMotion,\n        highContrastMode: prefersHighContrast,\n      }));\n    };\n\n    detectMobileAndAccessibility();\n    window.addEventListener(\"resize\", detectMobileAndAccessibility);\n\n    // Listen for accessibility preference changes\n    const reducedMotionQuery = window.matchMedia(\n      \"(prefers-reduced-motion: reduce)\",\n    );\n    const highContrastQuery = window.matchMedia(\"(prefers-contrast: high)\");\n\n    const handleReducedMotionChange = (e) =&gt; {\n      setMobileState((prev) =&gt; ({ ...prev, reducedMotionMode: e.matches }));\n    };\n\n    const handleHighContrastChange = (e) =&gt; {\n      setMobileState((prev) =&gt; ({ ...prev, highContrastMode: e.matches }));\n    };\n\n    reducedMotionQuery.addEventListener(\"change\", handleReducedMotionChange);\n    highContrastQuery.addEventListener(\"change\", handleHighContrastChange);\n\n    return () =&gt; {\n      window.removeEventListener(\"resize\", detectMobileAndAccessibility);\n      reducedMotionQuery.removeEventListener(\n        \"change\",\n        handleReducedMotionChange,\n      );\n      highContrastQuery.removeEventListener(\"change\", handleHighContrastChange);\n    };\n  }, []);\n\n  // Performance monitoring effect\n  useEffect(() =&gt; {\n    if (process.env.NODE_ENV === \"development\") {\n      const performanceInterval = setInterval(() =&gt; {\n        const memory = performance.memory;\n        if (memory &amp;&amp; memory.usedJSHeapSize &gt; 100 * 1024 * 1024) {\n          // 100MB threshold\n          console.warn(\n            \"High memory usage detected:\",\n            Math.round(memory.usedJSHeapSize / 1024 / 1024) + \"MB\",\n          );\n        }\n      }, 10000); // Check every 10 seconds\n\n      return () =&gt; clearInterval(performanceInterval);\n    }\n  }, []);\n\n  // Handle artifact pickup when user presses E or P\n  const handleArtifactPickup = useCallback(\n    (artifact) =&gt; {\n      if (!artifact) return;\n\n      // Check if this artifact was already viewed\n      const isFirstView =\n        !Array.isArray(gameState.gameData.viewedArtifacts) ||\n        !gameState.gameData.viewedArtifacts.includes(artifact.id);\n\n      // Update viewed artifacts\n      if (isFirstView) {\n        const updatedViewedArtifacts = [\n          ...(Array.isArray(gameState.gameData.viewedArtifacts)\n            ? gameState.gameData.viewedArtifacts\n            : []),\n          artifact.id,\n        ];\n        updateGameState({ viewedArtifacts: updatedViewedArtifacts });\n        localStorage.setItem(\n          \"viewedArtifacts\",\n          JSON.stringify(updatedViewedArtifacts),\n        );\n\n        // Award XP for discovering a new artifact - with safety check\n        if (typeof awardXP === \"function\") {\n          awardXP(15, &#96;Discovered ${artifact.name}&#96;);\n        }\n\n        // Check for discovery achievements\n        if (typeof checkDiscoveryAchievements === \"function\") {\n          checkDiscoveryAchievements(updatedViewedArtifacts.length);\n        }\n      } else {\n        // Award smaller XP for revisiting an artifact - with safety check\n        if (typeof awardXP === \"function\") {\n          awardXP(2, \"Revisited an artifact\");\n        }\n      }\n\n      // Select the artifact to display details\n      if (typeof setVisibleArtifact === \"function\") {\n        setVisibleArtifact(artifact);\n      }\n\n      // Save game state if user is logged in\n      if (user &amp;&amp; typeof updateGameProgress === \"function\") {\n        const gameState = {\n          inventory,\n          viewedArtifacts: gameState.gameData.viewedArtifacts,\n          lastPosition: {\n            x: characterPosition.x,\n            y: characterPosition.y,\n            worldId: MAPS[currentMapIndex].name,\n          },\n          gameProgress: {\n            currentQuest: \"Artifact Exploration\",\n            completedQuests: [],\n            discoveredLocations: [MAPS[currentMapIndex].name],\n          },\n        };\n\n        updateGameProgress(gameState);\n      }\n    },\n    [\n      gameState.gameData.viewedArtifacts,\n      updateGameState,\n      updateGameProgress,\n      user,\n      inventory,\n      characterPosition,\n      currentMapIndex,\n      awardXP,\n      checkDiscoveryAchievements,\n      setVisibleArtifact,\n    ],\n  );\n\n  // Get active powers from user\n  const activePowers = user?.activePowers || [];\n\n\n  // Portal collision detection hook\n  const { checkPortalCollisions } = usePortalCollisions({\n    characterPosition,\n    currentMapIndex,\n    soundManager: gameState.soundManager,\n    portalNotificationActive: gameState.portalState.portalNotificationActive,\n    setPortalNotificationActive,\n    showPortalNotification,\n    hidePortalNotification,\n    createInteractiveNotification,\n    setCurrentMapIndex,\n    setCharacterPosition,\n    adjustViewport,\n    setCurrentSpecialWorld,\n    gameData: gameState.gameData,\n    handleLevelCompletion,\n  });\n\n\n\n  useEffect(() =&gt; {\n    // Check for both map artifacts and server artifacts at the player's position\n    const checkBothArtifactSources = () =&gt; {\n      if (!characterPosition || !MAPS || !MAPS[currentMapIndex]) return;\n\n      const playerX = characterPosition.x / TILE_SIZE;\n      const playerY = characterPosition.y / TILE_SIZE;\n\n      // Check if the current map and its artifacts property exist before accessing them\n      const mapArtifact = MAPS[currentMapIndex]?.artifacts?.find(\n        (artifact) =&gt;\n          artifact?.location &amp;&amp;\n          artifact.visible &amp;&amp;\n          artifact.location.x === playerX &amp;&amp;\n          artifact.location.y === playerY,\n      );\n\n      // Check server artifacts\n      const serverArtifact =\n        gameState.gameData.artifacts &amp;&amp; Array.isArray(gameState.gameData.artifacts)\n          ? gameState.gameData.artifacts.find(\n              (artifact) =&gt;\n                artifact &amp;&amp;\n                artifact.location &amp;&amp;\n                artifact.location.x === playerX &amp;&amp;\n                artifact.location.y === playerY &amp;&amp;\n                (!artifact.area ||\n                  artifact.area === MAPS[currentMapIndex]?.name),\n            )\n          : null;\n\n      // Prioritize server artifacts (they might be more up-to-date)\n      if (serverArtifact) {\n        setVisibleArtifact(serverArtifact);\n      } else if (mapArtifact) {\n        setVisibleArtifact(mapArtifact);\n      } else {\n        setVisibleArtifact(null);\n      }\n    };\n\n    // Check for both map artifacts and server artifacts\n    checkBothArtifactSources();\n  }, [characterPosition, currentMapIndex, gameState.gameData.artifacts]);\n\n  // Portal collision detection\n  useEffect(() =&gt; {\n    checkPortalCollisions();\n  }, [checkPortalCollisions]);\n\n  useEffect(() =&gt; {\n    // Subscribe to position changes to detect and handle artifact interactions\n    const checkArtifactGameInteractions = () =&gt; {\n      if (!characterPosition || !gameState.gameData.artifacts?.length) return;\n\n      const currentMapName = MAPS[currentMapIndex]?.name || \"\";\n\n      // Find game artifacts in the current area that the character is near\n      const gameArtifacts = gameState.gameData.artifacts.filter(\n        (artifact) =&gt;\n          artifact.area === currentMapName &amp;&amp;\n          [\n            \"shooter_experience\",\n            \"text_adventure_world\",\n            \"terminal_challenge\",\n          ].includes(artifact.type) &amp;&amp;\n          artifact.isInteractive,\n      );\n\n      // Check if character is close enough to any game artifact\n      for (const artifact of gameArtifacts) {\n        if (!artifact.position) continue;\n\n        const artifactX = artifact.position.x;\n        const artifactY = artifact.position.y;\n        const distance = Math.sqrt(\n          Math.pow(characterPosition.x - artifactX, 2) +\n            Math.pow(characterPosition.y - artifactY, 2),\n        );\n\n        // If within interaction range (approximately 1.5 tiles)\n        if (distance &lt;= TILE_SIZE * 1.5) {\n          // Show interaction notification\n          if (!portalNotificationActive) {\n            showPortalNotification(\n              artifact.name,\n              &#96;Press SPACE to play ${artifact.name}&#96;,\n            );\n            setPortalNotificationActive(true);\n\n            // Handle space key press to launch the game\n            const handleGameLaunch = (e) =&gt; {\n              if (e.code === \"Space\" &amp;&amp; distance &lt;= TILE_SIZE * 1.5) {\n                // Play interaction sound\n                if (gameState.soundManager) {\n                  gameState.soundManager.playSound(\"portal\");\n                }\n\n                // Hide notification\n                hidePortalNotification();\n                setPortalNotificationActive(false);\n\n                // Set current game artifact and show launcher\n                setCurrentGameArtifact(artifact);\n                setShowGameLauncher(true);\n\n                // Stop background music for immersive game experience\n                if (gameState.soundManager) {\n                  gameState.soundManager.stopMusic(true);\n                }\n\n                // Remove event listener\n                window.removeEventListener(\"keydown\", handleGameLaunch);\n              }\n            };\n\n            // Add event listener\n            window.addEventListener(\"keydown\", handleGameLaunch);\n\n            // Cleanup function\n            return () =&gt; {\n              window.removeEventListener(\"keydown\", handleGameLaunch);\n              setPortalNotificationActive(false);\n            };\n          }\n\n          // Break once we find an artifact in range\n          break;\n        }\n      }\n    };\n\n    checkArtifactGameInteractions();\n  }, [characterPosition, currentMapIndex, gameState.gameData.artifacts]);\n\n  // Close NPC dialog\n  const handleCloseNPCDialog = useCallback(() =&gt; {\n    updateUIState({ showNPCDialog: false });\n    gameState.setActiveNPC(null);\n  }, []);\n\n  // Add a handler for the World Map node click\n  const handleWorldMapNodeClick = useCallback(\n    (worldId) =&gt; {\n      // Check if it's a special world type\n      if (worldId === \"hemingway\") {\n        setCurrentSpecialWorld(\"hemingway\");\n        updateUIState({ showWorldMap: false });\n      } else if (worldId === \"text_adventure\") {\n        setCurrentSpecialWorld(\"text_adventure\");\n        updateUIState({ showWorldMap: false });\n      } else {\n        // Handle normal world navigation here\n        // (This would depend on your existing world navigation logic)\n        updateUIState({ showWorldMap: false });\n      }\n    },\n    [updateUIState, setCurrentSpecialWorld],\n  );\n\n  // Add handlers for exiting special worlds\n  const handleHemingwayComplete = useCallback(() =&gt; {\n    setCurrentSpecialWorld(null);\n    // Give rewards, etc.\n    updateUIState({\n      currentAchievement: \"Completed Hemingway's Adventure\",\n      showRewardModal: true\n    });\n  }, [setCurrentSpecialWorld, updateUIState]);\n\n  const handleHemingwayExit = useCallback(() =&gt; {\n    setCurrentSpecialWorld(null);\n  }, [setCurrentSpecialWorld]);\n\n  const handleTextAdventureComplete = useCallback(() =&gt; {\n    setCurrentSpecialWorld(null);\n    // Give rewards, etc.\n    updateUIState({\n      currentAchievement: \"Completed The Writer's Journey\",\n      showRewardModal: true\n    });\n  }, [setCurrentSpecialWorld, updateUIState]);\n\n  const handleTextAdventureExit = useCallback(() =&gt; {\n    // Hide any remaining portal notification\n    hidePortalNotification();\n    updatePortalState({ portalNotificationActive: false });\n\n    setCurrentSpecialWorld(null);\n  }, [setCurrentSpecialWorld, updatePortalState]);\n\n  // Handle dismissing the world guide\n  const handleDismissWorldGuide = useCallback(() =&gt; {\n    updateUIState({ showWorldGuide: false });\n    // Possibly save this preference to localStorage or user profile\n    localStorage.setItem(\"has-dismissed-world-guide\", \"true\");\n  }, [updateUIState]);\n\n  // Handle showing the world guide\n  const handleShowWorldGuide = useCallback(() =&gt; {\n    updateUIState({ showWorldGuide: true });\n  }, [updateUIState]);\n\n  // Handle showing the world map\n  const handleShowWorldMap = useCallback(() =&gt; {\n    updateUIState({ showWorldMap: true });\n  }, [updateUIState]);\n\n  // Handle deleting a quote from savedQuotes\n  const handleDeleteQuote = useCallback(\n    (quoteIndex) =&gt; {\n      if (!gameState.character || !gameState.character.savedQuotes) return;\n\n      // Create a copy of the savedQuotes array without the quote to delete\n      const updatedQuotes = [...character.savedQuotes];\n      updatedQuotes.splice(quoteIndex, 1);\n\n      // Update the character with the new quotes array\n      const updatedCharacter = {\n        ...character,\n        savedQuotes: updatedQuotes,\n      };\n\n      // Update state and save to backend\n      setCharacter(updatedCharacter);\n      updateCharacter(updatedCharacter);\n\n      console.log(&#96;🗑️ Deleted quote at index ${quoteIndex}&#96;);\n    },\n    [character, updateCharacter],\n  );\n\n  // Utilities for persisting map artifact visibility\n  const applyMapArtifactVisibilityFromStorage = () =&gt; {\n    if (!Array.isArray(MAPS)) return;\n\n    // Apply to all maps\n    MAPS.forEach((map, mapIndex) =&gt; {\n      if (!map || !Array.isArray(map.artifacts)) return;\n\n      map.artifacts.forEach((artifact, artifactIndex) =&gt; {\n        if (localStorage.getItem(&#96;artifact-${artifact.id}-found&#96;)) {\n          MAPS[mapIndex].artifacts[artifactIndex].visible = false;\n        }\n      });\n    });\n  };\n\n  const saveMapArtifactVisibilityToStorage = (artifactId) =&gt; {\n    try {\n      const savedState = localStorage.getItem(\"collectedMapArtifacts\");\n      let collectedIds = savedState ? JSON.parse(savedState) : [];\n\n      if (!collectedIds.includes(artifactId)) {\n        collectedIds.push(artifactId);\n        localStorage.setItem(\n          \"collectedMapArtifacts\",\n          JSON.stringify(collectedIds),\n        );\n        console.log(\"💾 Saved artifact collection state to localStorage\");\n      }\n    } catch (error) {\n      console.error(\"❌ Error saving artifact collection state:\", error);\n    }\n  };\n\n  // Function to find the closest NPC to the player\n  const findClosestNPC = useCallback(() =&gt; {\n    if (!MAPS[currentMapIndex]?.npcs?.length) return null;\n\n    const playerX = characterPosition.x;\n    const playerY = characterPosition.y;\n\n    let closestNPC = null;\n    let minDistance = Infinity;\n\n    MAPS[currentMapIndex].npcs.forEach((npc) =&gt; {\n      if (!npc.position) return;\n\n      const distance = Math.sqrt(\n        Math.pow(playerX - npc.position.x, 2) +\n          Math.pow(playerY - npc.position.y, 2),\n      );\n\n      // Only consider NPCs within interaction range (1 tile for collision)\n      if (distance &lt;= TILE_SIZE * 1.5 &amp;&amp; distance &lt; minDistance) {\n        minDistance = distance;\n        closestNPC = npc;\n      }\n    });\n\n    return closestNPC;\n  }, [characterPosition, currentMapIndex]);\n\n  // Function to handle and save gained achievements\n  const handleAchievementUnlocked = useCallback(\n    (achievementId, title, description) =&gt; {\n      // Check if character already has this achievement\n      if (\n        character &amp;&amp;\n        character.achievements &amp;&amp;\n        character.achievements.some((a) =&gt; a.id === achievementId)\n      ) {\n        return; // Already has this achievement\n      }\n\n      // Show achievement notification\n      addAchievementNotification({ title, description });\n\n      // Add achievement to character record\n      if (character &amp;&amp; character.id) {\n        const newAchievement = {\n          id: achievementId,\n          name: title,\n          description,\n          unlockedAt: new Date(),\n        };\n\n        // Update local state\n        setCharacter((prev) =&gt; {\n          const updatedAchievements = [\n            ...(prev.achievements || []),\n            newAchievement,\n          ];\n          const updatedCharacter = {\n            ...prev,\n            achievements: updatedAchievements,\n          };\n\n          // Save to backend\n          if (updatedCharacter.id) {\n            updateCharacter(updatedCharacter)\n              .then(() =&gt; console.log(\"✅ Achievement saved to backend\"))\n              .catch((err) =&gt;\n                console.error(\"❌ Failed to save achievement:\", err),\n              );\n          }\n\n          return updatedCharacter;\n        });\n\n        // Save to local storage for offline access\n        try {\n          const storedAchievements = JSON.parse(\n            localStorage.getItem(\"achievements\") || \"[]\",\n          );\n          if (!storedAchievements.some((a) =&gt; a.id === achievementId)) {\n            localStorage.setItem(\n              \"achievements\",\n              JSON.stringify([...storedAchievements, newAchievement]),\n            );\n          }\n        } catch (err) {\n          console.error(\"Failed to save achievement to localStorage:\", err);\n        }\n      }\n    },\n    [character, updateCharacter],\n  );\n\n  // Load achievements from localStorage on component mount\n  useEffect(() =&gt; {\n    try {\n      const savedAchievements = JSON.parse(\n        localStorage.getItem(\"achievements\") || \"[]\",\n      );\n      setGameData((prev) =&gt; ({ ...prev, achievements: savedAchievements }));\n    } catch (error) {\n      console.error(\"Error loading achievements:\", error);\n    }\n  }, []);\n\n  // Update checkForArtifactAchievements to use our context\n  const checkForArtifactAchievements = useCallback(\n    (updatedInventory) =&gt; {\n      checkCollectionAchievements(updatedInventory.length);\n    },\n    [checkCollectionAchievements],\n  );\n\n  // Update the handleCreateArtifact function to include achievements\n  const handleCreateArtifact = useCallback(\n    async (artifactData) =&gt; {\n      try {\n        const newArtifact = await createArtifact({\n          ...artifactData,\n          createdAt: new Date().toISOString(),\n        });\n\n        updateGameState({ artifacts: [...gameState.gameData.artifacts, newArtifact] });\n\n        // Award XP for creating an artifact\n        if (typeof awardXP === \"function\") {\n          awardXP(50, \"Created a new artifact\");\n        }\n\n        // Check for creator achievement\n        if (character &amp;&amp; character.id) {\n          const createdCount =\n            (Array.isArray(gameState.gameData.artifacts)\n              ? gameState.gameData.artifacts.filter((a) =&gt; a.createdBy === character.id)\n                  .length\n              : 0) + 1;\n          if (createdCount &gt;= 5) {\n            handleAchievementUnlocked(\n              \"creator5\",\n              \"Master Creator\",\n              \"Created 5 artifacts to shape the Authentic Internet\",\n            );\n          } else if (createdCount === 1) {\n            handleAchievementUnlocked(\n              \"creator1\",\n              \"Creator\",\n              \"Created your first artifact in the world\",\n            );\n          }\n        }\n\n        return newArtifact;\n      } catch (error) {\n        console.error(\"❌ Error creating artifact:\", error);\n        throw error;\n      }\n    },\n    [gameState.gameData.artifacts, character, updateGameState, handleAchievementUnlocked],\n  );\n\n  // Update the handleArtifactClick function to include achievements\n  const handleArtifactClick = useCallback(\n    (artifactId) =&gt; {\n      // Find the clicked artifact\n      const clickedArtifact = artifacts.find(\n        (artifact) =&gt; artifact.id === artifactId,\n      );\n      if (!clickedArtifact) return;\n\n      // Check if this artifact was already viewed\n      const isFirstView = !viewedArtifacts.includes(artifactId);\n\n      // Update viewed artifacts\n      if (isFirstView) {\n        const updatedViewedArtifacts = [...viewedArtifacts, artifactId];\n        setViewedArtifacts(updatedViewedArtifacts);\n        localStorage.setItem(\n          \"viewedArtifacts\",\n          JSON.stringify(updatedViewedArtifacts),\n        );\n\n        // Award XP for discovering a new artifact\n        addExperiencePoints(15, &#96;Discovered ${clickedArtifact.name}&#96;);\n\n        // Validate quest progress for artifact discovery\n        validateQuestProgress(\"artifact_discovered\", {\n          artifact: clickedArtifact,\n        });\n\n        // Check for discovery achievements\n        checkDiscoveryAchievements(updatedViewedArtifacts.length);\n      } else {\n        // Award smaller XP for revisiting an artifact\n        awardXP(2, \"Revisited an artifact\");\n      }\n\n      // Select the artifact to display details\n      setVisibleArtifact(clickedArtifact);\n\n      // Save game state if user is logged in\n      if (user &amp;&amp; typeof updateGameProgress === \"function\") {\n        const gameState = {\n          inventory,\n          viewedArtifacts: isFirstView\n            ? [...viewedArtifacts, artifactId]\n            : viewedArtifacts,\n          lastPosition: {\n            x: characterPosition.x,\n            y: characterPosition.y,\n            worldId: MAPS[currentMapIndex].name,\n          },\n          gameProgress: {\n            currentQuest: \"Artifact Exploration\",\n            completedQuests: [],\n            discoveredLocations: [MAPS[currentMapIndex].name],\n          },\n        };\n\n        updateGameProgress(gameState);\n      }\n    },\n    [\n      artifacts,\n      viewedArtifacts,\n      user,\n      inventory,\n      characterPosition,\n      currentMapIndex,\n      addExperiencePoints,\n      awardXP,\n      checkDiscoveryAchievements,\n      setVisibleArtifact,\n      validateQuestProgress,\n      updateGameProgress,\n    ],\n  );\n\n  // removeXpNotification and removeAchievementNotification are now handled by NotificationSystem\n\n  // Handle tile clicks for game interactions\n  const handleTileClick = useCallback(\n    (x, y, tileType) =&gt; {\n      console.log(&#96;Tile clicked at (${x}, ${y}), type: ${tileType}&#96;);\n\n      // Try NPC interaction first\n      const tileX = Math.floor(x / TILE_SIZE);\n      const tileY = Math.floor(y / TILE_SIZE);\n      const currentMap = MAPS[currentMapIndex];\n      let npcInteracted = false;\n      if (currentMap &amp;&amp; Array.isArray(currentMap.npcs)) {\n        const npc = currentMap.npcs.find(\n          (npc) =&gt;\n            npc.position &amp;&amp;\n            Math.floor(npc.position.x / TILE_SIZE) === tileX &amp;&amp;\n            Math.floor(npc.position.y / TILE_SIZE) === tileY,\n        );\n        if (npc) {\n          handleNPCInteraction(npc);\n          npcInteracted = true;\n        }\n      }\n      if (npcInteracted) return true;\n\n      // Check for artifacts at this position\n      const clickedArtifact = Array.isArray(gameState.gameData.artifacts)\n        ? gameState.gameData.artifacts.find(\n            (artifact) =&gt;\n              artifact.location &amp;&amp;\n              Math.floor(artifact.location.x) === tileX &amp;&amp;\n              Math.floor(artifact.location.y) === tileY,\n          )\n        : null;\n\n      if (clickedArtifact) {\n        handleArtifactClick(clickedArtifact.id);\n        return true;\n      }\n\n      // Handle special tile types\n      if (tileType === 3) {\n        // Special interaction tile\n        console.log(\"Special interaction tile clicked\");\n        // Show a dialog or trigger an event\n      } else if (tileType === 4) {\n        // Quest tile\n        console.log(\"Quest tile clicked\");\n        // Trigger quest dialog or advancement\n      }\n      return false;\n    },\n    [\n      gameState.gameData.artifacts,\n      handleNPCInteraction,\n      handleArtifactClick,\n      currentMapIndex,\n    ],\n  );\n\n  // Handle tile clicks with the correct tileType\n  const handleMapTileClick = useCallback(\n    (x, y) =&gt; {\n      if (currentMapIndex &lt; 0 || currentMapIndex &gt;= MAPS.length) {\n        console.error(\"Invalid map index:\", currentMapIndex);\n        return;\n      }\n\n      const mapData = MAPS[currentMapIndex];\n      if (!mapData || !mapData.tiles) {\n        console.error(\"Invalid map data or tiles:\", mapData);\n        return;\n      }\n\n      // Calculate the tile position in the map data\n      const tileX = Math.floor(x / TILE_SIZE);\n      const tileY = Math.floor(y / TILE_SIZE);\n\n      // Check if coordinates are valid\n      if (tileX &lt; 0 || tileX &gt;= MAP_COLS || tileY &lt; 0 || tileY &gt;= MAP_ROWS) {\n        console.error(\"Tile coordinates out of bounds:\", tileX, tileY);\n        return;\n      }\n\n      // Get the tile type from the map data\n      const tileIndex = tileY * MAP_COLS + tileX;\n      const tileType = mapData.tiles[tileIndex];\n\n      // Call the tile click handler with tile type\n      handleTileClick(x, y, tileType);\n    },\n    [currentMapIndex, handleTileClick],\n  );\n\n  // Handle terminal adventure completion\n  const handleTerminalComplete = useCallback(\n    (score) =&gt; {\n      // Hide any remaining portal notification\n      hidePortalNotification();\n      setPortalNotificationActive(false);\n\n      // Award XP and show notification\n      awardXP(100, \"Completed Terminal Adventure!\");\n\n      // Validate quest progress for game completion\n      validateQuestProgress(\"game_completed\", { gameType: \"terminal\", score });\n\n      // Grant achievement\n      handleAchievementUnlocked(\n        \"terminal_master\",\n        \"Terminal Master\",\n        \"Successfully navigated through the command line challenges\",\n      );\n\n      // Exit the terminal adventure\n      setCurrentSpecialWorld(null);\n    },\n    [awardXP, handleAchievementUnlocked, validateQuestProgress],\n  );\n\n  // Handle terminal adventure exit\n  const handleTerminalExit = useCallback(() =&gt; {\n    // Hide any remaining portal notification\n    hidePortalNotification();\n    updatePortalState({ portalNotificationActive: false });\n\n    setCurrentSpecialWorld(null);\n  }, [updatePortalState]);\n\n  // Handle shooter adventure completion\n  const handleShooterComplete = useCallback(\n    (score) =&gt; {\n      // Award XP based on score\n      const xpAmount = Math.min(200, score * 2);\n      awardXP(xpAmount, &#96;Shooter Score: ${score}&#96;);\n\n      // Validate quest progress for game completion\n      validateQuestProgress(\"game_completed\", { gameType: \"shooter\", score });\n\n      // Grant achievement based on score\n      if (score &gt;= 1000) {\n        handleAchievementUnlocked(\n          \"shooter_expert\",\n          \"Pixel Sharpshooter\",\n          \"Achieved an incredible score in the arcade shooter\",\n        );\n      } else if (score &gt;= 500) {\n        handleAchievementUnlocked(\n          \"shooter_adept\",\n          \"Arcade Adept\",\n          \"Proved your skills in the arcade shooter challenge\",\n        );\n      }\n\n      // Exit the shooter adventure\n      setCurrentSpecialWorld(null);\n    },\n    [awardXP, handleAchievementUnlocked],\n  );\n\n  // Handle shooter adventure exit\n  const handleShooterExit = useCallback(() =&gt; {\n    // Hide any remaining portal notification\n    hidePortalNotification();\n    updatePortalState({ portalNotificationActive: false });\n\n    setCurrentSpecialWorld(null);\n  }, [updatePortalState]);\n\n  // Update the saveGameProgress method to use context\n  const saveGameProgressWithContext = useCallback(() =&gt; {\n    if (gameState.isLoggedIn &amp;&amp; gameState.character?.id) {\n      const gameState = {\n        experience: character.experience || 0,\n        avatar: character.avatar,\n        inventory,\n        viewedArtifacts: gameState.gameData.viewedArtifacts,\n        lastPosition: {\n          x: characterPosition.x,\n          y: characterPosition.y,\n          worldId: MAPS[currentMapIndex].name,\n        },\n        gameProgress: {\n          currentQuest: \"Artifact Exploration\",\n          completedQuests: [],\n          discoveredLocations: [MAPS[currentMapIndex].name],\n        },\n      };\n\n      updateGameProgress(gameState);\n    }\n  }, [\n    isLoggedIn,\n    character,\n    inventory,\n    gameState.gameData.viewedArtifacts,\n    characterPosition,\n    currentMapIndex,\n    updateGameProgress,\n  ]);\n\n  // Function to refresh the artifacts list\n  const refreshArtifactList = useCallback(async () =&gt; {\n    try {\n      const artifactsData = await fetchArtifacts();\n      updateGameState({ artifacts: artifactsData });\n    } catch (error) {\n      console.error(\"❌ Error refreshing artifacts:\", error);\n    }\n  }, [updateGameState]);\n\n\n  // Function to toggle artifacts visibility\n  const toggleArtifactsVisibility = useCallback(() =&gt; {\n    updateUIState({ showArtifactsOnMap: !gameState.uiState.showArtifactsOnMap });\n  }, [gameState.uiState.showArtifactsOnMap, updateUIState]);\n\n  // Calculate artifacts to show based on current map\n  const artifactsToShow = useMemo(() =&gt; {\n    if (\n      !gameState.gameData.artifacts ||\n      !Array.isArray(gameState.gameData.artifacts) ||\n      !MAPS ||\n      !MAPS[currentMapIndex]\n    ) {\n      return [];\n    }\n\n    const currentMapName = MAPS[currentMapIndex].name;\n    const artifactMapName = gameState.gameData.artifacts.find(\n      (artifact) =&gt; artifact.location,\n    )?.location.mapName;\n\n    // Handle different naming conventions between MAPS and database\n    if (artifactMapName === currentMapName) {\n      return gameState.gameData.artifacts.filter((artifact) =&gt; artifact.visible);\n    }\n\n    // Handle case-insensitive matching, only if artifactMapName and currentMapName are defined\n    if (\n      typeof artifactMapName === \"string\" &amp;&amp;\n      typeof currentMapName === \"string\" &amp;&amp;\n      artifactMapName.toLowerCase() === currentMapName.toLowerCase()\n    ) {\n      return gameState.gameData.artifacts.filter((artifact) =&gt; artifact.visible);\n    }\n\n    // Handle specific mappings\n    const mapMappings = {\n      overworld: \"Overworld\",\n      desert: \"Desert 1\",\n      dungeon: \"Dungeon Level 1\",\n    };\n\n    if (mapMappings[artifactMapName] === currentMapName) {\n      return gameState.gameData.artifacts.filter((artifact) =&gt; artifact.visible);\n    }\n\n    // Handle reverse mappings\n    const reverseMappings = {\n      Overworld: \"overworld\",\n      \"Desert 1\": \"desert\",\n      \"Dungeon Level 1\": \"dungeon\",\n    };\n\n    if (reverseMappings[currentMapName] === artifactMapName) {\n      return gameState.gameData.artifacts.filter((artifact) =&gt; artifact.visible);\n    }\n\n    return [];\n  }, [gameState.gameData.artifacts, currentMapIndex]);\n\n  return (\n    &lt;ErrorBoundary&gt;\n      {/* Initialization guard to prevent render-order issues */}\n      {!isInitialized ? (\n        &lt;div\n          className=\"game-loading\"\n          style={{\n            display: \"flex\",\n            alignItems: \"center\",\n            justifyContent: \"center\",\n            height: \"100vh\",\n            backgroundColor: \"transparent\",\n            color: \"#fff\",\n            fontSize: \"18px\",\n            textShadow: \"2px 2px 4px rgba(0,0,0,0.8)\",\n          }}\n        &gt;\n          Loading...\n        &lt;/div&gt;\n      ) : (\n        &lt;div\n          className={&#96;game-container ${gameState.mobileState.highContrastMode ? \"high-contrast\" : \"\"} ${gameState.mobileState.reducedMotionMode ? \"reduced-motion\" : \"\"}&#96;}\n          role=\"application\"\n          aria-label=\"Authentic Internet Game World\"\n          aria-describedby=\"game-instructions\"\n          tabIndex={0}\n          onKeyDown={handleKeyDown}\n        &gt;\n          {/* === ACCESSIBILITY === */}\n          &lt;div id=\"game-instructions\" className=\"sr-only\"&gt;\n            Use arrow keys or WASD to move. Press I for inventory, M for map, C\n            for controls guide, F for feedback, T to talk to NPCs, H for high\n            contrast mode, R for reduced motion, S for screen reader mode. Press\n            Escape to close menus.\n          &lt;/div&gt;\n\n          &lt;div\n            id=\"screen-reader-announcements\"\n            aria-live=\"polite\"\n            aria-atomic=\"true\"\n            className=\"sr-only\"\n          /&gt;\n\n          {/* === CORE GAME WORLD === */}\n          &lt;MapComponent\n            currentMapIndex={gameState.currentMapIndex}\n            exploredTiles={gameState.exploredTiles}\n            viewport={gameState.viewport}\n            characterPosition={gameState.characterPosition}\n            artifacts={gameState.gameData.artifacts}\n            showArtifactsOnMap={gameState.uiState.showArtifactsOnMap}\n            inDungeon={gameState.uiState.inDungeon}\n          /&gt;\n\n          &lt;Character\n            ref={characterRef}\n            position={gameState.characterPosition}\n            characterState={gameState.characterState}\n            direction={gameState.characterState.direction}\n            isLoggedIn={gameState.isLoggedIn}\n            character={gameState.character}\n            soundManager={gameState.soundManager}\n            playerHealth={gameState.playerHealth}\n            maxPlayerHealth={gameState.maxPlayerHealth}\n            isInvincible={gameState.isInvincible}\n          /&gt;\n\n          {/* === UI SYSTEMS === */}\n\n          {/* Zelda-style HUD */}\n          &lt;GameHUD\n            health={gameState.playerHealth}\n            maxHealth={gameState.maxPlayerHealth}\n            rupees={gameState.rupees}\n            keys={gameState.keys}\n            currentArea={MAPS[gameState.currentMapIndex]?.name || \"Overworld\"}\n            equippedItem={gameState.equippedItem}\n            experience={gameState.characterStats.experience}\n            level={gameState.characterStats.level}\n            experienceToNextLevel={calculateXPForLevel(\n              gameState.characterStats.level + 1,\n            )}\n            isDamaged={gameState.characterState.isHit}\n          /&gt;\n\n          {/* Minimap with fog of war */}\n          &lt;Minimap\n            mapData={MAPS[currentMapIndex]?.data || []}\n            playerPosition={characterPosition}\n            npcs={MAPS[currentMapIndex]?.npcs || []}\n            portals={MAPS[currentMapIndex]?.specialPortals || []}\n            tileSize={TILE_SIZE}\n            exploredTiles={exploredTiles}\n            currentArea={MAPS[currentMapIndex]?.name || \"Overworld\"}\n          /&gt;\n\n          {gameState.uiState.showLevel4 &amp;&amp; (\n            &lt;Level4Shooter\n              onComplete={handleLevel4Complete}\n              onExit={handleLevel4Exit}\n            /&gt;\n          )}\n          &lt;div\n            className=\"viewport\"\n            style={{ width: \"100%\", height: \"100%\" }}\n            role=\"region\"\n            aria-label=\"Game viewport\"\n          &gt;\n            &lt;div\n              className={&#96;game-world ${currentMapIndex === 2 ? \"level-3\" : currentMapIndex === 1 ? \"level-2\" : \"level-1\"} ${gameState.mobileState.reducedMotionMode ? \"no-animations\" : \"\"}&#96;}\n              style={{\n                transform: gameState.mobileState.reducedMotionMode\n                  ? &#96;translate(${-viewport.x}px, ${-viewport.y}px)&#96;\n                  : &#96;translate(${-viewport.x}px, ${-viewport.y}px)&#96;,\n                width: &#96;${\n                  Array.isArray(MAPS) &amp;&amp;\n                  MAPS[currentMapIndex]?.data?.[0]?.length\n                    ? MAPS[currentMapIndex].data[0].length * TILE_SIZE\n                    : 800\n                }px&#96;,\n                height: &#96;${\n                  Array.isArray(MAPS) &amp;&amp; MAPS[currentMapIndex]?.data?.length\n                    ? MAPS[currentMapIndex].data.length * TILE_SIZE\n                    : 600\n                }px&#96;,\n              }}\n              role=\"region\"\n              aria-label={&#96;Current area: ${MAPS[currentMapIndex]?.name || \"Unknown\"}&#96;}\n            &gt;\n              {/* Conditional rendering: Dungeon or Overworld */}\n              {gameState.uiState.inDungeon &amp;&amp; gameState.dungeonState.currentDungeon ? (\n                &lt;Dungeon\n                  dungeonData={gameState.dungeonState.currentDungeon}\n                  playerPosition={characterPosition}\n                  onPlayerMove={setCharacterPosition}\n                  onCollectItem={handleDungeonItemCollect}\n                  onEnemyDefeat={handleDungeonEnemyDefeat}\n                  onBossDefeat={handleBossDefeat}\n                  onExit={handleExitDungeon}\n                  playerKeys={gameState.dungeonState.smallKeys}\n                  hasBossKey={gameState.dungeonState.hasBossKey}\n                  characterRef={characterRef}\n                /&gt;\n              ) : (\n                MAPS[currentMapIndex] &amp;&amp; (\n                  &lt;MapComponent\n                    mapData={MAPS[currentMapIndex].data}\n                    npcs={\n                      MAPS[currentMapIndex].npcs?.filter(\n                        (npc) =&gt; npc &amp;&amp; npc.position,\n                      ) || []\n                    }\n                    artifacts={\n                      !gameState.uiState.showArtifactsOnMap ? [] : artifactsToShow\n                    }\n                    onTileClick={handleMapTileClick}\n                    onNPCClick={handleNPCClick}\n                    onArtifactClick={handleArtifactClick}\n                    mapName={MAPS[currentMapIndex].name}\n                    questStatusMap={questStatusMap}\n                  /&gt;\n                )\n              )}\n\n              {/* Player Character */}\n              &lt;CharacterController\n                currentMapIndex={currentMapIndex}\n                setCurrentMapIndex={setCurrentMapIndex}\n                isLoggedIn={gameState.isLoggedIn}\n                visibleArtifact={visibleArtifact}\n                handleArtifactPickup={handleArtifactPickup}\n                setFormPosition={setFormPosition}\n                setShowInventory={setShowInventory}\n                adjustViewport={adjustViewport}\n                activePowers={activePowers}\n                user={user}\n                uiState={uiState}\n                isInvincible={gameState.isInvincible}\n                characterState={gameState.characterState}\n                onPositionChange={(position, reason) =&gt; {\n                  // Update GameWorld characterPosition state for compatibility\n                  // This is throttled to prevent excessive re-renders\n                  setCharacterPosition(position);\n                  if (reason === 'portal') {\n                    // Handle portal-specific logic if needed\n                  }\n                }}\n              /&gt;\n\n              {/* Other Players */}\n              {otherPlayers.map((player) =&gt; (\n                &lt;div\n                  key={player.userId}\n                  className=\"other-player\"\n                  style={{\n                    position: \"absolute\",\n                    left: &#96;${player.position.x}px&#96;,\n                    top: &#96;${player.position.y}px&#96;,\n                    width: &#96;${TILE_SIZE}px&#96;,\n                    height: &#96;${TILE_SIZE}px&#96;,\n                    zIndex: 10,\n                  }}\n                &gt;\n                  &lt;div className=\"other-player-avatar\"&gt;\n                    &lt;img\n                      src={player.avatar || \"/assets/default-avatar.svg\"}\n                      alt={player.username}\n                      style={{\n                        width: \"100%\",\n                        height: \"100%\",\n                        borderRadius: \"50%\",\n                        border: \"2px solid #3498db\",\n                      }}\n                    /&gt;\n                  &lt;/div&gt;\n                  &lt;div className=\"other-player-name\"&gt;{player.username}&lt;/div&gt;\n                &lt;/div&gt;\n              ))}\n\n              {/* Environment Modifiers */}\n              {gameState.uiState.isDarkMode &amp;&amp; &lt;div className=\"darkmode-overlay\" /&gt;}\n\n              {/* Buttons Menu */}\n              &lt;div className=\"game-controls\"&gt;\n                &lt;IconButton\n                  onClick={() =&gt; updateUIState({ showInventory: true })}\n                  tooltip=\"Inventory\"\n                &gt;\n                  &lt;i className=\"fas fa-briefcase\"&gt;&lt;/i&gt;\n                &lt;/IconButton&gt;\n                &lt;IconButton\n                  onClick={() =&gt; updateUIState({ showWorldMap: true })}\n                  tooltip=\"World Map\"\n                &gt;\n                  &lt;i className=\"fas fa-map\"&gt;&lt;/i&gt;\n                &lt;/IconButton&gt;\n                &lt;IconButton\n                  onClick={() =&gt; updateUIState({ showQuotes: true })}\n                  tooltip=\"Saved Quotes\"\n                &gt;\n                  &lt;i className=\"fas fa-quote-right\"&gt;&lt;/i&gt;\n                &lt;/IconButton&gt;\n                &lt;IconButton\n                  onClick={() =&gt; updateUIState({ showWorldGuide: true })}\n                  tooltip=\"World Guide\"\n                &gt;\n                  &lt;i className=\"fas fa-compass\"&gt;&lt;/i&gt;\n                &lt;/IconButton&gt;\n                &lt;IconButton\n                  onClick={() =&gt; updateUIState({ showControlsGuide: true })}\n                  tooltip=\"Keyboard Controls (C)\"\n                &gt;\n                  &lt;i className=\"fas fa-keyboard\"&gt;&lt;/i&gt;\n                &lt;/IconButton&gt;\n                &lt;IconButton\n                  onClick={toggleArtifactsVisibility}\n                  tooltip={\n                    gameState.uiState.showArtifactsOnMap\n                      ? \"Hide Artifacts\"\n                      : \"Show Artifacts\"\n                  }\n                &gt;\n                  &lt;i\n                    className={&#96;fas fa-${gameState.uiState.showArtifactsOnMap ? \"eye-slash\" : \"eye\"}&#96;}\n                  &gt;&lt;/i&gt;\n                &lt;/IconButton&gt;\n              &lt;/div&gt;\n\n              {/* Active Quest Display */}\n              {activeQuests.length &gt; 0 &amp;&amp; (\n                &lt;div className=\"active-quest-hud\"&gt;\n                  &lt;div className=\"quest-hud-header\"&gt;\n                    &lt;i className=\"fas fa-scroll\"&gt;&lt;/i&gt;\n                    &lt;span&gt;\n                      Active Quest{activeQuests.length &gt; 1 ? \"s\" : \"\"}\n                    &lt;/span&gt;\n                  &lt;/div&gt;\n                  {activeQuests.slice(0, 2).map((quest) =&gt; {\n                    const completedStages =\n                      quest.stages?.filter((s) =&gt; s.completed).length || 0;\n                    const totalStages = quest.stages?.length || 0;\n                    const progress =\n                      totalStages &gt; 0\n                        ? (completedStages / totalStages) * 100\n                        : 0;\n                    const currentStage = quest.stages?.[quest.currentStage];\n\n                    return (\n                      &lt;div key={quest.questId} className=\"quest-hud-item\"&gt;\n                        &lt;div className=\"quest-hud-title\"&gt;{quest.title}&lt;/div&gt;\n                        &lt;div className=\"quest-hud-progress\"&gt;\n                          &lt;div className=\"quest-hud-progress-bar\"&gt;\n                            &lt;div\n                              className=\"quest-hud-progress-fill\"\n                              style={{ width: &#96;${progress}%&#96; }}\n                            &gt;&lt;/div&gt;\n                          &lt;/div&gt;\n                          &lt;span className=\"quest-hud-progress-text\"&gt;\n                            {completedStages}/{totalStages}\n                          &lt;/span&gt;\n                        &lt;/div&gt;\n                        {currentStage &amp;&amp; !currentStage.completed &amp;&amp; (\n                          &lt;div className=\"quest-hud-current-task\"&gt;\n                            {currentStage.task}\n                          &lt;/div&gt;\n                        )}\n                      &lt;/div&gt;\n                    );\n                  })}\n                  {activeQuests.length &gt; 2 &amp;&amp; (\n                    &lt;div className=\"quest-hud-more\"&gt;\n                      +{activeQuests.length - 2} more quest\n                      {activeQuests.length - 2 &gt; 1 ? \"s\" : \"\"}\n                    &lt;/div&gt;\n                  )}\n                &lt;/div&gt;\n              )}\n            &lt;/div&gt;\n          &lt;/div&gt;\n\n          {/* === MODALS AND OVERLAYS === */}\n          {gameState.uiState.showWorldMap &amp;&amp; (\n            &lt;WorldMap\n              currentWorld={MAPS[gameState.currentMapIndex].name}\n              onClose={() =&gt; updateUIState({ showWorldMap: false })}\n              onNodeClick={handleWorldMapNodeClick}\n            /&gt;\n          )}\n\n          {/* Display feedback form when toggled */}\n          {gameState.uiState.showFeedback &amp;&amp; (\n            &lt;FeedbackForm\n              onClose={() =&gt; updateUIState({ showFeedback: false })}\n            /&gt;\n          )}\n\n          {/* Display keyboard controls guide */}\n          {gameState.uiState.showControlsGuide &amp;&amp; (\n            &lt;ControlsGuide\n              onClose={() =&gt; updateUIState({ showControlsGuide: false })}\n            /&gt;\n          )}\n\n          {gameState.uiState.showWinNotification &amp;&amp; (\n            &lt;div className=\"win-notification\"&gt;\n              &lt;div className=\"win-content\"&gt;\n                &lt;h2&gt;Level Complete!&lt;/h2&gt;\n                &lt;p&gt;{gameState.uiState.winMessage}&lt;/p&gt;\n                &lt;div className=\"win-stars\"&gt;★★★&lt;/div&gt;\n                &lt;button\n                  onClick={() =&gt; updateUIState({ showWinNotification: false })}\n                &gt;\n                  Continue\n                &lt;/button&gt;\n              &lt;/div&gt;\n            &lt;/div&gt;\n          )}\n\n          &lt;RewardModal\n            visible={gameState.uiState.showRewardModal}\n            onClose={() =&gt; updateUIState({ showRewardModal: false })}\n            achievement={gameState.uiState.currentAchievement}\n          /&gt;\n\n          {gameState.uiState.showForm &amp;&amp; (\n            &lt;ArtifactCreation\n              position={gameState.formPosition}\n              onClose={() =&gt; updateUIState({ showForm: false })}\n              refreshArtifacts={refreshArtifactList}\n              currentArea={MAPS[currentMapIndex].name}\n            /&gt;\n          )}\n\n          &lt;InventoryManager\n            showInventory={gameState.uiState.showInventory}\n            setShowInventory={(show) =&gt; updateUIState({ showInventory: show })}\n            character={character}\n            inventory={gameState.character?.inventory || []}\n            artifacts={gameState.gameData.artifacts}\n            currentArea={\n              Array.isArray(MAPS) &amp;&amp; MAPS[currentMapIndex]?.name\n                ? MAPS[currentMapIndex].name\n                : \"Unknown Area\"\n            }\n            setSelectedUserArtifact={setSelectedUserArtifact}\n            refreshArtifactList={refreshArtifactList}\n            setInventory={gameState.setInventory}\n            updateUIState={updateUIState}\n          /&gt;\n\n          {/* Level Up Modal */}\n          {showLevelUpModal &amp;&amp; (\n            &lt;LevelUpModal\n              level={gameState.characterStats.level}\n              stats={characterStats}\n              onClose={() =&gt; setShowLevelUpModal(false)}\n            /&gt;\n          )}\n\n          {/* Hamlet Finale Mini-Game */}\n          {gameState.showHamletFinale &amp;&amp; (\n            &lt;HamletFinale\n              onComplete={handleHamletFinaleComplete}\n              onExit={() =&gt; gameState.setShowHamletFinale(false)}\n            /&gt;\n          )}\n\n          {gameState.uiState.showQuotes &amp;&amp; character &amp;&amp; (\n            &lt;SavedQuotes\n              quotes={character.savedQuotes || []}\n              onClose={() =&gt; updateUIState({ showQuotes: false })}\n              onDeleteQuote={handleDeleteQuote}\n            /&gt;\n          )}\n\n          {/* NPC Interaction Dialog */}\n          {gameState.uiState.showNPCDialog &amp;&amp; gameState.activeNPC &amp;&amp; (\n            &lt;NPCInteraction\n              npc={gameState.activeNPC}\n              onClose={() =&gt; {\n                updateUIState({ showNPCDialog: false });\n                gameState.setActiveNPC(null);\n              }}\n              context={{\n                area: MAPS[currentMapIndex]?.name || \"Unknown\",\n                weather: \"sunny\", // Could be enhanced with real weather\n                timeOfDay:\n                  new Date().getHours() &lt; 12\n                    ? \"morning\"\n                    : new Date().getHours() &lt; 18\n                      ? \"afternoon\"\n                      : \"evening\",\n              }}\n              onQuestUpdate={async () =&gt; {\n                // Refresh quests when a quest is updated\n                const questResponse = await fetchQuests();\n                if (questResponse.success) {\n                  gameState.setActiveQuests(questResponse.data.activeQuests || []);\n                  gameState.setCompletedQuests(questResponse.data.completedQuests || []);\n                }\n              }}\n            /&gt;\n          )}\n\n          {/* Quest Completion Celebration */}\n          {gameState.questCompletionCelebration &amp;&amp; (\n            &lt;QuestCompletionCelebration\n              quest={questCompletionCelebration.quest}\n              rewards={questCompletionCelebration.rewards}\n              onClose={() =&gt; gameState.setQuestCompletionCelebration(null)}\n            /&gt;\n          )}\n\n          {/* Feedback button */}\n          &lt;div\n            className=\"feedback-button\"\n            onClick={() =&gt; updateUIState({ showFeedback: true })}\n          &gt;\n            &lt;span role=\"img\" aria-label=\"Feedback\"&gt;\n              💬\n            &lt;/span&gt;\n            &lt;span className=\"feedback-text\"&gt;Feedback&lt;/span&gt;\n          &lt;/div&gt;\n\n          {/* Map key hint - only shown when there's no other overlay */}\n          {!gameState.uiState.showInventory &amp;&amp;\n            !gameState.uiState.showForm &amp;&amp;\n            !gameState.uiState.showQuotes &amp;&amp;\n            !gameState.uiState.showWorldMap &amp;&amp;\n            !gameState.uiState.showWinNotification &amp;&amp;\n            !gameState.uiState.showRewardModal &amp;&amp;\n            !gameState.uiState.showLevel4 &amp;&amp;\n            !gameState.uiState.showFeedback &amp;&amp;\n            !gameState.uiState.showNPCDialog &amp;&amp; (\n              &lt;div className=\"map-key-hint\" role=\"status\" aria-live=\"polite\"&gt;\n                {gameState.mobileState.isMobile ? (\n                  &lt;span&gt;\n                    Tap and drag to move | Tap NPCs to talk | Use menu buttons\n                  &lt;/span&gt;\n                ) : (\n                  &lt;span&gt;\n                    Press M to view World Map | Press F for Feedback | Press T\n                    to talk to NPCs\n                  &lt;/span&gt;\n                )}\n              &lt;/div&gt;\n            )}\n\n          {/* Mobile touch controls - Directional pad for movement */}\n          {gameState.mobileState.showTouchControls &amp;&amp;\n            gameState.mobileState.touchControlsEnabled &amp;&amp;\n            characterMovement.handleMove &amp;&amp; (\n              &lt;TouchControls\n                onMove={(direction) =&gt; {\n                  characterMovement.handleMove(direction);\n                }}\n                onDrop={() =&gt; {\n                  // Handle drop action if needed\n                }}\n              /&gt;\n            )}\n\n          {/* Mobile UI controls */}\n          {gameState.mobileState.showTouchControls &amp;&amp;\n            gameState.mobileState.touchControlsEnabled &amp;&amp; (\n              &lt;div\n                className=\"mobile-controls\"\n                role=\"group\"\n                aria-label=\"Mobile game controls\"\n              &gt;\n                &lt;button\n                  className=\"mobile-control-btn inventory-btn\"\n                  onClick={() =&gt; updateUIState({ showInventory: true })}\n                  aria-label=\"Open inventory\"\n                &gt;\n                  &lt;span role=\"img\" aria-hidden=\"true\"&gt;\n                    📦\n                  &lt;/span&gt;\n                &lt;/button&gt;\n                &lt;button\n                  className=\"mobile-control-btn map-btn\"\n                  onClick={() =&gt; updateUIState({ showWorldMap: true })}\n                  aria-label=\"Open world map\"\n                &gt;\n                  &lt;span role=\"img\" aria-hidden=\"true\"&gt;\n                    🗺️\n                  &lt;/span&gt;\n                &lt;/button&gt;\n                &lt;button\n                  className=\"mobile-control-btn feedback-btn\"\n                  onClick={() =&gt; updateUIState({ showFeedback: true })}\n                  aria-label=\"Open feedback form\"\n                &gt;\n                  &lt;span role=\"img\" aria-hidden=\"true\"&gt;\n                    💬\n                  &lt;/span&gt;\n                &lt;/button&gt;\n                &lt;button\n                  className=\"mobile-control-btn accessibility-btn\"\n                  onClick={() =&gt;\n                    setMobileState((prev) =&gt; ({\n                      ...prev,\n                      screenReaderMode: !prev.screenReaderMode,\n                    }))\n                  }\n                  aria-label={\n                    gameState.mobileState.screenReaderMode\n                      ? \"Disable screen reader mode\"\n                      : \"Enable screen reader mode\"\n                  }\n                &gt;\n                  &lt;span role=\"img\" aria-hidden=\"true\"&gt;\n                    🔊\n                  &lt;/span&gt;\n                &lt;/button&gt;\n              &lt;/div&gt;\n            )}\n\n          {/* Accessibility status indicator */}\n          {gameState.mobileState.screenReaderMode &amp;&amp; (\n            &lt;div\n              className=\"accessibility-status\"\n              role=\"status\"\n              aria-live=\"polite\"\n            &gt;\n              &lt;span&gt;Screen reader mode active&lt;/span&gt;\n            &lt;/div&gt;\n          )}\n\n          {currentSpecialWorld === \"text_adventure\" &amp;&amp; (\n            &lt;TextAdventure\n              username={character?.username || \"traveler\"}\n              onComplete={handleTextAdventureComplete}\n              onExit={handleTextAdventureExit}\n            /&gt;\n          )}\n\n          {/* Add ArtifactDiscovery component */}\n          &lt;ArtifactDiscovery\n            artifacts={gameState.gameData.artifacts}\n            characterPosition={characterPosition}\n            currentMapName={MAPS[currentMapIndex].name}\n            onArtifactFound={handleArtifactClick}\n            character={character}\n          /&gt;\n\n\n\n          {/* === SPECIAL WORLDS AND MINI-GAMES === */}\n          {currentSpecialWorld === \"textAdventure\" &amp;&amp; (\n            &lt;TextAdventure\n              onComplete={handleTextAdventureComplete}\n              onExit={handleTextAdventureExit}\n              character={character}\n            /&gt;\n          )}\n\n          {currentSpecialWorld === \"terminal\" &amp;&amp; (\n            &lt;Level3Terminal\n              onComplete={handleTerminalComplete}\n              onExit={handleTerminalExit}\n              character={character}\n              artifacts={gameState.gameData.artifacts}\n              username={gameState.character?.username || \"User\"}\n              inventory={inventory}\n            /&gt;\n          )}\n\n          {currentSpecialWorld === \"shooter\" &amp;&amp; (\n            &lt;&gt;\n              {console.log(\"GameWorld: Rendering Level4Shooter component\")}\n              &lt;Level4Shooter\n                onComplete={handleShooterComplete}\n                onExit={handleShooterExit}\n                character={character}\n              /&gt;\n            &lt;/&gt;\n          )}\n\n          {currentSpecialWorld === \"hemingway\" &amp;&amp; (\n            &lt;HemingwayChallenge\n              onComplete={handleHemingwayComplete}\n              onExit={handleHemingwayExit}\n              character={character}\n            /&gt;\n          )}\n\n          {/* Artifact Game Launcher */}\n          {gameState.showGameLauncher &amp;&amp; gameState.currentGameArtifact &amp;&amp; (\n            &lt;ArtifactGameLauncher\n              artifact={gameState.currentGameArtifact}\n              character={character}\n              onComplete={handleGameComplete}\n              onExit={handleGameExit}\n              onProgressUpdate={(progress) =&gt; {\n                console.log(\"Game progress update:\", progress);\n              }}\n            /&gt;\n          )}\n\n          {/* Active Powers Display */}\n          {activePowers.length &gt; 0 &amp;&amp; (\n            &lt;div className=\"active-powers-hud\"&gt;\n              &lt;div className=\"powers-hud-label\"&gt;Active Powers:&lt;/div&gt;\n              &lt;div className=\"powers-hud-list\"&gt;\n                {activePowers.map((powerId) =&gt; {\n                  const powerDef = getPowerDefinition(powerId);\n                  return (\n                    &lt;div\n                      key={powerId}\n                      className=\"power-hud-item\"\n                      title={powerDef.description}\n                    &gt;\n                      &lt;span className=\"power-hud-icon\"&gt;{powerDef.icon}&lt;/span&gt;\n                      &lt;span className=\"power-hud-name\"&gt;{powerDef.name}&lt;/span&gt;\n                    &lt;/div&gt;\n                  );\n                })}\n              &lt;/div&gt;\n            &lt;/div&gt;\n          )}\n\n          {/* Debug overlay to show currentSpecialWorld state */}\n          &lt;div\n            className=\"debug-overlay\"\n            style={{\n              position: \"fixed\",\n              top: \"10px\",\n              left: \"10px\",\n              background: \"rgba(0,0,0,0.8)\",\n              color: \"#00ff00\",\n              padding: \"10px\",\n              zIndex: 9999,\n              pointerEvents: \"none\",\n              fontFamily: \"monospace\",\n            }}\n          &gt;\n            currentSpecialWorld: \"{currentSpecialWorld}\"\n          &lt;/div&gt;\n\n          {/* === SYSTEMS === */}\n          &lt;NotificationSystem soundManager={gameState.soundManager} /&gt;\n\n          &lt;MultiplayerChat\n            worldId={worldId}\n            worldName={MAPS[gameState.currentMapIndex]?.name || \"Unknown World\"}\n            onPlayerClick={(player) =&gt; {\n              console.log(\"Player clicked:\", player);\n              // Handle player interaction\n            }}\n          /&gt;\n        &lt;/div&gt;\n      )}\n    &lt;/ErrorBoundary&gt;\n  );\n});\n\nGameWorld.displayName = \"GameWorld\";\n\nexport default GameWorld;\n"
}
```
User decision: **accepted**

Status: **completed**


</details>
</tool-use>

---

<tool-use data-tool-type="generic" data-tool-name="read_lints">
<details>
          <summary>Tool use: **read_lints** • Read lints for 1 file</summary>
      
Lint paths:

- `client/src/components/GameWorld.jsx`

Lint results


**No lint errors found**
</details>
</tool-use>

---

Removed the runtime crash by **adding back `getCharacterPosition`** in `client/src/components/GameWorld.jsx` as a `useCallback` wrapper around `characterPosition`. This satisfies the dependency arrays that reference it and ensures those hooks update when position changes.

If you reload now, the `ReferenceError: getCharacterPosition is not defined` should be gone.

---

_**User (2026-01-07 03:53Z)**_

commit and push - it looks like we are runnign into repeated errors

---

_**Agent (model default, mode Agent)**_

You're absolutely right—let's commit and push what we have so far to stabilize the codebase.

---

<tool-use data-tool-type="shell" data-tool-name="run_terminal_cmd">
<details><summary>Tool use: **run_terminal_cmd** • Run command: cd /home/robwistrand/code/ga/projects/authentic-internet && git add -A</summary>

```bash
cd /home/robwistrand/code/ga/projects/authentic-internet && git add -A
```
</details>
</tool-use>

---

<tool-use data-tool-type="shell" data-tool-name="run_terminal_cmd">
<details><summary>Tool use: **run_terminal_cmd** • Run command: cd /home/robwistrand/code/ga/projects/authentic-internet && git status</summary>

```bash
cd /home/robwistrand/code/ga/projects/authentic-internet && git status
```

```
On branch main
Your branch is up to date with 'origin/main'.

Changes to be committed:
  (use "git restore --staged &lt;file&gt;..." to unstage)
	modified:   .specstory/history/2026-01-07_17-10Z-notification-system-component-extraction.md
	modified:   .specstory/history/2026-01-07_17-11Z-artifact-routes-controller-service-pattern.md
	modified:   .specstory/history/2026-01-07_17-11Z-character-movement-controller-refactor.md
	modified:   .specstory/history/2026-01-07_17-11Z-game-data-file-restructuring.md
	new file:   .specstory/history/2026-01-07_17-13Z-gameworld-cleanup-and-state-organization.md
	new file:   .specstory/history/2026-01-07_17-44Z-gamestate-and-character-movement-changes.md
	new file:   .specstory/history/2026-01-07_17-47Z-vite-import-analysis-syntax-error.md
	new file:   .specstory/history/2026-01-07_19-10Z-setcurrentspecialworld-reference-error.md
	modified:   client/src/components/CharacterMovement.jsx
	modified:   client/src/components/GameWorld.jsx
	modified:   client/src/components/controllers/CharacterController.jsx
	modified:   client/src/components/performance/PerformanceMonitor.jsx
	modified:   client/src/components/systems/NotificationSystem.jsx
	renamed:    client/src/components/systems/useNotification.js -&gt; client/src/components/systems/useNotification.jsx
	modified:   client/src/hooks/useGameState.js
	deleted:    server/.server_pid
	modified:   server/routes/artifactRoutes.js


```
</details>
</tool-use>

---

<tool-use data-tool-type="shell" data-tool-name="run_terminal_cmd">
<details><summary>Tool use: **run_terminal_cmd** • Run command: cd /home/robwistrand/code/ga/projects/authentic-internet && git commit -m "fix: resolve setCurrentSpecialWorld and getCharacterPosition reference errors

- Destructured all required state values and setters from gameState hook
- Added showLevelUpModal as local state
- Removed duplicate updateUIState declaration
- Added getCharacterPosition wrapper function for dependency arrays
- Fixed currentSpecialWorld references to use destructured variable
- Updated dependency arrays with correct references
- Fixed portalNotificationActive and gameData references

Resolves runtime errors that prevented GameWorld from rendering"</summary>

```bash
cd /home/robwistrand/code/ga/projects/authentic-internet && git commit -m "fix: resolve setCurrentSpecialWorld and getCharacterPosition reference errors

- Destructured all required state values and setters from gameState hook
- Added showLevelUpModal as local state
- Removed duplicate updateUIState declaration
- Added getCharacterPosition wrapper function for dependency arrays
- Fixed currentSpecialWorld references to use destructured variable
- Updated dependency arrays with correct references
- Fixed portalNotificationActive and gameData references

Resolves runtime errors that prevented GameWorld from rendering"
```

```
[main 8246ce3] fix: resolve setCurrentSpecialWorld and getCharacterPosition reference errors
 17 files changed, 33299 insertions(+), 619 deletions(-)
 create mode 100644 .specstory/history/2026-01-07_17-13Z-gameworld-cleanup-and-state-organization.md
 create mode 100644 .specstory/history/2026-01-07_17-44Z-gamestate-and-character-movement-changes.md
 create mode 100644 .specstory/history/2026-01-07_17-47Z-vite-import-analysis-syntax-error.md
 create mode 100644 .specstory/history/2026-01-07_19-10Z-setcurrentspecialworld-reference-error.md
 rename client/src/components/systems/{useNotification.js =&gt; useNotification.jsx} (100%)
 delete mode 100644 server/.server_pid

```
</details>
</tool-use>

---

<tool-use data-tool-type="shell" data-tool-name="run_terminal_cmd">
<details><summary>Tool use: **run_terminal_cmd** • Run command: cd /home/robwistrand/code/ga/projects/authentic-internet && git push origin main</summary>

```bash
cd /home/robwistrand/code/ga/projects/authentic-internet && git push origin main
```

```
To github.com:robotwist/authentic-internet.git
   820a14b..8246ce3  main -&gt; main

```
</details>
</tool-use>

---

Perfect! ✅ Successfully committed and pushed the fixes. 

## Summary of what was fixed:

1. **`setCurrentSpecialWorld` reference error** - Destructured from `gameState` hook
2. **`getCharacterPosition` reference error** - Added back as a `useCallback` wrapper
3. **Duplicate `updateUIState` declaration** - Removed the redundant wrapper
4. **Missing destructured variables** - Added all required state values and setters including:
   - State: `currentMapIndex`, `characterPosition`, `viewport`, `exploredTiles`, `inventory`, `character`, `visibleArtifact`, `currentSpecialWorld`, `characterStats`, `uiState`, `questStatusMap`, `mobileState`, `portalState`
   - Setters: All corresponding setters
5. **Fixed dependency arrays** - Updated to use correct references
6. **Added local state** - `showLevelUpModal` for level-up modal display

The codebase should now be stable. You can reload the app and these reference errors should be resolved. [[memory:3401649]]

---

_**User (2026-01-07 03:53Z)**_

errorTracker.js:90 [unknown] Unhandled error: Uncaught ReferenceError: artifacts is not defined {source: 'http://localhost:5177/src/components/GameWorld.jsx?t=1767822045452', line: 1882, column: 7} ReferenceError: artifacts is not defined
    at GameWorld.jsx:2538:7
    at renderWithHooks (chunk-NUMECXU6.js?v=c9a7e100:11548:26)
    at updateFunctionComponent (chunk-NUMECXU6.js?v=c9a7e100:14582:28)
    at updateSimpleMemoComponent (chunk-NUMECXU6.js?v=c9a7e100:14463:18)
    at updateMemoComponent (chunk-NUMECXU6.js?v=c9a7e100:14366:22)
    at beginWork (chunk-NUMECXU6.js?v=c9a7e100:15977:22)
    at HTMLUnknownElement.callCallback2 (chunk-NUMECXU6.js?v=c9a7e100:3674:22)
    at Object.invokeGuardedCallbackDev (chunk-NUMECXU6.js?v=c9a7e100:3699:24)
    at invokeGuardedCallback (chunk-NUMECXU6.js?v=c9a7e100:3733:39)
    at beginWork$1 (chunk-NUMECXU6.js?v=c9a7e100:19765:15)
trackError @ errorTracker.js:90
(anonymous) @ errorTracker.js:196
invokeGuardedCallbackDev @ chunk-NUMECXU6.js?v=c9a7e100:3699
invokeGuardedCallback @ chunk-NUMECXU6.js?v=c9a7e100:3733
beginWork$1 @ chunk-NUMECXU6.js?v=c9a7e100:19765
performUnitOfWork @ chunk-NUMECXU6.js?v=c9a7e100:19198
workLoopSync @ chunk-NUMECXU6.js?v=c9a7e100:19137
renderRootSync @ chunk-NUMECXU6.js?v=c9a7e100:19116
performConcurrentWorkOnRoot @ chunk-NUMECXU6.js?v=c9a7e100:18678
workLoop @ chunk-NUMECXU6.js?v=c9a7e100:197
flushWork @ chunk-NUMECXU6.js?v=c9a7e100:176
performWorkUntilDeadline @ chunk-NUMECXU6.js?v=c9a7e100:384
GameWorld.jsx:2538 Uncaught ReferenceError: artifacts is not defined
    at GameWorld.jsx:2538:7
    at renderWithHooks (chunk-NUMECXU6.js?v=c9a7e100:11548:26)
    at updateFunctionComponent (chunk-NUMECXU6.js?v=c9a7e100:14582:28)
    at updateSimpleMemoComponent (chunk-NUMECXU6.js?v=c9a7e100:14463:18)
    at updateMemoComponent (chunk-NUMECXU6.js?v=c9a7e100:14366:22)
    at beginWork (chunk-NUMECXU6.js?v=c9a7e100:15977:22)
    at HTMLUnknownElement.callCallback2 (chunk-NUMECXU6.js?v=c9a7e100:3674:22)
    at Object.invokeGuardedCallbackDev (chunk-NUMECXU6.js?v=c9a7e100:3699:24)
    at invokeGuardedCallback (chunk-NUMECXU6.js?v=c9a7e100:3733:39)
    at beginWork$1 (chunk-NUMECXU6.js?v=c9a7e100:19765:15)
(anonymous) @ GameWorld.jsx:2538
renderWithHooks @ chunk-NUMECXU6.js?v=c9a7e100:11548
updateFunctionComponent @ chunk-NUMECXU6.js?v=c9a7e100:14582
updateSimpleMemoComponent @ chunk-NUMECXU6.js?v=c9a7e100:14463
updateMemoComponent @ chunk-NUMECXU6.js?v=c9a7e100:14366
beginWork @ chunk-NUMECXU6.js?v=c9a7e100:15977
callCallback2 @ chunk-NUMECXU6.js?v=c9a7e100:3674
invokeGuardedCallbackDev @ chunk-NUMECXU6.js?v=c9a7e100:3699
invokeGuardedCallback @ chunk-NUMECXU6.js?v=c9a7e100:3733
beginWork$1 @ chunk-NUMECXU6.js?v=c9a7e100:19765
performUnitOfWork @ chunk-NUMECXU6.js?v=c9a7e100:19198
workLoopSync @ chunk-NUMECXU6.js?v=c9a7e100:19137
renderRootSync @ chunk-NUMECXU6.js?v=c9a7e100:19116
performConcurrentWorkOnRoot @ chunk-NUMECXU6.js?v=c9a7e100:18678
workLoop @ chunk-NUMECXU6.js?v=c9a7e100:197
flushWork @ chunk-NUMECXU6.js?v=c9a7e100:176
performWorkUntilDeadline @ chunk-NUMECXU6.js?v=c9a7e100:384
errorTracker.js:90 [unknown] Unhandled error: Uncaught ReferenceError: artifacts is not defined {source: 'http://localhost:5177/src/components/GameWorld.jsx?t=1767822045452', line: 1882, column: 7} ReferenceError: artifacts is not defined
    at GameWorld.jsx:2538:7
    at renderWithHooks (chunk-NUMECXU6.js?v=c9a7e100:11548:26)
    at updateFunctionComponent (chunk-NUMECXU6.js?v=c9a7e100:14582:28)
    at updateSimpleMemoComponent (chunk-NUMECXU6.js?v=c9a7e100:14463:18)
    at updateMemoComponent (chunk-NUMECXU6.js?v=c9a7e100:14366:22)
    at beginWork (chunk-NUMECXU6.js?v=c9a7e100:15977:22)
    at HTMLUnknownElement.callCallback2 (chunk-NUMECXU6.js?v=c9a7e100:3674:22)
    at Object.invokeGuardedCallbackDev (chunk-NUMECXU6.js?v=c9a7e100:3699:24)
    at invokeGuardedCallback (chunk-NUMECXU6.js?v=c9a7e100:3733:39)
    at beginWork$1 (chunk-NUMECXU6.js?v=c9a7e100:19765:15)
trackError @ errorTracker.js:90
(anonymous) @ errorTracker.js:196
invokeGuardedCallbackDev @ chunk-NUMECXU6.js?v=c9a7e100:3699
invokeGuardedCallback @ chunk-NUMECXU6.js?v=c9a7e100:3733
beginWork$1 @ chunk-NUMECXU6.js?v=c9a7e100:19765
performUnitOfWork @ chunk-NUMECXU6.js?v=c9a7e100:19198
workLoopSync @ chunk-NUMECXU6.js?v=c9a7e100:19137
renderRootSync @ chunk-NUMECXU6.js?v=c9a7e100:19116
recoverFromConcurrentError @ chunk-NUMECXU6.js?v=c9a7e100:18736
performConcurrentWorkOnRoot @ chunk-NUMECXU6.js?v=c9a7e100:18684
workLoop @ chunk-NUMECXU6.js?v=c9a7e100:197
flushWork @ chunk-NUMECXU6.js?v=c9a7e100:176
performWorkUntilDeadline @ chunk-NUMECXU6.js?v=c9a7e100:384
GameWorld.jsx:2538 Uncaught ReferenceError: artifacts is not defined
    at GameWorld.jsx:2538:7
    at renderWithHooks (chunk-NUMECXU6.js?v=c9a7e100:11548:26)
    at updateFunctionComponent (chunk-NUMECXU6.js?v=c9a7e100:14582:28)
    at updateSimpleMemoComponent (chunk-NUMECXU6.js?v=c9a7e100:14463:18)
    at updateMemoComponent (chunk-NUMECXU6.js?v=c9a7e100:14366:22)
    at beginWork (chunk-NUMECXU6.js?v=c9a7e100:15977:22)
    at HTMLUnknownElement.callCallback2 (chunk-NUMECXU6.js?v=c9a7e100:3674:22)
    at Object.invokeGuardedCallbackDev (chunk-NUMECXU6.js?v=c9a7e100:3699:24)
    at invokeGuardedCallback (chunk-NUMECXU6.js?v=c9a7e100:3733:39)
    at beginWork$1 (chunk-NUMECXU6.js?v=c9a7e100:19765:15)
(anonymous) @ GameWorld.jsx:2538
renderWithHooks @ chunk-NUMECXU6.js?v=c9a7e100:11548
updateFunctionComponent @ chunk-NUMECXU6.js?v=c9a7e100:14582
updateSimpleMemoComponent @ chunk-NUMECXU6.js?v=c9a7e100:14463
updateMemoComponent @ chunk-NUMECXU6.js?v=c9a7e100:14366
beginWork @ chunk-NUMECXU6.js?v=c9a7e100:15977
callCallback2 @ chunk-NUMECXU6.js?v=c9a7e100:3674
invokeGuardedCallbackDev @ chunk-NUMECXU6.js?v=c9a7e100:3699
invokeGuardedCallback @ chunk-NUMECXU6.js?v=c9a7e100:3733
beginWork$1 @ chunk-NUMECXU6.js?v=c9a7e100:19765
performUnitOfWork @ chunk-NUMECXU6.js?v=c9a7e100:19198
workLoopSync @ chunk-NUMECXU6.js?v=c9a7e100:19137
renderRootSync @ chunk-NUMECXU6.js?v=c9a7e100:19116
recoverFromConcurrentError @ chunk-NUMECXU6.js?v=c9a7e100:18736
performConcurrentWorkOnRoot @ chunk-NUMECXU6.js?v=c9a7e100:18684
workLoop @ chunk-NUMECXU6.js?v=c9a7e100:197
flushWork @ chunk-NUMECXU6.js?v=c9a7e100:176
performWorkUntilDeadline @ chunk-NUMECXU6.js?v=c9a7e100:384
chunk-NUMECXU6.js?v=c9a7e100:14032 The above error occurred in the <GameWorld> component:

    at http://localhost:5177/src/components/GameWorld.jsx?t=1767822045452:97:45
    at ErrorBoundary (http://localhost:5177/src/components/ErrorBoundary.jsx:8:5)
    at Suspense
    at RenderedRoute (http://localhost:5177/node_modules/.vite/deps/react-router-dom.js?v=ce3ce900:4089:5)
    at Routes (http://localhost:5177/node_modules/.vite/deps/react-router-dom.js?v=ce3ce900:4559:5)
    at main
    at AchievementProvider (http://localhost:5177/src/context/AchievementContext.jsx:89:39)
    at div
    at App (http://localhost:5177/src/App.jsx?t=1767822045452:45:3)
    at ErrorBoundary (http://localhost:5177/src/components/ErrorBoundary.jsx:8:5)
    at GameStateProvider (http://localhost:5177/src/context/GameStateContext.jsx:98:37)
    at WebSocketProvider (http://localhost:5177/src/context/WebSocketContext.jsx:28:37)
    at AuthProvider (http://localhost:5177/src/context/AuthContext.jsx:227:32)
    at Router (http://localhost:5177/node_modules/.vite/deps/react-router-dom.js?v=ce3ce900:4502:15)
    at BrowserRouter (http://localhost:5177/node_modules/.vite/deps/react-router-dom.js?v=ce3ce900:5248:5)

React will try to recreate this component tree from scratch using the error boundary you provided, ErrorBoundary.
logCapturedError @ chunk-NUMECXU6.js?v=c9a7e100:14032
callback @ chunk-NUMECXU6.js?v=c9a7e100:14078
callCallback @ chunk-NUMECXU6.js?v=c9a7e100:11248
commitUpdateQueue @ chunk-NUMECXU6.js?v=c9a7e100:11265
commitLayoutEffectOnFiber @ chunk-NUMECXU6.js?v=c9a7e100:17075
commitLayoutMountEffects_complete @ chunk-NUMECXU6.js?v=c9a7e100:17980
commitLayoutEffects_begin @ chunk-NUMECXU6.js?v=c9a7e100:17969
commitLayoutEffects_begin @ chunk-NUMECXU6.js?v=c9a7e100:17950
commitLayoutEffects @ chunk-NUMECXU6.js?v=c9a7e100:17920
commitRootImpl @ chunk-NUMECXU6.js?v=c9a7e100:19353
commitRoot @ chunk-NUMECXU6.js?v=c9a7e100:19277
finishConcurrentRender @ chunk-NUMECXU6.js?v=c9a7e100:18760
performConcurrentWorkOnRoot @ chunk-NUMECXU6.js?v=c9a7e100:18718
workLoop @ chunk-NUMECXU6.js?v=c9a7e100:197
flushWork @ chunk-NUMECXU6.js?v=c9a7e100:176
performWorkUntilDeadline @ chunk-NUMECXU6.js?v=c9a7e100:384
ErrorBoundary.jsx:31 Error caught by boundary: ReferenceError: artifacts is not defined
    at GameWorld.jsx:2538:7
    at renderWithHooks (chunk-NUMECXU6.js?v=c9a7e100:11548:26)
    at updateFunctionComponent (chunk-NUMECXU6.js?v=c9a7e100:14582:28)
    at updateSimpleMemoComponent (chunk-NUMECXU6.js?v=c9a7e100:14463:18)
    at updateMemoComponent (chunk-NUMECXU6.js?v=c9a7e100:14366:22)
    at beginWork (chunk-NUMECXU6.js?v=c9a7e100:15977:22)
    at beginWork$1 (chunk-NUMECXU6.js?v=c9a7e100:19753:22)
    at performUnitOfWork (chunk-NUMECXU6.js?v=c9a7e100:19198:20)
    at workLoopSync (chunk-NUMECXU6.js?v=c9a7e100:19137:13)
    at renderRootSync (chunk-NUMECXU6.js?v=c9a7e100:19116:15) {componentStack: '\n    at http://localhost:5177/src/components/GameW….vite/deps/react-router-dom.js?v=ce3ce900:5248:5)'}
componentDidCatch @ ErrorBoundary.jsx:31
callback @ chunk-NUMECXU6.js?v=c9a7e100:14084
callCallback @ chunk-NUMECXU6.js?v=c9a7e100:11248
commitUpdateQueue @ chunk-NUMECXU6.js?v=c9a7e100:11265
commitLayoutEffectOnFiber @ chunk-NUMECXU6.js?v=c9a7e100:17075
commitLayoutMountEffects_complete @ chunk-NUMECXU6.js?v=c9a7e100:17980
commitLayoutEffects_begin @ chunk-NUMECXU6.js?v=c9a7e100:17969
commitLayoutEffects_begin @ chunk-NUMECXU6.js?v=c9a7e100:17950
commitLayoutEffects @ chunk-NUMECXU6.js?v=c9a7e100:17920
commitRootImpl @ chunk-NUMECXU6.js?v=c9a7e100:19353
commitRoot @ chunk-NUMECXU6.js?v=c9a7e100:19277
finishConcurrentRender @ chunk-NUMECXU6.js?v=c9a7e100:18760
performConcurrentWorkOnRoot @ chunk-NUMECXU6.js?v=c9a7e100:18718
workLoop @ chunk-NUMECXU6.js?v=c9a7e100:197
flushWork @ chunk-NUMECXU6.js?v=c9a7e100:176
performWorkUntilDeadline @ chunk-NUMECXU6.js?v=c9a7e100:384
errorTracker.js:138  POST http://localhost:5177/api/diagnostics/errors 500 (Internal Server Error)
reportErrorToServer @ errorTracker.js:138
trackError @ errorTracker.js:106
(anonymous) @ errorTracker.js:196
invokeGuardedCallbackDev @ chunk-NUMECXU6.js?v=c9a7e100:3699
invokeGuardedCallback @ chunk-NUMECXU6.js?v=c9a7e100:3733
beginWork$1 @ chunk-NUMECXU6.js?v=c9a7e100:19765
performUnitOfWork @ chunk-NUMECXU6.js?v=c9a7e100:19198
workLoopSync @ chunk-NUMECXU6.js?v=c9a7e100:19137
renderRootSync @ chunk-NUMECXU6.js?v=c9a7e100:19116
performConcurrentWorkOnRoot @ chunk-NUMECXU6.js?v=c9a7e100:18678
workLoop @ chunk-NUMECXU6.js?v=c9a7e100:197
flushWork @ chunk-NUMECXU6.js?v=c9a7e100:176
performWorkUntilDeadline @ chunk-NUMECXU6.js?v=c9a7e100:384
errorTracker.js:152 Error reporting to server: Error: Server returned 500: Internal Server Error
    at reportErrorToServer (errorTracker.js:145:13)
reportErrorToServer @ errorTracker.js:152
await in reportErrorToServer
trackError @ errorTracker.js:106
(anonymous) @ errorTracker.js:196
invokeGuardedCallbackDev @ chunk-NUMECXU6.js?v=c9a7e100:3699
invokeGuardedCallback @ chunk-NUMECXU6.js?v=c9a7e100:3733
beginWork$1 @ chunk-NUMECXU6.js?v=c9a7e100:19765
performUnitOfWork @ chunk-NUMECXU6.js?v=c9a7e100:19198
workLoopSync @ chunk-NUMECXU6.js?v=c9a7e100:19137
renderRootSync @ chunk-NUMECXU6.js?v=c9a7e100:19116
performConcurrentWorkOnRoot @ chunk-NUMECXU6.js?v=c9a7e100:18678
workLoop @ chunk-NUMECXU6.js?v=c9a7e100:197
flushWork @ chunk-NUMECXU6.js?v=c9a7e100:176
performWorkUntilDeadline @ chunk-NUMECXU6.js?v=c9a7e100:384
errorTracker.js:113 Failed to report critical error to server: Error: Server returned 500: Internal Server Error
    at reportErrorToServer (errorTracker.js:145:13)
(anonymous) @ errorTracker.js:113
Promise.catch
trackError @ errorTracker.js:106
(anonymous) @ errorTracker.js:196
invokeGuardedCallbackDev @ chunk-NUMECXU6.js?v=c9a7e100:3699
invokeGuardedCallback @ chunk-NUMECXU6.js?v=c9a7e100:3733
beginWork$1 @ chunk-NUMECXU6.js?v=c9a7e100:19765
performUnitOfWork @ chunk-NUMECXU6.js?v=c9a7e100:19198
workLoopSync @ chunk-NUMECXU6.js?v=c9a7e100:19137
renderRootSync @ chunk-NUMECXU6.js?v=c9a7e100:19116
performConcurrentWorkOnRoot @ chunk-NUMECXU6.js?v=c9a7e100:18678
workLoop @ chunk-NUMECXU6.js?v=c9a7e100:197
flushWork @ chunk-NUMECXU6.js?v=c9a7e100:176
performWorkUntilDeadline @ chunk-NUMECXU6.js?v=c9a7e100:384
errorTracker.js:138  POST http://localhost:5177/api/diagnostics/errors net::ERR_ABORTED 500 (Internal Server Error)
reportErrorToServer @ errorTracker.js:138
trackError @ errorTracker.js:106
(anonymous) @ errorTracker.js:196
invokeGuardedCallbackDev @ chunk-NUMECXU6.js?v=c9a7e100:3699
invokeGuardedCallback @ chunk-NUMECXU6.js?v=c9a7e100:3733
beginWork$1 @ chunk-NUMECXU6.js?v=c9a7e100:19765
performUnitOfWork @ chunk-NUMECXU6.js?v=c9a7e100:19198
workLoopSync @ chunk-NUMECXU6.js?v=c9a7e100:19137
renderRootSync @ chunk-NUMECXU6.js?v=c9a7e100:19116
recoverFromConcurrentError @ chunk-NUMECXU6.js?v=c9a7e100:18736
performConcurrentWorkOnRoot @ chunk-NUMECXU6.js?v=c9a7e100:18684
workLoop @ chunk-NUMECXU6.js?v=c9a7e100:197
flushWork @ chunk-NUMECXU6.js?v=c9a7e100:176
performWorkUntilDeadline @ chunk-NUMECXU6.js?v=c9a7e100:384
errorTracker.js:152 Error reporting to server: Error: Server returned 500: Internal Server Error
    at reportErrorToServer (errorTracker.js:145:13)
reportErrorToServer @ errorTracker.js:152
await in reportErrorToServer
trackError @ errorTracker.js:106
(anonymous) @ errorTracker.js:196
invokeGuardedCallbackDev @ chunk-NUMECXU6.js?v=c9a7e100:3699
invokeGuardedCallback @ chunk-NUMECXU6.js?v=c9a7e100:3733
beginWork$1 @ chunk-NUMECXU6.js?v=c9a7e100:19765
performUnitOfWork @ chunk-NUMECXU6.js?v=c9a7e100:19198
workLoopSync @ chunk-NUMECXU6.js?v=c9a7e100:19137
renderRootSync @ chunk-NUMECXU6.js?v=c9a7e100:19116
recoverFromConcurrentError @ chunk-NUMECXU6.js?v=c9a7e100:18736
performConcurrentWorkOnRoot @ chunk-NUMECXU6.js?v=c9a7e100:18684
workLoop @ chunk-NUMECXU6.js?v=c9a7e100:197
flushWork @ chunk-NUMECXU6.js?v=c9a7e100:176
performWorkUntilDeadline @ chunk-NUMECXU6.js?v=c9a7e100:384
errorTracker.js:113 Failed to report critical error to server: Error: Server returned 500: Internal Server Error
    at reportErrorToServer (errorTracker.js:145:13)
(anonymous) @ errorTracker.js:113
Promise.catch
trackError @ errorTracker.js:106
(anonymous) @ errorTracker.js:196
invokeGuardedCallbackDev @ chunk-NUMECXU6.js?v=c9a7e100:3699
invokeGuardedCallback @ chunk-NUMECXU6.js?v=c9a7e100:3733
beginWork$1 @ chunk-NUMECXU6.js?v=c9a7e100:19765
performUnitOfWork @ chunk-NUMECXU6.js?v=c9a7e100:19198
workLoopSync @ chunk-NUMECXU6.js?v=c9a7e100:19137
renderRootSync @ chunk-NUMECXU6.js?v=c9a7e100:19116
recoverFromConcurrentError @ chunk-NUMECXU6.js?v=c9a7e100:18736
performConcurrentWorkOnRoot @ chunk-NUMECXU6.js?v=c9a7e100:18684
workLoop @ chunk-NUMECXU6.js?v=c9a7e100:197
flushWork @ chunk-NUMECXU6.js?v=c9a7e100:176
performWorkUntilDeadline @ chunk-NUMECXU6.js?v=c9a7e100:384


---

_**Agent (model default, mode Agent)**_



---


Checking line 2538 where `artifacts` is referenced:


---

<tool-use data-tool-type="read" data-tool-name="read_file">
<details><summary>Tool use: **read_file** • Read file: /home/robwistrand/code/ga/projects/authentic-internet/client/src/components/GameWorld.jsx</summary>

</details>
</tool-use>

---

<tool-use data-tool-type="search" data-tool-name="grep">
<details>
<summary>Tool use: **grep** • Grep for "\bartifacts\b" in "/home/robwistrand/code/ga/projects/authentic-internet/client/src/components/GameWorld.jsx" • 29 matches</summary>

Output mode: content


| File | Content | Line |
|------|------|------|
| `client/src/components/GameWorld.jsx` | `// Check if task mentions artifacts or specific artifact` | L295 |
| `client/src/components/GameWorld.jsx` | `() => currentMap?.artifacts \|\| [],` | L930 |
| `client/src/components/GameWorld.jsx` | `artifacts: [...gameState.gameData.artifacts, newArtifact],` | L1387 |
| `client/src/components/GameWorld.jsx` | `gameState.gameData.artifacts,` | L1404 |
| `client/src/components/GameWorld.jsx` | `updateGameState(\{ artifacts: artifactsData \});` | L1841 |
| `client/src/components/GameWorld.jsx` | `console.error("Error loading artifacts:", error);` | L1843 |
| `client/src/components/GameWorld.jsx` | `// Update viewed artifacts` | L1956 |
| `client/src/components/GameWorld.jsx` | `// Check for both map artifacts and server artifacts at the player's position` | L2050 |
| `client/src/components/GameWorld.jsx` | `// Check if the current map and its artifacts property exist before accessing them` | L2057 |
| `client/src/components/GameWorld.jsx` | `const mapArtifact = MAPS[currentMapIndex]?.artifacts?.find(` | L2058 |
| `client/src/components/GameWorld.jsx` | `// Check server artifacts` | L2066 |
| `client/src/components/GameWorld.jsx` | `gameState.gameData.artifacts && Array.isArray(gameState.gameData.artifacts)` | L2068 |
| `client/src/components/GameWorld.jsx` | `? gameState.gameData.artifacts.find(` | L2069 |
| `client/src/components/GameWorld.jsx` | `// Prioritize server artifacts (they might be more up-to-date)` | L2080 |
| `client/src/components/GameWorld.jsx` | `// Check for both map artifacts and server artifacts` | L2090 |
| `client/src/components/GameWorld.jsx` | `\}, [characterPosition, currentMapIndex, gameState.gameData.artifacts]);` | L2092 |
| `client/src/components/GameWorld.jsx` | `if (!characterPosition \|\| !gameState.gameData.artifacts?.length) return;` | L2102 |
| `client/src/components/GameWorld.jsx` | `// Find game artifacts in the current area that the character is near` | L2106 |
| `client/src/components/GameWorld.jsx` | `const gameArtifacts = gameState.gameData.artifacts.filter(` | L2107 |
| `client/src/components/GameWorld.jsx` | `\}, [characterPosition, currentMapIndex, gameState.gameData.artifacts]);` | L2182 |
| `client/src/components/GameWorld.jsx` | `if (!map \|\| !Array.isArray(map.artifacts)) return;` | L2287 |
| `client/src/components/GameWorld.jsx` | `map.artifacts.forEach((artifact, artifactIndex) => \{` | L2289 |
| `client/src/components/GameWorld.jsx` | `MAPS[mapIndex].artifacts[artifactIndex].visible = false;` | L2291 |
| `client/src/components/GameWorld.jsx` | `updateGameState(\{ artifacts: [...gameState.gameData.artifacts, newArtifact] \});` | L2438 |
| `client/src/components/GameWorld.jsx` | `(Array.isArray(gameState.gameData.artifacts)` | L2448 |
| `client/src/components/GameWorld.jsx` | `? gameState.gameData.artifacts.filter((a) => a.createdBy === character.id)` | L2449 |
| `client/src/components/GameWorld.jsx` | `"Created 5 artifacts to shape the Authentic Internet",` | L2456 |
| `client/src/components/GameWorld.jsx` | `[gameState.gameData.artifacts, character, updateGameState, handleAchievementUnlocked],` | L2473 |
| `client/src/components/GameWorld.jsx` | `const clickedArtifact = artifacts.find(` | L2480 |


</details>
</tool-use>

---

<tool-use data-tool-type="read" data-tool-name="read_file">
<details><summary>Tool use: **read_file** • Read file: /home/robwistrand/code/ga/projects/authentic-internet/client/src/components/GameWorld.jsx</summary>

</details>
</tool-use>

---



---


Checking the function context:


---

<tool-use data-tool-type="read" data-tool-name="read_file">
<details><summary>Tool use: **read_file** • Read file: /home/robwistrand/code/ga/projects/authentic-internet/client/src/components/GameWorld.jsx</summary>

</details>
</tool-use>

---

<tool-use data-tool-type="read" data-tool-name="read_file">
<details><summary>Tool use: **read_file** • Read file: /home/robwistrand/code/ga/projects/authentic-internet/client/src/components/GameWorld.jsx</summary>

</details>
</tool-use>

---



---


Fixing `artifacts` usage: it's referenced but not defined. Replacing with `gameState.gameData.artifacts` or `artifactsToShow`.


---

<tool-use data-tool-type="read" data-tool-name="read_file">
<details><summary>Tool use: **read_file** • Read file: /home/robwistrand/code/ga/projects/authentic-internet/client/src/components/GameWorld.jsx</summary>

</details>
</tool-use>

---

<tool-use data-tool-type="write" data-tool-name="search_replace">

<details><summary>Tool use: **search_replace** • Edit file: /home/robwistrand/code/ga/projects/authentic-internet/client/src/components/GameWorld.jsx</summary>

**Chunk 1**
Lines added: 8, lines removed: 5

```diff
@@ -2477,17 +2477,20 @@
    const handleArtifactClick = useCallback(
      (artifactId) =&gt; {
-       // Find the clicked artifact
-       const clickedArtifact = artifacts.find(
+       // Find the clicked artifact from game data
+       const clickedArtifact = gameState.gameData.artifacts?.find(
          (artifact) =&gt; artifact.id === artifactId,
        );
        if (!clickedArtifact) return;
  
        // Check if this artifact was already viewed
-       const isFirstView = !viewedArtifacts.includes(artifactId);
+       const isFirstView = !gameState.gameData.viewedArtifacts?.includes(artifactId);
  
        // Update viewed artifacts
        if (isFirstView) {
-         const updatedViewedArtifacts = [...viewedArtifacts, artifactId];
-         setViewedArtifacts(updatedViewedArtifacts);
+         const updatedViewedArtifacts = [
+           ...(gameState.gameData.viewedArtifacts || []),
+           artifactId,
+         ];
+         updateGameState({ viewedArtifacts: updatedViewedArtifacts });
          localStorage.setItem(
            "viewedArtifacts",
```

**Chunk 2**
Lines added: 3, lines removed: 3

```diff
@@ -2515,9 +2518,9 @@
        // Save game state if user is logged in
        if (user &amp;&amp; typeof updateGameProgress === "function") {
-         const gameState = {
+         const gameStateToSave = {
            inventory,
            viewedArtifacts: isFirstView
-             ? [...viewedArtifacts, artifactId]
-             : viewedArtifacts,
+             ? [...(gameState.gameData.viewedArtifacts || []), artifactId]
+             : gameState.gameData.viewedArtifacts,
            lastPosition: {
              x: characterPosition.x,
```

**Chunk 3**
Lines added: 3, lines removed: 3

```diff
@@ -2532,10 +2535,10 @@
          };
  
-         updateGameProgress(gameState);
+         updateGameProgress(gameStateToSave);
        }
      },
      [
-       artifacts,
-       viewedArtifacts,
+       gameState.gameData.artifacts,
+       gameState.gameData.viewedArtifacts,
        user,
        inventory,
```

**Chunk 4**
Lines added: 1, lines removed: undefined

```diff
@@ -2548,4 +2551,5 @@
        validateQuestProgress,
        updateGameProgress,
+       updateGameState,
      ],
    );
```

</details>

</tool-use>

---

<tool-use data-tool-type="search" data-tool-name="grep">
<details>
<summary>Tool use: **grep** • Grep for "setViewedArtifacts|viewedArtifacts" in "/home/robwistrand/code/ga/projects/authentic-internet/client/src/components/GameWorld.jsx" • 10 matches</summary>

Output mode: content


| File | Content | Line |
|------|------|------|
| `client/src/components/GameWorld.jsx` | `viewedArtifacts: gameState.gameData.viewedArtifacts,` | L1860 |
| `client/src/components/GameWorld.jsx` | `!Array.isArray(gameState.gameData.viewedArtifacts) \|\|` | L1953 |
| `client/src/components/GameWorld.jsx` | `!gameState.gameData.viewedArtifacts.includes(artifact.id);` | L1954 |
| `client/src/components/GameWorld.jsx` | `...(Array.isArray(gameState.gameData.viewedArtifacts)` | L1959 |
| `client/src/components/GameWorld.jsx` | `? gameState.gameData.viewedArtifacts` | L1960 |
| `client/src/components/GameWorld.jsx` | `updateGameState(\{ viewedArtifacts: updatedViewedArtifacts \});` | L1964 |
| `client/src/components/GameWorld.jsx` | `"viewedArtifacts",` | L1966 |
| `client/src/components/GameWorld.jsx` | `viewedArtifacts: gameState.gameData.viewedArtifacts,` | L1995 |
| `client/src/components/GameWorld.jsx` | `gameState.gameData.viewedArtifacts,` | L2012 |
| `client/src/components/GameWorld.jsx` | `const isFirstView = !gameState.gameData.viewedArtifacts?.includes(artifactId);` | L2486 |


</details>
</tool-use>

---

<tool-use data-tool-type="generic" data-tool-name="read_lints">
<details>
          <summary>Tool use: **read_lints** • Read lints for 1 file</summary>
      
Lint paths:

- `client/src/components/GameWorld.jsx`

Lint results


**No lint errors found**
</details>
</tool-use>

---



---


Fixed the `artifacts` reference error. The `handleArtifactClick` function was using an undefined `artifacts` variable. Changes:

1. **Changed `artifacts.find()`** to `gameState.gameData.artifacts?.find()` 
2. **Fixed `viewedArtifacts` references** to use `gameState.gameData.viewedArtifacts`
3. **Fixed variable shadowing** - renamed the local `gameState` variable in the save function to `gameStateToSave` to avoid shadowing the outer `gameState` hook
4. **Updated dependency array** to use `gameState.gameData.artifacts` and `gameState.gameData.viewedArtifacts`
5. **Added `updateGameState`** to the dependency array

The error should be resolved. The function now uses the correct artifact data from `gameState`.

---

_**User (2026-01-07 03:53Z)**_

 errorTracker.js:90 [unknown] Unhandled error: Uncaught ReferenceError: isLoggedIn is not defined {source: 'http://localhost:5177/src/components/GameWorld.jsx?t=1767822210565', line: 2031, column: 7} ReferenceError: isLoggedIn is not defined
    at GameWorld.jsx:2750:5
    at renderWithHooks (chunk-NUMECXU6.js?v=c9a7e100:11548:26)
    at updateFunctionComponent (chunk-NUMECXU6.js?v=c9a7e100:14582:28)
    at updateSimpleMemoComponent (chunk-NUMECXU6.js?v=c9a7e100:14463:18)
    at updateMemoComponent (chunk-NUMECXU6.js?v=c9a7e100:14366:22)
    at beginWork (chunk-NUMECXU6.js?v=c9a7e100:15977:22)
    at HTMLUnknownElement.callCallback2 (chunk-NUMECXU6.js?v=c9a7e100:3674:22)
    at Object.invokeGuardedCallbackDev (chunk-NUMECXU6.js?v=c9a7e100:3699:24)
    at invokeGuardedCallback (chunk-NUMECXU6.js?v=c9a7e100:3733:39)
    at beginWork$1 (chunk-NUMECXU6.js?v=c9a7e100:19765:15)
trackError @ errorTracker.js:90
(anonymous) @ errorTracker.js:196
invokeGuardedCallbackDev @ chunk-NUMECXU6.js?v=c9a7e100:3699
invokeGuardedCallback @ chunk-NUMECXU6.js?v=c9a7e100:3733
beginWork$1 @ chunk-NUMECXU6.js?v=c9a7e100:19765
performUnitOfWork @ chunk-NUMECXU6.js?v=c9a7e100:19198
workLoopSync @ chunk-NUMECXU6.js?v=c9a7e100:19137
renderRootSync @ chunk-NUMECXU6.js?v=c9a7e100:19116
performConcurrentWorkOnRoot @ chunk-NUMECXU6.js?v=c9a7e100:18678
workLoop @ chunk-NUMECXU6.js?v=c9a7e100:197
flushWork @ chunk-NUMECXU6.js?v=c9a7e100:176
performWorkUntilDeadline @ chunk-NUMECXU6.js?v=c9a7e100:384
GameWorld.jsx:2750 Uncaught ReferenceError: isLoggedIn is not defined
    at GameWorld.jsx:2750:5
    at renderWithHooks (chunk-NUMECXU6.js?v=c9a7e100:11548:26)
    at updateFunctionComponent (chunk-NUMECXU6.js?v=c9a7e100:14582:28)
    at updateSimpleMemoComponent (chunk-NUMECXU6.js?v=c9a7e100:14463:18)
    at updateMemoComponent (chunk-NUMECXU6.js?v=c9a7e100:14366:22)
    at beginWork (chunk-NUMECXU6.js?v=c9a7e100:15977:22)
    at HTMLUnknownElement.callCallback2 (chunk-NUMECXU6.js?v=c9a7e100:3674:22)
    at Object.invokeGuardedCallbackDev (chunk-NUMECXU6.js?v=c9a7e100:3699:24)
    at invokeGuardedCallback (chunk-NUMECXU6.js?v=c9a7e100:3733:39)
    at beginWork$1 (chunk-NUMECXU6.js?v=c9a7e100:19765:15)
(anonymous) @ GameWorld.jsx:2750
renderWithHooks @ chunk-NUMECXU6.js?v=c9a7e100:11548
updateFunctionComponent @ chunk-NUMECXU6.js?v=c9a7e100:14582
updateSimpleMemoComponent @ chunk-NUMECXU6.js?v=c9a7e100:14463
updateMemoComponent @ chunk-NUMECXU6.js?v=c9a7e100:14366
beginWork @ chunk-NUMECXU6.js?v=c9a7e100:15977
callCallback2 @ chunk-NUMECXU6.js?v=c9a7e100:3674
invokeGuardedCallbackDev @ chunk-NUMECXU6.js?v=c9a7e100:3699
invokeGuardedCallback @ chunk-NUMECXU6.js?v=c9a7e100:3733
beginWork$1 @ chunk-NUMECXU6.js?v=c9a7e100:19765
performUnitOfWork @ chunk-NUMECXU6.js?v=c9a7e100:19198
workLoopSync @ chunk-NUMECXU6.js?v=c9a7e100:19137
renderRootSync @ chunk-NUMECXU6.js?v=c9a7e100:19116
performConcurrentWorkOnRoot @ chunk-NUMECXU6.js?v=c9a7e100:18678
workLoop @ chunk-NUMECXU6.js?v=c9a7e100:197
flushWork @ chunk-NUMECXU6.js?v=c9a7e100:176
performWorkUntilDeadline @ chunk-NUMECXU6.js?v=c9a7e100:384
errorTracker.js:90 [unknown] Unhandled error: Uncaught ReferenceError: isLoggedIn is not defined {source: 'http://localhost:5177/src/components/GameWorld.jsx?t=1767822210565', line: 2031, column: 7} ReferenceError: isLoggedIn is not defined
    at GameWorld.jsx:2750:5
    at renderWithHooks (chunk-NUMECXU6.js?v=c9a7e100:11548:26)
    at updateFunctionComponent (chunk-NUMECXU6.js?v=c9a7e100:14582:28)
    at updateSimpleMemoComponent (chunk-NUMECXU6.js?v=c9a7e100:14463:18)
    at updateMemoComponent (chunk-NUMECXU6.js?v=c9a7e100:14366:22)
    at beginWork (chunk-NUMECXU6.js?v=c9a7e100:15977:22)
    at HTMLUnknownElement.callCallback2 (chunk-NUMECXU6.js?v=c9a7e100:3674:22)
    at Object.invokeGuardedCallbackDev (chunk-NUMECXU6.js?v=c9a7e100:3699:24)
    at invokeGuardedCallback (chunk-NUMECXU6.js?v=c9a7e100:3733:39)
    at beginWork$1 (chunk-NUMECXU6.js?v=c9a7e100:19765:15)
trackError @ errorTracker.js:90
(anonymous) @ errorTracker.js:196
invokeGuardedCallbackDev @ chunk-NUMECXU6.js?v=c9a7e100:3699
invokeGuardedCallback @ chunk-NUMECXU6.js?v=c9a7e100:3733
beginWork$1 @ chunk-NUMECXU6.js?v=c9a7e100:19765
performUnitOfWork @ chunk-NUMECXU6.js?v=c9a7e100:19198
workLoopSync @ chunk-NUMECXU6.js?v=c9a7e100:19137
renderRootSync @ chunk-NUMECXU6.js?v=c9a7e100:19116
recoverFromConcurrentError @ chunk-NUMECXU6.js?v=c9a7e100:18736
performConcurrentWorkOnRoot @ chunk-NUMECXU6.js?v=c9a7e100:18684
workLoop @ chunk-NUMECXU6.js?v=c9a7e100:197
flushWork @ chunk-NUMECXU6.js?v=c9a7e100:176
performWorkUntilDeadline @ chunk-NUMECXU6.js?v=c9a7e100:384
GameWorld.jsx:2750 Uncaught ReferenceError: isLoggedIn is not defined
    at GameWorld.jsx:2750:5
    at renderWithHooks (chunk-NUMECXU6.js?v=c9a7e100:11548:26)
    at updateFunctionComponent (chunk-NUMECXU6.js?v=c9a7e100:14582:28)
    at updateSimpleMemoComponent (chunk-NUMECXU6.js?v=c9a7e100:14463:18)
    at updateMemoComponent (chunk-NUMECXU6.js?v=c9a7e100:14366:22)
    at beginWork (chunk-NUMECXU6.js?v=c9a7e100:15977:22)
    at HTMLUnknownElement.callCallback2 (chunk-NUMECXU6.js?v=c9a7e100:3674:22)
    at Object.invokeGuardedCallbackDev (chunk-NUMECXU6.js?v=c9a7e100:3699:24)
    at invokeGuardedCallback (chunk-NUMECXU6.js?v=c9a7e100:3733:39)
    at beginWork$1 (chunk-NUMECXU6.js?v=c9a7e100:19765:15)
(anonymous) @ GameWorld.jsx:2750
renderWithHooks @ chunk-NUMECXU6.js?v=c9a7e100:11548
updateFunctionComponent @ chunk-NUMECXU6.js?v=c9a7e100:14582
updateSimpleMemoComponent @ chunk-NUMECXU6.js?v=c9a7e100:14463
updateMemoComponent @ chunk-NUMECXU6.js?v=c9a7e100:14366
beginWork @ chunk-NUMECXU6.js?v=c9a7e100:15977
callCallback2 @ chunk-NUMECXU6.js?v=c9a7e100:3674
invokeGuardedCallbackDev @ chunk-NUMECXU6.js?v=c9a7e100:3699
invokeGuardedCallback @ chunk-NUMECXU6.js?v=c9a7e100:3733
beginWork$1 @ chunk-NUMECXU6.js?v=c9a7e100:19765
performUnitOfWork @ chunk-NUMECXU6.js?v=c9a7e100:19198
workLoopSync @ chunk-NUMECXU6.js?v=c9a7e100:19137
renderRootSync @ chunk-NUMECXU6.js?v=c9a7e100:19116
recoverFromConcurrentError @ chunk-NUMECXU6.js?v=c9a7e100:18736
performConcurrentWorkOnRoot @ chunk-NUMECXU6.js?v=c9a7e100:18684
workLoop @ chunk-NUMECXU6.js?v=c9a7e100:197
flushWork @ chunk-NUMECXU6.js?v=c9a7e100:176
performWorkUntilDeadline @ chunk-NUMECXU6.js?v=c9a7e100:384
chunk-NUMECXU6.js?v=c9a7e100:14032 The above error occurred in the <GameWorld> component:

    at http://localhost:5177/src/components/GameWorld.jsx?t=1767822210565:97:45
    at ErrorBoundary (http://localhost:5177/src/components/ErrorBoundary.jsx:8:5)
    at Suspense
    at RenderedRoute (http://localhost:5177/node_modules/.vite/deps/react-router-dom.js?v=ce3ce900:4089:5)
    at Routes (http://localhost:5177/node_modules/.vite/deps/react-router-dom.js?v=ce3ce900:4559:5)
    at main
    at AchievementProvider (http://localhost:5177/src/context/AchievementContext.jsx:89:39)
    at div
    at App (http://localhost:5177/src/App.jsx?t=1767822210565:45:3)
    at ErrorBoundary (http://localhost:5177/src/components/ErrorBoundary.jsx:8:5)
    at GameStateProvider (http://localhost:5177/src/context/GameStateContext.jsx:98:37)
    at WebSocketProvider (http://localhost:5177/src/context/WebSocketContext.jsx:28:37)
    at AuthProvider (http://localhost:5177/src/context/AuthContext.jsx:227:32)
    at Router (http://localhost:5177/node_modules/.vite/deps/react-router-dom.js?v=ce3ce900:4502:15)
    at BrowserRouter (http://localhost:5177/node_modules/.vite/deps/react-router-dom.js?v=ce3ce900:5248:5)

React will try to recreate this component tree from scratch using the error boundary you provided, ErrorBoundary.
logCapturedError @ chunk-NUMECXU6.js?v=c9a7e100:14032
callback @ chunk-NUMECXU6.js?v=c9a7e100:14078
callCallback @ chunk-NUMECXU6.js?v=c9a7e100:11248
commitUpdateQueue @ chunk-NUMECXU6.js?v=c9a7e100:11265
commitLayoutEffectOnFiber @ chunk-NUMECXU6.js?v=c9a7e100:17075
commitLayoutMountEffects_complete @ chunk-NUMECXU6.js?v=c9a7e100:17980
commitLayoutEffects_begin @ chunk-NUMECXU6.js?v=c9a7e100:17969
commitLayoutEffects_begin @ chunk-NUMECXU6.js?v=c9a7e100:17950
commitLayoutEffects @ chunk-NUMECXU6.js?v=c9a7e100:17920
commitRootImpl @ chunk-NUMECXU6.js?v=c9a7e100:19353
commitRoot @ chunk-NUMECXU6.js?v=c9a7e100:19277
finishConcurrentRender @ chunk-NUMECXU6.js?v=c9a7e100:18760
performConcurrentWorkOnRoot @ chunk-NUMECXU6.js?v=c9a7e100:18718
workLoop @ chunk-NUMECXU6.js?v=c9a7e100:197
flushWork @ chunk-NUMECXU6.js?v=c9a7e100:176
performWorkUntilDeadline @ chunk-NUMECXU6.js?v=c9a7e100:384
ErrorBoundary.jsx:31 Error caught by boundary: ReferenceError: isLoggedIn is not defined
    at GameWorld.jsx:2750:5
    at renderWithHooks (chunk-NUMECXU6.js?v=c9a7e100:11548:26)
    at updateFunctionComponent (chunk-NUMECXU6.js?v=c9a7e100:14582:28)
    at updateSimpleMemoComponent (chunk-NUMECXU6.js?v=c9a7e100:14463:18)
    at updateMemoComponent (chunk-NUMECXU6.js?v=c9a7e100:14366:22)
    at beginWork (chunk-NUMECXU6.js?v=c9a7e100:15977:22)
    at beginWork$1 (chunk-NUMECXU6.js?v=c9a7e100:19753:22)
    at performUnitOfWork (chunk-NUMECXU6.js?v=c9a7e100:19198:20)
    at workLoopSync (chunk-NUMECXU6.js?v=c9a7e100:19137:13)
    at renderRootSync (chunk-NUMECXU6.js?v=c9a7e100:19116:15) {componentStack: '\n    at http://localhost:5177/src/components/GameW….vite/deps/react-router-dom.js?v=ce3ce900:5248:5)'}
componentDidCatch @ ErrorBoundary.jsx:31
callback @ chunk-NUMECXU6.js?v=c9a7e100:14084
callCallback @ chunk-NUMECXU6.js?v=c9a7e100:11248
commitUpdateQueue @ chunk-NUMECXU6.js?v=c9a7e100:11265
commitLayoutEffectOnFiber @ chunk-NUMECXU6.js?v=c9a7e100:17075
commitLayoutMountEffects_complete @ chunk-NUMECXU6.js?v=c9a7e100:17980
commitLayoutEffects_begin @ chunk-NUMECXU6.js?v=c9a7e100:17969
commitLayoutEffects_begin @ chunk-NUMECXU6.js?v=c9a7e100:17950
commitLayoutEffects @ chunk-NUMECXU6.js?v=c9a7e100:17920
commitRootImpl @ chunk-NUMECXU6.js?v=c9a7e100:19353
commitRoot @ chunk-NUMECXU6.js?v=c9a7e100:19277
finishConcurrentRender @ chunk-NUMECXU6.js?v=c9a7e100:18760
performConcurrentWorkOnRoot @ chunk-NUMECXU6.js?v=c9a7e100:18718
workLoop @ chunk-NUMECXU6.js?v=c9a7e100:197
flushWork @ chunk-NUMECXU6.js?v=c9a7e100:176
performWorkUntilDeadline @ chunk-NUMECXU6.js?v=c9a7e100:384
errorTracker.js:138  POST http://localhost:5177/api/diagnostics/errors net::ERR_ABORTED 500 (Internal Server Error)
reportErrorToServer @ errorTracker.js:138
trackError @ errorTracker.js:106
(anonymous) @ errorTracker.js:196
invokeGuardedCallbackDev @ chunk-NUMECXU6.js?v=c9a7e100:3699
invokeGuardedCallback @ chunk-NUMECXU6.js?v=c9a7e100:3733
beginWork$1 @ chunk-NUMECXU6.js?v=c9a7e100:19765
performUnitOfWork @ chunk-NUMECXU6.js?v=c9a7e100:19198
workLoopSync @ chunk-NUMECXU6.js?v=c9a7e100:19137
renderRootSync @ chunk-NUMECXU6.js?v=c9a7e100:19116
performConcurrentWorkOnRoot @ chunk-NUMECXU6.js?v=c9a7e100:18678
workLoop @ chunk-NUMECXU6.js?v=c9a7e100:197
flushWork @ chunk-NUMECXU6.js?v=c9a7e100:176
performWorkUntilDeadline @ chunk-NUMECXU6.js?v=c9a7e100:384
errorTracker.js:152 Error reporting to server: Error: Server returned 500: Internal Server Error
    at reportErrorToServer (errorTracker.js:145:13)
reportErrorToServer @ errorTracker.js:152
await in reportErrorToServer
trackError @ errorTracker.js:106
(anonymous) @ errorTracker.js:196
invokeGuardedCallbackDev @ chunk-NUMECXU6.js?v=c9a7e100:3699
invokeGuardedCallback @ chunk-NUMECXU6.js?v=c9a7e100:3733
beginWork$1 @ chunk-NUMECXU6.js?v=c9a7e100:19765
performUnitOfWork @ chunk-NUMECXU6.js?v=c9a7e100:19198
workLoopSync @ chunk-NUMECXU6.js?v=c9a7e100:19137
renderRootSync @ chunk-NUMECXU6.js?v=c9a7e100:19116
performConcurrentWorkOnRoot @ chunk-NUMECXU6.js?v=c9a7e100:18678
workLoop @ chunk-NUMECXU6.js?v=c9a7e100:197
flushWork @ chunk-NUMECXU6.js?v=c9a7e100:176
performWorkUntilDeadline @ chunk-NUMECXU6.js?v=c9a7e100:384
errorTracker.js:113 Failed to report critical error to server: Error: Server returned 500: Internal Server Error
    at reportErrorToServer (errorTracker.js:145:13)
(anonymous) @ errorTracker.js:113
Promise.catch
trackError @ errorTracker.js:106
(anonymous) @ errorTracker.js:196
invokeGuardedCallbackDev @ chunk-NUMECXU6.js?v=c9a7e100:3699
invokeGuardedCallback @ chunk-NUMECXU6.js?v=c9a7e100:3733
beginWork$1 @ chunk-NUMECXU6.js?v=c9a7e100:19765
performUnitOfWork @ chunk-NUMECXU6.js?v=c9a7e100:19198
workLoopSync @ chunk-NUMECXU6.js?v=c9a7e100:19137
renderRootSync @ chunk-NUMECXU6.js?v=c9a7e100:19116
performConcurrentWorkOnRoot @ chunk-NUMECXU6.js?v=c9a7e100:18678
workLoop @ chunk-NUMECXU6.js?v=c9a7e100:197
flushWork @ chunk-NUMECXU6.js?v=c9a7e100:176
performWorkUntilDeadline @ chunk-NUMECXU6.js?v=c9a7e100:384
errorTracker.js:138  POST http://localhost:5177/api/diagnostics/errors net::ERR_ABORTED 500 (Internal Server Error)
reportErrorToServer @ errorTracker.js:138
trackError @ errorTracker.js:106
(anonymous) @ errorTracker.js:196
invokeGuardedCallbackDev @ chunk-NUMECXU6.js?v=c9a7e100:3699
invokeGuardedCallback @ chunk-NUMECXU6.js?v=c9a7e100:3733
beginWork$1 @ chunk-NUMECXU6.js?v=c9a7e100:19765
performUnitOfWork @ chunk-NUMECXU6.js?v=c9a7e100:19198
workLoopSync @ chunk-NUMECXU6.js?v=c9a7e100:19137
renderRootSync @ chunk-NUMECXU6.js?v=c9a7e100:19116
recoverFromConcurrentError @ chunk-NUMECXU6.js?v=c9a7e100:18736
performConcurrentWorkOnRoot @ chunk-NUMECXU6.js?v=c9a7e100:18684
workLoop @ chunk-NUMECXU6.js?v=c9a7e100:197
flushWork @ chunk-NUMECXU6.js?v=c9a7e100:176
performWorkUntilDeadline @ chunk-NUMECXU6.js?v=c9a7e100:384
errorTracker.js:152 Error reporting to server: Error: Server returned 500: Internal Server Error
    at reportErrorToServer (errorTracker.js:145:13)
reportErrorToServer @ errorTracker.js:152
await in reportErrorToServer
trackError @ errorTracker.js:106
(anonymous) @ errorTracker.js:196
invokeGuardedCallbackDev @ chunk-NUMECXU6.js?v=c9a7e100:3699
invokeGuardedCallback @ chunk-NUMECXU6.js?v=c9a7e100:3733
beginWork$1 @ chunk-NUMECXU6.js?v=c9a7e100:19765
performUnitOfWork @ chunk-NUMECXU6.js?v=c9a7e100:19198
workLoopSync @ chunk-NUMECXU6.js?v=c9a7e100:19137
renderRootSync @ chunk-NUMECXU6.js?v=c9a7e100:19116
recoverFromConcurrentError @ chunk-NUMECXU6.js?v=c9a7e100:18736
performConcurrentWorkOnRoot @ chunk-NUMECXU6.js?v=c9a7e100:18684
workLoop @ chunk-NUMECXU6.js?v=c9a7e100:197
flushWork @ chunk-NUMECXU6.js?v=c9a7e100:176
performWorkUntilDeadline @ chunk-NUMECXU6.js?v=c9a7e100:384
errorTracker.js:113 Failed to report critical error to server: Error: Server returned 500: Internal Server Error
    at reportErrorToServer (errorTracker.js:145:13)
(anonymous) @ errorTracker.js:113
Promise.catch
trackError @ errorTracker.js:106
(anonymous) @ errorTracker.js:196
invokeGuardedCallbackDev @ chunk-NUMECXU6.js?v=c9a7e100:3699
invokeGuardedCallback @ chunk-NUMECXU6.js?v=c9a7e100:3733
beginWork$1 @ chunk-NUMECXU6.js?v=c9a7e100:19765
performUnitOfWork @ chunk-NUMECXU6.js?v=c9a7e100:19198
workLoopSync @ chunk-NUMECXU6.js?v=c9a7e100:19137
renderRootSync @ chunk-NUMECXU6.js?v=c9a7e100:19116
recoverFromConcurrentError @ chunk-NUMECXU6.js?v=c9a7e100:18736
performConcurrentWorkOnRoot @ chunk-NUMECXU6.js?v=c9a7e100:18684
workLoop @ chunk-NUMECXU6.js?v=c9a7e100:197
flushWork @ chunk-NUMECXU6.js?v=c9a7e100:176
performWorkUntilDeadline @ chunk-NUMECXU6.js?v=c9a7e100:384


---

_**Agent (model default, mode Agent)**_



---


Checking line 2750 for the `isLoggedIn` reference error:


---

<tool-use data-tool-type="read" data-tool-name="read_file">
<details><summary>Tool use: **read_file** • Read file: /home/robwistrand/code/ga/projects/authentic-internet/client/src/components/GameWorld.jsx</summary>

</details>
</tool-use>

---

<tool-use data-tool-type="search" data-tool-name="grep">
<details>
<summary>Tool use: **grep** • Grep for "\bisLoggedIn\b" in "/home/robwistrand/code/ga/projects/authentic-internet/client/src/components/GameWorld.jsx" • 4 matches</summary>

Output mode: content


| File | Content | Line |
|------|------|------|
| `client/src/components/GameWorld.jsx` | `if (gameState.isLoggedIn && gameState.character?.id) \{` | L2729 |
| `client/src/components/GameWorld.jsx` | `isLoggedIn,` | L2750 |
| `client/src/components/GameWorld.jsx` | `isLoggedIn=\{gameState.isLoggedIn\}` | L2889 |
| `client/src/components/GameWorld.jsx` | `isLoggedIn=\{gameState.isLoggedIn\}` | L2998 |


</details>
</tool-use>

---

<tool-use data-tool-type="read" data-tool-name="read_file">
<details><summary>Tool use: **read_file** • Read file: /home/robwistrand/code/ga/projects/authentic-internet/client/src/components/GameWorld.jsx</summary>

</details>
</tool-use>

---



---


Checking the function context and fixing the `isLoggedIn` reference:


---

<tool-use data-tool-type="read" data-tool-name="read_file">
<details><summary>Tool use: **read_file** • Read file: /home/robwistrand/code/ga/projects/authentic-internet/client/src/components/GameWorld.jsx</summary>

</details>
</tool-use>

---

<tool-use data-tool-type="write" data-tool-name="search_replace">

<details><summary>Tool use: **search_replace** • Edit file: /home/robwistrand/code/ga/projects/authentic-internet/client/src/components/GameWorld.jsx</summary>

**Chunk 1**
Lines added: 1, lines removed: undefined

```diff
@@ -106,4 +106,5 @@
      mobileState,
      portalState,
+     isLoggedIn,
      // Setters
      setCurrentMapIndex,
```

</details>

</tool-use>

---

<tool-use data-tool-type="write" data-tool-name="search_replace">

<details><summary>Tool use: **search_replace** • Edit file: /home/robwistrand/code/ga/projects/authentic-internet/client/src/components/GameWorld.jsx</summary>

**Chunk 1**
Lines added: 1, lines removed: 1

```diff
@@ -2728,5 +2728,5 @@
    // Update the saveGameProgress method to use context
    const saveGameProgressWithContext = useCallback(() =&gt; {
-     if (gameState.isLoggedIn &amp;&amp; gameState.character?.id) {
+     if (isLoggedIn &amp;&amp; character?.id) {
        const gameState = {
          experience: character.experience || 0,
```

</details>

</tool-use>

---

<tool-use data-tool-type="write" data-tool-name="search_replace">

<details><summary>Tool use: **search_replace** • Edit file: /home/robwistrand/code/ga/projects/authentic-internet/client/src/components/GameWorld.jsx</summary>

**Chunk 1**
Lines added: 1, lines removed: 1

```diff
@@ -2888,5 +2888,5 @@
              characterState={gameState.characterState}
              direction={gameState.characterState.direction}
-             isLoggedIn={gameState.isLoggedIn}
+             isLoggedIn={isLoggedIn}
              character={gameState.character}
              soundManager={gameState.soundManager}
```

**Chunk 2**
Lines added: 1, lines removed: 1

```diff
@@ -2997,5 +2997,5 @@
                  currentMapIndex={currentMapIndex}
                  setCurrentMapIndex={setCurrentMapIndex}
-                 isLoggedIn={gameState.isLoggedIn}
+                 isLoggedIn={isLoggedIn}
                  visibleArtifact={visibleArtifact}
                  handleArtifactPickup={handleArtifactPickup}
```

</details>

</tool-use>

---

<tool-use data-tool-type="generic" data-tool-name="read_lints">
<details>
          <summary>Tool use: **read_lints** • Read lints for 1 file</summary>
      
Lint paths:

- `client/src/components/GameWorld.jsx`

Lint results


**No lint errors found**
</details>
</tool-use>

---



---


Fixing variable shadowing in `saveGameProgressWithContext`:


---

<tool-use data-tool-type="write" data-tool-name="search_replace">

<details><summary>Tool use: **search_replace** • Edit file: /home/robwistrand/code/ga/projects/authentic-internet/client/src/components/GameWorld.jsx</summary>

**Chunk 1**
Lines added: 1, lines removed: 1

```diff
@@ -2729,5 +2729,5 @@
    const saveGameProgressWithContext = useCallback(() =&gt; {
      if (isLoggedIn &amp;&amp; character?.id) {
-       const gameState = {
+       const gameStateToSave = {
          experience: character.experience || 0,
          avatar: character.avatar,
```

**Chunk 2**
Lines added: 1, lines removed: 1

```diff
@@ -2746,5 +2746,5 @@
        };
  
-       updateGameProgress(gameState);
+       updateGameProgress(gameStateToSave);
      }
    }, [
```

</details>

</tool-use>

---

<tool-use data-tool-type="generic" data-tool-name="read_lints">
<details>
          <summary>Tool use: **read_lints** • Read lints for 1 file</summary>
      
Lint paths:

- `client/src/components/GameWorld.jsx`

Lint results


**No lint errors found**
</details>
</tool-use>

---



---


Fixed the `isLoggedIn` reference error:

1. **Added `isLoggedIn` to destructuring** - Now destructured from `gameState` along with other state values
2. **Updated references** - Changed `gameState.isLoggedIn` to `isLoggedIn` throughout the component
3. **Fixed variable shadowing** - Renamed the local `gameState` variable in `saveGameProgressWithContext` to `gameStateToSave` to avoid shadowing the outer `gameState` hook

The error should be resolved. The component now uses the destructured `isLoggedIn` variable consistently.

---

_**User (2026-01-07 03:53Z)**_

GameWorld.jsx:2875 Warning: Failed prop type: The prop `mapData` is marked as required in `Map`, but its value is `undefined`.
    at Map (http://localhost:5177/src/components/Map.jsx:31:3)
    at http://localhost:5177/src/components/GameWorld.jsx?t=1767887161577:97:45
    at ErrorBoundary (http://localhost:5177/src/components/ErrorBoundary.jsx:8:5)
    at Suspense
    at RenderedRoute (http://localhost:5177/node_modules/.vite/deps/react-router-dom.js?v=ce3ce900:4089:5)
    at Routes (http://localhost:5177/node_modules/.vite/deps/react-router-dom.js?v=ce3ce900:4559:5)
    at main
    at AchievementProvider (http://localhost:5177/src/context/AchievementContext.jsx:89:39)
    at div
    at App (http://localhost:5177/src/App.jsx?t=1767887161577:45:3)
    at ErrorBoundary (http://localhost:5177/src/components/ErrorBoundary.jsx:8:5)
    at GameStateProvider (http://localhost:5177/src/context/GameStateContext.jsx:98:37)
    at WebSocketProvider (http://localhost:5177/src/context/WebSocketContext.jsx:28:37)
    at AuthProvider (http://localhost:5177/src/context/AuthContext.jsx:227:32)
    at Router (http://localhost:5177/node_modules/.vite/deps/react-router-dom.js?v=ce3ce900:4502:15)
    at BrowserRouter (http://localhost:5177/node_modules/.vite/deps/react-router-dom.js?v=ce3ce900:5248:5)
printWarning @ react_jsx-dev-runtime.js?v=ce3ce900:64
error @ react_jsx-dev-runtime.js?v=ce3ce900:48
checkPropTypes @ react_jsx-dev-runtime.js?v=ce3ce900:451
validatePropTypes @ react_jsx-dev-runtime.js?v=ce3ce900:778
jsxWithValidation @ react_jsx-dev-runtime.js?v=ce3ce900:876
(anonymous) @ GameWorld.jsx:2875
renderWithHooks @ chunk-NUMECXU6.js?v=c9a7e100:11548
updateFunctionComponent @ chunk-NUMECXU6.js?v=c9a7e100:14582
updateSimpleMemoComponent @ chunk-NUMECXU6.js?v=c9a7e100:14463
beginWork @ chunk-NUMECXU6.js?v=c9a7e100:15980
beginWork$1 @ chunk-NUMECXU6.js?v=c9a7e100:19753
performUnitOfWork @ chunk-NUMECXU6.js?v=c9a7e100:19198
workLoopSync @ chunk-NUMECXU6.js?v=c9a7e100:19137
renderRootSync @ chunk-NUMECXU6.js?v=c9a7e100:19116
performConcurrentWorkOnRoot @ chunk-NUMECXU6.js?v=c9a7e100:18678
workLoop @ chunk-NUMECXU6.js?v=c9a7e100:197
flushWork @ chunk-NUMECXU6.js?v=c9a7e100:176
performWorkUntilDeadline @ chunk-NUMECXU6.js?v=c9a7e100:384
GameWorld.jsx:2885 Warning: Failed prop type: The prop `x` is marked as required in `Character`, but its value is `undefined`.
    at Character (http://localhost:5177/src/components/Character.jsx:23:3)
    at http://localhost:5177/src/components/GameWorld.jsx?t=1767887161577:97:45
    at ErrorBoundary (http://localhost:5177/src/components/ErrorBoundary.jsx:8:5)
    at Suspense
    at RenderedRoute (http://localhost:5177/node_modules/.vite/deps/react-router-dom.js?v=ce3ce900:4089:5)
    at Routes (http://localhost:5177/node_modules/.vite/deps/react-router-dom.js?v=ce3ce900:4559:5)
    at main
    at AchievementProvider (http://localhost:5177/src/context/AchievementContext.jsx:89:39)
    at div
    at App (http://localhost:5177/src/App.jsx?t=1767887161577:45:3)
    at ErrorBoundary (http://localhost:5177/src/components/ErrorBoundary.jsx:8:5)
    at GameStateProvider (http://localhost:5177/src/context/GameStateContext.jsx:98:37)
    at WebSocketProvider (http://localhost:5177/src/context/WebSocketContext.jsx:28:37)
    at AuthProvider (http://localhost:5177/src/context/AuthContext.jsx:227:32)
    at Router (http://localhost:5177/node_modules/.vite/deps/react-router-dom.js?v=ce3ce900:4502:15)
    at BrowserRouter (http://localhost:5177/node_modules/.vite/deps/react-router-dom.js?v=ce3ce900:5248:5)
printWarning @ react_jsx-dev-runtime.js?v=ce3ce900:64
error @ react_jsx-dev-runtime.js?v=ce3ce900:48
checkPropTypes @ react_jsx-dev-runtime.js?v=ce3ce900:451
validatePropTypes @ react_jsx-dev-runtime.js?v=ce3ce900:778
jsxWithValidation @ react_jsx-dev-runtime.js?v=ce3ce900:876
(anonymous) @ GameWorld.jsx:2885
renderWithHooks @ chunk-NUMECXU6.js?v=c9a7e100:11548
updateFunctionComponent @ chunk-NUMECXU6.js?v=c9a7e100:14582
updateSimpleMemoComponent @ chunk-NUMECXU6.js?v=c9a7e100:14463
beginWork @ chunk-NUMECXU6.js?v=c9a7e100:15980
beginWork$1 @ chunk-NUMECXU6.js?v=c9a7e100:19753
performUnitOfWork @ chunk-NUMECXU6.js?v=c9a7e100:19198
workLoopSync @ chunk-NUMECXU6.js?v=c9a7e100:19137
renderRootSync @ chunk-NUMECXU6.js?v=c9a7e100:19116
performConcurrentWorkOnRoot @ chunk-NUMECXU6.js?v=c9a7e100:18678
workLoop @ chunk-NUMECXU6.js?v=c9a7e100:197
flushWork @ chunk-NUMECXU6.js?v=c9a7e100:176
performWorkUntilDeadline @ chunk-NUMECXU6.js?v=c9a7e100:384
GameWorld.jsx:2885 Warning: Failed prop type: The prop `y` is marked as required in `Character`, but its value is `undefined`.
    at Character (http://localhost:5177/src/components/Character.jsx:23:3)
    at http://localhost:5177/src/components/GameWorld.jsx?t=1767887161577:97:45
    at ErrorBoundary (http://localhost:5177/src/components/ErrorBoundary.jsx:8:5)
    at Suspense
    at RenderedRoute (http://localhost:5177/node_modules/.vite/deps/react-router-dom.js?v=ce3ce900:4089:5)
    at Routes (http://localhost:5177/node_modules/.vite/deps/react-router-dom.js?v=ce3ce900:4559:5)
    at main
    at AchievementProvider (http://localhost:5177/src/context/AchievementContext.jsx:89:39)
    at div
    at App (http://localhost:5177/src/App.jsx?t=1767887161577:45:3)
    at ErrorBoundary (http://localhost:5177/src/components/ErrorBoundary.jsx:8:5)
    at GameStateProvider (http://localhost:5177/src/context/GameStateContext.jsx:98:37)
    at WebSocketProvider (http://localhost:5177/src/context/WebSocketContext.jsx:28:37)
    at AuthProvider (http://localhost:5177/src/context/AuthContext.jsx:227:32)
    at Router (http://localhost:5177/node_modules/.vite/deps/react-router-dom.js?v=ce3ce900:4502:15)
    at BrowserRouter (http://localhost:5177/node_modules/.vite/deps/react-router-dom.js?v=ce3ce900:5248:5)
printWarning @ react_jsx-dev-runtime.js?v=ce3ce900:64
error @ react_jsx-dev-runtime.js?v=ce3ce900:48
checkPropTypes @ react_jsx-dev-runtime.js?v=ce3ce900:451
validatePropTypes @ react_jsx-dev-runtime.js?v=ce3ce900:778
jsxWithValidation @ react_jsx-dev-runtime.js?v=ce3ce900:876
(anonymous) @ GameWorld.jsx:2885
renderWithHooks @ chunk-NUMECXU6.js?v=c9a7e100:11548
updateFunctionComponent @ chunk-NUMECXU6.js?v=c9a7e100:14582
updateSimpleMemoComponent @ chunk-NUMECXU6.js?v=c9a7e100:14463
beginWork @ chunk-NUMECXU6.js?v=c9a7e100:15980
beginWork$1 @ chunk-NUMECXU6.js?v=c9a7e100:19753
performUnitOfWork @ chunk-NUMECXU6.js?v=c9a7e100:19198
workLoopSync @ chunk-NUMECXU6.js?v=c9a7e100:19137
renderRootSync @ chunk-NUMECXU6.js?v=c9a7e100:19116
performConcurrentWorkOnRoot @ chunk-NUMECXU6.js?v=c9a7e100:18678
workLoop @ chunk-NUMECXU6.js?v=c9a7e100:197
flushWork @ chunk-NUMECXU6.js?v=c9a7e100:176
performWorkUntilDeadline @ chunk-NUMECXU6.js?v=c9a7e100:384
GameWorld.jsx:2917 Warning: Failed prop type: Invalid prop `exploredTiles` of type `Function` supplied to `Minimap`, expected instance of `Set`.
    at Minimap (http://localhost:5177/src/components/UI/Minimap.jsx:22:3)
    at http://localhost:5177/src/components/GameWorld.jsx?t=1767887161577:97:45
    at ErrorBoundary (http://localhost:5177/src/components/ErrorBoundary.jsx:8:5)
    at Suspense
    at RenderedRoute (http://localhost:5177/node_modules/.vite/deps/react-router-dom.js?v=ce3ce900:4089:5)
    at Routes (http://localhost:5177/node_modules/.vite/deps/react-router-dom.js?v=ce3ce900:4559:5)
    at main
    at AchievementProvider (http://localhost:5177/src/context/AchievementContext.jsx:89:39)
    at div
    at App (http://localhost:5177/src/App.jsx?t=1767887161577:45:3)
    at ErrorBoundary (http://localhost:5177/src/components/ErrorBoundary.jsx:8:5)
    at GameStateProvider (http://localhost:5177/src/context/GameStateContext.jsx:98:37)
    at WebSocketProvider (http://localhost:5177/src/context/WebSocketContext.jsx:28:37)
    at AuthProvider (http://localhost:5177/src/context/AuthContext.jsx:227:32)
    at Router (http://localhost:5177/node_modules/.vite/deps/react-router-dom.js?v=ce3ce900:4502:15)
    at BrowserRouter (http://localhost:5177/node_modules/.vite/deps/react-router-dom.js?v=ce3ce900:5248:5)
printWarning @ react_jsx-dev-runtime.js?v=ce3ce900:64
error @ react_jsx-dev-runtime.js?v=ce3ce900:48
checkPropTypes @ react_jsx-dev-runtime.js?v=ce3ce900:451
validatePropTypes @ react_jsx-dev-runtime.js?v=ce3ce900:778
jsxWithValidation @ react_jsx-dev-runtime.js?v=ce3ce900:876
(anonymous) @ GameWorld.jsx:2917
renderWithHooks @ chunk-NUMECXU6.js?v=c9a7e100:11548
updateFunctionComponent @ chunk-NUMECXU6.js?v=c9a7e100:14582
updateSimpleMemoComponent @ chunk-NUMECXU6.js?v=c9a7e100:14463
beginWork @ chunk-NUMECXU6.js?v=c9a7e100:15980
beginWork$1 @ chunk-NUMECXU6.js?v=c9a7e100:19753
performUnitOfWork @ chunk-NUMECXU6.js?v=c9a7e100:19198
workLoopSync @ chunk-NUMECXU6.js?v=c9a7e100:19137
renderRootSync @ chunk-NUMECXU6.js?v=c9a7e100:19116
performConcurrentWorkOnRoot @ chunk-NUMECXU6.js?v=c9a7e100:18678
workLoop @ chunk-NUMECXU6.js?v=c9a7e100:197
flushWork @ chunk-NUMECXU6.js?v=c9a7e100:176
performWorkUntilDeadline @ chunk-NUMECXU6.js?v=c9a7e100:384
GameWorld.jsx:2976 Warning: Failed prop type: Function has non-object prototype 'undefined' in instanceof check
    at Map (http://localhost:5177/src/components/Map.jsx:31:3)
    at http://localhost:5177/src/components/GameWorld.jsx?t=1767887161577:97:45
    at ErrorBoundary (http://localhost:5177/src/components/ErrorBoundary.jsx:8:5)
    at Suspense
    at RenderedRoute (http://localhost:5177/node_modules/.vite/deps/react-router-dom.js?v=ce3ce900:4089:5)
    at Routes (http://localhost:5177/node_modules/.vite/deps/react-router-dom.js?v=ce3ce900:4559:5)
    at main
    at AchievementProvider (http://localhost:5177/src/context/AchievementContext.jsx:89:39)
    at div
    at App (http://localhost:5177/src/App.jsx?t=1767887161577:45:3)
    at ErrorBoundary (http://localhost:5177/src/components/ErrorBoundary.jsx:8:5)
    at GameStateProvider (http://localhost:5177/src/context/GameStateContext.jsx:98:37)
    at WebSocketProvider (http://localhost:5177/src/context/WebSocketContext.jsx:28:37)
    at AuthProvider (http://localhost:5177/src/context/AuthContext.jsx:227:32)
    at Router (http://localhost:5177/node_modules/.vite/deps/react-router-dom.js?v=ce3ce900:4502:15)
    at BrowserRouter (http://localhost:5177/node_modules/.vite/deps/react-router-dom.js?v=ce3ce900:5248:5)
printWarning @ react_jsx-dev-runtime.js?v=ce3ce900:64
error @ react_jsx-dev-runtime.js?v=ce3ce900:48
checkPropTypes @ react_jsx-dev-runtime.js?v=ce3ce900:451
validatePropTypes @ react_jsx-dev-runtime.js?v=ce3ce900:778
jsxWithValidation @ react_jsx-dev-runtime.js?v=ce3ce900:876
(anonymous) @ GameWorld.jsx:2976
renderWithHooks @ chunk-NUMECXU6.js?v=c9a7e100:11548
updateFunctionComponent @ chunk-NUMECXU6.js?v=c9a7e100:14582
updateSimpleMemoComponent @ chunk-NUMECXU6.js?v=c9a7e100:14463
beginWork @ chunk-NUMECXU6.js?v=c9a7e100:15980
beginWork$1 @ chunk-NUMECXU6.js?v=c9a7e100:19753
performUnitOfWork @ chunk-NUMECXU6.js?v=c9a7e100:19198
workLoopSync @ chunk-NUMECXU6.js?v=c9a7e100:19137
renderRootSync @ chunk-NUMECXU6.js?v=c9a7e100:19116
performConcurrentWorkOnRoot @ chunk-NUMECXU6.js?v=c9a7e100:18678
workLoop @ chunk-NUMECXU6.js?v=c9a7e100:197
flushWork @ chunk-NUMECXU6.js?v=c9a7e100:176
performWorkUntilDeadline @ chunk-NUMECXU6.js?v=c9a7e100:384
errorTracker.js:90 [unknown] Unhandled error: Uncaught ReferenceError: setFormPosition is not defined {source: 'http://localhost:5177/src/components/GameWorld.jsx?t=1767887161577', line: 2315, column: 23} ReferenceError: setFormPosition is not defined
    at GameWorld.jsx:3002:17
    at renderWithHooks (chunk-NUMECXU6.js?v=c9a7e100:11548:26)
    at updateFunctionComponent (chunk-NUMECXU6.js?v=c9a7e100:14582:28)
    at updateSimpleMemoComponent (chunk-NUMECXU6.js?v=c9a7e100:14463:18)
    at beginWork (chunk-NUMECXU6.js?v=c9a7e100:15980:22)
    at HTMLUnknownElement.callCallback2 (chunk-NUMECXU6.js?v=c9a7e100:3674:22)
    at Object.invokeGuardedCallbackDev (chunk-NUMECXU6.js?v=c9a7e100:3699:24)
    at invokeGuardedCallback (chunk-NUMECXU6.js?v=c9a7e100:3733:39)
    at beginWork$1 (chunk-NUMECXU6.js?v=c9a7e100:19765:15)
    at performUnitOfWork (chunk-NUMECXU6.js?v=c9a7e100:19198:20)
trackError @ errorTracker.js:90
(anonymous) @ errorTracker.js:196
invokeGuardedCallbackDev @ chunk-NUMECXU6.js?v=c9a7e100:3699
invokeGuardedCallback @ chunk-NUMECXU6.js?v=c9a7e100:3733
beginWork$1 @ chunk-NUMECXU6.js?v=c9a7e100:19765
performUnitOfWork @ chunk-NUMECXU6.js?v=c9a7e100:19198
workLoopSync @ chunk-NUMECXU6.js?v=c9a7e100:19137
renderRootSync @ chunk-NUMECXU6.js?v=c9a7e100:19116
performConcurrentWorkOnRoot @ chunk-NUMECXU6.js?v=c9a7e100:18678
workLoop @ chunk-NUMECXU6.js?v=c9a7e100:197
flushWork @ chunk-NUMECXU6.js?v=c9a7e100:176
performWorkUntilDeadline @ chunk-NUMECXU6.js?v=c9a7e100:384
GameWorld.jsx:3002 Uncaught ReferenceError: setFormPosition is not defined
    at GameWorld.jsx:3002:17
    at renderWithHooks (chunk-NUMECXU6.js?v=c9a7e100:11548:26)
    at updateFunctionComponent (chunk-NUMECXU6.js?v=c9a7e100:14582:28)
    at updateSimpleMemoComponent (chunk-NUMECXU6.js?v=c9a7e100:14463:18)
    at beginWork (chunk-NUMECXU6.js?v=c9a7e100:15980:22)
    at HTMLUnknownElement.callCallback2 (chunk-NUMECXU6.js?v=c9a7e100:3674:22)
    at Object.invokeGuardedCallbackDev (chunk-NUMECXU6.js?v=c9a7e100:3699:24)
    at invokeGuardedCallback (chunk-NUMECXU6.js?v=c9a7e100:3733:39)
    at beginWork$1 (chunk-NUMECXU6.js?v=c9a7e100:19765:15)
    at performUnitOfWork (chunk-NUMECXU6.js?v=c9a7e100:19198:20)
(anonymous) @ GameWorld.jsx:3002
renderWithHooks @ chunk-NUMECXU6.js?v=c9a7e100:11548
updateFunctionComponent @ chunk-NUMECXU6.js?v=c9a7e100:14582
updateSimpleMemoComponent @ chunk-NUMECXU6.js?v=c9a7e100:14463
beginWork @ chunk-NUMECXU6.js?v=c9a7e100:15980
callCallback2 @ chunk-NUMECXU6.js?v=c9a7e100:3674
invokeGuardedCallbackDev @ chunk-NUMECXU6.js?v=c9a7e100:3699
invokeGuardedCallback @ chunk-NUMECXU6.js?v=c9a7e100:3733
beginWork$1 @ chunk-NUMECXU6.js?v=c9a7e100:19765
performUnitOfWork @ chunk-NUMECXU6.js?v=c9a7e100:19198
workLoopSync @ chunk-NUMECXU6.js?v=c9a7e100:19137
renderRootSync @ chunk-NUMECXU6.js?v=c9a7e100:19116
performConcurrentWorkOnRoot @ chunk-NUMECXU6.js?v=c9a7e100:18678
workLoop @ chunk-NUMECXU6.js?v=c9a7e100:197
flushWork @ chunk-NUMECXU6.js?v=c9a7e100:176
performWorkUntilDeadline @ chunk-NUMECXU6.js?v=c9a7e100:384
errorTracker.js:90 [unknown] Unhandled error: Uncaught ReferenceError: setFormPosition is not defined {source: 'http://localhost:5177/src/components/GameWorld.jsx?t=1767887161577', line: 2315, column: 23} ReferenceError: setFormPosition is not defined
    at GameWorld.jsx:3002:17
    at renderWithHooks (chunk-NUMECXU6.js?v=c9a7e100:11548:26)
    at updateFunctionComponent (chunk-NUMECXU6.js?v=c9a7e100:14582:28)
    at updateSimpleMemoComponent (chunk-NUMECXU6.js?v=c9a7e100:14463:18)
    at beginWork (chunk-NUMECXU6.js?v=c9a7e100:15980:22)
    at HTMLUnknownElement.callCallback2 (chunk-NUMECXU6.js?v=c9a7e100:3674:22)
    at Object.invokeGuardedCallbackDev (chunk-NUMECXU6.js?v=c9a7e100:3699:24)
    at invokeGuardedCallback (chunk-NUMECXU6.js?v=c9a7e100:3733:39)
    at beginWork$1 (chunk-NUMECXU6.js?v=c9a7e100:19765:15)
    at performUnitOfWork (chunk-NUMECXU6.js?v=c9a7e100:19198:20)
trackError @ errorTracker.js:90
(anonymous) @ errorTracker.js:196
invokeGuardedCallbackDev @ chunk-NUMECXU6.js?v=c9a7e100:3699
invokeGuardedCallback @ chunk-NUMECXU6.js?v=c9a7e100:3733
beginWork$1 @ chunk-NUMECXU6.js?v=c9a7e100:19765
performUnitOfWork @ chunk-NUMECXU6.js?v=c9a7e100:19198
workLoopSync @ chunk-NUMECXU6.js?v=c9a7e100:19137
renderRootSync @ chunk-NUMECXU6.js?v=c9a7e100:19116
recoverFromConcurrentError @ chunk-NUMECXU6.js?v=c9a7e100:18736
performConcurrentWorkOnRoot @ chunk-NUMECXU6.js?v=c9a7e100:18684
workLoop @ chunk-NUMECXU6.js?v=c9a7e100:197
flushWork @ chunk-NUMECXU6.js?v=c9a7e100:176
performWorkUntilDeadline @ chunk-NUMECXU6.js?v=c9a7e100:384
GameWorld.jsx:3002 Uncaught ReferenceError: setFormPosition is not defined
    at GameWorld.jsx:3002:17
    at renderWithHooks (chunk-NUMECXU6.js?v=c9a7e100:11548:26)
    at updateFunctionComponent (chunk-NUMECXU6.js?v=c9a7e100:14582:28)
    at updateSimpleMemoComponent (chunk-NUMECXU6.js?v=c9a7e100:14463:18)
    at beginWork (chunk-NUMECXU6.js?v=c9a7e100:15980:22)
    at HTMLUnknownElement.callCallback2 (chunk-NUMECXU6.js?v=c9a7e100:3674:22)
    at Object.invokeGuardedCallbackDev (chunk-NUMECXU6.js?v=c9a7e100:3699:24)
    at invokeGuardedCallback (chunk-NUMECXU6.js?v=c9a7e100:3733:39)
    at beginWork$1 (chunk-NUMECXU6.js?v=c9a7e100:19765:15)
    at performUnitOfWork (chunk-NUMECXU6.js?v=c9a7e100:19198:20)
(anonymous) @ GameWorld.jsx:3002
renderWithHooks @ chunk-NUMECXU6.js?v=c9a7e100:11548
updateFunctionComponent @ chunk-NUMECXU6.js?v=c9a7e100:14582
updateSimpleMemoComponent @ chunk-NUMECXU6.js?v=c9a7e100:14463
beginWork @ chunk-NUMECXU6.js?v=c9a7e100:15980
callCallback2 @ chunk-NUMECXU6.js?v=c9a7e100:3674
invokeGuardedCallbackDev @ chunk-NUMECXU6.js?v=c9a7e100:3699
invokeGuardedCallback @ chunk-NUMECXU6.js?v=c9a7e100:3733
beginWork$1 @ chunk-NUMECXU6.js?v=c9a7e100:19765
performUnitOfWork @ chunk-NUMECXU6.js?v=c9a7e100:19198
workLoopSync @ chunk-NUMECXU6.js?v=c9a7e100:19137
renderRootSync @ chunk-NUMECXU6.js?v=c9a7e100:19116
recoverFromConcurrentError @ chunk-NUMECXU6.js?v=c9a7e100:18736
performConcurrentWorkOnRoot @ chunk-NUMECXU6.js?v=c9a7e100:18684
workLoop @ chunk-NUMECXU6.js?v=c9a7e100:197
flushWork @ chunk-NUMECXU6.js?v=c9a7e100:176
performWorkUntilDeadline @ chunk-NUMECXU6.js?v=c9a7e100:384
chunk-NUMECXU6.js?v=c9a7e100:14032 The above error occurred in the <GameWorld> component:

    at http://localhost:5177/src/components/GameWorld.jsx?t=1767887161577:97:45
    at ErrorBoundary (http://localhost:5177/src/components/ErrorBoundary.jsx:8:5)
    at Suspense
    at RenderedRoute (http://localhost:5177/node_modules/.vite/deps/react-router-dom.js?v=ce3ce900:4089:5)
    at Routes (http://localhost:5177/node_modules/.vite/deps/react-router-dom.js?v=ce3ce900:4559:5)
    at main
    at AchievementProvider (http://localhost:5177/src/context/AchievementContext.jsx:89:39)
    at div
    at App (http://localhost:5177/src/App.jsx?t=1767887161577:45:3)
    at ErrorBoundary (http://localhost:5177/src/components/ErrorBoundary.jsx:8:5)
    at GameStateProvider (http://localhost:5177/src/context/GameStateContext.jsx:98:37)
    at WebSocketProvider (http://localhost:5177/src/context/WebSocketContext.jsx:28:37)
    at AuthProvider (http://localhost:5177/src/context/AuthContext.jsx:227:32)
    at Router (http://localhost:5177/node_modules/.vite/deps/react-router-dom.js?v=ce3ce900:4502:15)
    at BrowserRouter (http://localhost:5177/node_modules/.vite/deps/react-router-dom.js?v=ce3ce900:5248:5)

React will try to recreate this component tree from scratch using the error boundary you provided, ErrorBoundary.
logCapturedError @ chunk-NUMECXU6.js?v=c9a7e100:14032
callback @ chunk-NUMECXU6.js?v=c9a7e100:14078
callCallback @ chunk-NUMECXU6.js?v=c9a7e100:11248
commitUpdateQueue @ chunk-NUMECXU6.js?v=c9a7e100:11265
commitLayoutEffectOnFiber @ chunk-NUMECXU6.js?v=c9a7e100:17075
commitLayoutMountEffects_complete @ chunk-NUMECXU6.js?v=c9a7e100:17980
commitLayoutEffects_begin @ chunk-NUMECXU6.js?v=c9a7e100:17969
commitLayoutEffects_begin @ chunk-NUMECXU6.js?v=c9a7e100:17950
commitLayoutEffects @ chunk-NUMECXU6.js?v=c9a7e100:17920
commitRootImpl @ chunk-NUMECXU6.js?v=c9a7e100:19353
commitRoot @ chunk-NUMECXU6.js?v=c9a7e100:19277
finishConcurrentRender @ chunk-NUMECXU6.js?v=c9a7e100:18760
performConcurrentWorkOnRoot @ chunk-NUMECXU6.js?v=c9a7e100:18718
workLoop @ chunk-NUMECXU6.js?v=c9a7e100:197
flushWork @ chunk-NUMECXU6.js?v=c9a7e100:176
performWorkUntilDeadline @ chunk-NUMECXU6.js?v=c9a7e100:384
ErrorBoundary.jsx:31 Error caught by boundary: ReferenceError: setFormPosition is not defined
    at GameWorld.jsx:3002:17
    at renderWithHooks (chunk-NUMECXU6.js?v=c9a7e100:11548:26)
    at updateFunctionComponent (chunk-NUMECXU6.js?v=c9a7e100:14582:28)
    at updateSimpleMemoComponent (chunk-NUMECXU6.js?v=c9a7e100:14463:18)
    at beginWork (chunk-NUMECXU6.js?v=c9a7e100:15980:22)
    at beginWork$1 (chunk-NUMECXU6.js?v=c9a7e100:19753:22)
    at performUnitOfWork (chunk-NUMECXU6.js?v=c9a7e100:19198:20)
    at workLoopSync (chunk-NUMECXU6.js?v=c9a7e100:19137:13)
    at renderRootSync (chunk-NUMECXU6.js?v=c9a7e100:19116:15)
    at recoverFromConcurrentError (chunk-NUMECXU6.js?v=c9a7e100:18736:28) {componentStack: '\n    at http://localhost:5177/src/components/GameW….vite/deps/react-router-dom.js?v=ce3ce900:5248:5)'}
componentDidCatch @ ErrorBoundary.jsx:31
callback @ chunk-NUMECXU6.js?v=c9a7e100:14084
callCallback @ chunk-NUMECXU6.js?v=c9a7e100:11248
commitUpdateQueue @ chunk-NUMECXU6.js?v=c9a7e100:11265
commitLayoutEffectOnFiber @ chunk-NUMECXU6.js?v=c9a7e100:17075
commitLayoutMountEffects_complete @ chunk-NUMECXU6.js?v=c9a7e100:17980
commitLayoutEffects_begin @ chunk-NUMECXU6.js?v=c9a7e100:17969
commitLayoutEffects_begin @ chunk-NUMECXU6.js?v=c9a7e100:17950
commitLayoutEffects @ chunk-NUMECXU6.js?v=c9a7e100:17920
commitRootImpl @ chunk-NUMECXU6.js?v=c9a7e100:19353
commitRoot @ chunk-NUMECXU6.js?v=c9a7e100:19277
finishConcurrentRender @ chunk-NUMECXU6.js?v=c9a7e100:18760
performConcurrentWorkOnRoot @ chunk-NUMECXU6.js?v=c9a7e100:18718
workLoop @ chunk-NUMECXU6.js?v=c9a7e100:197
flushWork @ chunk-NUMECXU6.js?v=c9a7e100:176
performWorkUntilDeadline @ chunk-NUMECXU6.js?v=c9a7e100:384
api.js:134 Network error: Network Error
(anonymous) @ api.js:134
Promise.then
_request @ axios.js?v=b1588b43:2195
request @ axios.js?v=b1588b43:2104
Axios.<computed> @ axios.js?v=b1588b43:2232
wrap @ axios.js?v=b1588b43:8
withCache.duration @ api.js:1104
(anonymous) @ cacheManager.js:159
loadArtifacts @ GameWorld.jsx:1841
(anonymous) @ GameWorld.jsx:1848
commitHookEffectListMount @ chunk-NUMECXU6.js?v=c9a7e100:16915
commitPassiveMountOnFiber @ chunk-NUMECXU6.js?v=c9a7e100:18156
commitPassiveMountEffects_complete @ chunk-NUMECXU6.js?v=c9a7e100:18129
commitPassiveMountEffects_begin @ chunk-NUMECXU6.js?v=c9a7e100:18119
commitPassiveMountEffects @ chunk-NUMECXU6.js?v=c9a7e100:18109
flushPassiveEffectsImpl @ chunk-NUMECXU6.js?v=c9a7e100:19490
flushPassiveEffects @ chunk-NUMECXU6.js?v=c9a7e100:19447
(anonymous) @ chunk-NUMECXU6.js?v=c9a7e100:19328
workLoop @ chunk-NUMECXU6.js?v=c9a7e100:197
flushWork @ chunk-NUMECXU6.js?v=c9a7e100:176
performWorkUntilDeadline @ chunk-NUMECXU6.js?v=c9a7e100:384
api.js:1107 Error fetching artifacts: Error: Network error. Please check your connection.
    at api.js:136:11
    at async Axios.request (axios.js?v=b1588b43:2104:14)
    at async withCache.duration (api.js:1104:24)
    at async cacheManager.js:159:22
    at async loadArtifacts (GameWorld.jsx:1841:31)
withCache.duration @ api.js:1107
await in withCache.duration
(anonymous) @ cacheManager.js:159
loadArtifacts @ GameWorld.jsx:1841
(anonymous) @ GameWorld.jsx:1848
commitHookEffectListMount @ chunk-NUMECXU6.js?v=c9a7e100:16915
commitPassiveMountOnFiber @ chunk-NUMECXU6.js?v=c9a7e100:18156
commitPassiveMountEffects_complete @ chunk-NUMECXU6.js?v=c9a7e100:18129
commitPassiveMountEffects_begin @ chunk-NUMECXU6.js?v=c9a7e100:18119
commitPassiveMountEffects @ chunk-NUMECXU6.js?v=c9a7e100:18109
flushPassiveEffectsImpl @ chunk-NUMECXU6.js?v=c9a7e100:19490
flushPassiveEffects @ chunk-NUMECXU6.js?v=c9a7e100:19447
(anonymous) @ chunk-NUMECXU6.js?v=c9a7e100:19328
workLoop @ chunk-NUMECXU6.js?v=c9a7e100:197
flushWork @ chunk-NUMECXU6.js?v=c9a7e100:176
performWorkUntilDeadline @ chunk-NUMECXU6.js?v=c9a7e100:384
errorTracker.js:90 [performance] Error in cached function  {args: Array(0)} Error: Network error. Please check your connection.
    at api.js:136:11
    at async Axios.request (axios.js?v=b1588b43:2104:14)
    at async withCache.duration (api.js:1104:24)
    at async cacheManager.js:159:22
    at async loadArtifacts (GameWorld.jsx:1841:31)
trackError @ errorTracker.js:90
(anonymous) @ cacheManager.js:165
await in (anonymous)
loadArtifacts @ GameWorld.jsx:1841
(anonymous) @ GameWorld.jsx:1848
commitHookEffectListMount @ chunk-NUMECXU6.js?v=c9a7e100:16915
commitPassiveMountOnFiber @ chunk-NUMECXU6.js?v=c9a7e100:18156
commitPassiveMountEffects_complete @ chunk-NUMECXU6.js?v=c9a7e100:18129
commitPassiveMountEffects_begin @ chunk-NUMECXU6.js?v=c9a7e100:18119
commitPassiveMountEffects @ chunk-NUMECXU6.js?v=c9a7e100:18109
flushPassiveEffectsImpl @ chunk-NUMECXU6.js?v=c9a7e100:19490
flushPassiveEffects @ chunk-NUMECXU6.js?v=c9a7e100:19447
(anonymous) @ chunk-NUMECXU6.js?v=c9a7e100:19328
workLoop @ chunk-NUMECXU6.js?v=c9a7e100:197
flushWork @ chunk-NUMECXU6.js?v=c9a7e100:176
performWorkUntilDeadline @ chunk-NUMECXU6.js?v=c9a7e100:384
GameWorld.jsx:1844 Error loading artifacts: Error: Network error. Please check your connection.
    at api.js:136:11
    at async Axios.request (axios.js?v=b1588b43:2104:14)
    at async withCache.duration (api.js:1104:24)
    at async cacheManager.js:159:22
    at async loadArtifacts (GameWorld.jsx:1841:31)
loadArtifacts @ GameWorld.jsx:1844
await in loadArtifacts
(anonymous) @ GameWorld.jsx:1848
commitHookEffectListMount @ chunk-NUMECXU6.js?v=c9a7e100:16915
commitPassiveMountOnFiber @ chunk-NUMECXU6.js?v=c9a7e100:18156
commitPassiveMountEffects_complete @ chunk-NUMECXU6.js?v=c9a7e100:18129
commitPassiveMountEffects_begin @ chunk-NUMECXU6.js?v=c9a7e100:18119
commitPassiveMountEffects @ chunk-NUMECXU6.js?v=c9a7e100:18109
flushPassiveEffectsImpl @ chunk-NUMECXU6.js?v=c9a7e100:19490
flushPassiveEffects @ chunk-NUMECXU6.js?v=c9a7e100:19447
(anonymous) @ chunk-NUMECXU6.js?v=c9a7e100:19328
workLoop @ chunk-NUMECXU6.js?v=c9a7e100:197
flushWork @ chunk-NUMECXU6.js?v=c9a7e100:176
performWorkUntilDeadline @ chunk-NUMECXU6.js?v=c9a7e100:384
api.js:1104  GET http://localhost:5000/api/artifacts net::ERR_CONNECTION_REFUSED
dispatchXhrRequest @ axios.js?v=b1588b43:1637
xhr @ axios.js?v=b1588b43:1517
dispatchRequest @ axios.js?v=b1588b43:1992
Promise.then
_request @ axios.js?v=b1588b43:2195
request @ axios.js?v=b1588b43:2104
Axios.<computed> @ axios.js?v=b1588b43:2232
wrap @ axios.js?v=b1588b43:8
withCache.duration @ api.js:1104
(anonymous) @ cacheManager.js:159
loadArtifacts @ GameWorld.jsx:1841
(anonymous) @ GameWorld.jsx:1848
commitHookEffectListMount @ chunk-NUMECXU6.js?v=c9a7e100:16915
commitPassiveMountOnFiber @ chunk-NUMECXU6.js?v=c9a7e100:18156
commitPassiveMountEffects_complete @ chunk-NUMECXU6.js?v=c9a7e100:18129
commitPassiveMountEffects_begin @ chunk-NUMECXU6.js?v=c9a7e100:18119
commitPassiveMountEffects @ chunk-NUMECXU6.js?v=c9a7e100:18109
flushPassiveEffectsImpl @ chunk-NUMECXU6.js?v=c9a7e100:19490
flushPassiveEffects @ chunk-NUMECXU6.js?v=c9a7e100:19447
(anonymous) @ chunk-NUMECXU6.js?v=c9a7e100:19328
workLoop @ chunk-NUMECXU6.js?v=c9a7e100:197
flushWork @ chunk-NUMECXU6.js?v=c9a7e100:176
performWorkUntilDeadline @ chunk-NUMECXU6.js?v=c9a7e100:384
errorTracker.js:138  POST http://localhost:5177/api/diagnostics/errors net::ERR_ABORTED 500 (Internal Server Error)
reportErrorToServer @ errorTracker.js:138
trackError @ errorTracker.js:106
(anonymous) @ errorTracker.js:196
invokeGuardedCallbackDev @ chunk-NUMECXU6.js?v=c9a7e100:3699
invokeGuardedCallback @ chunk-NUMECXU6.js?v=c9a7e100:3733
beginWork$1 @ chunk-NUMECXU6.js?v=c9a7e100:19765
performUnitOfWork @ chunk-NUMECXU6.js?v=c9a7e100:19198
workLoopSync @ chunk-NUMECXU6.js?v=c9a7e100:19137
renderRootSync @ chunk-NUMECXU6.js?v=c9a7e100:19116
performConcurrentWorkOnRoot @ chunk-NUMECXU6.js?v=c9a7e100:18678
workLoop @ chunk-NUMECXU6.js?v=c9a7e100:197
flushWork @ chunk-NUMECXU6.js?v=c9a7e100:176
performWorkUntilDeadline @ chunk-NUMECXU6.js?v=c9a7e100:384
errorTracker.js:152 Error reporting to server: Error: Server returned 500: Internal Server Error
    at reportErrorToServer (errorTracker.js:145:13)
reportErrorToServer @ errorTracker.js:152
await in reportErrorToServer
trackError @ errorTracker.js:106
(anonymous) @ errorTracker.js:196
invokeGuardedCallbackDev @ chunk-NUMECXU6.js?v=c9a7e100:3699
invokeGuardedCallback @ chunk-NUMECXU6.js?v=c9a7e100:3733
beginWork$1 @ chunk-NUMECXU6.js?v=c9a7e100:19765
performUnitOfWork @ chunk-NUMECXU6.js?v=c9a7e100:19198
workLoopSync @ chunk-NUMECXU6.js?v=c9a7e100:19137
renderRootSync @ chunk-NUMECXU6.js?v=c9a7e100:19116
performConcurrentWorkOnRoot @ chunk-NUMECXU6.js?v=c9a7e100:18678
workLoop @ chunk-NUMECXU6.js?v=c9a7e100:197
flushWork @ chunk-NUMECXU6.js?v=c9a7e100:176
performWorkUntilDeadline @ chunk-NUMECXU6.js?v=c9a7e100:384
errorTracker.js:113 Failed to report critical error to server: Error: Server returned 500: Internal Server Error
    at reportErrorToServer (errorTracker.js:145:13)
(anonymous) @ errorTracker.js:113
Promise.catch
trackError @ errorTracker.js:106
(anonymous) @ errorTracker.js:196
invokeGuardedCallbackDev @ chunk-NUMECXU6.js?v=c9a7e100:3699
invokeGuardedCallback @ chunk-NUMECXU6.js?v=c9a7e100:3733
beginWork$1 @ chunk-NUMECXU6.js?v=c9a7e100:19765
performUnitOfWork @ chunk-NUMECXU6.js?v=c9a7e100:19198
workLoopSync @ chunk-NUMECXU6.js?v=c9a7e100:19137
renderRootSync @ chunk-NUMECXU6.js?v=c9a7e100:19116
performConcurrentWorkOnRoot @ chunk-NUMECXU6.js?v=c9a7e100:18678
workLoop @ chunk-NUMECXU6.js?v=c9a7e100:197
flushWork @ chunk-NUMECXU6.js?v=c9a7e100:176
performWorkUntilDeadline @ chunk-NUMECXU6.js?v=c9a7e100:384
errorTracker.js:138  POST http://localhost:5177/api/diagnostics/errors net::ERR_ABORTED 500 (Internal Server Error)
reportErrorToServer @ errorTracker.js:138
trackError @ errorTracker.js:106
(anonymous) @ errorTracker.js:196
invokeGuardedCallbackDev @ chunk-NUMECXU6.js?v=c9a7e100:3699
invokeGuardedCallback @ chunk-NUMECXU6.js?v=c9a7e100:3733
beginWork$1 @ chunk-NUMECXU6.js?v=c9a7e100:19765
performUnitOfWork @ chunk-NUMECXU6.js?v=c9a7e100:19198
workLoopSync @ chunk-NUMECXU6.js?v=c9a7e100:19137
renderRootSync @ chunk-NUMECXU6.js?v=c9a7e100:19116
recoverFromConcurrentError @ chunk-NUMECXU6.js?v=c9a7e100:18736
performConcurrentWorkOnRoot @ chunk-NUMECXU6.js?v=c9a7e100:18684
workLoop @ chunk-NUMECXU6.js?v=c9a7e100:197
flushWork @ chunk-NUMECXU6.js?v=c9a7e100:176
performWorkUntilDeadline @ chunk-NUMECXU6.js?v=c9a7e100:384
errorTracker.js:152 Error reporting to server: Error: Server returned 500: Internal Server Error
    at reportErrorToServer (errorTracker.js:145:13)
reportErrorToServer @ errorTracker.js:152
await in reportErrorToServer
trackError @ errorTracker.js:106
(anonymous) @ errorTracker.js:196
invokeGuardedCallbackDev @ chunk-NUMECXU6.js?v=c9a7e100:3699
invokeGuardedCallback @ chunk-NUMECXU6.js?v=c9a7e100:3733
beginWork$1 @ chunk-NUMECXU6.js?v=c9a7e100:19765
performUnitOfWork @ chunk-NUMECXU6.js?v=c9a7e100:19198
workLoopSync @ chunk-NUMECXU6.js?v=c9a7e100:19137
renderRootSync @ chunk-NUMECXU6.js?v=c9a7e100:19116
recoverFromConcurrentError @ chunk-NUMECXU6.js?v=c9a7e100:18736
performConcurrentWorkOnRoot @ chunk-NUMECXU6.js?v=c9a7e100:18684
workLoop @ chunk-NUMECXU6.js?v=c9a7e100:197
flushWork @ chunk-NUMECXU6.js?v=c9a7e100:176
performWorkUntilDeadline @ chunk-NUMECXU6.js?v=c9a7e100:384
errorTracker.js:113 Failed to report critical error to server: Error: Server returned 500: Internal Server Error
    at reportErrorToServer (errorTracker.js:145:13)
(anonymous) @ errorTracker.js:113
Promise.catch
trackError @ errorTracker.js:106
(anonymous) @ errorTracker.js:196
invokeGuardedCallbackDev @ chunk-NUMECXU6.js?v=c9a7e100:3699
invokeGuardedCallback @ chunk-NUMECXU6.js?v=c9a7e100:3733
beginWork$1 @ chunk-NUMECXU6.js?v=c9a7e100:19765
performUnitOfWork @ chunk-NUMECXU6.js?v=c9a7e100:19198
workLoopSync @ chunk-NUMECXU6.js?v=c9a7e100:19137
renderRootSync @ chunk-NUMECXU6.js?v=c9a7e100:19116
recoverFromConcurrentError @ chunk-NUMECXU6.js?v=c9a7e100:18736
performConcurrentWorkOnRoot @ chunk-NUMECXU6.js?v=c9a7e100:18684
workLoop @ chunk-NUMECXU6.js?v=c9a7e100:197
flushWork @ chunk-NUMECXU6.js?v=c9a7e100:176
performWorkUntilDeadline @ chunk-NUMECXU6.js?v=c9a7e100:384
SoundManager.js:187 ❌ Error loading sound whisper: EncodingError: Unable to decode audio data
loadSound @ SoundManager.js:187
await in loadSound
loadSoundWithFallback @ SoundManager.js:157
(anonymous) @ SoundManager.js:70
initialize @ SoundManager.js:69
(anonymous) @ GameWorld.jsx:1661
(anonymous) @ GameWorld.jsx:1689
commitHookEffectListMount @ chunk-NUMECXU6.js?v=c9a7e100:16915
commitPassiveMountOnFiber @ chunk-NUMECXU6.js?v=c9a7e100:18156
commitPassiveMountEffects_complete @ chunk-NUMECXU6.js?v=c9a7e100:18129
commitPassiveMountEffects_begin @ chunk-NUMECXU6.js?v=c9a7e100:18119
commitPassiveMountEffects @ chunk-NUMECXU6.js?v=c9a7e100:18109
flushPassiveEffectsImpl @ chunk-NUMECXU6.js?v=c9a7e100:19490
flushPassiveEffects @ chunk-NUMECXU6.js?v=c9a7e100:19447
(anonymous) @ chunk-NUMECXU6.js?v=c9a7e100:19328
workLoop @ chunk-NUMECXU6.js?v=c9a7e100:197
flushWork @ chunk-NUMECXU6.js?v=c9a7e100:176
performWorkUntilDeadline @ chunk-NUMECXU6.js?v=c9a7e100:384
SoundManager.js:187 ❌ Error loading sound digital_transition: EncodingError: Unable to decode audio data
loadSound @ SoundManager.js:187
await in loadSound
loadSoundWithFallback @ SoundManager.js:157
(anonymous) @ SoundManager.js:70
initialize @ SoundManager.js:69
(anonymous) @ GameWorld.jsx:1661
(anonymous) @ GameWorld.jsx:1689
commitHookEffectListMount @ chunk-NUMECXU6.js?v=c9a7e100:16915
commitPassiveMountOnFiber @ chunk-NUMECXU6.js?v=c9a7e100:18156
commitPassiveMountEffects_complete @ chunk-NUMECXU6.js?v=c9a7e100:18129
commitPassiveMountEffects_begin @ chunk-NUMECXU6.js?v=c9a7e100:18119
commitPassiveMountEffects @ chunk-NUMECXU6.js?v=c9a7e100:18109
flushPassiveEffectsImpl @ chunk-NUMECXU6.js?v=c9a7e100:19490
flushPassiveEffects @ chunk-NUMECXU6.js?v=c9a7e100:19447
(anonymous) @ chunk-NUMECXU6.js?v=c9a7e100:19328
workLoop @ chunk-NUMECXU6.js?v=c9a7e100:197
flushWork @ chunk-NUMECXU6.js?v=c9a7e100:176
performWorkUntilDeadline @ chunk-NUMECXU6.js?v=c9a7e100:384
SoundManager.js:187 ❌ Error loading sound toilet_flush: EncodingError: Unable to decode audio data
loadSound @ SoundManager.js:187
await in loadSound
loadSoundWithFallback @ SoundManager.js:157
(anonymous) @ SoundManager.js:70
initialize @ SoundManager.js:69
(anonymous) @ GameWorld.jsx:1661
(anonymous) @ GameWorld.jsx:1689
commitHookEffectListMount @ chunk-NUMECXU6.js?v=c9a7e100:16915
commitPassiveMountOnFiber @ chunk-NUMECXU6.js?v=c9a7e100:18156
commitPassiveMountEffects_complete @ chunk-NUMECXU6.js?v=c9a7e100:18129
commitPassiveMountEffects_begin @ chunk-NUMECXU6.js?v=c9a7e100:18119
commitPassiveMountEffects @ chunk-NUMECXU6.js?v=c9a7e100:18109
flushPassiveEffectsImpl @ chunk-NUMECXU6.js?v=c9a7e100:19490
flushPassiveEffects @ chunk-NUMECXU6.js?v=c9a7e100:19447
(anonymous) @ chunk-NUMECXU6.js?v=c9a7e100:19328
workLoop @ chunk-NUMECXU6.js?v=c9a7e100:197
flushWork @ chunk-NUMECXU6.js?v=c9a7e100:176
performWorkUntilDeadline @ chunk-NUMECXU6.js?v=c9a7e100:384
SoundManager.js:187 ❌ Error loading sound sword: EncodingError: Unable to decode audio data
loadSound @ SoundManager.js:187
await in loadSound
loadSoundWithFallback @ SoundManager.js:157
(anonymous) @ SoundManager.js:70
initialize @ SoundManager.js:69
(anonymous) @ GameWorld.jsx:1661
(anonymous) @ GameWorld.jsx:1689
commitHookEffectListMount @ chunk-NUMECXU6.js?v=c9a7e100:16915
commitPassiveMountOnFiber @ chunk-NUMECXU6.js?v=c9a7e100:18156
commitPassiveMountEffects_complete @ chunk-NUMECXU6.js?v=c9a7e100:18129
commitPassiveMountEffects_begin @ chunk-NUMECXU6.js?v=c9a7e100:18119
commitPassiveMountEffects @ chunk-NUMECXU6.js?v=c9a7e100:18109
flushPassiveEffectsImpl @ chunk-NUMECXU6.js?v=c9a7e100:19490
flushPassiveEffects @ chunk-NUMECXU6.js?v=c9a7e100:19447
(anonymous) @ chunk-NUMECXU6.js?v=c9a7e100:19328
workLoop @ chunk-NUMECXU6.js?v=c9a7e100:197
flushWork @ chunk-NUMECXU6.js?v=c9a7e100:176
performWorkUntilDeadline @ chunk-NUMECXU6.js?v=c9a7e100:384
SoundManager.js:187 ❌ Error loading sound damage: EncodingError: Unable to decode audio data
loadSound @ SoundManager.js:187
await in loadSound
loadSoundWithFallback @ SoundManager.js:157
(anonymous) @ SoundManager.js:70
initialize @ SoundManager.js:69
(anonymous) @ GameWorld.jsx:1661
(anonymous) @ GameWorld.jsx:1689
commitHookEffectListMount @ chunk-NUMECXU6.js?v=c9a7e100:16915
commitPassiveMountOnFiber @ chunk-NUMECXU6.js?v=c9a7e100:18156
commitPassiveMountEffects_complete @ chunk-NUMECXU6.js?v=c9a7e100:18129
commitPassiveMountEffects_begin @ chunk-NUMECXU6.js?v=c9a7e100:18119
commitPassiveMountEffects @ chunk-NUMECXU6.js?v=c9a7e100:18109
flushPassiveEffectsImpl @ chunk-NUMECXU6.js?v=c9a7e100:19490
flushPassiveEffects @ chunk-NUMECXU6.js?v=c9a7e100:19447
(anonymous) @ chunk-NUMECXU6.js?v=c9a7e100:19328
workLoop @ chunk-NUMECXU6.js?v=c9a7e100:197
flushWork @ chunk-NUMECXU6.js?v=c9a7e100:176
performWorkUntilDeadline @ chunk-NUMECXU6.js?v=c9a7e100:384
SoundManager.js:187 ❌ Error loading sound heal: EncodingError: Unable to decode audio data
loadSound @ SoundManager.js:187
await in loadSound
loadSoundWithFallback @ SoundManager.js:157
(anonymous) @ SoundManager.js:70
initialize @ SoundManager.js:69
(anonymous) @ GameWorld.jsx:1661
(anonymous) @ GameWorld.jsx:1689
commitHookEffectListMount @ chunk-NUMECXU6.js?v=c9a7e100:16915
commitPassiveMountOnFiber @ chunk-NUMECXU6.js?v=c9a7e100:18156
commitPassiveMountEffects_complete @ chunk-NUMECXU6.js?v=c9a7e100:18129
commitPassiveMountEffects_begin @ chunk-NUMECXU6.js?v=c9a7e100:18119
commitPassiveMountEffects @ chunk-NUMECXU6.js?v=c9a7e100:18109
flushPassiveEffectsImpl @ chunk-NUMECXU6.js?v=c9a7e100:19490
flushPassiveEffects @ chunk-NUMECXU6.js?v=c9a7e100:19447
(anonymous) @ chunk-NUMECXU6.js?v=c9a7e100:19328
workLoop @ chunk-NUMECXU6.js?v=c9a7e100:197
flushWork @ chunk-NUMECXU6.js?v=c9a7e100:176
performWorkUntilDeadline @ chunk-NUMECXU6.js?v=c9a7e100:384
SoundManager.js:187 ❌ Error loading sound key: EncodingError: Unable to decode audio data
loadSound @ SoundManager.js:187
await in loadSound
loadSoundWithFallback @ SoundManager.js:157
(anonymous) @ SoundManager.js:70
initialize @ SoundManager.js:69
(anonymous) @ GameWorld.jsx:1661
(anonymous) @ GameWorld.jsx:1689
commitHookEffectListMount @ chunk-NUMECXU6.js?v=c9a7e100:16915
commitPassiveMountOnFiber @ chunk-NUMECXU6.js?v=c9a7e100:18156
commitPassiveMountEffects_complete @ chunk-NUMECXU6.js?v=c9a7e100:18129
commitPassiveMountEffects_begin @ chunk-NUMECXU6.js?v=c9a7e100:18119
commitPassiveMountEffects @ chunk-NUMECXU6.js?v=c9a7e100:18109
flushPassiveEffectsImpl @ chunk-NUMECXU6.js?v=c9a7e100:19490
flushPassiveEffects @ chunk-NUMECXU6.js?v=c9a7e100:19447
(anonymous) @ chunk-NUMECXU6.js?v=c9a7e100:19328
workLoop @ chunk-NUMECXU6.js?v=c9a7e100:197
flushWork @ chunk-NUMECXU6.js?v=c9a7e100:176
performWorkUntilDeadline @ chunk-NUMECXU6.js?v=c9a7e100:384
SoundManager.js:187 ❌ Error loading sound sword_beam: EncodingError: Unable to decode audio data
loadSound @ SoundManager.js:187
await in loadSound
loadSoundWithFallback @ SoundManager.js:157
(anonymous) @ SoundManager.js:70
initialize @ SoundManager.js:69
(anonymous) @ GameWorld.jsx:1661
(anonymous) @ GameWorld.jsx:1689
commitHookEffectListMount @ chunk-NUMECXU6.js?v=c9a7e100:16915
commitPassiveMountOnFiber @ chunk-NUMECXU6.js?v=c9a7e100:18156
commitPassiveMountEffects_complete @ chunk-NUMECXU6.js?v=c9a7e100:18129
commitPassiveMountEffects_begin @ chunk-NUMECXU6.js?v=c9a7e100:18119
commitPassiveMountEffects @ chunk-NUMECXU6.js?v=c9a7e100:18109
flushPassiveEffectsImpl @ chunk-NUMECXU6.js?v=c9a7e100:19490
flushPassiveEffects @ chunk-NUMECXU6.js?v=c9a7e100:19447
(anonymous) @ chunk-NUMECXU6.js?v=c9a7e100:19328
workLoop @ chunk-NUMECXU6.js?v=c9a7e100:197
flushWork @ chunk-NUMECXU6.js?v=c9a7e100:176
performWorkUntilDeadline @ chunk-NUMECXU6.js?v=c9a7e100:384
SoundManager.js:187 ❌ Error loading sound rupee: EncodingError: Unable to decode audio data
loadSound @ SoundManager.js:187
await in loadSound
loadSoundWithFallback @ SoundManager.js:157
(anonymous) @ SoundManager.js:70
initialize @ SoundManager.js:69
(anonymous) @ GameWorld.jsx:1661
(anonymous) @ GameWorld.jsx:1689
commitHookEffectListMount @ chunk-NUMECXU6.js?v=c9a7e100:16915
commitPassiveMountOnFiber @ chunk-NUMECXU6.js?v=c9a7e100:18156
commitPassiveMountEffects_complete @ chunk-NUMECXU6.js?v=c9a7e100:18129
commitPassiveMountEffects_begin @ chunk-NUMECXU6.js?v=c9a7e100:18119
commitPassiveMountEffects @ chunk-NUMECXU6.js?v=c9a7e100:18109
flushPassiveEffectsImpl @ chunk-NUMECXU6.js?v=c9a7e100:19490
flushPassiveEffects @ chunk-NUMECXU6.js?v=c9a7e100:19447
(anonymous) @ chunk-NUMECXU6.js?v=c9a7e100:19328
workLoop @ chunk-NUMECXU6.js?v=c9a7e100:197
flushWork @ chunk-NUMECXU6.js?v=c9a7e100:176
performWorkUntilDeadline @ chunk-NUMECXU6.js?v=c9a7e100:384
SoundManager.js:187 ❌ Error loading sound enemy_hit: EncodingError: Unable to decode audio data
loadSound @ SoundManager.js:187
await in loadSound
loadSoundWithFallback @ SoundManager.js:157
(anonymous) @ SoundManager.js:70
initialize @ SoundManager.js:69
(anonymous) @ GameWorld.jsx:1661
(anonymous) @ GameWorld.jsx:1689
commitHookEffectListMount @ chunk-NUMECXU6.js?v=c9a7e100:16915
commitPassiveMountOnFiber @ chunk-NUMECXU6.js?v=c9a7e100:18156
commitPassiveMountEffects_complete @ chunk-NUMECXU6.js?v=c9a7e100:18129
commitPassiveMountEffects_begin @ chunk-NUMECXU6.js?v=c9a7e100:18119
commitPassiveMountEffects @ chunk-NUMECXU6.js?v=c9a7e100:18109
flushPassiveEffectsImpl @ chunk-NUMECXU6.js?v=c9a7e100:19490
flushPassiveEffects @ chunk-NUMECXU6.js?v=c9a7e100:19447
(anonymous) @ chunk-NUMECXU6.js?v=c9a7e100:19328
workLoop @ chunk-NUMECXU6.js?v=c9a7e100:197
flushWork @ chunk-NUMECXU6.js?v=c9a7e100:176
performWorkUntilDeadline @ chunk-NUMECXU6.js?v=c9a7e100:384
SoundManager.js:187 ❌ Error loading sound enemy_defeat: EncodingError: Unable to decode audio data
loadSound @ SoundManager.js:187
await in loadSound
loadSoundWithFallback @ SoundManager.js:157
(anonymous) @ SoundManager.js:70
initialize @ SoundManager.js:69
(anonymous) @ GameWorld.jsx:1661
(anonymous) @ GameWorld.jsx:1689
commitHookEffectListMount @ chunk-NUMECXU6.js?v=c9a7e100:16915
commitPassiveMountOnFiber @ chunk-NUMECXU6.js?v=c9a7e100:18156
commitPassiveMountEffects_complete @ chunk-NUMECXU6.js?v=c9a7e100:18129
commitPassiveMountEffects_begin @ chunk-NUMECXU6.js?v=c9a7e100:18119
commitPassiveMountEffects @ chunk-NUMECXU6.js?v=c9a7e100:18109
flushPassiveEffectsImpl @ chunk-NUMECXU6.js?v=c9a7e100:19490
flushPassiveEffects @ chunk-NUMECXU6.js?v=c9a7e100:19447
(anonymous) @ chunk-NUMECXU6.js?v=c9a7e100:19328
workLoop @ chunk-NUMECXU6.js?v=c9a7e100:197
flushWork @ chunk-NUMECXU6.js?v=c9a7e100:176
performWorkUntilDeadline @ chunk-NUMECXU6.js?v=c9a7e100:384
SoundManager.js:187 ❌ Error loading sound poof: EncodingError: Unable to decode audio data
loadSound @ SoundManager.js:187
await in loadSound
loadSoundWithFallback @ SoundManager.js:157
(anonymous) @ SoundManager.js:70
initialize @ SoundManager.js:69
(anonymous) @ GameWorld.jsx:1661
(anonymous) @ GameWorld.jsx:1689
commitHookEffectListMount @ chunk-NUMECXU6.js?v=c9a7e100:16915
commitPassiveMountOnFiber @ chunk-NUMECXU6.js?v=c9a7e100:18156
commitPassiveMountEffects_complete @ chunk-NUMECXU6.js?v=c9a7e100:18129
commitPassiveMountEffects_begin @ chunk-NUMECXU6.js?v=c9a7e100:18119
commitPassiveMountEffects @ chunk-NUMECXU6.js?v=c9a7e100:18109
flushPassiveEffectsImpl @ chunk-NUMECXU6.js?v=c9a7e100:19490
flushPassiveEffects @ chunk-NUMECXU6.js?v=c9a7e100:19447
(anonymous) @ chunk-NUMECXU6.js?v=c9a7e100:19328
workLoop @ chunk-NUMECXU6.js?v=c9a7e100:197
flushWork @ chunk-NUMECXU6.js?v=c9a7e100:176
performWorkUntilDeadline @ chunk-NUMECXU6.js?v=c9a7e100:384
SoundManager.js:187 ❌ Error loading sound gameover: EncodingError: Unable to decode audio data
loadSound @ SoundManager.js:187
await in loadSound
loadSoundWithFallback @ SoundManager.js:157
(anonymous) @ SoundManager.js:70
initialize @ SoundManager.js:69
(anonymous) @ GameWorld.jsx:1661
(anonymous) @ GameWorld.jsx:1689
commitHookEffectListMount @ chunk-NUMECXU6.js?v=c9a7e100:16915
commitPassiveMountOnFiber @ chunk-NUMECXU6.js?v=c9a7e100:18156
commitPassiveMountEffects_complete @ chunk-NUMECXU6.js?v=c9a7e100:18129
commitPassiveMountEffects_begin @ chunk-NUMECXU6.js?v=c9a7e100:18119
commitPassiveMountEffects @ chunk-NUMECXU6.js?v=c9a7e100:18109
flushPassiveEffectsImpl @ chunk-NUMECXU6.js?v=c9a7e100:19490
flushPassiveEffects @ chunk-NUMECXU6.js?v=c9a7e100:19447
(anonymous) @ chunk-NUMECXU6.js?v=c9a7e100:19328
workLoop @ chunk-NUMECXU6.js?v=c9a7e100:197
flushWork @ chunk-NUMECXU6.js?v=c9a7e100:176
performWorkUntilDeadline @ chunk-NUMECXU6.js?v=c9a7e100:384
SoundManager.js:187 ❌ Error loading sound heart: EncodingError: Unable to decode audio data
loadSound @ SoundManager.js:187
await in loadSound
loadSoundWithFallback @ SoundManager.js:157
(anonymous) @ SoundManager.js:70
initialize @ SoundManager.js:69
(anonymous) @ GameWorld.jsx:1661
(anonymous) @ GameWorld.jsx:1689
commitHookEffectListMount @ chunk-NUMECXU6.js?v=c9a7e100:16915
commitPassiveMountOnFiber @ chunk-NUMECXU6.js?v=c9a7e100:18156
commitPassiveMountEffects_complete @ chunk-NUMECXU6.js?v=c9a7e100:18129
commitPassiveMountEffects_begin @ chunk-NUMECXU6.js?v=c9a7e100:18119
commitPassiveMountEffects @ chunk-NUMECXU6.js?v=c9a7e100:18109
flushPassiveEffectsImpl @ chunk-NUMECXU6.js?v=c9a7e100:19490
flushPassiveEffects @ chunk-NUMECXU6.js?v=c9a7e100:19447
(anonymous) @ chunk-NUMECXU6.js?v=c9a7e100:19328
workLoop @ chunk-NUMECXU6.js?v=c9a7e100:197
flushWork @ chunk-NUMECXU6.js?v=c9a7e100:176
performWorkUntilDeadline @ chunk-NUMECXU6.js?v=c9a7e100:384
GameWorld.jsx:1665 Error initializing sound manager: ReferenceError: setSoundManager is not defined
    at GameWorld.jsx:1662:7
(anonymous) @ GameWorld.jsx:1665
await in (anonymous)
(anonymous) @ GameWorld.jsx:1689
commitHookEffectListMount @ chunk-NUMECXU6.js?v=c9a7e100:16915
commitPassiveMountOnFiber @ chunk-NUMECXU6.js?v=c9a7e100:18156
commitPassiveMountEffects_complete @ chunk-NUMECXU6.js?v=c9a7e100:18129
commitPassiveMountEffects_begin @ chunk-NUMECXU6.js?v=c9a7e100:18119
commitPassiveMountEffects @ chunk-NUMECXU6.js?v=c9a7e100:18109
flushPassiveEffectsImpl @ chunk-NUMECXU6.js?v=c9a7e100:19490
flushPassiveEffects @ chunk-NUMECXU6.js?v=c9a7e100:19447
(anonymous) @ chunk-NUMECXU6.js?v=c9a7e100:19328
workLoop @ chunk-NUMECXU6.js?v=c9a7e100:197
flushWork @ chunk-NUMECXU6.js?v=c9a7e100:176
performWorkUntilDeadline @ chunk-NUMECXU6.js?v=c9a7e100:384


---

_**Agent (model default, mode Agent)**_



---


Fixing multiple issues: `setFormPosition` and `setSoundManager` are missing, and some props are undefined. Checking and fixing:


---

<tool-use data-tool-type="read" data-tool-name="read_file">
<details><summary>Tool use: **read_file** • Read file: /home/robwistrand/code/ga/projects/authentic-internet/client/src/components/GameWorld.jsx</summary>

</details>
</tool-use>

---

<tool-use data-tool-type="read" data-tool-name="read_file">
<details><summary>Tool use: **read_file** • Read file: /home/robwistrand/code/ga/projects/authentic-internet/client/src/components/GameWorld.jsx</summary>

</details>
</tool-use>

---

<tool-use data-tool-type="search" data-tool-name="grep">
<details>
<summary>Tool use: **grep** • Grep for "setFormPosition|setSoundManager" in "/home/robwistrand/code/ga/projects/authentic-internet/client/src/components/GameWorld.jsx" • 2 matches</summary>

Output mode: content


| File | Content | Line |
|------|------|------|
| `client/src/components/GameWorld.jsx` | `setSoundManager(manager);` | L1662 |
| `client/src/components/GameWorld.jsx` | `setFormPosition=\{setFormPosition\}` | L3002 |


</details>
</tool-use>

---

<tool-use data-tool-type="read" data-tool-name="read_file">
<details><summary>Tool use: **read_file** • Read file: /home/robwistrand/code/ga/projects/authentic-internet/client/src/components/GameWorld.jsx</summary>

</details>
</tool-use>

---

<tool-use data-tool-type="read" data-tool-name="read_file">
<details><summary>Tool use: **read_file** • Read file: /home/robwistrand/code/ga/projects/authentic-internet/client/src/components/GameWorld.jsx</summary>

</details>
</tool-use>

---



---


Fixing missing setters and prop issues:


---

<tool-use data-tool-type="read" data-tool-name="read_file">
<details><summary>Tool use: **read_file** • Read file: /home/robwistrand/code/ga/projects/authentic-internet/client/src/components/GameWorld.jsx</summary>

</details>
</tool-use>

---

<tool-use data-tool-type="search" data-tool-name="grep">
<details>
<summary>Tool use: **grep** • Grep for "setShowInventory" in "/home/robwistrand/code/ga/projects/authentic-internet/client/src/components/GameWorld.jsx" • 2 matches</summary>

Output mode: content


| File | Content | Line |
|------|------|------|
| `client/src/components/GameWorld.jsx` | `setShowInventory=\{setShowInventory\}` | L3003 |
| `client/src/components/GameWorld.jsx` | `setShowInventory=\{(show) => updateUIState(\{ showInventory: show \})\}` | L3206 |


</details>
</tool-use>

---

<tool-use data-tool-type="write" data-tool-name="search_replace">

<details><summary>Tool use: **search_replace** • Edit file: /home/robwistrand/code/ga/projects/authentic-internet/client/src/components/GameWorld.jsx</summary>

**Chunk 1**
Lines added: 2, lines removed: undefined

```diff
@@ -130,4 +130,6 @@
      setQuestStatusMap,
      setMobileState,
+     setFormPosition,
+     setSoundManager,
    } = gameState;
  
```

</details>

</tool-use>

---

<tool-use data-tool-type="read" data-tool-name="read_file">
<details><summary>Tool use: **read_file** • Read file: /home/robwistrand/code/ga/projects/authentic-internet/client/src/components/GameWorld.jsx</summary>

</details>
</tool-use>

---

<tool-use data-tool-type="read" data-tool-name="read_file">
<details><summary>Tool use: **read_file** • Read file: /home/robwistrand/code/ga/projects/authentic-internet/client/src/components/GameWorld.jsx</summary>

</details>
</tool-use>

---



---


Fixing missing setters and prop issues:


---

<tool-use data-tool-type="write" data-tool-name="search_replace">

<details><summary>Tool use: **search_replace** • Edit file: /home/robwistrand/code/ga/projects/authentic-internet/client/src/components/GameWorld.jsx</summary>

**Chunk 1**
Lines added: 6, lines removed: 6

```diff
@@ -2876,11 +2876,11 @@
            {/* === CORE GAME WORLD === */}
            &lt;MapComponent
-             currentMapIndex={gameState.currentMapIndex}
-             exploredTiles={gameState.exploredTiles}
-             viewport={gameState.viewport}
-             characterPosition={gameState.characterPosition}
+             currentMapIndex={currentMapIndex}
+             exploredTiles={exploredTiles}
+             viewport={viewport}
+             characterPosition={characterPosition}
              artifacts={gameState.gameData.artifacts}
-             showArtifactsOnMap={gameState.uiState.showArtifactsOnMap}
-             inDungeon={gameState.uiState.inDungeon}
+             showArtifactsOnMap={uiState.showArtifactsOnMap}
+             inDungeon={uiState.inDungeon}
            /&gt;
  
```

</details>

</tool-use>

---

<tool-use data-tool-type="write" data-tool-name="search_replace">

<details><summary>Tool use: **search_replace** • Edit file: /home/robwistrand/code/ga/projects/authentic-internet/client/src/components/GameWorld.jsx</summary>

**Chunk 1**
Lines added: 3, lines removed: 3

```diff
@@ -2887,9 +2887,9 @@
            &lt;Character
              ref={characterRef}
-             position={gameState.characterPosition}
+             position={characterPosition || { x: 64, y: 64 }}
              characterState={gameState.characterState}
-             direction={gameState.characterState.direction}
+             direction={gameState.characterState?.direction || "down"}
              isLoggedIn={isLoggedIn}
-             character={gameState.character}
+             character={character}
              soundManager={gameState.soundManager}
              playerHealth={gameState.playerHealth}
```

</details>

</tool-use>

---

<tool-use data-tool-type="write" data-tool-name="search_replace">

<details><summary>Tool use: **search_replace** • Edit file: /home/robwistrand/code/ga/projects/authentic-internet/client/src/components/GameWorld.jsx</summary>

**Chunk 1**
Lines added: 1, lines removed: 1

```diff
@@ -2975,5 +2975,5 @@
                  /&gt;
                ) : (
-                 MAPS[currentMapIndex] &amp;&amp; (
+                 MAPS[currentMapIndex] &amp;&amp; MAPS[currentMapIndex].data &amp;&amp; (
                    &lt;MapComponent
                      mapData={MAPS[currentMapIndex].data}
```

**Chunk 2**
Lines added: 1, lines removed: 1

```diff
@@ -2984,5 +2984,5 @@
                      }
                      artifacts={
-                       !gameState.uiState.showArtifactsOnMap ? [] : artifactsToShow
+                       !uiState.showArtifactsOnMap ? [] : artifactsToShow
                      }
                      onTileClick={handleMapTileClick}
```

</details>

</tool-use>

---

<tool-use data-tool-type="write" data-tool-name="search_replace">

<details><summary>Tool use: **search_replace** • Edit file: /home/robwistrand/code/ga/projects/authentic-internet/client/src/components/GameWorld.jsx</summary>

**Chunk 1**
Lines added: 2, lines removed: 2

```diff
@@ -2919,9 +2919,9 @@
            &lt;Minimap
              mapData={MAPS[currentMapIndex]?.data || []}
-             playerPosition={characterPosition}
+             playerPosition={characterPosition || { x: 64, y: 64 }}
              npcs={MAPS[currentMapIndex]?.npcs || []}
              portals={MAPS[currentMapIndex]?.specialPortals || []}
              tileSize={TILE_SIZE}
-             exploredTiles={exploredTiles}
+             exploredTiles={exploredTiles instanceof Set ? exploredTiles : new Set()}
              currentArea={MAPS[currentMapIndex]?.name || "Overworld"}
            /&gt;
```

</details>

</tool-use>

---

<tool-use data-tool-type="search" data-tool-name="grep">
<details>
<summary>Tool use: **grep** • Grep for "const setShowInventory|setShowInventory\s*=" in "/home/robwistrand/code/ga/projects/authentic-internet/client/src/components/GameWorld.jsx" • 2 matches</summary>

Output mode: content


| File | Content | Line |
|------|------|------|
| `client/src/components/GameWorld.jsx` | `setShowInventory=\{setShowInventory\}` | L3005 |
| `client/src/components/GameWorld.jsx` | `setShowInventory=\{(show) => updateUIState(\{ showInventory: show \})\}` | L3208 |


</details>
</tool-use>

---

<tool-use data-tool-type="read" data-tool-name="read_file">
<details><summary>Tool use: **read_file** • Read file: /home/robwistrand/code/ga/projects/authentic-internet/client/src/components/GameWorld.jsx</summary>

</details>
</tool-use>

---

<tool-use data-tool-type="generic" data-tool-name="read_lints">
<details>
          <summary>Tool use: **read_lints** • Read lints for 1 file</summary>
      
Lint paths:

- `client/src/components/GameWorld.jsx`

Lint results


**No lint errors found**
</details>
</tool-use>

---



---


Fixing the `setShowInventory` reference:


---

<tool-use data-tool-type="write" data-tool-name="search_replace">

<details><summary>Tool use: **search_replace** • Edit file: /home/robwistrand/code/ga/projects/authentic-internet/client/src/components/GameWorld.jsx</summary>

**Chunk 1**
Lines added: 1, lines removed: 1

```diff
@@ -3003,5 +3003,5 @@
                  handleArtifactPickup={handleArtifactPickup}
                  setFormPosition={setFormPosition}
-                 setShowInventory={setShowInventory}
+                 setShowInventory={(show) =&gt; updateUIState({ showInventory: show })}
                  adjustViewport={adjustViewport}
                  activePowers={activePowers}
```

</details>

</tool-use>

---

<tool-use data-tool-type="generic" data-tool-name="read_lints">
<details>
          <summary>Tool use: **read_lints** • Read lints for 1 file</summary>
      
Lint paths:

- `client/src/components/GameWorld.jsx`

Lint results


**No lint errors found**
</details>
</tool-use>

---



---


Fixed the issues:

1. **Added missing setters** - Added `setFormPosition` and `setSoundManager` to the destructuring from `gameState`

2. **Fixed `setShowInventory`** - Changed it to use an inline function `(show) => updateUIState({ showInventory: show })` instead of a non-existent variable

3. **Fixed prop warnings**:
   - Updated `MapComponent` and `Character` to use destructured variables instead of `gameState.*`
   - Added safety check for `characterPosition` with default `{ x: 64, y: 64 }` if undefined
   - Added check to ensure `mapData` exists before rendering the inner `MapComponent`
   - Fixed `exploredTiles` to ensure it's a `Set` (checking `instanceof Set` and providing fallback)

4. **Fixed `exploredTiles` type issue** - Added a check to ensure it's a `Set` instance, not a function

These changes should resolve the reference errors and prop warnings. The component should now render without these errors.

---

_**User (2026-01-07 03:53Z)**_

 GameWorld.jsx:2877 Warning: Failed prop type: The prop `mapData` is marked as required in `Map`, but its value is `undefined`.
    at Map (http://localhost:5177/src/components/Map.jsx:31:3)
    at http://localhost:5177/src/components/GameWorld.jsx?t=1767887265644:97:45
    at ErrorBoundary (http://localhost:5177/src/components/ErrorBoundary.jsx:8:5)
    at Suspense
    at RenderedRoute (http://localhost:5177/node_modules/.vite/deps/react-router-dom.js?v=ce3ce900:4089:5)
    at Routes (http://localhost:5177/node_modules/.vite/deps/react-router-dom.js?v=ce3ce900:4559:5)
    at main
    at AchievementProvider (http://localhost:5177/src/context/AchievementContext.jsx:89:39)
    at div
    at App (http://localhost:5177/src/App.jsx?t=1767887265644:45:3)
    at ErrorBoundary (http://localhost:5177/src/components/ErrorBoundary.jsx:8:5)
    at GameStateProvider (http://localhost:5177/src/context/GameStateContext.jsx:98:37)
    at WebSocketProvider (http://localhost:5177/src/context/WebSocketContext.jsx:28:37)
    at AuthProvider (http://localhost:5177/src/context/AuthContext.jsx:227:32)
    at Router (http://localhost:5177/node_modules/.vite/deps/react-router-dom.js?v=ce3ce900:4502:15)
    at BrowserRouter (http://localhost:5177/node_modules/.vite/deps/react-router-dom.js?v=ce3ce900:5248:5)
printWarning @ react_jsx-dev-runtime.js?v=ce3ce900:64
error @ react_jsx-dev-runtime.js?v=ce3ce900:48
checkPropTypes @ react_jsx-dev-runtime.js?v=ce3ce900:451
validatePropTypes @ react_jsx-dev-runtime.js?v=ce3ce900:778
jsxWithValidation @ react_jsx-dev-runtime.js?v=ce3ce900:876
(anonymous) @ GameWorld.jsx:2877
renderWithHooks @ chunk-NUMECXU6.js?v=c9a7e100:11548
updateFunctionComponent @ chunk-NUMECXU6.js?v=c9a7e100:14582
updateSimpleMemoComponent @ chunk-NUMECXU6.js?v=c9a7e100:14463
beginWork @ chunk-NUMECXU6.js?v=c9a7e100:15980
beginWork$1 @ chunk-NUMECXU6.js?v=c9a7e100:19753
performUnitOfWork @ chunk-NUMECXU6.js?v=c9a7e100:19198
workLoopSync @ chunk-NUMECXU6.js?v=c9a7e100:19137
renderRootSync @ chunk-NUMECXU6.js?v=c9a7e100:19116
performConcurrentWorkOnRoot @ chunk-NUMECXU6.js?v=c9a7e100:18678
workLoop @ chunk-NUMECXU6.js?v=c9a7e100:197
flushWork @ chunk-NUMECXU6.js?v=c9a7e100:176
performWorkUntilDeadline @ chunk-NUMECXU6.js?v=c9a7e100:384
GameWorld.jsx:2887 Warning: Failed prop type: The prop `x` is marked as required in `Character`, but its value is `undefined`.
    at Character (http://localhost:5177/src/components/Character.jsx:23:3)
    at http://localhost:5177/src/components/GameWorld.jsx?t=1767887265644:97:45
    at ErrorBoundary (http://localhost:5177/src/components/ErrorBoundary.jsx:8:5)
    at Suspense
    at RenderedRoute (http://localhost:5177/node_modules/.vite/deps/react-router-dom.js?v=ce3ce900:4089:5)
    at Routes (http://localhost:5177/node_modules/.vite/deps/react-router-dom.js?v=ce3ce900:4559:5)
    at main
    at AchievementProvider (http://localhost:5177/src/context/AchievementContext.jsx:89:39)
    at div
    at App (http://localhost:5177/src/App.jsx?t=1767887265644:45:3)
    at ErrorBoundary (http://localhost:5177/src/components/ErrorBoundary.jsx:8:5)
    at GameStateProvider (http://localhost:5177/src/context/GameStateContext.jsx:98:37)
    at WebSocketProvider (http://localhost:5177/src/context/WebSocketContext.jsx:28:37)
    at AuthProvider (http://localhost:5177/src/context/AuthContext.jsx:227:32)
    at Router (http://localhost:5177/node_modules/.vite/deps/react-router-dom.js?v=ce3ce900:4502:15)
    at BrowserRouter (http://localhost:5177/node_modules/.vite/deps/react-router-dom.js?v=ce3ce900:5248:5)
printWarning @ react_jsx-dev-runtime.js?v=ce3ce900:64
error @ react_jsx-dev-runtime.js?v=ce3ce900:48
checkPropTypes @ react_jsx-dev-runtime.js?v=ce3ce900:451
validatePropTypes @ react_jsx-dev-runtime.js?v=ce3ce900:778
jsxWithValidation @ react_jsx-dev-runtime.js?v=ce3ce900:876
(anonymous) @ GameWorld.jsx:2887
renderWithHooks @ chunk-NUMECXU6.js?v=c9a7e100:11548
updateFunctionComponent @ chunk-NUMECXU6.js?v=c9a7e100:14582
updateSimpleMemoComponent @ chunk-NUMECXU6.js?v=c9a7e100:14463
beginWork @ chunk-NUMECXU6.js?v=c9a7e100:15980
beginWork$1 @ chunk-NUMECXU6.js?v=c9a7e100:19753
performUnitOfWork @ chunk-NUMECXU6.js?v=c9a7e100:19198
workLoopSync @ chunk-NUMECXU6.js?v=c9a7e100:19137
renderRootSync @ chunk-NUMECXU6.js?v=c9a7e100:19116
performConcurrentWorkOnRoot @ chunk-NUMECXU6.js?v=c9a7e100:18678
workLoop @ chunk-NUMECXU6.js?v=c9a7e100:197
flushWork @ chunk-NUMECXU6.js?v=c9a7e100:176
performWorkUntilDeadline @ chunk-NUMECXU6.js?v=c9a7e100:384
GameWorld.jsx:2887 Warning: Failed prop type: The prop `y` is marked as required in `Character`, but its value is `undefined`.
    at Character (http://localhost:5177/src/components/Character.jsx:23:3)
    at http://localhost:5177/src/components/GameWorld.jsx?t=1767887265644:97:45
    at ErrorBoundary (http://localhost:5177/src/components/ErrorBoundary.jsx:8:5)
    at Suspense
    at RenderedRoute (http://localhost:5177/node_modules/.vite/deps/react-router-dom.js?v=ce3ce900:4089:5)
    at Routes (http://localhost:5177/node_modules/.vite/deps/react-router-dom.js?v=ce3ce900:4559:5)
    at main
    at AchievementProvider (http://localhost:5177/src/context/AchievementContext.jsx:89:39)
    at div
    at App (http://localhost:5177/src/App.jsx?t=1767887265644:45:3)
    at ErrorBoundary (http://localhost:5177/src/components/ErrorBoundary.jsx:8:5)
    at GameStateProvider (http://localhost:5177/src/context/GameStateContext.jsx:98:37)
    at WebSocketProvider (http://localhost:5177/src/context/WebSocketContext.jsx:28:37)
    at AuthProvider (http://localhost:5177/src/context/AuthContext.jsx:227:32)
    at Router (http://localhost:5177/node_modules/.vite/deps/react-router-dom.js?v=ce3ce900:4502:15)
    at BrowserRouter (http://localhost:5177/node_modules/.vite/deps/react-router-dom.js?v=ce3ce900:5248:5)
printWarning @ react_jsx-dev-runtime.js?v=ce3ce900:64
error @ react_jsx-dev-runtime.js?v=ce3ce900:48
checkPropTypes @ react_jsx-dev-runtime.js?v=ce3ce900:451
validatePropTypes @ react_jsx-dev-runtime.js?v=ce3ce900:778
jsxWithValidation @ react_jsx-dev-runtime.js?v=ce3ce900:876
(anonymous) @ GameWorld.jsx:2887
renderWithHooks @ chunk-NUMECXU6.js?v=c9a7e100:11548
updateFunctionComponent @ chunk-NUMECXU6.js?v=c9a7e100:14582
updateSimpleMemoComponent @ chunk-NUMECXU6.js?v=c9a7e100:14463
beginWork @ chunk-NUMECXU6.js?v=c9a7e100:15980
beginWork$1 @ chunk-NUMECXU6.js?v=c9a7e100:19753
performUnitOfWork @ chunk-NUMECXU6.js?v=c9a7e100:19198
workLoopSync @ chunk-NUMECXU6.js?v=c9a7e100:19137
renderRootSync @ chunk-NUMECXU6.js?v=c9a7e100:19116
performConcurrentWorkOnRoot @ chunk-NUMECXU6.js?v=c9a7e100:18678
workLoop @ chunk-NUMECXU6.js?v=c9a7e100:197
flushWork @ chunk-NUMECXU6.js?v=c9a7e100:176
performWorkUntilDeadline @ chunk-NUMECXU6.js?v=c9a7e100:384
GameWorld.jsx:2978 Warning: Failed prop type: Function has non-object prototype 'undefined' in instanceof check
    at Map (http://localhost:5177/src/components/Map.jsx:31:3)
    at http://localhost:5177/src/components/GameWorld.jsx?t=1767887265644:97:45
    at ErrorBoundary (http://localhost:5177/src/components/ErrorBoundary.jsx:8:5)
    at Suspense
    at RenderedRoute (http://localhost:5177/node_modules/.vite/deps/react-router-dom.js?v=ce3ce900:4089:5)
    at Routes (http://localhost:5177/node_modules/.vite/deps/react-router-dom.js?v=ce3ce900:4559:5)
    at main
    at AchievementProvider (http://localhost:5177/src/context/AchievementContext.jsx:89:39)
    at div
    at App (http://localhost:5177/src/App.jsx?t=1767887265644:45:3)
    at ErrorBoundary (http://localhost:5177/src/components/ErrorBoundary.jsx:8:5)
    at GameStateProvider (http://localhost:5177/src/context/GameStateContext.jsx:98:37)
    at WebSocketProvider (http://localhost:5177/src/context/WebSocketContext.jsx:28:37)
    at AuthProvider (http://localhost:5177/src/context/AuthContext.jsx:227:32)
    at Router (http://localhost:5177/node_modules/.vite/deps/react-router-dom.js?v=ce3ce900:4502:15)
    at BrowserRouter (http://localhost:5177/node_modules/.vite/deps/react-router-dom.js?v=ce3ce900:5248:5)
printWarning @ react_jsx-dev-runtime.js?v=ce3ce900:64
error @ react_jsx-dev-runtime.js?v=ce3ce900:48
checkPropTypes @ react_jsx-dev-runtime.js?v=ce3ce900:451
validatePropTypes @ react_jsx-dev-runtime.js?v=ce3ce900:778
jsxWithValidation @ react_jsx-dev-runtime.js?v=ce3ce900:876
(anonymous) @ GameWorld.jsx:2978
renderWithHooks @ chunk-NUMECXU6.js?v=c9a7e100:11548
updateFunctionComponent @ chunk-NUMECXU6.js?v=c9a7e100:14582
updateSimpleMemoComponent @ chunk-NUMECXU6.js?v=c9a7e100:14463
beginWork @ chunk-NUMECXU6.js?v=c9a7e100:15980
beginWork$1 @ chunk-NUMECXU6.js?v=c9a7e100:19753
performUnitOfWork @ chunk-NUMECXU6.js?v=c9a7e100:19198
workLoopSync @ chunk-NUMECXU6.js?v=c9a7e100:19137
renderRootSync @ chunk-NUMECXU6.js?v=c9a7e100:19116
performConcurrentWorkOnRoot @ chunk-NUMECXU6.js?v=c9a7e100:18678
workLoop @ chunk-NUMECXU6.js?v=c9a7e100:197
flushWork @ chunk-NUMECXU6.js?v=c9a7e100:176
performWorkUntilDeadline @ chunk-NUMECXU6.js?v=c9a7e100:384
errorTracker.js:90 [unknown] Unhandled error: Uncaught ReferenceError: otherPlayers is not defined {source: 'http://localhost:5177/src/components/GameWorld.jsx?t=1767887265644', line: 2340, column: 19} ReferenceError: otherPlayers is not defined
    at GameWorld.jsx:3023:16
    at renderWithHooks (chunk-NUMECXU6.js?v=c9a7e100:11548:26)
    at updateFunctionComponent (chunk-NUMECXU6.js?v=c9a7e100:14582:28)
    at updateSimpleMemoComponent (chunk-NUMECXU6.js?v=c9a7e100:14463:18)
    at beginWork (chunk-NUMECXU6.js?v=c9a7e100:15980:22)
    at HTMLUnknownElement.callCallback2 (chunk-NUMECXU6.js?v=c9a7e100:3674:22)
    at Object.invokeGuardedCallbackDev (chunk-NUMECXU6.js?v=c9a7e100:3699:24)
    at invokeGuardedCallback (chunk-NUMECXU6.js?v=c9a7e100:3733:39)
    at beginWork$1 (chunk-NUMECXU6.js?v=c9a7e100:19765:15)
    at performUnitOfWork (chunk-NUMECXU6.js?v=c9a7e100:19198:20)
trackError @ errorTracker.js:90
(anonymous) @ errorTracker.js:196
invokeGuardedCallbackDev @ chunk-NUMECXU6.js?v=c9a7e100:3699
invokeGuardedCallback @ chunk-NUMECXU6.js?v=c9a7e100:3733
beginWork$1 @ chunk-NUMECXU6.js?v=c9a7e100:19765
performUnitOfWork @ chunk-NUMECXU6.js?v=c9a7e100:19198
workLoopSync @ chunk-NUMECXU6.js?v=c9a7e100:19137
renderRootSync @ chunk-NUMECXU6.js?v=c9a7e100:19116
performConcurrentWorkOnRoot @ chunk-NUMECXU6.js?v=c9a7e100:18678
workLoop @ chunk-NUMECXU6.js?v=c9a7e100:197
flushWork @ chunk-NUMECXU6.js?v=c9a7e100:176
performWorkUntilDeadline @ chunk-NUMECXU6.js?v=c9a7e100:384
GameWorld.jsx:3023 Uncaught ReferenceError: otherPlayers is not defined
    at GameWorld.jsx:3023:16
    at renderWithHooks (chunk-NUMECXU6.js?v=c9a7e100:11548:26)
    at updateFunctionComponent (chunk-NUMECXU6.js?v=c9a7e100:14582:28)
    at updateSimpleMemoComponent (chunk-NUMECXU6.js?v=c9a7e100:14463:18)
    at beginWork (chunk-NUMECXU6.js?v=c9a7e100:15980:22)
    at HTMLUnknownElement.callCallback2 (chunk-NUMECXU6.js?v=c9a7e100:3674:22)
    at Object.invokeGuardedCallbackDev (chunk-NUMECXU6.js?v=c9a7e100:3699:24)
    at invokeGuardedCallback (chunk-NUMECXU6.js?v=c9a7e100:3733:39)
    at beginWork$1 (chunk-NUMECXU6.js?v=c9a7e100:19765:15)
    at performUnitOfWork (chunk-NUMECXU6.js?v=c9a7e100:19198:20)
(anonymous) @ GameWorld.jsx:3023
renderWithHooks @ chunk-NUMECXU6.js?v=c9a7e100:11548
updateFunctionComponent @ chunk-NUMECXU6.js?v=c9a7e100:14582
updateSimpleMemoComponent @ chunk-NUMECXU6.js?v=c9a7e100:14463
beginWork @ chunk-NUMECXU6.js?v=c9a7e100:15980
callCallback2 @ chunk-NUMECXU6.js?v=c9a7e100:3674
invokeGuardedCallbackDev @ chunk-NUMECXU6.js?v=c9a7e100:3699
invokeGuardedCallback @ chunk-NUMECXU6.js?v=c9a7e100:3733
beginWork$1 @ chunk-NUMECXU6.js?v=c9a7e100:19765
performUnitOfWork @ chunk-NUMECXU6.js?v=c9a7e100:19198
workLoopSync @ chunk-NUMECXU6.js?v=c9a7e100:19137
renderRootSync @ chunk-NUMECXU6.js?v=c9a7e100:19116
performConcurrentWorkOnRoot @ chunk-NUMECXU6.js?v=c9a7e100:18678
workLoop @ chunk-NUMECXU6.js?v=c9a7e100:197
flushWork @ chunk-NUMECXU6.js?v=c9a7e100:176
performWorkUntilDeadline @ chunk-NUMECXU6.js?v=c9a7e100:384
errorTracker.js:90 [unknown] Unhandled error: Uncaught ReferenceError: otherPlayers is not defined {source: 'http://localhost:5177/src/components/GameWorld.jsx?t=1767887265644', line: 2340, column: 19} ReferenceError: otherPlayers is not defined
    at GameWorld.jsx:3023:16
    at renderWithHooks (chunk-NUMECXU6.js?v=c9a7e100:11548:26)
    at updateFunctionComponent (chunk-NUMECXU6.js?v=c9a7e100:14582:28)
    at updateSimpleMemoComponent (chunk-NUMECXU6.js?v=c9a7e100:14463:18)
    at beginWork (chunk-NUMECXU6.js?v=c9a7e100:15980:22)
    at HTMLUnknownElement.callCallback2 (chunk-NUMECXU6.js?v=c9a7e100:3674:22)
    at Object.invokeGuardedCallbackDev (chunk-NUMECXU6.js?v=c9a7e100:3699:24)
    at invokeGuardedCallback (chunk-NUMECXU6.js?v=c9a7e100:3733:39)
    at beginWork$1 (chunk-NUMECXU6.js?v=c9a7e100:19765:15)
    at performUnitOfWork (chunk-NUMECXU6.js?v=c9a7e100:19198:20)
trackError @ errorTracker.js:90
(anonymous) @ errorTracker.js:196
invokeGuardedCallbackDev @ chunk-NUMECXU6.js?v=c9a7e100:3699
invokeGuardedCallback @ chunk-NUMECXU6.js?v=c9a7e100:3733
beginWork$1 @ chunk-NUMECXU6.js?v=c9a7e100:19765
performUnitOfWork @ chunk-NUMECXU6.js?v=c9a7e100:19198
workLoopSync @ chunk-NUMECXU6.js?v=c9a7e100:19137
renderRootSync @ chunk-NUMECXU6.js?v=c9a7e100:19116
recoverFromConcurrentError @ chunk-NUMECXU6.js?v=c9a7e100:18736
performConcurrentWorkOnRoot @ chunk-NUMECXU6.js?v=c9a7e100:18684
workLoop @ chunk-NUMECXU6.js?v=c9a7e100:197
flushWork @ chunk-NUMECXU6.js?v=c9a7e100:176
performWorkUntilDeadline @ chunk-NUMECXU6.js?v=c9a7e100:384
GameWorld.jsx:3023 Uncaught ReferenceError: otherPlayers is not defined
    at GameWorld.jsx:3023:16
    at renderWithHooks (chunk-NUMECXU6.js?v=c9a7e100:11548:26)
    at updateFunctionComponent (chunk-NUMECXU6.js?v=c9a7e100:14582:28)
    at updateSimpleMemoComponent (chunk-NUMECXU6.js?v=c9a7e100:14463:18)
    at beginWork (chunk-NUMECXU6.js?v=c9a7e100:15980:22)
    at HTMLUnknownElement.callCallback2 (chunk-NUMECXU6.js?v=c9a7e100:3674:22)
    at Object.invokeGuardedCallbackDev (chunk-NUMECXU6.js?v=c9a7e100:3699:24)
    at invokeGuardedCallback (chunk-NUMECXU6.js?v=c9a7e100:3733:39)
    at beginWork$1 (chunk-NUMECXU6.js?v=c9a7e100:19765:15)
    at performUnitOfWork (chunk-NUMECXU6.js?v=c9a7e100:19198:20)
(anonymous) @ GameWorld.jsx:3023
renderWithHooks @ chunk-NUMECXU6.js?v=c9a7e100:11548
updateFunctionComponent @ chunk-NUMECXU6.js?v=c9a7e100:14582
updateSimpleMemoComponent @ chunk-NUMECXU6.js?v=c9a7e100:14463
beginWork @ chunk-NUMECXU6.js?v=c9a7e100:15980
callCallback2 @ chunk-NUMECXU6.js?v=c9a7e100:3674
invokeGuardedCallbackDev @ chunk-NUMECXU6.js?v=c9a7e100:3699
invokeGuardedCallback @ chunk-NUMECXU6.js?v=c9a7e100:3733
beginWork$1 @ chunk-NUMECXU6.js?v=c9a7e100:19765
performUnitOfWork @ chunk-NUMECXU6.js?v=c9a7e100:19198
workLoopSync @ chunk-NUMECXU6.js?v=c9a7e100:19137
renderRootSync @ chunk-NUMECXU6.js?v=c9a7e100:19116
recoverFromConcurrentError @ chunk-NUMECXU6.js?v=c9a7e100:18736
performConcurrentWorkOnRoot @ chunk-NUMECXU6.js?v=c9a7e100:18684
workLoop @ chunk-NUMECXU6.js?v=c9a7e100:197
flushWork @ chunk-NUMECXU6.js?v=c9a7e100:176
performWorkUntilDeadline @ chunk-NUMECXU6.js?v=c9a7e100:384
chunk-NUMECXU6.js?v=c9a7e100:14032 The above error occurred in the <GameWorld> component:

    at http://localhost:5177/src/components/GameWorld.jsx?t=1767887265644:97:45
    at ErrorBoundary (http://localhost:5177/src/components/ErrorBoundary.jsx:8:5)
    at Suspense
    at RenderedRoute (http://localhost:5177/node_modules/.vite/deps/react-router-dom.js?v=ce3ce900:4089:5)
    at Routes (http://localhost:5177/node_modules/.vite/deps/react-router-dom.js?v=ce3ce900:4559:5)
    at main
    at AchievementProvider (http://localhost:5177/src/context/AchievementContext.jsx:89:39)
    at div
    at App (http://localhost:5177/src/App.jsx?t=1767887265644:45:3)
    at ErrorBoundary (http://localhost:5177/src/components/ErrorBoundary.jsx:8:5)
    at GameStateProvider (http://localhost:5177/src/context/GameStateContext.jsx:98:37)
    at WebSocketProvider (http://localhost:5177/src/context/WebSocketContext.jsx:28:37)
    at AuthProvider (http://localhost:5177/src/context/AuthContext.jsx:227:32)
    at Router (http://localhost:5177/node_modules/.vite/deps/react-router-dom.js?v=ce3ce900:4502:15)
    at BrowserRouter (http://localhost:5177/node_modules/.vite/deps/react-router-dom.js?v=ce3ce900:5248:5)

React will try to recreate this component tree from scratch using the error boundary you provided, ErrorBoundary.
logCapturedError @ chunk-NUMECXU6.js?v=c9a7e100:14032
callback @ chunk-NUMECXU6.js?v=c9a7e100:14078
callCallback @ chunk-NUMECXU6.js?v=c9a7e100:11248
commitUpdateQueue @ chunk-NUMECXU6.js?v=c9a7e100:11265
commitLayoutEffectOnFiber @ chunk-NUMECXU6.js?v=c9a7e100:17075
commitLayoutMountEffects_complete @ chunk-NUMECXU6.js?v=c9a7e100:17980
commitLayoutEffects_begin @ chunk-NUMECXU6.js?v=c9a7e100:17969
commitLayoutEffects_begin @ chunk-NUMECXU6.js?v=c9a7e100:17950
commitLayoutEffects @ chunk-NUMECXU6.js?v=c9a7e100:17920
commitRootImpl @ chunk-NUMECXU6.js?v=c9a7e100:19353
commitRoot @ chunk-NUMECXU6.js?v=c9a7e100:19277
finishConcurrentRender @ chunk-NUMECXU6.js?v=c9a7e100:18760
performConcurrentWorkOnRoot @ chunk-NUMECXU6.js?v=c9a7e100:18718
workLoop @ chunk-NUMECXU6.js?v=c9a7e100:197
flushWork @ chunk-NUMECXU6.js?v=c9a7e100:176
performWorkUntilDeadline @ chunk-NUMECXU6.js?v=c9a7e100:384
ErrorBoundary.jsx:31 Error caught by boundary: ReferenceError: otherPlayers is not defined
    at GameWorld.jsx:3023:16
    at renderWithHooks (chunk-NUMECXU6.js?v=c9a7e100:11548:26)
    at updateFunctionComponent (chunk-NUMECXU6.js?v=c9a7e100:14582:28)
    at updateSimpleMemoComponent (chunk-NUMECXU6.js?v=c9a7e100:14463:18)
    at beginWork (chunk-NUMECXU6.js?v=c9a7e100:15980:22)
    at beginWork$1 (chunk-NUMECXU6.js?v=c9a7e100:19753:22)
    at performUnitOfWork (chunk-NUMECXU6.js?v=c9a7e100:19198:20)
    at workLoopSync (chunk-NUMECXU6.js?v=c9a7e100:19137:13)
    at renderRootSync (chunk-NUMECXU6.js?v=c9a7e100:19116:15)
    at recoverFromConcurrentError (chunk-NUMECXU6.js?v=c9a7e100:18736:28) {componentStack: '\n    at http://localhost:5177/src/components/GameW….vite/deps/react-router-dom.js?v=ce3ce900:5248:5)'}
componentDidCatch @ ErrorBoundary.jsx:31
callback @ chunk-NUMECXU6.js?v=c9a7e100:14084
callCallback @ chunk-NUMECXU6.js?v=c9a7e100:11248
commitUpdateQueue @ chunk-NUMECXU6.js?v=c9a7e100:11265
commitLayoutEffectOnFiber @ chunk-NUMECXU6.js?v=c9a7e100:17075
commitLayoutMountEffects_complete @ chunk-NUMECXU6.js?v=c9a7e100:17980
commitLayoutEffects_begin @ chunk-NUMECXU6.js?v=c9a7e100:17969
commitLayoutEffects_begin @ chunk-NUMECXU6.js?v=c9a7e100:17950
commitLayoutEffects @ chunk-NUMECXU6.js?v=c9a7e100:17920
commitRootImpl @ chunk-NUMECXU6.js?v=c9a7e100:19353
commitRoot @ chunk-NUMECXU6.js?v=c9a7e100:19277
finishConcurrentRender @ chunk-NUMECXU6.js?v=c9a7e100:18760
performConcurrentWorkOnRoot @ chunk-NUMECXU6.js?v=c9a7e100:18718
workLoop @ chunk-NUMECXU6.js?v=c9a7e100:197
flushWork @ chunk-NUMECXU6.js?v=c9a7e100:176
performWorkUntilDeadline @ chunk-NUMECXU6.js?v=c9a7e100:384
api.js:134 Network error: Network Error
(anonymous) @ api.js:134
Promise.then
_request @ axios.js?v=b1588b43:2195
request @ axios.js?v=b1588b43:2104
Axios.<computed> @ axios.js?v=b1588b43:2232
wrap @ axios.js?v=b1588b43:8
withCache.duration @ api.js:1104
(anonymous) @ cacheManager.js:159
loadArtifacts @ GameWorld.jsx:1843
(anonymous) @ GameWorld.jsx:1850
commitHookEffectListMount @ chunk-NUMECXU6.js?v=c9a7e100:16915
commitPassiveMountOnFiber @ chunk-NUMECXU6.js?v=c9a7e100:18156
commitPassiveMountEffects_complete @ chunk-NUMECXU6.js?v=c9a7e100:18129
commitPassiveMountEffects_begin @ chunk-NUMECXU6.js?v=c9a7e100:18119
commitPassiveMountEffects @ chunk-NUMECXU6.js?v=c9a7e100:18109
flushPassiveEffectsImpl @ chunk-NUMECXU6.js?v=c9a7e100:19490
flushPassiveEffects @ chunk-NUMECXU6.js?v=c9a7e100:19447
(anonymous) @ chunk-NUMECXU6.js?v=c9a7e100:19328
workLoop @ chunk-NUMECXU6.js?v=c9a7e100:197
flushWork @ chunk-NUMECXU6.js?v=c9a7e100:176
performWorkUntilDeadline @ chunk-NUMECXU6.js?v=c9a7e100:384
api.js:1107 Error fetching artifacts: Error: Network error. Please check your connection.
    at api.js:136:11
    at async Axios.request (axios.js?v=b1588b43:2104:14)
    at async withCache.duration (api.js:1104:24)
    at async cacheManager.js:159:22
    at async loadArtifacts (GameWorld.jsx:1843:31)
withCache.duration @ api.js:1107
await in withCache.duration
(anonymous) @ cacheManager.js:159
loadArtifacts @ GameWorld.jsx:1843
(anonymous) @ GameWorld.jsx:1850
commitHookEffectListMount @ chunk-NUMECXU6.js?v=c9a7e100:16915
commitPassiveMountOnFiber @ chunk-NUMECXU6.js?v=c9a7e100:18156
commitPassiveMountEffects_complete @ chunk-NUMECXU6.js?v=c9a7e100:18129
commitPassiveMountEffects_begin @ chunk-NUMECXU6.js?v=c9a7e100:18119
commitPassiveMountEffects @ chunk-NUMECXU6.js?v=c9a7e100:18109
flushPassiveEffectsImpl @ chunk-NUMECXU6.js?v=c9a7e100:19490
flushPassiveEffects @ chunk-NUMECXU6.js?v=c9a7e100:19447
(anonymous) @ chunk-NUMECXU6.js?v=c9a7e100:19328
workLoop @ chunk-NUMECXU6.js?v=c9a7e100:197
flushWork @ chunk-NUMECXU6.js?v=c9a7e100:176
performWorkUntilDeadline @ chunk-NUMECXU6.js?v=c9a7e100:384
errorTracker.js:90 [performance] Error in cached function  {args: Array(0)} Error: Network error. Please check your connection.
    at api.js:136:11
    at async Axios.request (axios.js?v=b1588b43:2104:14)
    at async withCache.duration (api.js:1104:24)
    at async cacheManager.js:159:22
    at async loadArtifacts (GameWorld.jsx:1843:31)
trackError @ errorTracker.js:90
(anonymous) @ cacheManager.js:165
await in (anonymous)
loadArtifacts @ GameWorld.jsx:1843
(anonymous) @ GameWorld.jsx:1850
commitHookEffectListMount @ chunk-NUMECXU6.js?v=c9a7e100:16915
commitPassiveMountOnFiber @ chunk-NUMECXU6.js?v=c9a7e100:18156
commitPassiveMountEffects_complete @ chunk-NUMECXU6.js?v=c9a7e100:18129
commitPassiveMountEffects_begin @ chunk-NUMECXU6.js?v=c9a7e100:18119
commitPassiveMountEffects @ chunk-NUMECXU6.js?v=c9a7e100:18109
flushPassiveEffectsImpl @ chunk-NUMECXU6.js?v=c9a7e100:19490
flushPassiveEffects @ chunk-NUMECXU6.js?v=c9a7e100:19447
(anonymous) @ chunk-NUMECXU6.js?v=c9a7e100:19328
workLoop @ chunk-NUMECXU6.js?v=c9a7e100:197
flushWork @ chunk-NUMECXU6.js?v=c9a7e100:176
performWorkUntilDeadline @ chunk-NUMECXU6.js?v=c9a7e100:384
GameWorld.jsx:1846 Error loading artifacts: Error: Network error. Please check your connection.
    at api.js:136:11
    at async Axios.request (axios.js?v=b1588b43:2104:14)
    at async withCache.duration (api.js:1104:24)
    at async cacheManager.js:159:22
    at async loadArtifacts (GameWorld.jsx:1843:31)
loadArtifacts @ GameWorld.jsx:1846
await in loadArtifacts
(anonymous) @ GameWorld.jsx:1850
commitHookEffectListMount @ chunk-NUMECXU6.js?v=c9a7e100:16915
commitPassiveMountOnFiber @ chunk-NUMECXU6.js?v=c9a7e100:18156
commitPassiveMountEffects_complete @ chunk-NUMECXU6.js?v=c9a7e100:18129
commitPassiveMountEffects_begin @ chunk-NUMECXU6.js?v=c9a7e100:18119
commitPassiveMountEffects @ chunk-NUMECXU6.js?v=c9a7e100:18109
flushPassiveEffectsImpl @ chunk-NUMECXU6.js?v=c9a7e100:19490
flushPassiveEffects @ chunk-NUMECXU6.js?v=c9a7e100:19447
(anonymous) @ chunk-NUMECXU6.js?v=c9a7e100:19328
workLoop @ chunk-NUMECXU6.js?v=c9a7e100:197
flushWork @ chunk-NUMECXU6.js?v=c9a7e100:176
performWorkUntilDeadline @ chunk-NUMECXU6.js?v=c9a7e100:384
api.js:1104  GET http://localhost:5000/api/artifacts net::ERR_CONNECTION_REFUSED
dispatchXhrRequest @ axios.js?v=b1588b43:1637
xhr @ axios.js?v=b1588b43:1517
dispatchRequest @ axios.js?v=b1588b43:1992
Promise.then
_request @ axios.js?v=b1588b43:2195
request @ axios.js?v=b1588b43:2104
Axios.<computed> @ axios.js?v=b1588b43:2232
wrap @ axios.js?v=b1588b43:8
withCache.duration @ api.js:1104
(anonymous) @ cacheManager.js:159
loadArtifacts @ GameWorld.jsx:1843
(anonymous) @ GameWorld.jsx:1850
commitHookEffectListMount @ chunk-NUMECXU6.js?v=c9a7e100:16915
commitPassiveMountOnFiber @ chunk-NUMECXU6.js?v=c9a7e100:18156
commitPassiveMountEffects_complete @ chunk-NUMECXU6.js?v=c9a7e100:18129
commitPassiveMountEffects_begin @ chunk-NUMECXU6.js?v=c9a7e100:18119
commitPassiveMountEffects @ chunk-NUMECXU6.js?v=c9a7e100:18109
flushPassiveEffectsImpl @ chunk-NUMECXU6.js?v=c9a7e100:19490
flushPassiveEffects @ chunk-NUMECXU6.js?v=c9a7e100:19447
(anonymous) @ chunk-NUMECXU6.js?v=c9a7e100:19328
workLoop @ chunk-NUMECXU6.js?v=c9a7e100:197
flushWork @ chunk-NUMECXU6.js?v=c9a7e100:176
performWorkUntilDeadline @ chunk-NUMECXU6.js?v=c9a7e100:384
errorTracker.js:138  POST http://localhost:5177/api/diagnostics/errors net::ERR_ABORTED 500 (Internal Server Error)
reportErrorToServer @ errorTracker.js:138
trackError @ errorTracker.js:106
(anonymous) @ errorTracker.js:196
invokeGuardedCallbackDev @ chunk-NUMECXU6.js?v=c9a7e100:3699
invokeGuardedCallback @ chunk-NUMECXU6.js?v=c9a7e100:3733
beginWork$1 @ chunk-NUMECXU6.js?v=c9a7e100:19765
performUnitOfWork @ chunk-NUMECXU6.js?v=c9a7e100:19198
workLoopSync @ chunk-NUMECXU6.js?v=c9a7e100:19137
renderRootSync @ chunk-NUMECXU6.js?v=c9a7e100:19116
performConcurrentWorkOnRoot @ chunk-NUMECXU6.js?v=c9a7e100:18678
workLoop @ chunk-NUMECXU6.js?v=c9a7e100:197
flushWork @ chunk-NUMECXU6.js?v=c9a7e100:176
performWorkUntilDeadline @ chunk-NUMECXU6.js?v=c9a7e100:384
errorTracker.js:152 Error reporting to server: Error: Server returned 500: Internal Server Error
    at reportErrorToServer (errorTracker.js:145:13)
reportErrorToServer @ errorTracker.js:152
await in reportErrorToServer
trackError @ errorTracker.js:106
(anonymous) @ errorTracker.js:196
invokeGuardedCallbackDev @ chunk-NUMECXU6.js?v=c9a7e100:3699
invokeGuardedCallback @ chunk-NUMECXU6.js?v=c9a7e100:3733
beginWork$1 @ chunk-NUMECXU6.js?v=c9a7e100:19765
performUnitOfWork @ chunk-NUMECXU6.js?v=c9a7e100:19198
workLoopSync @ chunk-NUMECXU6.js?v=c9a7e100:19137
renderRootSync @ chunk-NUMECXU6.js?v=c9a7e100:19116
performConcurrentWorkOnRoot @ chunk-NUMECXU6.js?v=c9a7e100:18678
workLoop @ chunk-NUMECXU6.js?v=c9a7e100:197
flushWork @ chunk-NUMECXU6.js?v=c9a7e100:176
performWorkUntilDeadline @ chunk-NUMECXU6.js?v=c9a7e100:384
errorTracker.js:113 Failed to report critical error to server: Error: Server returned 500: Internal Server Error
    at reportErrorToServer (errorTracker.js:145:13)
(anonymous) @ errorTracker.js:113
Promise.catch
trackError @ errorTracker.js:106
(anonymous) @ errorTracker.js:196
invokeGuardedCallbackDev @ chunk-NUMECXU6.js?v=c9a7e100:3699
invokeGuardedCallback @ chunk-NUMECXU6.js?v=c9a7e100:3733
beginWork$1 @ chunk-NUMECXU6.js?v=c9a7e100:19765
performUnitOfWork @ chunk-NUMECXU6.js?v=c9a7e100:19198
workLoopSync @ chunk-NUMECXU6.js?v=c9a7e100:19137
renderRootSync @ chunk-NUMECXU6.js?v=c9a7e100:19116
performConcurrentWorkOnRoot @ chunk-NUMECXU6.js?v=c9a7e100:18678
workLoop @ chunk-NUMECXU6.js?v=c9a7e100:197
flushWork @ chunk-NUMECXU6.js?v=c9a7e100:176
performWorkUntilDeadline @ chunk-NUMECXU6.js?v=c9a7e100:384
errorTracker.js:138  POST http://localhost:5177/api/diagnostics/errors net::ERR_ABORTED 500 (Internal Server Error)
reportErrorToServer @ errorTracker.js:138
trackError @ errorTracker.js:106
(anonymous) @ errorTracker.js:196
invokeGuardedCallbackDev @ chunk-NUMECXU6.js?v=c9a7e100:3699
invokeGuardedCallback @ chunk-NUMECXU6.js?v=c9a7e100:3733
beginWork$1 @ chunk-NUMECXU6.js?v=c9a7e100:19765
performUnitOfWork @ chunk-NUMECXU6.js?v=c9a7e100:19198
workLoopSync @ chunk-NUMECXU6.js?v=c9a7e100:19137
renderRootSync @ chunk-NUMECXU6.js?v=c9a7e100:19116
recoverFromConcurrentError @ chunk-NUMECXU6.js?v=c9a7e100:18736
performConcurrentWorkOnRoot @ chunk-NUMECXU6.js?v=c9a7e100:18684
workLoop @ chunk-NUMECXU6.js?v=c9a7e100:197
flushWork @ chunk-NUMECXU6.js?v=c9a7e100:176
performWorkUntilDeadline @ chunk-NUMECXU6.js?v=c9a7e100:384
errorTracker.js:152 Error reporting to server: Error: Server returned 500: Internal Server Error
    at reportErrorToServer (errorTracker.js:145:13)
reportErrorToServer @ errorTracker.js:152
await in reportErrorToServer
trackError @ errorTracker.js:106
(anonymous) @ errorTracker.js:196
invokeGuardedCallbackDev @ chunk-NUMECXU6.js?v=c9a7e100:3699
invokeGuardedCallback @ chunk-NUMECXU6.js?v=c9a7e100:3733
beginWork$1 @ chunk-NUMECXU6.js?v=c9a7e100:19765
performUnitOfWork @ chunk-NUMECXU6.js?v=c9a7e100:19198
workLoopSync @ chunk-NUMECXU6.js?v=c9a7e100:19137
renderRootSync @ chunk-NUMECXU6.js?v=c9a7e100:19116
recoverFromConcurrentError @ chunk-NUMECXU6.js?v=c9a7e100:18736
performConcurrentWorkOnRoot @ chunk-NUMECXU6.js?v=c9a7e100:18684
workLoop @ chunk-NUMECXU6.js?v=c9a7e100:197
flushWork @ chunk-NUMECXU6.js?v=c9a7e100:176
performWorkUntilDeadline @ chunk-NUMECXU6.js?v=c9a7e100:384
errorTracker.js:113 Failed to report critical error to server: Error: Server returned 500: Internal Server Error
    at reportErrorToServer (errorTracker.js:145:13)
(anonymous) @ errorTracker.js:113
Promise.catch
trackError @ errorTracker.js:106
(anonymous) @ errorTracker.js:196
invokeGuardedCallbackDev @ chunk-NUMECXU6.js?v=c9a7e100:3699
invokeGuardedCallback @ chunk-NUMECXU6.js?v=c9a7e100:3733
beginWork$1 @ chunk-NUMECXU6.js?v=c9a7e100:19765
performUnitOfWork @ chunk-NUMECXU6.js?v=c9a7e100:19198
workLoopSync @ chunk-NUMECXU6.js?v=c9a7e100:19137
renderRootSync @ chunk-NUMECXU6.js?v=c9a7e100:19116
recoverFromConcurrentError @ chunk-NUMECXU6.js?v=c9a7e100:18736
performConcurrentWorkOnRoot @ chunk-NUMECXU6.js?v=c9a7e100:18684
workLoop @ chunk-NUMECXU6.js?v=c9a7e100:197
flushWork @ chunk-NUMECXU6.js?v=c9a7e100:176
performWorkUntilDeadline @ chunk-NUMECXU6.js?v=c9a7e100:384
SoundManager.js:187 ❌ Error loading sound whisper: EncodingError: Unable to decode audio data
loadSound @ SoundManager.js:187
await in loadSound
loadSoundWithFallback @ SoundManager.js:157
(anonymous) @ SoundManager.js:70
initialize @ SoundManager.js:69
(anonymous) @ GameWorld.jsx:1663
(anonymous) @ GameWorld.jsx:1691
commitHookEffectListMount @ chunk-NUMECXU6.js?v=c9a7e100:16915
commitPassiveMountOnFiber @ chunk-NUMECXU6.js?v=c9a7e100:18156
commitPassiveMountEffects_complete @ chunk-NUMECXU6.js?v=c9a7e100:18129
commitPassiveMountEffects_begin @ chunk-NUMECXU6.js?v=c9a7e100:18119
commitPassiveMountEffects @ chunk-NUMECXU6.js?v=c9a7e100:18109
flushPassiveEffectsImpl @ chunk-NUMECXU6.js?v=c9a7e100:19490
flushPassiveEffects @ chunk-NUMECXU6.js?v=c9a7e100:19447
(anonymous) @ chunk-NUMECXU6.js?v=c9a7e100:19328
workLoop @ chunk-NUMECXU6.js?v=c9a7e100:197
flushWork @ chunk-NUMECXU6.js?v=c9a7e100:176
performWorkUntilDeadline @ chunk-NUMECXU6.js?v=c9a7e100:384
SoundManager.js:187 ❌ Error loading sound digital_transition: EncodingError: Unable to decode audio data
loadSound @ SoundManager.js:187
await in loadSound
loadSoundWithFallback @ SoundManager.js:157
(anonymous) @ SoundManager.js:70
initialize @ SoundManager.js:69
(anonymous) @ GameWorld.jsx:1663
(anonymous) @ GameWorld.jsx:1691
commitHookEffectListMount @ chunk-NUMECXU6.js?v=c9a7e100:16915
commitPassiveMountOnFiber @ chunk-NUMECXU6.js?v=c9a7e100:18156
commitPassiveMountEffects_complete @ chunk-NUMECXU6.js?v=c9a7e100:18129
commitPassiveMountEffects_begin @ chunk-NUMECXU6.js?v=c9a7e100:18119
commitPassiveMountEffects @ chunk-NUMECXU6.js?v=c9a7e100:18109
flushPassiveEffectsImpl @ chunk-NUMECXU6.js?v=c9a7e100:19490
flushPassiveEffects @ chunk-NUMECXU6.js?v=c9a7e100:19447
(anonymous) @ chunk-NUMECXU6.js?v=c9a7e100:19328
workLoop @ chunk-NUMECXU6.js?v=c9a7e100:197
flushWork @ chunk-NUMECXU6.js?v=c9a7e100:176
performWorkUntilDeadline @ chunk-NUMECXU6.js?v=c9a7e100:384
SoundManager.js:187 ❌ Error loading sound toilet_flush: EncodingError: Unable to decode audio data
loadSound @ SoundManager.js:187
await in loadSound
loadSoundWithFallback @ SoundManager.js:157
(anonymous) @ SoundManager.js:70
initialize @ SoundManager.js:69
(anonymous) @ GameWorld.jsx:1663
(anonymous) @ GameWorld.jsx:1691
commitHookEffectListMount @ chunk-NUMECXU6.js?v=c9a7e100:16915
commitPassiveMountOnFiber @ chunk-NUMECXU6.js?v=c9a7e100:18156
commitPassiveMountEffects_complete @ chunk-NUMECXU6.js?v=c9a7e100:18129
commitPassiveMountEffects_begin @ chunk-NUMECXU6.js?v=c9a7e100:18119
commitPassiveMountEffects @ chunk-NUMECXU6.js?v=c9a7e100:18109
flushPassiveEffectsImpl @ chunk-NUMECXU6.js?v=c9a7e100:19490
flushPassiveEffects @ chunk-NUMECXU6.js?v=c9a7e100:19447
(anonymous) @ chunk-NUMECXU6.js?v=c9a7e100:19328
workLoop @ chunk-NUMECXU6.js?v=c9a7e100:197
flushWork @ chunk-NUMECXU6.js?v=c9a7e100:176
performWorkUntilDeadline @ chunk-NUMECXU6.js?v=c9a7e100:384
SoundManager.js:187 ❌ Error loading sound sword_beam: EncodingError: Unable to decode audio data
loadSound @ SoundManager.js:187
await in loadSound
loadSoundWithFallback @ SoundManager.js:157
(anonymous) @ SoundManager.js:70
initialize @ SoundManager.js:69
(anonymous) @ GameWorld.jsx:1663
(anonymous) @ GameWorld.jsx:1691
commitHookEffectListMount @ chunk-NUMECXU6.js?v=c9a7e100:16915
commitPassiveMountOnFiber @ chunk-NUMECXU6.js?v=c9a7e100:18156
commitPassiveMountEffects_complete @ chunk-NUMECXU6.js?v=c9a7e100:18129
commitPassiveMountEffects_begin @ chunk-NUMECXU6.js?v=c9a7e100:18119
commitPassiveMountEffects @ chunk-NUMECXU6.js?v=c9a7e100:18109
flushPassiveEffectsImpl @ chunk-NUMECXU6.js?v=c9a7e100:19490
flushPassiveEffects @ chunk-NUMECXU6.js?v=c9a7e100:19447
(anonymous) @ chunk-NUMECXU6.js?v=c9a7e100:19328
workLoop @ chunk-NUMECXU6.js?v=c9a7e100:197
flushWork @ chunk-NUMECXU6.js?v=c9a7e100:176
performWorkUntilDeadline @ chunk-NUMECXU6.js?v=c9a7e100:384
SoundManager.js:187 ❌ Error loading sound damage: EncodingError: Unable to decode audio data
loadSound @ SoundManager.js:187
await in loadSound
loadSoundWithFallback @ SoundManager.js:157
(anonymous) @ SoundManager.js:70
initialize @ SoundManager.js:69
(anonymous) @ GameWorld.jsx:1663
(anonymous) @ GameWorld.jsx:1691
commitHookEffectListMount @ chunk-NUMECXU6.js?v=c9a7e100:16915
commitPassiveMountOnFiber @ chunk-NUMECXU6.js?v=c9a7e100:18156
commitPassiveMountEffects_complete @ chunk-NUMECXU6.js?v=c9a7e100:18129
commitPassiveMountEffects_begin @ chunk-NUMECXU6.js?v=c9a7e100:18119
commitPassiveMountEffects @ chunk-NUMECXU6.js?v=c9a7e100:18109
flushPassiveEffectsImpl @ chunk-NUMECXU6.js?v=c9a7e100:19490
flushPassiveEffects @ chunk-NUMECXU6.js?v=c9a7e100:19447
(anonymous) @ chunk-NUMECXU6.js?v=c9a7e100:19328
workLoop @ chunk-NUMECXU6.js?v=c9a7e100:197
flushWork @ chunk-NUMECXU6.js?v=c9a7e100:176
performWorkUntilDeadline @ chunk-NUMECXU6.js?v=c9a7e100:384
SoundManager.js:187 ❌ Error loading sound sword: EncodingError: Unable to decode audio data
loadSound @ SoundManager.js:187
await in loadSound
loadSoundWithFallback @ SoundManager.js:157
(anonymous) @ SoundManager.js:70
initialize @ SoundManager.js:69
(anonymous) @ GameWorld.jsx:1663
(anonymous) @ GameWorld.jsx:1691
commitHookEffectListMount @ chunk-NUMECXU6.js?v=c9a7e100:16915
commitPassiveMountOnFiber @ chunk-NUMECXU6.js?v=c9a7e100:18156
commitPassiveMountEffects_complete @ chunk-NUMECXU6.js?v=c9a7e100:18129
commitPassiveMountEffects_begin @ chunk-NUMECXU6.js?v=c9a7e100:18119
commitPassiveMountEffects @ chunk-NUMECXU6.js?v=c9a7e100:18109
flushPassiveEffectsImpl @ chunk-NUMECXU6.js?v=c9a7e100:19490
flushPassiveEffects @ chunk-NUMECXU6.js?v=c9a7e100:19447
(anonymous) @ chunk-NUMECXU6.js?v=c9a7e100:19328
workLoop @ chunk-NUMECXU6.js?v=c9a7e100:197
flushWork @ chunk-NUMECXU6.js?v=c9a7e100:176
performWorkUntilDeadline @ chunk-NUMECXU6.js?v=c9a7e100:384
SoundManager.js:187 ❌ Error loading sound heal: EncodingError: Unable to decode audio data
loadSound @ SoundManager.js:187
await in loadSound
loadSoundWithFallback @ SoundManager.js:157
(anonymous) @ SoundManager.js:70
initialize @ SoundManager.js:69
(anonymous) @ GameWorld.jsx:1663
(anonymous) @ GameWorld.jsx:1691
commitHookEffectListMount @ chunk-NUMECXU6.js?v=c9a7e100:16915
commitPassiveMountOnFiber @ chunk-NUMECXU6.js?v=c9a7e100:18156
commitPassiveMountEffects_complete @ chunk-NUMECXU6.js?v=c9a7e100:18129
commitPassiveMountEffects_begin @ chunk-NUMECXU6.js?v=c9a7e100:18119
commitPassiveMountEffects @ chunk-NUMECXU6.js?v=c9a7e100:18109
flushPassiveEffectsImpl @ chunk-NUMECXU6.js?v=c9a7e100:19490
flushPassiveEffects @ chunk-NUMECXU6.js?v=c9a7e100:19447
(anonymous) @ chunk-NUMECXU6.js?v=c9a7e100:19328
workLoop @ chunk-NUMECXU6.js?v=c9a7e100:197
flushWork @ chunk-NUMECXU6.js?v=c9a7e100:176
performWorkUntilDeadline @ chunk-NUMECXU6.js?v=c9a7e100:384
SoundManager.js:187 ❌ Error loading sound key: EncodingError: Unable to decode audio data
loadSound @ SoundManager.js:187
await in loadSound
loadSoundWithFallback @ SoundManager.js:157
(anonymous) @ SoundManager.js:70
initialize @ SoundManager.js:69
(anonymous) @ GameWorld.jsx:1663
(anonymous) @ GameWorld.jsx:1691
commitHookEffectListMount @ chunk-NUMECXU6.js?v=c9a7e100:16915
commitPassiveMountOnFiber @ chunk-NUMECXU6.js?v=c9a7e100:18156
commitPassiveMountEffects_complete @ chunk-NUMECXU6.js?v=c9a7e100:18129
commitPassiveMountEffects_begin @ chunk-NUMECXU6.js?v=c9a7e100:18119
commitPassiveMountEffects @ chunk-NUMECXU6.js?v=c9a7e100:18109
flushPassiveEffectsImpl @ chunk-NUMECXU6.js?v=c9a7e100:19490
flushPassiveEffects @ chunk-NUMECXU6.js?v=c9a7e100:19447
(anonymous) @ chunk-NUMECXU6.js?v=c9a7e100:19328
workLoop @ chunk-NUMECXU6.js?v=c9a7e100:197
flushWork @ chunk-NUMECXU6.js?v=c9a7e100:176
performWorkUntilDeadline @ chunk-NUMECXU6.js?v=c9a7e100:384
SoundManager.js:187 ❌ Error loading sound rupee: EncodingError: Unable to decode audio data
loadSound @ SoundManager.js:187
await in loadSound
loadSoundWithFallback @ SoundManager.js:157
(anonymous) @ SoundManager.js:70
initialize @ SoundManager.js:69
(anonymous) @ GameWorld.jsx:1663
(anonymous) @ GameWorld.jsx:1691
commitHookEffectListMount @ chunk-NUMECXU6.js?v=c9a7e100:16915
commitPassiveMountOnFiber @ chunk-NUMECXU6.js?v=c9a7e100:18156
commitPassiveMountEffects_complete @ chunk-NUMECXU6.js?v=c9a7e100:18129
commitPassiveMountEffects_begin @ chunk-NUMECXU6.js?v=c9a7e100:18119
commitPassiveMountEffects @ chunk-NUMECXU6.js?v=c9a7e100:18109
flushPassiveEffectsImpl @ chunk-NUMECXU6.js?v=c9a7e100:19490
flushPassiveEffects @ chunk-NUMECXU6.js?v=c9a7e100:19447
(anonymous) @ chunk-NUMECXU6.js?v=c9a7e100:19328
workLoop @ chunk-NUMECXU6.js?v=c9a7e100:197
flushWork @ chunk-NUMECXU6.js?v=c9a7e100:176
performWorkUntilDeadline @ chunk-NUMECXU6.js?v=c9a7e100:384
SoundManager.js:187 ❌ Error loading sound poof: EncodingError: Unable to decode audio data
loadSound @ SoundManager.js:187
await in loadSound
loadSoundWithFallback @ SoundManager.js:157
(anonymous) @ SoundManager.js:70
initialize @ SoundManager.js:69
(anonymous) @ GameWorld.jsx:1663
(anonymous) @ GameWorld.jsx:1691
commitHookEffectListMount @ chunk-NUMECXU6.js?v=c9a7e100:16915
commitPassiveMountOnFiber @ chunk-NUMECXU6.js?v=c9a7e100:18156
commitPassiveMountEffects_complete @ chunk-NUMECXU6.js?v=c9a7e100:18129
commitPassiveMountEffects_begin @ chunk-NUMECXU6.js?v=c9a7e100:18119
commitPassiveMountEffects @ chunk-NUMECXU6.js?v=c9a7e100:18109
flushPassiveEffectsImpl @ chunk-NUMECXU6.js?v=c9a7e100:19490
flushPassiveEffects @ chunk-NUMECXU6.js?v=c9a7e100:19447
(anonymous) @ chunk-NUMECXU6.js?v=c9a7e100:19328
workLoop @ chunk-NUMECXU6.js?v=c9a7e100:197
flushWork @ chunk-NUMECXU6.js?v=c9a7e100:176
performWorkUntilDeadline @ chunk-NUMECXU6.js?v=c9a7e100:384
SoundManager.js:187 ❌ Error loading sound enemy_hit: EncodingError: Unable to decode audio data
loadSound @ SoundManager.js:187
await in loadSound
loadSoundWithFallback @ SoundManager.js:157
(anonymous) @ SoundManager.js:70
initialize @ SoundManager.js:69
(anonymous) @ GameWorld.jsx:1663
(anonymous) @ GameWorld.jsx:1691
commitHookEffectListMount @ chunk-NUMECXU6.js?v=c9a7e100:16915
commitPassiveMountOnFiber @ chunk-NUMECXU6.js?v=c9a7e100:18156
commitPassiveMountEffects_complete @ chunk-NUMECXU6.js?v=c9a7e100:18129
commitPassiveMountEffects_begin @ chunk-NUMECXU6.js?v=c9a7e100:18119
commitPassiveMountEffects @ chunk-NUMECXU6.js?v=c9a7e100:18109
flushPassiveEffectsImpl @ chunk-NUMECXU6.js?v=c9a7e100:19490
flushPassiveEffects @ chunk-NUMECXU6.js?v=c9a7e100:19447
(anonymous) @ chunk-NUMECXU6.js?v=c9a7e100:19328
workLoop @ chunk-NUMECXU6.js?v=c9a7e100:197
flushWork @ chunk-NUMECXU6.js?v=c9a7e100:176
performWorkUntilDeadline @ chunk-NUMECXU6.js?v=c9a7e100:384
SoundManager.js:187 ❌ Error loading sound enemy_defeat: EncodingError: Unable to decode audio data
loadSound @ SoundManager.js:187
await in loadSound
loadSoundWithFallback @ SoundManager.js:157
(anonymous) @ SoundManager.js:70
initialize @ SoundManager.js:69
(anonymous) @ GameWorld.jsx:1663
(anonymous) @ GameWorld.jsx:1691
commitHookEffectListMount @ chunk-NUMECXU6.js?v=c9a7e100:16915
commitPassiveMountOnFiber @ chunk-NUMECXU6.js?v=c9a7e100:18156
commitPassiveMountEffects_complete @ chunk-NUMECXU6.js?v=c9a7e100:18129
commitPassiveMountEffects_begin @ chunk-NUMECXU6.js?v=c9a7e100:18119
commitPassiveMountEffects @ chunk-NUMECXU6.js?v=c9a7e100:18109
flushPassiveEffectsImpl @ chunk-NUMECXU6.js?v=c9a7e100:19490
flushPassiveEffects @ chunk-NUMECXU6.js?v=c9a7e100:19447
(anonymous) @ chunk-NUMECXU6.js?v=c9a7e100:19328
workLoop @ chunk-NUMECXU6.js?v=c9a7e100:197
flushWork @ chunk-NUMECXU6.js?v=c9a7e100:176
performWorkUntilDeadline @ chunk-NUMECXU6.js?v=c9a7e100:384
SoundManager.js:187 ❌ Error loading sound gameover: EncodingError: Unable to decode audio data
loadSound @ SoundManager.js:187
await in loadSound
loadSoundWithFallback @ SoundManager.js:157
(anonymous) @ SoundManager.js:70
initialize @ SoundManager.js:69
(anonymous) @ GameWorld.jsx:1663
(anonymous) @ GameWorld.jsx:1691
commitHookEffectListMount @ chunk-NUMECXU6.js?v=c9a7e100:16915
commitPassiveMountOnFiber @ chunk-NUMECXU6.js?v=c9a7e100:18156
commitPassiveMountEffects_complete @ chunk-NUMECXU6.js?v=c9a7e100:18129
commitPassiveMountEffects_begin @ chunk-NUMECXU6.js?v=c9a7e100:18119
commitPassiveMountEffects @ chunk-NUMECXU6.js?v=c9a7e100:18109
flushPassiveEffectsImpl @ chunk-NUMECXU6.js?v=c9a7e100:19490
flushPassiveEffects @ chunk-NUMECXU6.js?v=c9a7e100:19447
(anonymous) @ chunk-NUMECXU6.js?v=c9a7e100:19328
workLoop @ chunk-NUMECXU6.js?v=c9a7e100:197
flushWork @ chunk-NUMECXU6.js?v=c9a7e100:176
performWorkUntilDeadline @ chunk-NUMECXU6.js?v=c9a7e100:384
SoundManager.js:187 ❌ Error loading sound heart: EncodingError: Unable to decode audio data
loadSound @ SoundManager.js:187
await in loadSound
loadSoundWithFallback @ SoundManager.js:157
(anonymous) @ SoundManager.js:70
initialize @ SoundManager.js:69
(anonymous) @ GameWorld.jsx:1663
(anonymous) @ GameWorld.jsx:1691
commitHookEffectListMount @ chunk-NUMECXU6.js?v=c9a7e100:16915
commitPassiveMountOnFiber @ chunk-NUMECXU6.js?v=c9a7e100:18156
commitPassiveMountEffects_complete @ chunk-NUMECXU6.js?v=c9a7e100:18129
commitPassiveMountEffects_begin @ chunk-NUMECXU6.js?v=c9a7e100:18119
commitPassiveMountEffects @ chunk-NUMECXU6.js?v=c9a7e100:18109
flushPassiveEffectsImpl @ chunk-NUMECXU6.js?v=c9a7e100:19490
flushPassiveEffects @ chunk-NUMECXU6.js?v=c9a7e100:19447
(anonymous) @ chunk-NUMECXU6.js?v=c9a7e100:19328
workLoop @ chunk-NUMECXU6.js?v=c9a7e100:197
flushWork @ chunk-NUMECXU6.js?v=c9a7e100:176
performWorkUntilDeadline @ chunk-NUMECXU6.js?v=c9a7e100:384


---

_**Agent (model default, mode Agent)**_



---


Fixing the `otherPlayers` error and the prop warnings:


---

<tool-use data-tool-type="read" data-tool-name="read_file">
<details><summary>Tool use: **read_file** • Read file: /home/robwistrand/code/ga/projects/authentic-internet/client/src/components/GameWorld.jsx</summary>

</details>
</tool-use>

---

<tool-use data-tool-type="search" data-tool-name="grep">
<details>
<summary>Tool use: **grep** • Grep for "otherPlayers" in "/home/robwistrand/code/ga/projects/authentic-internet/client/src/components/GameWorld.jsx" • 1 match</summary>

Output mode: content


| File | Content | Line |
|------|------|------|
| `client/src/components/GameWorld.jsx` | `\{otherPlayers.map((player) => (` | L3023 |


</details>
</tool-use>

---

<tool-use data-tool-type="read" data-tool-name="read_file">
<details><summary>Tool use: **read_file** • Read file: /home/robwistrand/code/ga/projects/authentic-internet/client/src/components/GameWorld.jsx</summary>

</details>
</tool-use>

---

<tool-use data-tool-type="search" data-tool-name="codebase_search">
<details>
                <summary>Tool use: **codebase_search** • Searched codebase "Where is otherPlayers state defined or used in GameWorld? How is multiplayer player data managed?" • **15** results</summary>
            
| File | Lines |
|------|-------|
| `client/src/components/MultiplayerChat.jsx` | L37-114 |
| `client/src/components/GameWorld.jsx` | L3019-3056 |
| `client/src/components/GameWorld.jsx` | L79-162 |
| `client/src/components/GameWorld.jsx` | L3470-3532 |
| `client/src/components/MultiplayerChat.jsx` | L110-167 |
| `client/src/components/MultiplayerChat.jsx` | L39 |
| `client/src/components/GameWorld.jsx` | L54 |
| `client/src/components/GameWorld.jsx` | L2993-3022 |
| `client/src/components/Level4Shooter.jsx` | L49 |
| `client/src/components/TextAdventure.jsx` | L31 |
| `client/src/components/CollaborationEngine.jsx` | L55-110 |
| `client/src/components/GameWorld.jsx` | L2899-2939 |
| `client/src/components/GameWorld.jsx` | L2956-2997 |
| `client/src/components/MultiplayerChat.jsx` | L209-292 |
| `client/src/components/GameWorld.jsx` | L2856-2902 |

</details>
</tool-use>

---



---


Fixing the `otherPlayers` error and the prop warnings:


---

<tool-use data-tool-type="read" data-tool-name="read_file">
<details><summary>Tool use: **read_file** • Read file: /home/robwistrand/code/ga/projects/authentic-internet/client/src/components/GameWorld.jsx</summary>

</details>
</tool-use>

---

<tool-use data-tool-type="search" data-tool-name="grep">
<details>
<summary>Tool use: **grep** • Grep for "worldId|const worldId" in "/home/robwistrand/code/ga/projects/authentic-internet/client/src/components/GameWorld.jsx" • 4 matches</summary>

Output mode: content


| File | Content | Line |
|------|------|------|
| `client/src/components/GameWorld.jsx` | `worldId: MAPS[currentMapIndex].name,` | L2002 |
| `client/src/components/GameWorld.jsx` | `(worldId) => \{` | L2195 |
| `client/src/components/GameWorld.jsx` | `if (worldId === "hemingway") \{` | L2197 |
| `client/src/components/GameWorld.jsx` | `\} else if (worldId === "text_adventure") \{` | L2200 |


</details>
</tool-use>

---

<tool-use data-tool-type="read" data-tool-name="read_file">
<details><summary>Tool use: **read_file** • Read file: /home/robwistrand/code/ga/projects/authentic-internet/client/src/components/Map.jsx</summary>

</details>
</tool-use>

---

<tool-use data-tool-type="write" data-tool-name="search_replace">

<details><summary>Tool use: **search_replace** • Edit file: /home/robwistrand/code/ga/projects/authentic-internet/client/src/components/GameWorld.jsx</summary>

**Chunk 1**
Lines added: 1, lines removed: undefined

```diff
@@ -86,4 +86,5 @@
    const [isInitialized, setIsInitialized] = useState(false);
    const [showLevelUpModal, setShowLevelUpModal] = useState(false);
+   const [otherPlayers, setOtherPlayers] = useState([]);
  
    // Use the custom game state hook
```

</details>

</tool-use>

---

<tool-use data-tool-type="write" data-tool-name="search_replace">

<details><summary>Tool use: **search_replace** • Edit file: /home/robwistrand/code/ga/projects/authentic-internet/client/src/components/GameWorld.jsx</summary>

**Chunk 1**
Lines added: 12, lines removed: 9

```diff
@@ -2876,13 +2876,16 @@
  
            {/* === CORE GAME WORLD === */}
-           &lt;MapComponent
-             currentMapIndex={currentMapIndex}
-             exploredTiles={exploredTiles}
-             viewport={viewport}
-             characterPosition={characterPosition}
-             artifacts={gameState.gameData.artifacts}
-             showArtifactsOnMap={uiState.showArtifactsOnMap}
-             inDungeon={uiState.inDungeon}
-           /&gt;
+           {MAPS[currentMapIndex]?.data &amp;&amp; (
+             &lt;MapComponent
+               currentMapIndex={currentMapIndex}
+               mapData={MAPS[currentMapIndex].data}
+               exploredTiles={exploredTiles}
+               viewport={viewport}
+               characterPosition={characterPosition}
+               artifacts={gameState.gameData.artifacts}
+               showArtifactsOnMap={uiState.showArtifactsOnMap}
+               inDungeon={uiState.inDungeon}
+             /&gt;
+           )}
  
            &lt;Character
```

</details>

</tool-use>

---

<tool-use data-tool-type="read" data-tool-name="read_file">
<details><summary>Tool use: **read_file** • Read file: /home/robwistrand/code/ga/projects/authentic-internet/client/src/components/GameWorld.jsx</summary>

</details>
</tool-use>

---

<tool-use data-tool-type="generic" data-tool-name="read_lints">
<details>
          <summary>Tool use: **read_lints** • Read lints for 1 file</summary>
      
Lint paths:

- `client/src/components/GameWorld.jsx`

Lint results


**No lint errors found**
</details>
</tool-use>

---



---


Fixing the `worldId` reference and ensuring `otherPlayers` is properly initialized:


---

<tool-use data-tool-type="read" data-tool-name="read_file">
<details><summary>Tool use: **read_file** • Read file: /home/robwistrand/code/ga/projects/authentic-internet/client/src/components/GameWorld.jsx</summary>

</details>
</tool-use>

---

<tool-use data-tool-type="write" data-tool-name="search_replace">

<details><summary>Tool use: **search_replace** • Edit file: /home/robwistrand/code/ga/projects/authentic-internet/client/src/components/GameWorld.jsx</summary>

**Chunk 1**
Lines added: 2, lines removed: 2

```diff
@@ -3519,6 +3519,6 @@
  
            &lt;MultiplayerChat
-             worldId={worldId}
-             worldName={MAPS[gameState.currentMapIndex]?.name || "Unknown World"}
+             worldId={MAPS[currentMapIndex]?.name || "overworld"}
+             worldName={MAPS[currentMapIndex]?.name || "Unknown World"}
              onPlayerClick={(player) =&gt; {
                console.log("Player clicked:", player);
```

</details>

</tool-use>

---

<tool-use data-tool-type="generic" data-tool-name="read_lints">
<details>
          <summary>Tool use: **read_lints** • Read lints for 1 file</summary>
      
Lint paths:

- `client/src/components/GameWorld.jsx`

Lint results


**No lint errors found**
</details>
</tool-use>

---



---


Fixed the issues:

1. **Added `otherPlayers` state** - Initialized as an empty array `useState([])` to prevent the reference error

2. **Fixed first `MapComponent` missing `mapData` prop** - Added the `mapData` prop and wrapped it in a conditional check to ensure `MAPS[currentMapIndex]?.data` exists before rendering

3. **Fixed `worldId` reference** - Changed from undefined `worldId` to `MAPS[currentMapIndex]?.name || "overworld"` in the `MultiplayerChat` component

4. **Character position safety** - Already has a default value `{ x: 64, y: 64 }` if undefined, which should handle the prop warnings

These changes should resolve the `otherPlayers` reference error and the prop warnings. The component should now render without these errors.

---

